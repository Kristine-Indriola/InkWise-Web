document.addEventListener("DOMContentLoaded",function(){const a=document.querySelector(".create-form"),i=document.getElementById("design");a&&i&&a.addEventListener("submit",function(){i.value=JSON.stringify({text:"Please join us...",bride:"ELEANOR",groom:"VINCENT",date:"25 October 2025"})});const e=document.getElementById("previewModal"),s=document.getElementById("modalImg"),l=document.getElementById("closePreview");e&&s&&l&&(document.querySelectorAll(".preview-thumb").forEach(function(o){o.addEventListener("click",function(){s.src=o.dataset.img,e.classList.add("is-visible")})}),l.addEventListener("click",function(){e.classList.remove("is-visible"),s.src=""}),e.addEventListener("click",function(o){o.target===this&&(e.classList.remove("is-visible"),s.src="")})),document.querySelectorAll(".video-swatches").forEach(o=>{const c=o.closest(".w-full");if(!c)return;const t=c.querySelector(".template-video"),d=c.querySelector(".template-image"),n=t?t.querySelector("source"):null;o.querySelectorAll(".swatch-btn").forEach(r=>{r.addEventListener("click",()=>{if(!(t&&d&&n))return;const m=r.getAttribute("data-video"),f=r.getAttribute("data-image");m&&(d.classList.add("hidden"),t.classList.remove("hidden"),n.src!==m&&(n.src=m,t.load()),t.play()),f&&(d.src=f,d.classList.remove("hidden"),t.classList.add("hidden"))})})}),document.querySelectorAll(".btn-upload").forEach(o=>{o.addEventListener("click",function(c){c.preventDefault();let t=o.getAttribute("data-url");if(!t){const n=o.closest("form");t=n?n.getAttribute("action"):o.getAttribute("href")}if(!t){u("Upload URL not found",!0);return}o.classList.add("disabled"),o.setAttribute("aria-disabled","true");let d=document.querySelector("meta[name=csrf-token]")?document.querySelector("meta[name=csrf-token]").getAttribute("content"):"";if(!d){const n=o.closest("form");if(n){const r=n.querySelector("input[name=_token]");r&&(d=r.value)}}fetch(t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":d,Accept:"application/json"}}).then(n=>{if(n.ok)return n.json().catch(()=>({}));throw new Error("Upload failed")}).then(n=>{const r=o.closest(".template-card");r&&r.remove(),n.success?u("Sent"):n&&n.existing?u("Already exists"):u("Sent")}).catch(n=>{console.error(n),u("Failed to send template",!0),o.classList.remove("disabled"),o.removeAttribute("aria-disabled")})})});function u(o,c=!1){let t=document.getElementById("tw-toast");t||(t=document.createElement("div"),t.id="tw-toast",t.className="tw-toast",document.body.appendChild(t)),t.textContent=o,t.classList.toggle("error",!!c),t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),3e3)}});document.addEventListener("DOMContentLoaded",function(){console.log("Template dropdown script loaded");const a=document.querySelector(".create-dropdown-container"),i=document.querySelector(".dropdown-toggle"),e=document.querySelector(".create-dropdown-menu");console.log("Found elements:",{container:!!a,toggle:!!i,menu:!!e}),a&&i&&e?(console.log("All dropdown elements found, attaching event listeners"),e.style.display="none",e.setAttribute("aria-hidden","true"),i.addEventListener("click",function(s){console.log("Dropdown toggle clicked"),s.preventDefault(),s.stopPropagation();const l=e.style.display==="block";console.log("Dropdown currently visible:",l),l?(e.style.display="none",e.setAttribute("aria-hidden","true"),i.setAttribute("aria-expanded","false"),console.log("Dropdown hidden")):(e.style.display="block",e.setAttribute("aria-hidden","false"),i.setAttribute("aria-expanded","true"),console.log("Dropdown shown"))}),document.addEventListener("click",function(s){a.contains(s.target)||(e.style.display="none",e.setAttribute("aria-hidden","true"),i.setAttribute("aria-expanded","false"))}),document.addEventListener("keydown",function(s){s.key==="Escape"&&(e.style.display="none",e.setAttribute("aria-hidden","true"),i.setAttribute("aria-expanded","false"))}),e.addEventListener("click",function(s){s.target.closest(".dropdown-item")&&(e.style.display="none",e.setAttribute("aria-hidden","true"),i.setAttribute("aria-expanded","false"))})):console.error("Dropdown elements not found - this may cause the create template button to not work")});
