var ri=Object.defineProperty;var ni=(e,t,r)=>t in e?ri(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Hr=(e,t,r)=>ni(e,typeof t!="symbol"?t+"":t,r);import{g as ii,r as l,R as Ba,j as a,a as si,c as oi}from"./client-Cv0X-2PX.js";var rr={exports:{}},nr,Wr;function li(){if(Wr)return nr;Wr=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return nr=e,nr}var ir,Ur;function ci(){if(Ur)return ir;Ur=1;var e=li();function t(){}function r(){}return r.resetWarningCache=t,ir=function(){function i(m,f,p,b,v,w){if(w!==e){var R=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw R.name="Invariant Violation",R}}i.isRequired=i;function s(){return i}var d={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:s,element:i,elementType:i,instanceOf:s,node:i,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:r,resetWarningCache:t};return d.PropTypes=d,d},ir}var Or;function di(){return Or||(Or=1,rr.exports=ci()()),rr.exports}var ui=di();const V=ii(ui);function hi(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const r=document.implementation.createHTMLDocument(),i=r.createElement("base"),s=r.createElement("a");return r.head.appendChild(i),r.body.appendChild(s),t&&(i.href=t),s.href=e,s.href}const fi=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function wt(e){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r]);return t}let Ut=null;function bn(e={}){return Ut||(e.includeStyleProperties?(Ut=e.includeStyleProperties,Ut):(Ut=wt(window.getComputedStyle(document.documentElement)),Ut))}function za(e,t){const i=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return i?parseFloat(i.replace("px","")):0}function mi(e){const t=za(e,"border-left-width"),r=za(e,"border-right-width");return e.clientWidth+t+r}function gi(e){const t=za(e,"border-top-width"),r=za(e,"border-bottom-width");return e.clientHeight+t+r}function yn(e,t={}){const r=t.width||mi(e),i=t.height||gi(e);return{width:r,height:i}}function pi(){let e,t;try{t=process}catch{}const r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const Fe=16384;function bi(e){(e.width>Fe||e.height>Fe)&&(e.width>Fe&&e.height>Fe?e.width>e.height?(e.height*=Fe/e.width,e.width=Fe):(e.width*=Fe/e.height,e.height=Fe):e.width>Fe?(e.height*=Fe/e.width,e.width=Fe):(e.width*=Fe/e.height,e.height=Fe))}function Fa(e){return new Promise((t,r)=>{const i=new Image;i.onload=()=>{i.decode().then(()=>{requestAnimationFrame(()=>t(i))})},i.onerror=r,i.crossOrigin="anonymous",i.decoding="async",i.src=e})}async function yi(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function vi(e,t,r){const i="http://www.w3.org/2000/svg",s=document.createElementNS(i,"svg"),d=document.createElementNS(i,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${r}`),s.setAttribute("viewBox",`0 0 ${t} ${r}`),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("externalResourcesRequired","true"),s.appendChild(d),d.appendChild(e),yi(s)}const _e=(e,t)=>{if(e instanceof t)return!0;const r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||_e(r,t)};function wi(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function xi(e,t){return bn(t).map(r=>{const i=e.getPropertyValue(r),s=e.getPropertyPriority(r);return`${r}: ${i}${s?" !important":""};`}).join(" ")}function Si(e,t,r,i){const s=`.${e}:${t}`,d=r.cssText?wi(r):xi(r,i);return document.createTextNode(`${s}{${d}}`)}function $r(e,t,r,i){const s=window.getComputedStyle(e,r),d=s.getPropertyValue("content");if(d===""||d==="none")return;const m=fi();try{t.className=`${t.className} ${m}`}catch{return}const f=document.createElement("style");f.appendChild(Si(m,r,s,i)),t.appendChild(f)}function Ii(e,t,r){$r(e,t,":before",r),$r(e,t,":after",r)}const Yr="application/font-woff",Zr="image/jpeg",Mi={woff:Yr,woff2:Yr,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Zr,jpeg:Zr,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ji(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function yr(e){const t=ji(e).toLowerCase();return Mi[t]||""}function Ni(e){return e.split(/,/)[1]}function hr(e){return e.search(/^(data:)/)!==-1}function Ci(e,t){return`data:${t};base64,${e}`}async function vn(e,t,r){const i=await fetch(e,t);if(i.status===404)throw new Error(`Resource "${i.url}" not found`);const s=await i.blob();return new Promise((d,m)=>{const f=new FileReader;f.onerror=m,f.onloadend=()=>{try{d(r({res:i,result:f.result}))}catch(p){m(p)}},f.readAsDataURL(s)})}const sr={};function ki(e,t,r){let i=e.replace(/\?.*/,"");return r&&(i=e),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),t?`[${t}]${i}`:i}async function vr(e,t,r){const i=ki(e,t,r.includeQueryParams);if(sr[i]!=null)return sr[i];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let s;try{const d=await vn(e,r.fetchRequestInit,({res:m,result:f})=>(t||(t=m.headers.get("Content-Type")||""),Ni(f)));s=Ci(d,t)}catch(d){s=r.imagePlaceholder||"";let m=`Failed to fetch resource: ${e}`;d&&(m=typeof d=="string"?d:d.message),m&&console.warn(m)}return sr[i]=s,s}async function _i(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):Fa(t)}async function Pi(e,t){if(e.currentSrc){const d=document.createElement("canvas"),m=d.getContext("2d");d.width=e.clientWidth,d.height=e.clientHeight,m==null||m.drawImage(e,0,0,d.width,d.height);const f=d.toDataURL();return Fa(f)}const r=e.poster,i=yr(r),s=await vr(r,i,t);return Fa(s)}async function Ri(e,t){var r;try{if(!((r=e==null?void 0:e.contentDocument)===null||r===void 0)&&r.body)return await Ha(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function Ai(e,t){return _e(e,HTMLCanvasElement)?_i(e):_e(e,HTMLVideoElement)?Pi(e,t):_e(e,HTMLIFrameElement)?Ri(e,t):e.cloneNode(wn(e))}const Ei=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",wn=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function Li(e,t,r){var i,s;if(wn(t))return t;let d=[];return Ei(e)&&e.assignedNodes?d=wt(e.assignedNodes()):_e(e,HTMLIFrameElement)&&(!((i=e.contentDocument)===null||i===void 0)&&i.body)?d=wt(e.contentDocument.body.childNodes):d=wt(((s=e.shadowRoot)!==null&&s!==void 0?s:e).childNodes),d.length===0||_e(e,HTMLVideoElement)||await d.reduce((m,f)=>m.then(()=>Ha(f,r)).then(p=>{p&&t.appendChild(p)}),Promise.resolve()),t}function zi(e,t,r){const i=t.style;if(!i)return;const s=window.getComputedStyle(e);s.cssText?(i.cssText=s.cssText,i.transformOrigin=s.transformOrigin):bn(r).forEach(d=>{let m=s.getPropertyValue(d);d==="font-size"&&m.endsWith("px")&&(m=`${Math.floor(parseFloat(m.substring(0,m.length-2)))-.1}px`),_e(e,HTMLIFrameElement)&&d==="display"&&m==="inline"&&(m="block"),d==="d"&&t.getAttribute("d")&&(m=`path(${t.getAttribute("d")})`),i.setProperty(d,m,s.getPropertyPriority(d))})}function Fi(e,t){_e(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),_e(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function Di(e,t){if(_e(e,HTMLSelectElement)){const i=Array.from(t.children).find(s=>e.value===s.getAttribute("value"));i&&i.setAttribute("selected","")}}function Ti(e,t,r){return _e(t,Element)&&(zi(e,t,r),Ii(e,t,r),Fi(e,t),Di(e,t)),t}async function Bi(e,t){const r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;const i={};for(let d=0;d<r.length;d++){const f=r[d].getAttribute("xlink:href");if(f){const p=e.querySelector(f),b=document.querySelector(f);!p&&b&&!i[f]&&(i[f]=await Ha(b,t,!0))}}const s=Object.values(i);if(s.length){const d="http://www.w3.org/1999/xhtml",m=document.createElementNS(d,"svg");m.setAttribute("xmlns",d),m.style.position="absolute",m.style.width="0",m.style.height="0",m.style.overflow="hidden",m.style.display="none";const f=document.createElementNS(d,"defs");m.appendChild(f);for(let p=0;p<s.length;p++)f.appendChild(s[p]);e.appendChild(m)}return e}async function Ha(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(i=>Ai(i,t)).then(i=>Li(e,i,t)).then(i=>Ti(e,i,t)).then(i=>Bi(i,t))}const xn=/url\((['"]?)([^'"]+?)\1\)/g,Hi=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Wi=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ui(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Oi(e){const t=[];return e.replace(xn,(r,i,s)=>(t.push(s),r)),t.filter(r=>!hr(r))}async function $i(e,t,r,i,s){try{const d=r?hi(t,r):t,m=yr(t);let f;return s||(f=await vr(d,m,i)),e.replace(Ui(t),`$1${f}$3`)}catch{}return e}function Yi(e,{preferredFontFormat:t}){return t?e.replace(Wi,r=>{for(;;){const[i,,s]=Hi.exec(r)||[];if(!s)return"";if(s===t)return`src: ${i};`}}):e}function Sn(e){return e.search(xn)!==-1}async function In(e,t,r){if(!Sn(e))return e;const i=Yi(e,r);return Oi(i).reduce((d,m)=>d.then(f=>$i(f,m,t,r)),Promise.resolve(i))}async function Ot(e,t,r){var i;const s=(i=t.style)===null||i===void 0?void 0:i.getPropertyValue(e);if(s){const d=await In(s,null,r);return t.style.setProperty(e,d,t.style.getPropertyPriority(e)),!0}return!1}async function Zi(e,t){await Ot("background",e,t)||await Ot("background-image",e,t),await Ot("mask",e,t)||await Ot("-webkit-mask",e,t)||await Ot("mask-image",e,t)||await Ot("-webkit-mask-image",e,t)}async function Gi(e,t){const r=_e(e,HTMLImageElement);if(!(r&&!hr(e.src))&&!(_e(e,SVGImageElement)&&!hr(e.href.baseVal)))return;const i=r?e.src:e.href.baseVal,s=await vr(i,yr(i),t);await new Promise((d,m)=>{e.onload=d,e.onerror=t.onImageErrorHandler?(...p)=>{try{d(t.onImageErrorHandler(...p))}catch(b){m(b)}}:m;const f=e;f.decode&&(f.decode=d),f.loading==="lazy"&&(f.loading="eager"),r?(e.srcset="",e.src=s):e.href.baseVal=s})}async function Qi(e,t){const i=wt(e.childNodes).map(s=>Mn(s,t));await Promise.all(i).then(()=>e)}async function Mn(e,t){_e(e,Element)&&(await Zi(e,t),await Gi(e,t),await Qi(e,t))}function Xi(e,t){const{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);const i=t.style;return i!=null&&Object.keys(i).forEach(s=>{r[s]=i[s]}),e}const Gr={};async function Qr(e){let t=Gr[e];if(t!=null)return t;const i=await(await fetch(e)).text();return t={url:e,cssText:i},Gr[e]=t,t}async function Xr(e,t){let r=e.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,d=(r.match(/url\([^)]+\)/g)||[]).map(async m=>{let f=m.replace(i,"$1");return f.startsWith("https://")||(f=new URL(f,e.url).href),vn(f,t.fetchRequestInit,({result:p})=>(r=r.replace(m,`url(${p})`),[m,p]))});return Promise.all(d).then(()=>r)}function qr(e){if(e==null)return[];const t=[],r=/(\/\*[\s\S]*?\*\/)/gi;let i=e.replace(r,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const p=s.exec(i);if(p===null)break;t.push(p[0])}i=i.replace(s,"");const d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,m="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",f=new RegExp(m,"gi");for(;;){let p=d.exec(i);if(p===null){if(p=f.exec(i),p===null)break;d.lastIndex=f.lastIndex}else f.lastIndex=d.lastIndex;t.push(p[0])}return t}async function qi(e,t){const r=[],i=[];return e.forEach(s=>{if("cssRules"in s)try{wt(s.cssRules||[]).forEach((d,m)=>{if(d.type===CSSRule.IMPORT_RULE){let f=m+1;const p=d.href,b=Qr(p).then(v=>Xr(v,t)).then(v=>qr(v).forEach(w=>{try{s.insertRule(w,w.startsWith("@import")?f+=1:s.cssRules.length)}catch(R){console.error("Error inserting rule from remote css",{rule:w,error:R})}})).catch(v=>{console.error("Error loading remote css",v.toString())});i.push(b)}})}catch(d){const m=e.find(f=>f.href==null)||document.styleSheets[0];s.href!=null&&i.push(Qr(s.href).then(f=>Xr(f,t)).then(f=>qr(f).forEach(p=>{m.insertRule(p,m.cssRules.length)})).catch(f=>{console.error("Error loading remote stylesheet",f)})),console.error("Error inlining remote css file",d)}}),Promise.all(i).then(()=>(e.forEach(s=>{if("cssRules"in s)try{wt(s.cssRules||[]).forEach(d=>{r.push(d)})}catch(d){console.error(`Error while reading CSS rules from ${s.href}`,d)}}),r))}function Vi(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Sn(t.style.getPropertyValue("src")))}async function Ji(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const r=wt(e.ownerDocument.styleSheets),i=await qi(r,t);return Vi(i)}function jn(e){return e.trim().replace(/["']/g,"")}function Ki(e){const t=new Set;function r(i){(i.style.fontFamily||getComputedStyle(i).fontFamily).split(",").forEach(d=>{t.add(jn(d))}),Array.from(i.children).forEach(d=>{d instanceof HTMLElement&&r(d)})}return r(e),t}async function es(e,t){const r=await Ji(e,t),i=Ki(e);return(await Promise.all(r.filter(d=>i.has(jn(d.style.fontFamily))).map(d=>{const m=d.parentStyleSheet?d.parentStyleSheet.href:null;return In(d.cssText,m,t)}))).join(`
`)}async function ts(e,t){const r=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await es(e,t);if(r){const i=document.createElement("style"),s=document.createTextNode(r);i.appendChild(s),e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}}async function Nn(e,t={}){const{width:r,height:i}=yn(e,t),s=await Ha(e,t,!0);return await ts(s,t),await Mn(s,t),Xi(s,t),await vi(s,r,i)}async function Cn(e,t={}){const{width:r,height:i}=yn(e,t),s=await Nn(e,t),d=await Fa(s),m=document.createElement("canvas"),f=m.getContext("2d"),p=t.pixelRatio||pi(),b=t.canvasWidth||r,v=t.canvasHeight||i;return m.width=b*p,m.height=v*p,t.skipAutoScale||bi(m),m.style.width=`${b}`,m.style.height=`${v}`,t.backgroundColor&&(f.fillStyle=t.backgroundColor,f.fillRect(0,0,m.width,m.height)),f.drawImage(d,0,0,m.width,m.height),m}async function as(e,t={}){return(await Cn(e,t)).toDataURL()}async function rs(e,t={}){return(await Cn(e,t)).toDataURL("image/jpeg",t.quality||1)}const ns="modulepreload",is=function(e){return"/build/"+e},Vr={},fa=function(t,r,i){let s=Promise.resolve();if(r&&r.length>0){let m=function(b){return Promise.all(b.map(v=>Promise.resolve(v).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),p=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=m(r.map(b=>{if(b=is(b),b in Vr)return;Vr[b]=!0;const v=b.endsWith(".css"),w=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${w}`))return;const R=document.createElement("link");if(R.rel=v?"stylesheet":ns,v||(R.as="script"),R.crossOrigin="",R.href=b,p&&R.setAttribute("nonce",p),document.head.appendChild(R),v)return new Promise((z,O)=>{R.addEventListener("load",z),R.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(m){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=m,window.dispatchEvent(f),!f.defaultPrevented)throw m}return s.then(m=>{for(const f of m||[])f.status==="rejected"&&d(f.reason);return t().catch(d)})};let or=0,Yt=0;const Jr=["#2563eb","#dc2626","#059669","#f59e0b","#7c3aed"];function ss(e,t,r){var m;const i=(e==null?void 0:e.id)??`layer-${Yt===0?t:Yt}`;Yt+=1;const s=(e==null?void 0:e.type)??(e==null?void 0:e.kind)??"shape",d=kn((e==null?void 0:e.frame)||((m=e==null?void 0:e.metadata)==null?void 0:m.frame)||null,r,s,t);return{id:i,name:(e==null?void 0:e.name)??`Layer ${t+1}`,type:s,visible:(e==null?void 0:e.visible)!==void 0?!!e.visible:!0,locked:(e==null?void 0:e.locked)!==void 0?!!e.locked:!1,opacity:typeof(e==null?void 0:e.opacity)=="number"?e.opacity:1,frame:d,fill:(e==null?void 0:e.fill)??(e==null?void 0:e.color)??_n(s),stroke:(e==null?void 0:e.stroke)??(e==null?void 0:e.border)??null,content:(e==null?void 0:e.content)??(e==null?void 0:e.text)??"",fontSize:typeof(e==null?void 0:e.fontSize)=="number"?e.fontSize:42,fontFamily:(e==null?void 0:e.fontFamily)??"Inter, sans-serif",fontWeight:(e==null?void 0:e.fontWeight)??"400",textAlign:(e==null?void 0:e.textAlign)??"center",borderRadius:typeof(e==null?void 0:e.borderRadius)=="number"?e.borderRadius:Pn(s),metadata:(e==null?void 0:e.metadata)??{}}}function kn(e,t,r,i=0){if(!e){if(!t)return null;const d=48,m=Math.round(t.width*.6),f=Math.min(200,Math.round(t.height*.22)),p=i*32;return{x:d+p%120,y:d+p,width:r==="text"?Math.max(320,m):m,height:r==="text"?Math.max(120,Math.round(t.height*.12)):f,rotation:0}}const s=d=>typeof d=="number"?d:parseFloat(d);return{x:s(e.x)||0,y:s(e.y)||0,width:Math.max(1,s(e.width)||1),height:Math.max(1,s(e.height)||1),rotation:s(e.rotation)||0}}function fr(e,t=0){const r=(e==null?void 0:e.id)??`page-${or===0?t:or}`;or+=1;const i=Array.isArray(e==null?void 0:e.nodes)?e.nodes.map((s,d)=>ss(s,d,e)):[];return{id:r,name:(e==null?void 0:e.name)??`Page ${t+1}`,width:(e==null?void 0:e.width)??400,height:(e==null?void 0:e.height)??400,background:(e==null?void 0:e.background)??"#ffffff",safeZone:(e==null?void 0:e.safeZone)??null,bleed:(e==null?void 0:e.bleed)??null,nodes:i,metadata:(e==null?void 0:e.metadata)??{}}}function De(e="shape",t=null,r={}){var f;const i=r.id??`layer-${Yt}`;Yt+=1;const d=(r.frame?{...r.frame}:null)||(t?kn(null,t,e,((f=t.nodes)==null?void 0:f.length)??0):null),m=r.fill??_n(e);return{id:i,name:r.name??os(e),type:e,visible:r.visible!==void 0?r.visible:!0,locked:r.locked??!1,opacity:typeof r.opacity=="number"?r.opacity:1,frame:d,fill:m,stroke:r.stroke??null,content:r.content??(e==="text"?"Double-click to edit text":""),fontSize:r.fontSize??(e==="text"?48:null),fontFamily:r.fontFamily??"Inter, sans-serif",fontWeight:r.fontWeight??(e==="text"?"400":void 0),textAlign:r.textAlign??"center",borderRadius:r.borderRadius??Pn(e,r.variant),variant:r.variant??(e==="shape"?"rectangle":null),metadata:{...r.metadata??{}}}}function os(e){return e==="text"?"Text box":e==="image"?"Image placeholder":"Shape"}function _n(e){switch(e){case"text":return"#0f172a";case"image":return"rgba(148, 163, 184, 0.2)";default:return Jr[Yt%Jr.length]}}function Pn(e,t){return e==="shape"&&(t==="circle"||t==="ellipse")?9999:e==="shape"?16:0}const Rn=l.createContext(null);function ls(e){var r;const t=(r=e==null?void 0:e.design)==null?void 0:r.pages;return Array.isArray(t)&&t.length>0?t.map((i,s)=>fr(i,s)):[fr(null,0)]}const cs=({template:e})=>{var m,f;const t=ls(e),r=((m=t[0])==null?void 0:m.id)??"page-0",i=(f=e==null?void 0:e.design)==null?void 0:f.activePageId,d=t.some(p=>p.id===i)?i:r;return{template:e,pages:t,activePageId:d,selectedLayerId:Da(t,d),zoom:1,panX:0,panY:0,layersPanelOpen:!0,inspectorOpen:!0,recentlyUploadedImages:[],showPreviewModal:!1,history:{undoStack:[],redoStack:[]}}};function ds(e,t){var r,i,s,d,m,f;switch(t.type){case"SELECT_PAGE":return{...e,activePageId:t.pageId,selectedLayerId:Da(e.pages,t.pageId)};case"ADD_PAGE":{const p=fr(t.page,e.pages.length),b=[...e.pages,p];return Ke(e,b,{activePageId:p.id,selectedLayerId:((r=p.nodes[0])==null?void 0:r.id)??null})}case"DELETE_PAGE":{if(e.pages.length<=1)return e;const p=e.pages.findIndex(R=>R.id===t.pageId);if(p===-1)return e;const b=e.pages.filter(R=>R.id!==t.pageId);let v=e.activePageId;if(t.pageId===e.activePageId){const R=p>0?p-1:0;v=((i=b[R])==null?void 0:i.id)??((s=b[0])==null?void 0:s.id)??null}const w=Da(b,v);return Ke(e,b,{activePageId:v,selectedLayerId:w})}case"UPDATE_PAGE_NAME":{const p=e.pages.map(b=>b.id===t.pageId?{...b,name:t.name}:b);return Ke(e,p)}case"UPDATE_PAGE_PROPS":{const p=e.pages.map(b=>b.id===t.pageId?{...b,...t.props}:b);return Ke(e,p)}case"SELECT_LAYER":return{...e,selectedLayerId:t.layerId};case"UPDATE_LAYER_PROPS":{const p=e.pages.map(b=>{if(b.id!==t.pageId)return b;const v=b.nodes.map(w=>w.id===t.layerId?{...w,...t.props}:w);return{...b,nodes:v}});return Ke(e,p,{selectedLayerId:Aa(e,p,t.layerId)})}case"ADD_LAYER":{const p=e.pages.map(b=>{if(b.id!==t.pageId)return b;const v=[...b.nodes,t.layer];return{...b,nodes:v}});return Ke(e,p,{selectedLayerId:t.layer.id})}case"REMOVE_LAYER":{const p=e.pages.map(v=>{if(v.id!==t.pageId)return v;const w=v.nodes.filter(R=>R.id!==t.layerId);return{...v,nodes:w}}),b=Aa(e,p,null);return Ke(e,p,{selectedLayerId:b})}case"DUPLICATE_LAYER":{const p=e.pages.map(v=>{if(v.id!==t.pageId)return v;const w=v.nodes.find(z=>z.id===t.layerId);if(!w)return v;const R={...De(w.type,v,{...w,id:void 0,name:`${w.name} copy`,frame:w.frame?{...w.frame,x:w.frame.x+24,y:w.frame.y+24}:w.frame})};return{...v,nodes:[...v.nodes,R]}}),b=(d=p.find(v=>v.id===t.pageId))==null?void 0:d.nodes.slice(-1)[0];return Ke(e,p,{selectedLayerId:(b==null?void 0:b.id)??e.selectedLayerId})}case"REORDER_LAYER":{const p=e.pages.map(b=>{if(b.id!==t.pageId)return b;const v=b.nodes.findIndex(z=>z.id===t.layerId);if(v===-1)return b;const w=[...b.nodes],[R]=w.splice(v,1);if(t.direction==="FORWARD")w.splice(Math.min(w.length,v+1),0,R);else if(t.direction==="BACKWARD")w.splice(Math.max(0,v-1),0,R);else if(t.direction==="FRONT")w.push(R);else if(t.direction==="BACK")w.unshift(R);else if(typeof t.position=="number"){const z=Math.max(0,Math.min(w.length,t.position));w.splice(z,0,R)}else w.push(R);return{...b,nodes:w}});return Ke(e,p)}case"BEGIN_LAYER_TRANSFORM":return{...e,history:An(e)};case"UPDATE_LAYER_FRAME":{const p=e.pages.map(b=>{if(b.id!==t.pageId)return b;const v=b.nodes.map(w=>{if(w.id!==t.layerId||w.locked)return w;const R=us(w.frame,t.frame,b);return{...w,frame:R}});return{...b,nodes:v}});return Ke(e,p,{selectedLayerId:t.layerId},t.trackHistory!==!1)}case"NUDGE_LAYER":{const p=e.pages.find(z=>z.id===t.pageId);if(!p)return e;const b=p.nodes.find(z=>z.id===t.layerId);if(!b||b.locked)return e;const v=t.dx??0,w=t.dy??0,R=e.pages.map(z=>{if(z.id!==t.pageId)return z;const O=z.nodes.map($=>{if($.id!==t.layerId)return $;const re=$.frame??En(z);return{...$,frame:{...re,x:Math.round(re.x+v),y:Math.round(re.y+w)}}});return{...z,nodes:O}});return Ke(e,R,{selectedLayerId:t.layerId},t.trackHistory!==!1)}case"UPDATE_ZOOM":{const p=Math.min(Math.max(t.value,.25),3);return{...e,zoom:Number(p.toFixed(2))}}case"UPDATE_PAN":return{...e,panX:t.panX,panY:t.panY};case"SET_LAYERS_PANEL_OPEN":return{...e,layersPanelOpen:t.open};case"ADD_RECENTLY_UPLOADED_IMAGE":{const v=[{id:`recent-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,dataUrl:t.dataUrl,fileName:t.fileName,uploadedAt:new Date().toISOString()},...e.recentlyUploadedImages.filter(w=>w.dataUrl!==t.dataUrl)].slice(0,10);return{...e,recentlyUploadedImages:v}}case"DELETE_RECENTLY_UPLOADED_IMAGE":{const p=t.id,b=(e.recentlyUploadedImages||[]).filter(v=>v.id!==p);return{...e,recentlyUploadedImages:b}}case"SET_RECENTLY_UPLOADED_IMAGES":return{...e,recentlyUploadedImages:Array.isArray(t.images)?t.images:[]};case"PUSH_HISTORY":return{...e,history:{undoStack:[...e.history.undoStack,t.snapshot],redoStack:[]}};case"UNDO":{if(e.history.undoStack.length===0)return e;const p=[...e.history.undoStack],b=p.pop(),v=ha(b.pages),w=v.some(z=>z.id===e.activePageId)?e.activePageId:((m=v[0])==null?void 0:m.id)??null,R=Aa(e,v,e.selectedLayerId,w);return{...e,pages:v,activePageId:w,selectedLayerId:R,history:{undoStack:p,redoStack:[{pages:ha(e.pages)},...e.history.redoStack]}}}case"REDO":{if(e.history.redoStack.length===0)return e;const[p,...b]=e.history.redoStack,v=ha(p.pages),w=v.some(z=>z.id===e.activePageId)?e.activePageId:((f=v[0])==null?void 0:f.id)??null,R=Aa(e,v,e.selectedLayerId,w);return{...e,pages:v,activePageId:w,selectedLayerId:R,history:{undoStack:[...e.history.undoStack,{pages:ha(e.pages)}],redoStack:b}}}case"SHOW_PREVIEW_MODAL":return{...e,showPreviewModal:!0};case"HIDE_PREVIEW_MODAL":return{...e,showPreviewModal:!1};default:return e}}function wr({template:e,routes:t,flags:r,user:i,csrfToken:s,children:d}){const[m,f]=l.useReducer(ds,{template:e},cs);Ba.useEffect(()=>{let b=!0;async function v(){try{const R=await(await fa(()=>import("./recentImagesDB-CO6kquVm.js"),[])).getAllImages();if(!b)return;const z=R.slice().sort((O,$)=>new Date($.uploadedAt)-new Date(O.uploadedAt)).slice(0,10).map(O=>({id:O.id,dataUrl:O.blob?URL.createObjectURL(O.blob):"",fileName:O.fileName,uploadedAt:O.uploadedAt}));f({type:"SET_RECENTLY_UPLOADED_IMAGES",images:z})}catch{}}return v(),()=>{b=!1}},[]);const p=l.useMemo(()=>({state:m,dispatch:f,routes:t,flags:r,user:i,csrfToken:s}),[m,t,r,i,s]);return a.jsx(Rn.Provider,{value:p,children:d})}wr.propTypes={template:V.object,routes:V.object,flags:V.object,user:V.object,csrfToken:V.string,children:V.node.isRequired};wr.defaultProps={template:{},routes:{},flags:{},user:null,csrfToken:""};function mt(){const e=l.useContext(Rn);if(!e)throw new Error("useBuilderStore must be used within BuilderStoreProvider");return e}function Da(e,t){const r=e.find(s=>s.id===t)??e[0];return!r||!Array.isArray(r.nodes)||r.nodes.length===0?null:(r.nodes.find(s=>s.visible!==!1)??r.nodes[0]).id}function Ke(e,t,r={},i=!0){const s=i?An(e):e.history;return{...e,...r,pages:t,history:s}}function An(e){return{undoStack:[...e.history.undoStack,{pages:ha(e.pages)}],redoStack:[]}}function ha(e){return e.map(t=>({...t,metadata:{...t.metadata??{}},nodes:(Array.isArray(t.nodes)?t.nodes:[]).map(r=>({...r,frame:r.frame?{...r.frame}:null,metadata:{...r.metadata??{}}}))}))}function Aa(e,t,r,i){const s=i??e.activePageId,d=t.find(m=>m.id===s)??t[0];return d?r&&d.nodes.some(f=>f.id===r)?r:Da(t,s):null}function us(e,t,r){const i=e??En(r);return t?{x:Math.round(t.x??i.x),y:Math.round(t.y??i.y),width:Math.max(1,Math.round(t.width??i.width)),height:Math.max(1,Math.round(t.height??i.height)),rotation:Math.round(t.rotation??i.rotation??0)}:i}function En(e){return{x:Math.round(e.width*.1),y:Math.round(e.height*.1),width:Math.round(e.width*.6),height:Math.round(e.height*.25),rotation:0}}function hs(e){for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}const fs={birthday:{descriptor:"Celebration",phrases:["Party Pop","Cake Day","Spark Joy","Wish Glow","Confetti","Happy Vibes","Cheer Up","Fun Burst","Sugar Rush","Joy Ride","Glow Up","Gift Time","Funfetti","Sweet Bash","Party Vibe","Cake Rush","Festive Pop","Neon Fun","Sparkle","Cheer Wave","Joy Beam","Glitz Pop","Star Bash","Color Pop","Fun Bloom","Bright Bash","Lively Duo","Pop Joy","Glitter Pop","Glow Fest"]},corporate:{descriptor:"Executive",phrases:["Prime Edge","Bold Pitch","Team Sync","Strategy Hub","Future Desk","Growth Lab","Vision Deck","Focus Meet","Sharp Line","Core Plan","Pulse Ops","Scale Up","Insight Grid","Brand Apex","Data Flow","Venture Co","Logic Hub","Drive Co","Power Desk","Beyond HQ","Clarity Lab","Metric Mode","Peak Brief","Unity Team","Agenda Pro","Project Grid","Summit Note","Lead Sync","Bright Co","Studio HQ"]},baptism:{descriptor:"Sacred",phrases:["Pure Grace","Holy Light","Sacred Joy","Blessed Flow","Faith Rise","Grace Note","Gentle Waters","Pure Hope","Divine Glow","Sacred Bloom","Peace Tide","Hope Wave","Kind Light","Serene Gift","Grace Path","Soul Shine","Angel Dawn","Pure Promise","Light Song","Calm River","Soft Halo","Gentle Flame","Grace Drift","Hope Bloom","Dove Glow","Quiet Joy","Still Light","Angel Whisper","Sacred Rise","Grace Aura"]},wedding:{descriptor:"Romantic",phrases:["True Love","Ever Us","Golden Vow","Sweet Knot","Heart Duo","Luxe Union","Pure Romance","Velvet Kiss","Love Bloom","Charm Pair","Crystal Vow","Forever You","Bliss Bond","Tender Two","Moonlight","Rose Promise","Soulmate","Joyful Duo","Unity Glow","Dream Pair","Soft Embrace","Aurora Kiss","Gentle Vow","Eternal Two","Velvet Vow","Pearl Love","Blush Union","Amor Duo","Starry Kiss","Golden Duo"]}};function ms(e=[],t={}){const r=t.perCategory||20,i={...fs,...t.themeConfig||{}},s=Object.keys(i),d=[];return s.forEach(m=>{const f=i[m];if(!f)return;const p=hs([...f.phrases||[]]),b=Math.min(r,p.length);for(let v=0;v<b;v++){const w=e[v%Math.max(1,e.length)],z=(p[v]||"").split(/\s+/).filter(Boolean),O=z[0]??"",$=z.length>1?z.slice(1).join(" "):"",re=((w==null?void 0:w.layers)||[]).map((A,q)=>({role:A.role??(q===0?"heading":"subheading"),family:A.family||(q===0?"Inter":"Georgia"),fallback:A.fallback||(q===0?"sans-serif":"serif"),fontSize:q===0?Math.max(18,Math.round((A.fontSize||36)*.72)):Math.max(10,Math.round((A.fontSize||16)*.7)),fontWeight:A.fontWeight||(q===0?"600":"400"),content:q===0?O:q===1?$:"",transform:A.transform||"none",align:A.align||"center",letterSpacing:A.letterSpacing??0,offsetY:A.offsetY??(q===0?0:40)}));d.push({id:`${m}-${v}-${(w==null?void 0:w.id)??"combo"}`,label:f.descriptor?`${(w==null?void 0:w.label)??"Preset"} · ${f.descriptor}`:(w==null?void 0:w.label)??"Preset",description:f.descriptor??"",category:m,layers:re})}}),d}var gs={};function ps(e){if(!e)return{top:0,right:0,bottom:0,left:0};const t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const s=parseFloat(i);return Number.isNaN(s)?0:s}return 0},r=t(e.margin??e.all??0);return{top:t(e.top??r),right:t(e.right??r),bottom:t(e.bottom??r),left:t(e.left??r)}}function nt(e,t,r){const i=r.left,s=t.width-r.right-e.width,d=r.top,m=t.height-r.bottom-e.height;return{...e,x:Math.max(i,Math.min(s,e.x)),y:Math.max(d,Math.min(m,e.y))}}function Kr(e){if(typeof e!="string")return{h:0,s:0,l:0};let t=e.trim().replace("#","").toLowerCase();t.length===3&&(t=t.split("").map(w=>w+w).join("")),/^[0-9a-f]{6}$/.test(t)||(t="ffffff");const r=parseInt(t.slice(0,2),16)/255,i=parseInt(t.slice(2,4),16)/255,s=parseInt(t.slice(4,6),16)/255,d=Math.max(r,i,s),m=Math.min(r,i,s),f=d-m;let p=0;f!==0&&(d===r?p=(i-s)/f%6:d===i?p=(s-r)/f+2:p=(r-i)/f+4,p=Math.round(p*60),p<0&&(p+=360));const b=(d+m)/2,v=f===0?0:f/(1-Math.abs(2*b-1));return{h:p,s:Math.round(v*100),l:Math.round(b*100)}}function en(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:"255,255,255"}const tn=[{id:"text",label:"Text",description:"Add headings, body copy, and typography styles.",icon:"fa-solid fa-t"},{id:"images",label:"Upload",description:"Upload customer photos or choose from brand assets.",icon:"fa-solid fa-cloud-arrow-up"},{id:"shapes",label:"Shapes",description:"Insert vector shapes, lines, and frames.",icon:"fa-solid fa-shapes"},{id:"photos",label:"Photos",description:"Add photos and images.",icon:"fa-solid fa-image"},{id:"icons",label:"Icons",description:"Insert icons and symbols.",icon:"fa-solid fa-icons"},{id:"draw",label:"Draw",description:"Draw shapes and lines.",icon:"fa-solid fa-pencil"},{id:"background",label:"Background",description:"Set background.",icon:"fa-solid fa-palette"},{id:"colors",label:"Colors",description:"Generate color palettes.",icon:"fa-solid fa-palette"},{id:"layers",label:"Layers",description:"Manage layers.",icon:"fa-solid fa-layer-group"},{id:"quotes",label:"Quotes",description:"Add quotes.",icon:"fa-solid fa-quote-left"}],bs=[{id:"all",label:"All images",value:null},{id:"photos",label:"Photos",value:"photos"},{id:"illustrations",label:"Illustrations",value:"illustrations"},{id:"vectors",label:"Vectors",value:"vectors"},{id:"3d",label:"3D Models",value:"3d"},{id:"gifs",label:"GIFs",value:"gifs"}],ys=[{id:"unsplash",label:"Unsplash"},{id:"pixabay",label:"Pixabay"}],Ta={unsplash:"Unsplash",pixabay:"Pixabay"},vs="53250708-d3f88461e75cb0c2c5366a181",Ea={unsplash:20,pixabay:30,flaticon:50},an={all:{imageType:"all"},photos:{imageType:"photo"},illustrations:{imageType:"illustration"},vectors:{imageType:"vector"},"3d":{querySuffix:"3d model render",category:"computer"},gifs:{querySuffix:"animated gif loop",order:"popular"}},ws=(e=[])=>e.filter(Boolean).map(t=>{var r,i,s,d,m,f,p,b,v,w;return{id:`unsplash-${t.id}`,thumbUrl:((r=t==null?void 0:t.urls)==null?void 0:r.thumb)??((i=t==null?void 0:t.urls)==null?void 0:i.small)??((s=t==null?void 0:t.urls)==null?void 0:s.regular),previewUrl:((d=t==null?void 0:t.urls)==null?void 0:d.small)??((m=t==null?void 0:t.urls)==null?void 0:m.regular)??((f=t==null?void 0:t.urls)==null?void 0:f.full),downloadUrl:((p=t==null?void 0:t.urls)==null?void 0:p.regular)??((b=t==null?void 0:t.urls)==null?void 0:b.full)??((v=t==null?void 0:t.urls)==null?void 0:v.small),description:(t==null?void 0:t.alt_description)??(t==null?void 0:t.description)??"Unsplash photo",provider:"unsplash",providerLabel:Ta.unsplash,credit:(w=t==null?void 0:t.user)!=null&&w.name?`Photo by ${t.user.name} on Unsplash`:"Unsplash",raw:t}}),xs=(e=[])=>e.filter(Boolean).map(t=>({id:`pixabay-${t.id}`,thumbUrl:(t==null?void 0:t.previewURL)??(t==null?void 0:t.webformatURL),previewUrl:(t==null?void 0:t.webformatURL)??(t==null?void 0:t.largeImageURL)??(t==null?void 0:t.previewURL),downloadUrl:(t==null?void 0:t.largeImageURL)??(t==null?void 0:t.webformatURL)??(t==null?void 0:t.previewURL),description:(t==null?void 0:t.tags)??"Pixabay image",provider:"pixabay",providerLabel:Ta.pixabay,credit:t!=null&&t.user?`${t.user} on Pixabay`:"Pixabay",raw:t}));function Ss({isSidebarHidden:e,onToggleSidebar:t}){const[r,i]=l.useState("text"),[s,d]=l.useState(""),[m,f]=l.useState([]),[p,b]=l.useState(!1),[v,w]=l.useState(1),[R,z]=l.useState(!1),[O,$]=l.useState(!0),[re,A]=l.useState("all"),[q,ce]=l.useState("unsplash"),ne=l.useRef(1),X=l.useRef(""),me=l.useRef(!1),[be,Me]=l.useState([]),[ge,Te]=l.useState(!1),[Pe,ue]=l.useState(""),[ie,Se]=l.useState(""),[y,I]=l.useState(""),[F,H]=l.useState(!1),Q=l.useRef(null),S=l.useRef([]),D=l.useRef(0),[ee,W]=l.useState("birthday"),[te,je]=l.useState("#ffffff"),[Ce,oe]=l.useState(!1),[he,fe]=l.useState("solid"),[U,Ne]=l.useState("#ffffff"),[xt,Be]=l.useState("#ffffff"),[ke,Ye]=l.useState(["#c97a8c","#a855f7"]),[He,St]=l.useState("soft-blend"),[We,Ze]=l.useState("layers"),[we,Re]=l.useState(!0),[It,P]=l.useState(0),[Ue,it]=l.useState(100),st=l.useRef(null),[jr,Zt]=l.useState(["#ffffff","#000000","#ef4444","#22c55e","#3b82f6"]),Oe=l.useMemo(()=>[{id:"birthday-pop",label:"Birthday Pop",keywords:["birthday","party","celebration","fun","kids"],colors:["#FDE68A","#F97316","#EA580C","#B45309","#78350F"]},{id:"corporate-cool",label:"Corporate Cool",keywords:["corporate","business","office","modern","tech"],colors:["#E0E7FF","#6366F1","#312E81","#0F172A","#8B5CF6"]},{id:"wedding-rose",label:"Wedding Rose",keywords:["wedding","romantic","rose","love","pastel","pink"],colors:["#FDECF3","#FBCFE8","#F472B6","#DB2777","#831843"]},{id:"baptism-serene",label:"Baptism Serene",keywords:["baptism","faith","calm","serene","baby"],colors:["#E0F2FE","#CFFAFE","#A5F3FC","#67E8F9","#22D3EE"]},{id:"organic-fern",label:"Organic Fern",keywords:["organic","earth","nature","green","eco"],colors:["#F0FDF4","#A7F3D0","#34D399","#10B981","#065F46"]},{id:"citrus-splash",label:"Citrus Splash",keywords:["citrus","summer","tropical","bright","sunny"],colors:["#FFF7ED","#FDE68A","#FCD34D","#F59E0B","#B45309"]},{id:"tropical-punch",label:"Tropical Punch",keywords:["tropical","beach","island","vacation","sunset"],colors:["#FFEDD5","#FDBA74","#FB7185","#F472B6","#C084FC"]},{id:"pastel-dream",label:"Pastel Dream",keywords:["pastel","soft","gentle","dreamy","baby","pink"],colors:["#F3E8FF","#FDE68A","#C7D2FE","#BFDBFE","#FBCFE8"]},{id:"luxe-midnight",label:"Luxe Midnight",keywords:["luxury","midnight","event","formal","black tie"],colors:["#0F172A","#1E293B","#475569","#64748B","#FACC15"]},{id:"neon-future",label:"Neon Future",keywords:["neon","retro","future","nightlife","electric"],colors:["#0F172A","#0EA5E9","#22D3EE","#F472B6","#F97316"]},{id:"pink-blush",label:"Pink Blush",keywords:["pink","blush","soft","romantic","pastel"],colors:["#FCE7F3","#FBCFE8","#F472B6","#DB2777","#831843"]},{id:"hot-pink",label:"Hot Pink",keywords:["pink","hot","bright","vibrant","energetic"],colors:["#FCE7F3","#F472B6","#EC4899","#BE185D","#831843"]},{id:"dusty-pink",label:"Dusty Pink",keywords:["pink","dusty","muted","soft","vintage"],colors:["#FDF2F8","#FCE7F3","#FBCFE8","#F9A8D4","#F472B6"]},{id:"neon-pink",label:"Neon Pink",keywords:["pink","neon","bright","electric","modern"],colors:["#FCE7F3","#F472B6","#EC4899","#BE185D","#9D174D"]},{id:"pink-sunset",label:"Pink Sunset",keywords:["pink","sunset","warm","evening","romantic"],colors:["#FDE2E2","#FCA5A5","#F87171","#EF4444","#DC2626"]}],[]),pe=l.useMemo(()=>[],[]);l.useMemo(()=>["#ffffff","#000000","#1f2937","#8f384b","#c97a8c","#f9c5d1"],[]);const Gt=l.useMemo(()=>[{id:"soft-blend",label:"Soft blend",generator:o=>`linear-gradient(135deg, ${o.join(", ")})`},{id:"sunset-bloom",label:"Sunset bloom",generator:o=>`linear-gradient(165deg, ${o[0]}, ${o[1]}, ${o[0]})`},{id:"radial-glow",label:"Radial glow",generator:o=>`radial-gradient(circle at top, ${o[0]}, ${o[1]})`},{id:"spotlight",label:"Spotlight",generator:o=>`conic-gradient(from 90deg, ${o[0]}, ${o[1]}, ${o[0]})`}],[]),et=l.useCallback((o,n)=>{const c=Array.isArray(n)&&n.length?n:["#f472b6","#9333ea"],h=Gt[0];return(Gt.find(k=>k.id===o)??h).generator(c)},[Gt]);l.useMemo(()=>et(He,ke),[et,He,ke]),l.useMemo(()=>`linear-gradient(0deg, rgba(0, 0, 0, 1), transparent), linear-gradient(90deg, rgba(${en(U)}, ${Ue/100}), ${U})`,[U,Ue]);const At=5,Qt=l.useCallback(o=>{const n=o==null?void 0:o.trim().toLowerCase();return n?Oe.filter(c=>{var k;const h=c.label.toLowerCase().includes(n),g=(k=c.keywords)==null?void 0:k.some(j=>j.includes(n));return h||g}).map(c=>({id:`curated-${c.id}`,label:c.label,colors:[...c.colors],source:"curated"})):[]},[Oe]),Xt=l.useCallback(o=>{S.current=o?Qt(o):[],D.current=0},[Qt]),qt=l.useCallback(o=>{var h;if(!((h=S.current)!=null&&h.length))return[];const n=D.current,c=S.current.slice(n,n+o);return D.current=n+c.length,c},[]);l.useEffect(()=>{const o=Q.current||document.querySelector(".builder-sidebar__palette-scroll");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const gt=l.useCallback(()=>{if(!(Oe!=null&&Oe.length))return null;const o=Math.floor(Math.random()*Oe.length),n=Oe[o];return n?{id:`curated-${n.id}-${Math.random().toString(36).slice(2,7)}`,label:n.label,colors:[...n.colors],source:"curated"}:null},[Oe]),Vt=l.useCallback(async o=>{const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"default"})});if(!n.ok)throw new Error(`Colormind responded with ${n.status}`);const c=await n.json();if(!(c!=null&&c.result)||!Array.isArray(c.result))throw new Error("Colormind response missing result array");return c.result.map(h=>{if(!Array.isArray(h)||h.length!==3)return"#000000";const[g,k,j]=h.map(_=>Math.max(0,Math.min(255,Number(_)||0)));return`rgb(${g}, ${k}, ${j})`})},[]),Jt=l.useCallback(async({normalizedQuery:o,startIndex:n=0})=>{const c=["https://colormind.io/api/","https://corsproxy.io/?https://colormind.io/api/"],h=[];let g=!1;const k=qt(At);for(k.length&&h.push(...k);h.length<At;){let j=null;for(let M=0;M<c.length;M++)try{if(j=await Vt(c[M]),j&&j.length)break}catch(B){M===c.length-1&&console.warn("Colormind endpoint failed",B)}if(!j||!j.length){g=!0;const M=gt();h.push({id:(M==null?void 0:M.id)??`fallback-${n+h.length}`,label:(M==null?void 0:M.label)??"Designer Fallback",colors:(M==null?void 0:M.colors)??["#e2e8f0","#cbd5f5","#a5b4fc","#818cf8","#4c1d95"],source:"curated"});continue}const _=n+h.length;h.push({id:`colormind-${Date.now()}-${_}-${Math.random().toString(36).slice(2,6)}`,label:o?`AI Blend ${_+1}`:`Colormind ${_+1}`,colors:j,source:"colormind"})}if(!h.length){const j=gt();h.push({id:(j==null?void 0:j.id)??`fallback-${Math.random().toString(36).slice(2,6)}`,label:(j==null?void 0:j.label)??"Designer Fallback",colors:(j==null?void 0:j.colors)??["#e2e8f0","#cbd5f5","#a5b4fc","#818cf8","#4c1d95"],source:"curated"})}return{paletteSets:h,usedFallback:g}},[Vt,gt,qt]),[Kt,ma]=l.useState(""),[Mt,ea]=l.useState([{id:"default-heart",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",description:"Heart",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-star",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",description:"Star",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-home",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",description:"Home",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-user",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",description:"User",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-search",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",description:"Search",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-settings",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",description:"Settings",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"}]),[ta,ga]=l.useState(!1),[Nr,Et]=l.useState(1),[Ae,aa]=l.useState(!1),[Ge,J]=l.useState(!0),pt=l.useRef(1),pa=l.useRef(""),jt=l.useRef(!1),[Nt,ot]=l.useState([]),[Wa,Cr]=l.useState(""),[Ua,ba]=l.useState(!1),[kr,Lt]=l.useState(1),[Ee,ya]=l.useState(!1),[Qe,bt]=l.useState(!0),yt=l.useRef(1),va=l.useRef(""),ra=l.useRef(!1),[_r,Pr]=l.useState(""),[Ct,zt]=l.useState([]),[na,kt]=l.useState(!1),[Rr,ia]=l.useState(1),[Le,wa]=l.useState(!1),[Xe,lt]=l.useState(!0),Ft=l.useRef(1),xa=l.useRef(""),Dt=l.useRef(!1),[_t,Sa]=l.useState([]),[Ia,Oa]=l.useState(1),[ct,sa]=l.useState(!1),[dt,oa]=l.useState(!0),Pt=12,la=l.useRef(null),u=l.useRef(null),x=[{id:"combo-aurora-atelier",label:"Aurora Atelier",description:"Playfair Display headline with Source Sans Pro narrative subcopy.",align:"center",layers:[{role:"heading",content:"Aurora Atelier",family:"Playfair Display",fallback:"serif",fontSize:44,fontWeight:"600",transform:"uppercase",letterSpacing:2,offsetY:0},{role:"subheading",content:"Visual storytelling & editorial craft",family:"Source Sans Pro",fallback:"sans-serif",fontSize:18,fontWeight:"400",letterSpacing:.6,offsetY:58}]},{id:"combo-lumina-forge",label:"Lumina Forge",description:"DM Serif Display hero matched with crisp Inter labels.",align:"left",layers:[{role:"heading",content:"Lumina Forge",family:"DM Serif Display",fallback:"serif",fontSize:42,fontWeight:"600",offsetY:0},{role:"subheading",content:"Product strategy & venture labs",family:"Inter",fallback:"sans-serif",fontSize:17,fontWeight:"500",letterSpacing:.5,offsetY:56}]},{id:"combo-saffron-harbor",label:"Saffron Harbor",description:"Cormorant Garamond headline with welcoming Nunito Sans body.",align:"center",layers:[{role:"heading",content:"Saffron Harbor",family:"Cormorant Garamond",fallback:"serif",fontSize:48,fontWeight:"500",letterSpacing:1,offsetY:0},{role:"subheading",content:"Artisanal markets & seaside residencies",family:"Nunito Sans",fallback:"sans-serif",fontSize:19,fontWeight:"400",offsetY:64}]},{id:"combo-meridian-labs",label:"Meridian Labs",description:"Libre Baskerville deck titles with Manrope research notes.",align:"left",layers:[{role:"heading",content:"Meridian Labs",family:"Libre Baskerville",fallback:"serif",fontSize:40,fontWeight:"700",offsetY:0},{role:"subheading",content:"Insight decks • Research memos",family:"Manrope",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-celestial-grid",label:"Celestial Grid",description:"Cinzel monograms paired with Space Grotesk captions.",align:"center",layers:[{role:"heading",content:"Celestial Grid",family:"Cinzel",fallback:"serif",fontSize:46,fontWeight:"600",letterSpacing:1.2,offsetY:0},{role:"subheading",content:"Futurist observatory narratives",family:"Space Grotesk",fallback:"sans-serif",fontSize:17,fontWeight:"500",offsetY:60}]},{id:"combo-radiant-market",label:"Radiant Market",description:"Abril Fatface display balanced by Work Sans merchandising notes.",align:"center",layers:[{role:"heading",content:"Radiant Market",family:"Abril Fatface",fallback:"serif",fontSize:50,fontWeight:"600",offsetY:0},{role:"subheading",content:"Seasonal florals & gifting studio",family:"Work Sans",fallback:"sans-serif",fontSize:18,fontWeight:"400",offsetY:66}]},{id:"combo-atelier-north",label:"Atelier North",description:"Lora type paired with crisp Poppins service line.",align:"left",layers:[{role:"heading",content:"Atelier North",family:"Lora",fallback:"serif",fontSize:42,fontWeight:"600",offsetY:0},{role:"subheading",content:"Boutique identity consultancy",family:"Poppins",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60}]},{id:"combo-solstice-audio",label:"Solstice Audio",description:"Volkhov warmth with Mulish modernity.",align:"center",layers:[{role:"heading",content:"Solstice Audio",family:"Volkhov",fallback:"serif",fontSize:44,fontWeight:"700",offsetY:0},{role:"subheading",content:"Soundscapes for modern retreats",family:"Mulish",fallback:"sans-serif",fontSize:17,fontWeight:"500",letterSpacing:.4,offsetY:62}]},{id:"combo-harvest-lane",label:"Harvest Lane",description:"Cardo editorial serif with Questrial market notes.",align:"left",layers:[{role:"heading",content:"Harvest Lane",family:"Cardo",fallback:"serif",fontSize:43,fontWeight:"600",offsetY:0},{role:"subheading",content:"Slow food residencies & journals",family:"Questrial",fallback:"sans-serif",fontSize:18,fontWeight:"400",offsetY:60}]},{id:"combo-paragon-museum",label:"Paragon Museum",description:"Marcellus title with IBM Plex Sans itinerary details.",align:"center",layers:[{role:"heading",content:"Paragon Museum",family:"Marcellus",fallback:"serif",fontSize:45,fontWeight:"600",letterSpacing:1,offsetY:0},{role:"subheading",content:"Annual symposium schedule",family:"IBM Plex Sans",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60},{role:"detail",content:"Tickets • Archives • Tours",family:"IBM Plex Sans",fallback:"sans-serif",fontSize:14,fontWeight:"400",letterSpacing:1,offsetY:110}]},{id:"combo-velvet-horizon",label:"Velvet Horizon",description:"Rosarivo curves with airy Raleway notes.",align:"center",layers:[{role:"heading",content:"Velvet Horizon",family:"Rosarivo",fallback:"serif",fontSize:46,fontWeight:"600",offsetY:0},{role:"subheading",content:"Sunset editorials & travel essays",family:"Raleway",fallback:"sans-serif",fontSize:17,fontWeight:"500",offsetY:62}]},{id:"combo-meteora-studio",label:"Meteora Studio",description:"Prata elegance with grounded Figtree descriptors.",align:"left",layers:[{role:"heading",content:"Meteora Studio",family:"Prata",fallback:"serif",fontSize:44,fontWeight:"600",letterSpacing:1.2,offsetY:0},{role:"subheading",content:"Speculative interiors & lighting labs",family:"Figtree",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60}]},{id:"combo-ember-studio",label:"Ember Studio",description:"Spectral prose headlines with Karla annotations.",align:"left",layers:[{role:"heading",content:"Ember Studio",family:"Spectral",fallback:"serif",fontSize:42,fontWeight:"600",offsetY:0},{role:"subheading",content:"Culinary films & sonic diaries",family:"Karla",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60}]},{id:"combo-glasshouse",label:"Glasshouse",description:"Gloock statement paired with Montserrat details.",align:"center",layers:[{role:"heading",content:"Glasshouse",family:"Gloock",fallback:"serif",fontSize:48,fontWeight:"600",offsetY:0},{role:"subheading",content:"Greenhouse culture & creative labs",family:"Montserrat",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:64}]},{id:"combo-nova-lounge",label:"Nova Lounge",description:"Noto Serif Display paired with Urbanist lounge notes.",align:"center",layers:[{role:"heading",content:"Nova Lounge",family:"Noto Serif Display",fallback:"serif",fontSize:46,fontWeight:"600",letterSpacing:1,offsetY:0},{role:"subheading",content:"Midnight tastings & listening rooms",family:"Urbanist",fallback:"sans-serif",fontSize:18,fontWeight:"400",offsetY:62}]},{id:"combo-terrace-agency",label:"Terrace Agency",description:"Quattrocento headlines with DM Sans service info.",align:"left",layers:[{role:"heading",content:"Terrace Agency",family:"Quattrocento",fallback:"serif",fontSize:41,fontWeight:"700",offsetY:0},{role:"subheading",content:"Landscape narratives & brand sites",family:"DM Sans",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-lucid-canvas",label:"Lucid Canvas",description:"Ysabeau contrasts with approachable Cabin body.",align:"center",layers:[{role:"heading",content:"Lucid Canvas",family:"Ysabeau",fallback:"serif",fontSize:45,fontWeight:"600",offsetY:0},{role:"subheading",content:"Immersive art fair programming",family:"Cabin",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:62}]},{id:"combo-citrine-summit",label:"Citrine Summit",description:"Crimson Pro titles with Open Sans agenda text.",align:"center",layers:[{role:"heading",content:"Citrine Summit",family:"Crimson Pro",fallback:"serif",fontSize:43,fontWeight:"600",offsetY:0},{role:"subheading",content:"Sustainability briefings & labs",family:"Open Sans",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60}]},{id:"combo-frame-factory",label:"Frame Factory",description:"Fraunces curves with minimalist Outfit copy.",align:"left",layers:[{role:"heading",content:"Frame Factory",family:"Fraunces",fallback:"serif",fontSize:42,fontWeight:"600",offsetY:0},{role:"subheading",content:"Gallery systems & product drops",family:"Outfit",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-indigo-manor",label:"Indigo Manor",description:"EB Garamond editorial voice with Hind Madurai support.",align:"center",layers:[{role:"heading",content:"Indigo Manor",family:"EB Garamond",fallback:"serif",fontSize:45,fontWeight:"600",offsetY:0},{role:"subheading",content:"Cultural residences & salons",family:"Hind Madurai",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:62}]},{id:"combo-marble-coast",label:"Marble Coast",description:"Tenor Sans structure with Gentium Plus narrative.",align:"center",layers:[{role:"heading",content:"Marble Coast",family:"Tenor Sans",fallback:"sans-serif",fontSize:42,fontWeight:"600",letterSpacing:.8,offsetY:0},{role:"subheading",content:"Coastal architecture dossiers",family:"Gentium Plus",fallback:"serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-orchid-bureau",label:"Orchid Bureau",description:"Newsreader gravitas with Heebo clarity.",align:"left",layers:[{role:"heading",content:"Orchid Bureau",family:"Newsreader",fallback:"serif",fontSize:43,fontWeight:"600",offsetY:0},{role:"subheading",content:"Trend reports • Field interviews",family:"Heebo",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-lux-atelier",label:"Lux Atelier",description:"Baskervville elegance with utilitarian Lato captions.",align:"center",layers:[{role:"heading",content:"Lux Atelier",family:"Baskervville",fallback:"serif",fontSize:44,fontWeight:"600",letterSpacing:1,offsetY:0},{role:"subheading",content:"Made-to-measure wardrobe plans",family:"Lato",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:60}]},{id:"combo-cobalt-grove",label:"Cobalt Grove",description:"Zilla Slab hero text with Rubik supporting copy.",align:"left",layers:[{role:"heading",content:"Cobalt Grove",family:"Zilla Slab",fallback:"serif",fontSize:42,fontWeight:"700",offsetY:0},{role:"subheading",content:"Botanical research & residency notes",family:"Rubik",fallback:"sans-serif",fontSize:18,fontWeight:"500",offsetY:58}]},{id:"combo-lobster-spark-joy",label:"Lobster",description:'Lobster script font with "Spark Joy" text.',align:"center",layers:[{role:"heading",content:"Spark Joy",family:"Lobster",fallback:"cursive",fontSize:48,fontWeight:"400",offsetY:0}]},{id:"combo-fredoka-one-party-mode",label:"Fredoka One",description:'Fredoka One rounded font with "Party Mode" text.',align:"center",layers:[{role:"heading",content:"Party Mode",family:"Fredoka One",fallback:"sans-serif",fontSize:44,fontWeight:"400",offsetY:0}]},{id:"combo-pacifico-sweet-vibes",label:"Pacifico",description:'Pacifico brush script with "Sweet Vibes" text.',align:"center",layers:[{role:"heading",content:"Sweet Vibes",family:"Pacifico",fallback:"cursive",fontSize:46,fontWeight:"400",offsetY:0}]},{id:"combo-baloo-two-happy-day",label:"Baloo 2",description:'Baloo 2 playful font with "Happy Day" text.',align:"center",layers:[{role:"heading",content:"Happy Day",family:"Baloo 2",fallback:"cursive",fontSize:45,fontWeight:"600",offsetY:0}]},{id:"combo-poppins-bold-fun-time",label:"Poppins Bold",description:'Poppins Bold with "Fun Time" text.',align:"center",layers:[{role:"heading",content:"Fun Time",family:"Poppins",fallback:"sans-serif",fontSize:42,fontWeight:"700",offsetY:0}]},{id:"combo-anton-big-wish",label:"Anton",description:'Anton condensed font with "Big Wish" text.',align:"center",layers:[{role:"heading",content:"Big Wish",family:"Anton",fallback:"sans-serif",fontSize:44,fontWeight:"400",offsetY:0}]},{id:"combo-gochi-hand-playful-mood",label:"Gochi Hand",description:'Gochi Hand handwritten font with "Playful Mood" text.',align:"center",layers:[{role:"heading",content:"Playful Mood",family:"Gochi Hand",fallback:"cursive",fontSize:42,fontWeight:"400",offsetY:0}]},{id:"combo-bangers-color-pop",label:"Bangers",description:'Bangers comic font with "Color Pop" text.',align:"center",layers:[{role:"heading",content:"Color Pop",family:"Bangers",fallback:"cursive",fontSize:46,fontWeight:"400",offsetY:0}]},{id:"combo-chewy-bright-fun",label:"Chewy",description:'Chewy rounded font with "Bright Fun" text.',align:"center",layers:[{role:"heading",content:"Bright Fun",family:"Chewy",fallback:"cursive",fontSize:44,fontWeight:"400",offsetY:0}]},{id:"combo-rubik-extrabold-joy-burst",label:"Rubik ExtraBold",description:'Rubik ExtraBold with "Joy Burst" text.',align:"center",layers:[{role:"heading",content:"Joy Burst",family:"Rubik",fallback:"sans-serif",fontSize:43,fontWeight:"800",offsetY:0}]},{id:"combo-montserrat-prime-edge",label:"Montserrat SemiBold",description:'Montserrat SemiBold with "Prime Edge" text.',align:"center",layers:[{role:"heading",content:"Prime Edge",family:"Montserrat",fallback:"sans-serif",fontSize:42,fontWeight:"600",offsetY:0}]},{id:"combo-helvetica-core-vision",label:"Helvetica Neue",description:'Helvetica Neue with "Core Vision" text.',align:"center",layers:[{role:"heading",content:"Core Vision",family:"Helvetica Neue",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-lato-solid-mark",label:"Lato Bold",description:'Lato Bold with "Solid Mark" text.',align:"center",layers:[{role:"heading",content:"Solid Mark",family:"Lato",fallback:"sans-serif",fontSize:41,fontWeight:"700",offsetY:0}]},{id:"combo-source-sans-blue-line",label:"Source Sans Pro",description:'Source Sans Pro with "Blue Line" text.',align:"center",layers:[{role:"heading",content:"Blue Line",family:"Source Sans Pro",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-poppins-medium-clean-form",label:"Poppins Medium",description:'Poppins Medium with "Clean Form" text.',align:"center",layers:[{role:"heading",content:"Clean Form",family:"Poppins",fallback:"sans-serif",fontSize:40,fontWeight:"500",offsetY:0}]},{id:"combo-roboto-condensed-sharp-fit",label:"Roboto Condensed",description:'Roboto Condensed with "Sharp Fit" text.',align:"center",layers:[{role:"heading",content:"Sharp Fit",family:"Roboto Condensed",fallback:"sans-serif",fontSize:41,fontWeight:"600",offsetY:0}]},{id:"combo-open-sans-pure-focus",label:"Open Sans",description:'Open Sans with "Pure Focus" text.',align:"center",layers:[{role:"heading",content:"Pure Focus",family:"Open Sans",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-oswald-bold-scope",label:"Oswald",description:'Oswald with "Bold Scope" text.',align:"center",layers:[{role:"heading",content:"Bold Scope",family:"Oswald",fallback:"sans-serif",fontSize:43,fontWeight:"700",offsetY:0}]},{id:"combo-nunito-sans-next-phase",label:"Nunito Sans",description:'Nunito Sans with "Next Phase" text.',align:"center",layers:[{role:"heading",content:"Next Phase",family:"Nunito Sans",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-inter-true-value",label:"Inter SemiBold",description:'Inter SemiBold with "True Value" text.',align:"center",layers:[{role:"heading",content:"True Value",family:"Inter",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-quicksand-pure-grace",label:"Quicksand Light",description:'Quicksand Light with "Pure Grace" text.',align:"center",layers:[{role:"heading",content:"Pure Grace",family:"Quicksand",fallback:"sans-serif",fontSize:39,fontWeight:"300",offsetY:0}]},{id:"combo-great-vibes-little-bless",label:"Great Vibes",description:'Great Vibes script with "Little Bless" text.',align:"center",layers:[{role:"heading",content:"Little Bless",family:"Great Vibes",fallback:"cursive",fontSize:48,fontWeight:"400",offsetY:0}]},{id:"combo-parisienne-soft-light",label:"Parisienne",description:'Parisienne script with "Soft Light" text.',align:"center",layers:[{role:"heading",content:"Soft Light",family:"Parisienne",fallback:"cursive",fontSize:47,fontWeight:"400",offsetY:0}]},{id:"combo-nunito-gentle-love",label:"Nunito Light",description:'Nunito Light with "Gentle Love" text.',align:"center",layers:[{role:"heading",content:"Gentle Love",family:"Nunito",fallback:"sans-serif",fontSize:39,fontWeight:"300",offsetY:0}]},{id:"combo-cormorant-garamond-sacred-hope",label:"Cormorant Garamond",description:'Cormorant Garamond with "Sacred Hope" text.',align:"center",layers:[{role:"heading",content:"Sacred Hope",family:"Cormorant Garamond",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-playfair-display-new-faith",label:"Playfair Display",description:'Playfair Display with "New Faith" text.',align:"center",layers:[{role:"heading",content:"New Faith",family:"Playfair Display",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-allura-sweet-peace",label:"Allura",description:'Allura script with "Sweet Peace" text.',align:"center",layers:[{role:"heading",content:"Sweet Peace",family:"Allura",fallback:"cursive",fontSize:47,fontWeight:"400",offsetY:0}]},{id:"combo-dm-sans-calm-flow",label:"DM Sans",description:'DM Sans with "Calm Flow" text.',align:"center",layers:[{role:"heading",content:"Calm Flow",family:"DM Sans",fallback:"sans-serif",fontSize:40,fontWeight:"500",offsetY:0}]},{id:"combo-satisfy-angel-glow",label:"Satisfy",description:'Satisfy script with "Angel Glow" text.',align:"center",layers:[{role:"heading",content:"Angel Glow",family:"Satisfy",fallback:"cursive",fontSize:47,fontWeight:"400",offsetY:0}]},{id:"combo-karla-tender-joy",label:"Karla",description:'Karla with "Tender Joy" text.',align:"center",layers:[{role:"heading",content:"Tender Joy",family:"Karla",fallback:"sans-serif",fontSize:40,fontWeight:"600",offsetY:0}]},{id:"combo-cinzel-eternal-love",label:"Cinzel",description:'Cinzel with "Eternal Love" text.',align:"center",layers:[{role:"heading",content:"Eternal Love",family:"Cinzel",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-cormorant-infant-golden-vow",label:"Cormorant Infant",description:'Cormorant Infant with "Golden Vow" text.',align:"center",layers:[{role:"heading",content:"Golden Vow",family:"Cormorant Infant",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-playfair-display-sweet-promise",label:"Playfair Display Italic",description:'Playfair Display italic styling with "Sweet Promise" text.',align:"center",layers:[{role:"heading",content:"Sweet Promise",family:"Playfair Display",fallback:"serif",fontSize:43,fontWeight:"500",offsetY:0}]},{id:"combo-great-vibes-forever-us",label:"Great Vibes Duo",description:'Great Vibes script with "Forever Us" text.',align:"center",layers:[{role:"heading",content:"Forever Us",family:"Great Vibes",fallback:"cursive",fontSize:48,fontWeight:"400",offsetY:0}]},{id:"combo-alex-brush-soft-romance",label:"Alex Brush",description:'Alex Brush script with "Soft Romance" text.',align:"center",layers:[{role:"heading",content:"Soft Romance",family:"Alex Brush",fallback:"cursive",fontSize:47,fontWeight:"400",offsetY:0}]},{id:"combo-montserrat-light-true-bond",label:"Montserrat Light",description:'Montserrat Light with "True Bond" text.',align:"center",layers:[{role:"heading",content:"True Bond",family:"Montserrat",fallback:"sans-serif",fontSize:40,fontWeight:"300",offsetY:0}]},{id:"combo-bodoni-moda-classic-heart",label:"Bodoni Moda",description:'Bodoni Moda with "Classic Heart" text.',align:"center",layers:[{role:"heading",content:"Classic Heart",family:"Bodoni Moda",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-parisienne-pure-bliss",label:"Parisienne Delight",description:'Parisienne script with "Pure Bliss" text.',align:"center",layers:[{role:"heading",content:"Pure Bliss",family:"Parisienne",fallback:"cursive",fontSize:47,fontWeight:"400",offsetY:0}]},{id:"combo-cormorant-upright-duo-dream",label:"Cormorant Upright",description:'Cormorant Upright with "Duo Dream" text.',align:"center",layers:[{role:"heading",content:"Duo Dream",family:"Cormorant Upright",fallback:"serif",fontSize:44,fontWeight:"600",offsetY:0}]},{id:"combo-libre-baskerville-ever-after",label:"Libre Baskerville Italic",description:'Libre Baskerville italic styling with "Ever After" text.',align:"center",layers:[{role:"heading",content:"Ever After",family:"Libre Baskerville",fallback:"serif",fontSize:43,fontWeight:"500",offsetY:0}]},{id:"combo-bright-joy",label:"Bright Joy",description:"Comic Neue Bold pops with cheerful energy.",align:"center",layers:[{role:"heading",content:"Bright Joy",family:"Comic Neue",fallback:"sans-serif",fontSize:56,fontWeight:"700",letterSpacing:1.2,offsetY:0}]},{id:"combo-fun-burst",label:"Fun Burst",description:"Amatic SC Bold delivers tall, joyful headlines.",align:"center",layers:[{role:"heading",content:"Fun Burst",family:"Amatic SC",fallback:"cursive",fontSize:60,fontWeight:"700",letterSpacing:2,offsetY:0}]},{id:"combo-party-pop",label:"Party Pop",description:"Luckiest Guy makes party invites feel loud and bold.",align:"center",layers:[{role:"heading",content:"Party Pop",family:"Luckiest Guy",fallback:"sans-serif",fontSize:54,fontWeight:"700",letterSpacing:.8,offsetY:0}]},{id:"combo-happy-glow",label:"Happy Glow",description:"Kalam Bold handwriting with warm friendly charm.",align:"center",layers:[{role:"heading",content:"Happy Glow",family:"Kalam",fallback:"cursive",fontSize:52,fontWeight:"700",letterSpacing:.6,offsetY:0}]},{id:"combo-sugar-fun",label:"Sugar Fun",description:"Bubblegum Sans delivers soft rounded sweetness.",align:"center",layers:[{role:"heading",content:"Sugar Fun",family:"Bubblegum Sans",fallback:"cursive",fontSize:50,fontWeight:"400",letterSpacing:.6,offsetY:0}]},{id:"combo-big-cheer",label:"Big Cheer",description:"Shrikhand brings oversized celebratory impact.",align:"center",layers:[{role:"heading",content:"Big Cheer",family:"Shrikhand",fallback:"cursive",fontSize:58,fontWeight:"400",letterSpacing:1,offsetY:0}]},{id:"combo-color-wave",label:"Color Wave",description:"Jua keeps bold all-caps lettering friendly and bright.",align:"center",layers:[{role:"heading",content:"Color Wave",family:"Jua",fallback:"sans-serif",fontSize:52,fontWeight:"400",letterSpacing:1,offsetY:0}]},{id:"combo-cute-spark",label:"Cute Spark",description:"DynaPuff bursts with bubbly motion and bounce.",align:"center",layers:[{role:"heading",content:"Cute Spark",family:"DynaPuff",fallback:"sans-serif",fontSize:54,fontWeight:"700",letterSpacing:1,offsetY:0}]},{id:"combo-fun-scribble",label:"Fun Scribble",description:"Cabin Sketch channels playful pencil energy.",align:"center",layers:[{role:"heading",content:"Fun Scribble",family:"Cabin Sketch",fallback:"cursive",fontSize:56,fontWeight:"700",letterSpacing:1.4,offsetY:0}]},{id:"combo-mega-fun",label:"Mega Fun",description:"Titan One makes every headline feel like a billboard.",align:"center",layers:[{role:"heading",content:"Mega Fun",family:"Titan One",fallback:"cursive",fontSize:55,fontWeight:"400",letterSpacing:1,offsetY:0}]},{id:"combo-core-line",label:"Core Line",description:"Futura PT brings geometric corporate clarity.",align:"center",layers:[{role:"heading",content:"Core Line",family:"Futura PT",fallback:"sans-serif",fontSize:46,fontWeight:"600",letterSpacing:1,offsetY:0}]},{id:"combo-prime-grid",label:"Prime Grid",description:"Avenir Next keeps tech-forward layouts refined.",align:"center",layers:[{role:"heading",content:"Prime Grid",family:"Avenir Next",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.8,offsetY:0}]},{id:"combo-clean-slate",label:"Clean Slate",description:"Work Sans Medium introduces crisp editorial tone.",align:"center",layers:[{role:"heading",content:"Clean Slate",family:"Work Sans",fallback:"sans-serif",fontSize:44,fontWeight:"500",letterSpacing:.6,offsetY:0}]},{id:"combo-lead-focus",label:"Lead Focus",description:"Proxima Nova stays neutral for product decks.",align:"center",layers:[{role:"heading",content:"Lead Focus",family:"Proxima Nova",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.6,offsetY:0}]},{id:"combo-firm-base",label:"Firm Base",description:"IBM Plex Sans looks confident and precise.",align:"center",layers:[{role:"heading",content:"Firm Base",family:"IBM Plex Sans",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.6,offsetY:0}]},{id:"combo-true-form",label:"True Form",description:"Barlow Semi Condensed adds agile modern structure.",align:"center",layers:[{role:"heading",content:"True Form",family:"Barlow Semi Condensed",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.6,offsetY:0}]},{id:"combo-sharp-flow",label:"Sharp Flow",description:"Sora balances futuristic branding and clarity.",align:"center",layers:[{role:"heading",content:"Sharp Flow",family:"Sora",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.8,offsetY:0}]},{id:"combo-next-line",label:"Next Line",description:"Metropolis delivers clean presentation headers.",align:"center",layers:[{role:"heading",content:"Next Line",family:"Metropolis",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.8,offsetY:0}]},{id:"combo-clear-frame",label:"Clear Frame",description:"Urbanist keeps product UI notes legible and fresh.",align:"center",layers:[{role:"heading",content:"Clear Frame",family:"Urbanist",fallback:"sans-serif",fontSize:44,fontWeight:"600",letterSpacing:.6,offsetY:0}]},{id:"default-user",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",description:"User",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"}],C=l.useCallback((o=1)=>{if(!(ct||!dt)){sa(!0);try{const n=(o-1)*Pt,c=x.slice(n,n+Pt);if(c.length===0){oa(!1);return}Sa(h=>[...h,...c]),Oa(o+1),oa(n+Pt<x.length)}finally{sa(!1)}}},[dt,ct,Pt]);l.useEffect(()=>{r==="text"&&_t.length===0&&C(1)},[r,_t.length,C]),l.useEffect(()=>{const o=la.current||document.querySelector(".text-panel__styled-presets"),n=o==null?void 0:o.querySelector(".styled-loading-indicator");if(!o||!n||!dt)return;const c=new IntersectionObserver(h=>{const[g]=h;g.isIntersecting&&!ct&&dt&&C(Ia)},{root:o,rootMargin:"50px",threshold:.1});return c.observe(n),u.current=c,()=>{var h;try{(h=u.current)==null||h.disconnect()}catch{}}},[Ia,ct,dt,C]);const[L,T]=l.useState(""),[ae,se]=l.useState([{id:"default-square",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",description:"Square",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"rectangle"},{id:"default-circle",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",description:"Circle",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"circle"},{id:"default-triangle",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",description:"Triangle",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"triangle"},{id:"default-star-shape",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiwxOSA0OSwxOSA1OCwzNiAzMiwzNiIgcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiwxOSA0OSwxOSA1OCwzNiAzMiwzNiIgcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiwxOSA0OSwxOSA1OCwzNiAzMiwzNiIgcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",description:"Star",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"star"}]),[ye,ut]=l.useState(!1),[qe,ht]=l.useState(1),[ze,Ar]=l.useState(!1),[ft,Tt]=l.useState(!0),Bt=l.useRef(1),Er=l.useRef(""),ca=l.useRef(!1),Lr=l.useRef(new Set),{state:tt,dispatch:ve}=mt(),zr=l.useRef(null),Ma=l.useRef(null),Hn=l.useRef(null),N=l.useMemo(()=>tt.pages.find(o=>o.id===tt.activePageId)??tt.pages[0],[tt.pages,tt.activePageId]),Ve=l.useMemo(()=>ps(N==null?void 0:N.safeZone),[N==null?void 0:N.safeZone]),$a=Ta[q]??Ta.unsplash;l.useMemo(()=>pe.find(o=>o.id===ee)??pe[0],[pe,ee]);const ja=l.useCallback(o=>{if(typeof o!="string")return"#ffffff";const n=o.trim();return n.startsWith("linear-gradient")?"#ffffff":/^#([0-9a-f]{3,4})$/i.test(n)?`#${n.slice(1).split("").map(g=>g+g).join("").slice(0,6)}`:/^#([0-9a-f]{6})([0-9a-f]{2})?$/i.test(n)?n.slice(0,7):"#ffffff"},[]);l.useEffect(()=>{je(ja((N==null?void 0:N.background)??"#ffffff"))},[N==null?void 0:N.background,ja]),l.useEffect(()=>{Ne(te)},[te]),l.useEffect(()=>{Be(U.toUpperCase())},[U]),l.useEffect(()=>{const{h:o}=Kr(U);P(o)},[U]),l.useEffect(()=>{if(!Ce)return;const o=c=>{var g,k;const h=(k=(g=c.target)==null?void 0:g.closest)==null?void 0:k.call(g,".builder-sidebar__color-button");st.current&&!st.current.contains(c.target)&&!h&&oe(!1)},n=c=>{c.key==="Escape"&&oe(!1)};return document.addEventListener("mousedown",o),document.addEventListener("keydown",n),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("keydown",n)}},[Ce]);const Ya=o=>{if(!N)return;const n=De("text",N,{name:o.name,content:o.content,fontSize:o.fontSize,textAlign:o.align??"center"});n.frame&&(n.frame=nt(n.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:n})};l.useEffect(()=>{try{const o=ms(x,{perCategory:24});o&&o.length&&Sa(o)}catch(o){console.warn("Failed to generate font presets",o)}},[]);const Ht=(o,n=null)=>{var h,g;if(!N)return;const c=De("shape",N,{name:o==="circle"?"Circle":"Rectangle",variant:o,borderRadius:o==="circle"?9999:16});o==="circle"&&(c.frame={...c.frame,width:Math.min(N.width*.3,((h=c.frame)==null?void 0:h.width)??280),height:Math.min(N.width*.3,((g=c.frame)==null?void 0:g.height)??280)}),n&&(c.metadata={...c.metadata,backgroundImage:n,objectFit:"cover",imageScale:1,imageOffsetX:0,imageOffsetY:0},c.fill="transparent"),c.frame&&(c.frame=nt(c.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:c})},Wn=()=>{var o;N&&((o=zr.current)==null||o.click())},Un=async o=>{const n=o.target.files[0];if(!n||!N){console.log("No file selected or no active page");return}if(console.log("File selected:",n.name,"Size:",n.size,"Type:",n.type),!n.type.startsWith("image/")){alert("Please select an image file.");return}const c=10*1024*1024;if(n.size>c){alert("Image file is too large. Please select an image smaller than 10MB.");return}const h=new FileReader;h.onload=async g=>{try{const k=g.target.result;if(console.log("Image loaded, data URL length:",(k==null?void 0:k.length)??0),!k||!k.startsWith("data:image/")){console.error("Invalid data URL:",k),alert("Failed to read the image file. Please try again.");return}const j=new Image;j.onload=async()=>{try{const _=j.naturalWidth||j.width,M=j.naturalHeight||j.height,B=Math.round(N.width*.85),Y=Math.round(N.height*.85),K=Math.min(1,B/_,Y/M),Z=Math.max(1,Math.round(_*K)),le=Math.max(1,Math.round(M*K)),E=Math.round((N.width-Z)/2),de=Math.round((N.height-le)/2),G=De("image",N,{name:n.name||"Uploaded image",content:k,metadata:{objectFit:"cover",imageScale:1,imageOffsetX:0,imageOffsetY:0}});G.frame={x:E,y:de,width:Z,height:le,rotation:0},G.frame&&(G.frame=nt(G.frame,N,Ve));try{ve({type:"ADD_LAYER",pageId:N.id,layer:G}),console.log("Layer dispatched to store")}catch(xe){console.error("Error dispatching layer:",xe),alert("Failed to add image to canvas. Please try again.")}try{const xe=await fa(()=>import("./recentImagesDB-CO6kquVm.js"),[]),$e=`recent-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;await xe.saveImage($e,n.name,n),xe.pruneOld(10).catch(()=>{});const Ie=URL.createObjectURL(n);ve({type:"ADD_RECENTLY_UPLOADED_IMAGE",dataUrl:Ie,fileName:n.name,id:$e})}catch(xe){console.error("Failed to persist or dispatch recent image from sidebar:",xe)}}catch(_){console.error("Error creating layer from uploaded image:",_),alert("An error occurred while processing the image. Please try again.")}},j.onerror=()=>{console.error("Failed to load image for sizing"),alert("Uploaded image could not be loaded. Try a different file.")},j.src=k}catch(k){console.error("Error processing uploaded image:",k),alert("An error occurred while processing the image. Please try again.")}},h.onerror=()=>{console.error("Error reading file"),alert("Failed to read the image file. Please try again.")},console.log("Starting to read file as data URL"),h.readAsDataURL(n),o.target.value=""},On=o=>{if(N)try{const n=new Image;n.onload=()=>{const c=n.naturalWidth||n.width,h=n.naturalHeight||n.height,g=Math.round(N.width*.85),k=Math.round(N.height*.85),j=Math.min(1,g/c,k/h),_=Math.max(1,Math.round(c*j)),M=Math.max(1,Math.round(h*j)),B=Math.round((N.width-_)/2),Y=Math.round((N.height-M)/2),K=De("image",N,{name:o.fileName||"Uploaded image",content:o.dataUrl,metadata:{objectFit:"cover",imageScale:1,imageOffsetX:0,imageOffsetY:0}});K.frame={x:B,y:Y,width:_,height:M,rotation:0},K.frame&&(K.frame=nt(K.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:K})},n.onerror=()=>{const c=De("image",N,{name:o.fileName||"Uploaded image",content:o.dataUrl,metadata:{objectFit:"cover",imageScale:1,imageOffsetX:0,imageOffsetY:0}});ve({type:"ADD_LAYER",pageId:N.id,layer:c})},n.src=o.dataUrl}catch(n){console.error("Failed to add recent image to canvas:",n),alert("Could not add image to canvas. Check console for details.")}},Na=l.useCallback(async(o,n)=>{const c=o==null?void 0:o.trim();if(!c)return{items:[],hasMore:!1};if(q==="unsplash"){const le=Ea.unsplash,E=re!=="all"?`&content_filter=${re}`:"",de=await fetch(`https://api.unsplash.com/search/photos?query=${encodeURIComponent(c)}&client_id=iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs&per_page=${le}&page=${n}${E}`);if(!de.ok)throw new Error(`API error: ${de.status}`);const G=await de.json(),xe=ws(G.results||[]),$e=G.total_pages??(xe.length===le?n+1:n);return{items:xe,hasMore:n<$e&&xe.length>0}}const h=Ea.pixabay,g=an[re]??an.all,j=[c,g==null?void 0:g.querySuffix].filter(Boolean).join(" "),_=new URLSearchParams({key:vs,q:j||c,safesearch:"true",page:String(n),per_page:String(h)});g!=null&&g.imageType&&g.imageType!=="all"&&_.set("image_type",g.imageType),g!=null&&g.category&&_.set("category",g.category),g!=null&&g.order&&_.set("order",g.order);const M=await fetch(`https://pixabay.com/api/?${_.toString()}`);if(!M.ok)throw new Error(`API error: ${M.status}`);const B=await M.json(),Y=xs(B.hits||[]),K=Math.min(B.totalHits??0,500),Z=(n-1)*h+Y.length;return{items:Y,hasMore:K>0&&Z<K}},[q,re]),Ca=l.useCallback(async o=>{const n=(o??"").trim();if(n){me.current=!0,X.current=n,b(!0),w(1),ne.current=1,$(!0);try{const{items:c,hasMore:h}=await Na(n,1);f(c);const g=c.length>0?2:1;w(g),ne.current=g,$(h)}catch(c){console.error("Search failed:",c),alert("Search failed. Please try again."),f([]),$(!1)}finally{b(!1)}}},[Na]),Za=l.useCallback(async()=>{if(R||!O)return;const o=X.current.trim();if(o){z(!0);try{const{items:n,hasMore:c}=await Na(o,ne.current);if(n.length>0){f(g=>[...g,...n]);const h=ne.current+1;w(h),ne.current=h}$(c&&n.length>0)}catch(n){console.error("Load more failed:",n),alert("Failed to load more images. Please try again."),$(!1)}finally{z(!1)}}},[Na,O,R]),Fr=l.useRef(Za);l.useEffect(()=>{Fr.current=Za},[Za]);const ka=l.useCallback(async(o,n)=>{const c=o==null?void 0:o.trim();if(!c)return{items:[],hasMore:!1};const h=Ea.flaticon;console.log("Fetching icons:",{query:c,pageNumber:n,perPage:h});const g=[{name:"Iconify",searchUrl:`https://api.iconify.design/search?query=${encodeURIComponent(c)}&limit=${h}&start=${(n-1)*h}`,noAuth:!0,type:"iconify"},{name:"Simple Icons Search",searchUrl:`https://api.github.com/search/code?q=${encodeURIComponent(c)}+repo:simple-icons/simple-icons&per_page=${Math.min(h,30)}&page=${n}`,noAuth:!0,type:"github"}];for(const M of g)try{console.log(`Trying ${M.name} API...`);const B=await fetch(M.searchUrl);if(!B.ok){const E=await B.text();console.log(`${M.name} search failed:`,B.status,E);continue}const Y=await B.json();console.log(`${M.name} search successful:`,Y);let K=[],Z=0;M.name==="Iconify"?(K=(Y==null?void 0:Y.icons)||[],Z=(Y==null?void 0:Y.total)||0,Z=Math.min(Z,1e3)):M.name==="Simple Icons Search"&&(K=Y.items||[],Z=Y.total_count||0);const le=K.map((E,de)=>{var at;let G="",xe="",$e="",Ie="",Rt="";if(M.name==="Iconify"){const[rt,Je]=E.split(":");G=`https://api.iconify.design/${E}.svg?width=64&height=64`,xe=`https://api.iconify.design/${E}.svg?width=128&height=128`,$e=`https://api.iconify.design/${E}.svg`,Ie=Je.replace(/([A-Z])/g," $1").trim()||E,Rt=`Iconify (${rt})`}else if(M.name==="Simple Icons Search"){let rt="";E.path&&(rt=E.path.split("/").pop().replace(".svg","")),rt=rt||E.name||((at=E.path)==null?void 0:at.split("/").pop())||`icon-${de}`;const Je=String(rt).toLowerCase().replace(/[^a-z0-9]/g,"");G=`https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/${encodeURIComponent(Je)}.svg`,xe=G,$e=G,Ie=rt.replace(/([A-Z])/g," $1").trim()||"Simple Icon",Rt="Simple Icons"}return{id:`${M.name.toLowerCase()}-${E}-${de}`,thumbUrl:G,previewUrl:xe,downloadUrl:$e,description:Ie,provider:M.name.toLowerCase(),providerLabel:M.name,credit:Rt,raw:E}}).filter(E=>E.thumbUrl);if(le.length>0){console.log(`Returning ${le.length} results from ${M.name}`);const E=Math.ceil(Z/h),de=n<E&&le.length===h&&Z>n*h;return console.log(`Pagination info: page ${n}/${E}, hasMore: ${de}, totalItems: ${Z}`),{items:le,hasMore:de}}else console.log(`${M.name} returned no valid results`)}catch(B){console.log(`${M.name} API error:`,B.message);continue}console.log("All APIs failed, providing fallback icons");const _=[{name:"heart",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",tags:["love","favorite","like"]},{name:"star",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",tags:["favorite","rating","bookmark"]},{name:"home",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",tags:["house","building","property"]},{name:"user",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",tags:["person","profile","account"]},{name:"search",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",tags:["find","magnify","lookup"]},{name:"settings",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",tags:["gear","config","preferences"]},{name:"mail",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/mail.svg",tags:["email","message","envelope"]},{name:"phone",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/phone.svg",tags:["call","contact","telephone"]},{name:"camera",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/camera.svg",tags:["photo","picture","image"]},{name:"music",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/music.svg",tags:["audio","sound","note"]},{name:"play",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/play.svg",tags:["start","begin","media"]},{name:"pause",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/pause.svg",tags:["stop","wait","media"]},{name:"arrowright",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/arrowright.svg",tags:["next","forward","direction"]},{name:"arrowleft",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/arrowleft.svg",tags:["back","previous","direction"]},{name:"check",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/check.svg",tags:["yes","confirm","tick"]},{name:"close",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/close.svg",tags:["x","cancel","exit"]},{name:"plus",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/plus.svg",tags:["add","new","create"]},{name:"minus",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/minus.svg",tags:["remove","subtract","delete"]},{name:"menu",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/menu.svg",tags:["hamburger","navigation","list"]},{name:"calendar",url:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/calendar.svg",tags:["date","schedule","event"]}].filter(M=>M.name.toLowerCase().includes(c.toLowerCase())||M.tags.some(B=>B.toLowerCase().includes(c.toLowerCase()))).slice(0,Math.min(h,20)).map((M,B)=>({id:`fallback-${B}`,thumbUrl:M.url,previewUrl:M.url,downloadUrl:M.url,description:M.name.replace(/([A-Z])/g," $1").trim(),provider:"fallback",providerLabel:"Simple Icons",credit:"Simple Icons",raw:M}));return console.log(`Returning ${_.length} filtered fallback icons for query "${c}"`),{items:_,hasMore:!1}},[]),_a=l.useCallback(async(o,n)=>{const c=o==null?void 0:o.trim();if(!c)return{items:[],hasMore:!1};const h=Ea.flaticon;console.log("Fetching shapes:",{query:c,pageNumber:n,perPage:h});const g=[{name:"Iconify",searchUrl:`https://api.iconify.design/search?query=${encodeURIComponent(c+" shape")}&limit=${h}&start=${(n-1)*h}`,noAuth:!0,type:"iconify"},{name:"Simple Icons Search",searchUrl:`https://api.github.com/search/code?q=${encodeURIComponent(c+" shape")}+repo:simple-icons/simple-icons&per_page=${Math.min(h,30)}&page=${n}`,noAuth:!0,type:"github"}];for(const M of g)try{console.log(`Trying ${M.name} API for shapes...`);const B=await fetch(M.searchUrl);if(!B.ok){const E=await B.text();console.log(`${M.name} search failed:`,B.status,E);continue}const Y=await B.json();console.log(`${M.name} search successful:`,Y);let K=[],Z=0;M.name==="Iconify"?(K=(Y==null?void 0:Y.icons)||[],Z=(Y==null?void 0:Y.total)||0,Z=Math.min(Z,1e3)):M.name==="Simple Icons Search"&&(K=Y.items||[],Z=Y.total_count||0);const le=K.map((E,de)=>{var rt;let G="",xe="",$e="",Ie="",Rt="",at="rectangle";if(M.name==="Iconify"){const[Je,ar]=E.split(":");G=`https://api.iconify.design/${E}.svg?width=64&height=64`,xe=`https://api.iconify.design/${E}.svg?width=128&height=128`,$e=`https://api.iconify.design/${E}.svg`,Ie=ar.replace(/([A-Z])/g," $1").trim()||E,Rt=`Iconify (${Je})`,Ie.toLowerCase().includes("circle")||Ie.toLowerCase().includes("round")?at="circle":Ie.toLowerCase().includes("triangle")?at="triangle":Ie.toLowerCase().includes("star")&&(at="star")}else if(M.name==="Simple Icons Search"){let Je="";E.path&&(Je=E.path.split("/").pop().replace(".svg","")),Je=Je||E.name||((rt=E.path)==null?void 0:rt.split("/").pop())||`shape-${de}`;const ar=String(Je).toLowerCase().replace(/[^a-z0-9]/g,"");G=`https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/${encodeURIComponent(ar)}.svg`,xe=G,$e=G,Ie=Je.replace(/([A-Z])/g," $1").trim()||"Shape",Rt="Simple Icons",Ie.toLowerCase().includes("circle")||Ie.toLowerCase().includes("round")?at="circle":Ie.toLowerCase().includes("triangle")?at="triangle":Ie.toLowerCase().includes("star")&&(at="star")}return{id:`${M.name.toLowerCase()}-shape-${E}-${de}`,thumbUrl:G,previewUrl:xe,downloadUrl:$e,description:Ie,provider:M.name.toLowerCase(),providerLabel:M.name,credit:Rt,variant:at,raw:E}}).filter(E=>E.thumbUrl);if(le.length>0){console.log(`Returning ${le.length} results from ${M.name}`);const E=Math.ceil(Z/h),de=n<E&&le.length===h&&Z>n*h;return console.log(`Pagination info: page ${n}/${E}, hasMore: ${de}, totalItems: ${Z}`),{items:le,hasMore:de}}else console.log(`${M.name} returned no valid results`)}catch(B){console.log(`${M.name} API error:`,B.message);continue}console.log("All APIs failed, providing fallback shapes");const _=[{name:"square",variant:"rectangle",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",tags:["rectangle","square","box"]},{name:"circle",variant:"circle",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",tags:["circle","round","oval"]},{name:"triangle",variant:"triangle",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",tags:["triangle","polygon","geometric"]},{name:"star",variant:"star",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",tags:["star","rating","favorite"]},{name:"hexagon",variant:"hexagon",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIxNiwyMCA4LDM2IDI0LDUyIDQwLDUyIDQ4LDM2IDQwLDIwIiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",tags:["hexagon","polygon","geometric"]},{name:"diamond",variant:"diamond",url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiwyMCAyMCw4IDQ0LDg1MiA0NCIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",tags:["diamond","rhombus","geometric"]}].filter(M=>M.name.toLowerCase().includes(c.toLowerCase())||M.tags.some(B=>B.toLowerCase().includes(c.toLowerCase()))).slice(0,Math.min(h,20)).map((M,B)=>({id:`fallback-shape-${B}`,thumbUrl:M.url,previewUrl:M.url,downloadUrl:M.url,description:M.name.replace(/([A-Z])/g," $1").trim(),provider:"fallback",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:M.variant,raw:M}));return console.log(`Returning ${_.length} filtered fallback shapes for query "${c}"`),{items:_,hasMore:!1}},[]),Dr=l.useCallback(async o=>{const n=(o??"").trim();if(!n){se([{id:"default-square",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiB4PSI4IiB5PSI4IiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxYTFhMWEiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=",description:"Square",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"rectangle"},{id:"default-circle",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMjQiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",description:"Circle",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"circle"},{id:"default-triangle",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIzMiw4IDgsNTYgNTYsNTYiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzFhMWEwYSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPg==",description:"Triangle",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"triangle"},{id:"default-star-shape",thumbUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",previewUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",downloadUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBvbHlnb24gcG9pbnRzPSIyMCwxNiAzMiwzNiA0MiwzNiA0OCwzNiA0OCwxNiAzOCwxNiAzOCwyNiAyMCwyNiIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjMWExYTBhIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+",description:"Star",provider:"default",providerLabel:"Basic Shapes",credit:"Basic Shapes",variant:"star"}]),ca.current=!1,ht(1),Bt.current=1,Tt(!1);return}ca.current=!0,Er.current=n,ut(!0),ht(1),Bt.current=1,Tt(!0);try{const{items:c,hasMore:h}=await _a(n,1);se(c);const g=c.length>0?2:1;ht(g),Bt.current=g,Tt(h)}catch(c){console.error("Shape search failed:",c),alert("Some shape providers are unavailable. Showing fallback shapes instead."),Tt(!1)}finally{ut(!1)}},[_a]),Ga=l.useCallback(async()=>{if(ze||!ft)return;const o=Er.current.trim();if(o){Ar(!0);try{const{items:n,hasMore:c}=await _a(o,Bt.current);if(n.length>0){se(g=>[...g,...n]);const h=Bt.current+1;ht(h),Bt.current=h}Tt(c&&n.length>0)}catch(n){console.error("Load more shapes failed:",n),alert("Unable to load more shapes. Using available shapes."),Tt(!1)}finally{Ar(!1)}}},[_a,ft,ze]),Qa=l.useRef(Ga);l.useEffect(()=>{Qa.current=Ga},[Ga]),l.useEffect(()=>{if(ae.length===0||!ft)return;const o=document.querySelector(".shape-loading-indicator"),n=document.querySelector(".builder-sidebar__shape-results");if(!o||!n){console.log("Shape loading indicator or scroll container not found");return}console.log("Setting up IntersectionObserver for shape loading indicator");const c=new IntersectionObserver(h=>{const[g]=h;console.log("Shape IntersectionObserver triggered:",{isIntersecting:g.isIntersecting,isLoadingMoreShapes:ze,hasMoreShapes:ft,shapeSearchResultsLength:ae.length}),g.isIntersecting&&!ze&&ft&&(console.log("Loading more shapes via IntersectionObserver..."),Qa.current())},{root:n,rootMargin:"50px",threshold:.1});return c.observe(o),()=>{console.log("Cleaning up shape IntersectionObserver"),c.disconnect()}},[ae.length,ft,ze]),l.useEffect(()=>{const o=document.querySelector(".builder-sidebar__shape-results");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const $n=l.useCallback(()=>{!ze&&ft&&Qa.current()},[ze,ft]),Tr=l.useCallback(async o=>{const n=(o??"").trim();if(!n){ea([{id:"default-heart",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg",description:"Heart",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-star",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/star.svg",description:"Star",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-home",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/home.svg",description:"Home",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-user",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/user.svg",description:"User",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-search",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/search.svg",description:"Search",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"},{id:"default-settings",thumbUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",previewUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",downloadUrl:"https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/settings.svg",description:"Settings",provider:"default",providerLabel:"Simple Icons",credit:"Simple Icons"}]),jt.current=!1,Et(1),pt.current=1,J(!1);return}jt.current=!0,pa.current=n,ga(!0),Et(1),pt.current=1,J(!0);try{const{items:c,hasMore:h}=await ka(n,1);ea(c);const g=c.length>0?2:1;Et(g),pt.current=g,J(h)}catch(c){console.error("Icon search failed:",c),alert("Some icon providers are unavailable. Showing fallback icons instead."),J(!1)}finally{ga(!1)}},[ka]),Xa=l.useCallback(async()=>{if(Ae||!Ge)return;const o=pa.current.trim();if(o){aa(!0);try{const{items:n,hasMore:c}=await ka(o,pt.current);if(n.length>0){ea(g=>[...g,...n]);const h=pt.current+1;Et(h),pt.current=h}J(c&&n.length>0)}catch(n){console.error("Load more icons failed:",n),alert("Unable to load more icons. Using available icons."),J(!1)}finally{aa(!1)}}},[ka,Ge,Ae]),qa=l.useRef(Xa);l.useEffect(()=>{qa.current=Xa},[Xa]),l.useEffect(()=>{if(Mt.length===0||!Ge)return;const o=document.querySelector(".icon-loading-indicator"),n=document.querySelector(".builder-sidebar__icon-results");if(!o||!n){console.log("Icon loading indicator or scroll container not found");return}console.log("Setting up IntersectionObserver for icon loading indicator");const c=new IntersectionObserver(h=>{const[g]=h;console.log("Icon IntersectionObserver triggered:",{isIntersecting:g.isIntersecting,isLoadingMoreIcons:Ae,hasMoreIcons:Ge,iconSearchResultsLength:Mt.length}),g.isIntersecting&&!Ae&&Ge&&(console.log("Loading more icons via IntersectionObserver..."),qa.current())},{root:n,rootMargin:"50px",threshold:.1});return c.observe(o),()=>{console.log("Cleaning up icon IntersectionObserver"),c.disconnect()}},[Mt.length,Ge,Ae]),l.useEffect(()=>{const o=document.querySelector(".builder-sidebar__icon-results");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const Yn=l.useCallback(()=>{!Ae&&Ge&&qa.current()},[Ae,Ge]),Zn=async o=>{if(N)if(o.variant)Ht(o.variant);else{const n=(o==null?void 0:o.downloadUrl)||(o==null?void 0:o.previewUrl)||(o==null?void 0:o.thumbUrl);if(!n){alert("Unable to load the selected shape. Please choose another one.");return}try{const c=await fetch(n);if(!c.ok)throw new Error(`Network error: ${c.status}`);const h=await c.blob(),g=new FileReader;g.onload=()=>{const k=g.result,j=new Image;j.onload=()=>{const _=j.naturalWidth||j.width,M=j.naturalHeight||j.height,B=Math.round(N.width*.2),Y=Math.round(N.height*.2),K=Math.min(1,B/_,Y/M),Z=Math.max(1,Math.round(_*K)),le=Math.max(1,Math.round(M*K)),E=Math.round((N.width-Z)/2),de=Math.round((N.height-le)/2),G=De("image",N,{name:(o==null?void 0:o.description)||"Shape",content:k,metadata:{objectFit:"contain",imageScale:1,imageOffsetX:0,imageOffsetY:0,attribution:o==null?void 0:o.credit,isShape:!0}});G.frame={x:E,y:de,width:Z,height:le,rotation:0},G.frame&&(G.frame=nt(G.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:G})},j.src=k},g.readAsDataURL(h)}catch(c){console.error("Failed to load shape:",c),alert("Failed to load shape. Please try again.")}}},Pa=async o=>{if(!N)return;const n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=async c=>{const h=c.target.files[0];if(!h)return;const g=10*1024*1024;if(h.size>g){alert("Image file is too large. Please select an image smaller than 10MB.");return}const k=new FileReader;k.onload=async j=>{try{const _=j.target.result;if(!_||!_.startsWith("data:image/")){alert("Failed to read the image file. Please try again.");return}Ht(o,_);try{const M=await fa(()=>import("./recentImagesDB-CO6kquVm.js"),[]),B=`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;await M.saveImage(B,h.name,h),M.pruneOld(10).catch(()=>{});const Y=URL.createObjectURL(h);ve({type:"ADD_RECENTLY_UPLOADED_IMAGE",dataUrl:Y,fileName:h.name,id:B})}catch(M){console.error("Failed to persist shape image:",M)}}catch(_){console.error("Error processing image for shape:",_),alert("An error occurred while processing the image. Please try again.")}},k.onerror=()=>{alert("Failed to read the image file. Please try again.")},k.readAsDataURL(h)},n.click()},Va=l.useCallback(async({append:o=!1}={})=>{const n=ie.trim(),c=n.toLowerCase();if(o){if(!be.length||ge||F)return;H(!0),I("Loading more palettes...")}else Xt(c),Te(!0),ue(""),I("Generating palettes...");try{const{paletteSets:h,usedFallback:g}=await Jt({normalizedQuery:c,startIndex:o?be.length:0});Me(j=>o?[...j,...h]:h),o||ue("");const k=n?`Showing palettes for “${n}”`:"Showing AI + curated palettes.";I(k)}catch(h){if(console.error("Failed to generate color palettes:",h),o)ue("Unable to load more palettes right now. Scroll again to retry.");else{ue("Colormind is unavailable. Showing designer-picked palettes.");const g=Array.from({length:At},()=>gt()||{id:`fallback-${Math.random().toString(36).slice(2,6)}`,label:"Designer Fallback",colors:["#e2e8f0","#cbd5f5","#a5b4fc","#818cf8","#4c1d95"],source:"curated"});Me(g),I(n?`Showing curated palettes for “${n}”.`:"Showing curated palettes.")}}finally{o?H(!1):Te(!1)}},[ie,be.length,Jt,ge,F,gt,Xt]);l.useEffect(()=>{const o=Q.current;if(!o)return;const n=()=>{o.scrollTop+o.clientHeight>=o.scrollHeight-80&&Va({append:!0})},c=h=>{const g=o.scrollTop<=0&&h.deltaY<0,k=o.scrollTop+o.clientHeight>=o.scrollHeight-1&&h.deltaY>0;(g||k)&&(h.preventDefault(),h.stopPropagation())};return o.addEventListener("scroll",n),o.addEventListener("wheel",c,{passive:!1}),()=>{o.removeEventListener("scroll",n),o.removeEventListener("wheel",c)}},[Va,be.length,r]);const Br=l.useCallback(o=>{var h;if(!N)return;const n=tt.selectedLayerId;if(!n){ue("Select a layer on the canvas, then click a color swatch.");return}if(!((h=N.nodes)==null?void 0:h.find(g=>g.id===n))){ue("Select a layer on the canvas, then click a color swatch.");return}ve({type:"UPDATE_LAYER_PROPS",pageId:N.id,layerId:n,props:{fill:o}}),Zt(g=>[o,...g.filter(j=>j!==o)].slice(0,20)),ue("")},[N,ve,tt.selectedLayerId]),vt=l.useCallback(o=>{N&&(ve({type:"UPDATE_PAGE_PROPS",pageId:N.id,props:{background:o}}),ue(""))},[N,ve]),Wt=l.useCallback((o,n=1)=>{if(!o)return;const c=ja(o);je(c),Ne(c),Be(c.toUpperCase());const h=n<1?`rgba(${en(c)}, ${n})`:c;vt(h)},[vt,ja]);l.useCallback(o=>{if(!o){Be("");return}const n=(o.startsWith("#")?o:`#${o}`).toUpperCase();Be(n),/^#([0-9A-F]{3}|[0-9A-F]{6})$/.test(n)&&Wt(n)},[Wt]),l.useCallback(o=>{const n=Number(o);P(n);const{s:c,l:h}=Kr(U),g=hslToHex(n,c,h);Wt(g)},[Wt,U]),l.useCallback(o=>{if(fe(o),o==="gradient"){vt(et(He,ke));return}Wt(U)},[vt,et,ke,Wt,He,U]),l.useCallback((o,n)=>{Ye(c=>{const h=[...c];return h[o]=n,he==="gradient"&&vt(et(He,h)),h})},[vt,et,he,He]),l.useCallback(o=>{St(o),fe("gradient"),vt(et(o,ke))},[vt,et,ke]),l.useCallback(()=>{Ye(o=>{if(o.length>=3)return o;const n=o[o.length-1]??"#ffffff";return[...o,n]})},[]),l.useCallback(()=>{oe(o=>!o)},[]),l.useCallback(()=>{oe(!1)},[]);const Gn=({placeholder:o="Search palette type (e.g. birthday, pastel, wedding)",buttonLabel:n="Generate Colors",helperInstruction:c="Click a swatch to color the selected layer.",onApply:h=Br}={})=>a.jsxs(a.Fragment,{children:[a.jsxs("form",{className:"builder-sidebar__search palette-search",onSubmit:g=>{g.preventDefault(),Va()},children:[a.jsx("input",{type:"text",placeholder:o,value:ie,onChange:g=>Se(g.target.value)}),a.jsx("button",{type:"submit",disabled:ge,children:ge?"Generating...":n})]}),be.length>0&&a.jsx("div",{className:"builder-sidebar__palette-list builder-sidebar__palette-scroll",ref:Q,role:"region","aria-label":"Generated palettes",tabIndex:0,style:{maxHeight:"320px",overflowY:"auto",paddingRight:"8px"},children:be.map((g,k)=>{var j;return a.jsxs("div",{className:"builder-sidebar__palette",children:[a.jsxs("div",{className:"builder-sidebar__palette-header",children:[a.jsx("h3",{children:g.label??`Palette ${k+1}`}),a.jsxs("span",{children:[g.source==="colormind"?"AI generated palette":"Curated palette"," • ",c]})]}),a.jsx("div",{className:"builder-sidebar__palette-colors",children:(j=g.colors)==null?void 0:j.map((_,M)=>{var B;return a.jsxs("div",{className:"builder-sidebar__palette-item",children:[a.jsx("button",{type:"button",className:"builder-sidebar__palette-swatch",style:{backgroundColor:_},title:`Apply ${_}`,onClick:()=>h(_)}),a.jsx("span",{className:"builder-sidebar__palette-code",children:((B=_==null?void 0:_.toUpperCase)==null?void 0:B.call(_))??_})]},`${k}-${M}`)})})]},g.id??`palette-${k}`)})}),F&&a.jsx("div",{className:"builder-sidebar__hint",style:{color:"#0f172a",fontWeight:600},children:"Loading more palettes..."}),y&&a.jsx("div",{className:"builder-sidebar__hint",style:{color:"#0f172a",fontWeight:600},children:y}),Pe&&a.jsx("div",{className:"builder-sidebar__hint",style:{color:"#b45309",fontWeight:600},children:Pe})]}),da=l.useCallback((o={})=>{const{family:n,weights:c}=o;if(!n)return;const h=Array.isArray(c)&&c.length>0?Array.from(new Set(c.map(_=>{if(typeof _=="number")return String(_);if(typeof _=="string"){const M=_.match(/\d+/);return M?M[0]:_.toLowerCase().includes("bold")?"700":"400"}return"400"}))):["400"],g=h.length>0?h.join(";"):"400",k=`${n}-${g}`;if(Lr.current.has(k))return;const j=document.createElement("link");j.rel="stylesheet",j.href=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(n)}:wght@${g}&display=swap`,document.head.appendChild(j),Lr.current.add(k)},[]),Qn=l.useCallback(o=>{var n;!N||!((n=o==null?void 0:o.layers)!=null&&n.length)||(o.layers.forEach(c=>{da({family:c.family,weights:[c.fontWeight??"400"]})}),o.layers.forEach((c,h)=>{const g=De("text",N,{name:`${o.label??"Font Combo"} ${c.role??h+1}`,content:c.content,fontSize:c.fontSize??32,fontWeight:c.fontWeight??"400",fontFamily:`${c.family}, ${c.fallback??"sans-serif"}`,textAlign:c.align??o.align??"center",textTransform:c.transform??"none",letterSpacing:c.letterSpacing??0});if(g.frame){const k=c.offsetY??h*64;g.frame={...g.frame,width:c.width??g.frame.width,height:c.height??g.frame.height,x:g.frame.x,y:g.frame.y+k},g.frame=nt(g.frame,N,Ve)}ve({type:"ADD_LAYER",pageId:N.id,layer:g})}))},[N,ve,da,Ve]);l.useEffect(()=>{_t.forEach(o=>{var n;(n=o.layers)==null||n.forEach(c=>{da({family:c.family,weights:[c.fontWeight??"400"]})})})},[_t,da]);const Xn=async o=>{if(!N)return;const n=(o==null?void 0:o.downloadUrl)||(o==null?void 0:o.previewUrl)||(o==null?void 0:o.thumbUrl);if(!n){alert("Unable to load the selected icon. Please choose another one.");return}try{const c=await fetch(n);if(!c.ok)throw new Error(`Network error: ${c.status}`);const h=await c.blob(),g=new FileReader;g.onload=()=>{const k=g.result,j=new Image;j.onload=()=>{const _=j.naturalWidth||j.width,M=j.naturalHeight||j.height,B=Math.round(N.width*.15),Y=Math.round(N.height*.15),K=Math.min(1,B/_,Y/M),Z=Math.max(1,Math.round(_*K)),le=Math.max(1,Math.round(M*K)),E=Math.round((N.width-Z)/2),de=Math.round((N.height-le)/2),G=De("image",N,{name:(o==null?void 0:o.description)||"Icon",content:k,metadata:{objectFit:"contain",imageScale:1,imageOffsetX:0,imageOffsetY:0,attribution:o==null?void 0:o.credit,isIcon:!0}});G.frame={x:E,y:de,width:Z,height:le,rotation:0},G.frame&&(G.frame=nt(G.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:G})},j.src=k},g.readAsDataURL(h)}catch(c){console.error("Failed to load icon:",c),alert("Failed to load icon. Please try again.")}},Ra=l.useCallback(async(o,n)=>{const c=o==null?void 0:o.trim();if(!c)return{items:[],hasMore:!1};const h=20,g=(n-1)*h;try{const k=gs.REACT_APP_GOOGLE_FONTS_API_KEY||"AIzaSyB8AzfLkq8VwHq5t5n5n5n5n5n5n5n5n5",j=await fetch(`https://www.googleapis.com/webfonts/v1/webfonts?key=${k}&sort=popularity`);if(!j.ok)throw new Error(`Google Fonts API error: ${j.status}`);const B=((await j.json()).items||[]).filter(E=>E.family.toLowerCase().includes(c.toLowerCase())||E.category&&E.category.toLowerCase().includes(c.toLowerCase())),Y=g,K=Y+h;return{items:B.slice(Y,K).map(E=>({id:`font-${E.family.replace(/\s+/g,"-").toLowerCase()}`,family:E.family,category:E.category,variants:E.variants,subsets:E.subsets,version:E.version,lastModified:E.lastModified,files:E.files,provider:"google-fonts",providerLabel:"Google Fonts",credit:"Google Fonts"})),hasMore:K<B.length}}catch(k){console.error("Google Fonts API failed:",k);const _=[{family:"Inter",category:"sans-serif",variants:["400","500","600","700"]},{family:"Roboto",category:"sans-serif",variants:["300","400","500","700"]},{family:"Open Sans",category:"sans-serif",variants:["300","400","600","700"]},{family:"Lato",category:"sans-serif",variants:["300","400","700"]},{family:"Montserrat",category:"sans-serif",variants:["400","500","600","700"]},{family:"Poppins",category:"sans-serif",variants:["300","400","500","600","700"]},{family:"Nunito",category:"sans-serif",variants:["300","400","600","700"]},{family:"Playfair Display",category:"serif",variants:["400","700"]},{family:"Merriweather",category:"serif",variants:["300","400","700"]},{family:"Crimson Text",category:"serif",variants:["400","600"]}].filter(Z=>Z.family.toLowerCase().includes(c.toLowerCase())||Z.category.toLowerCase().includes(c.toLowerCase())),M=g,B=M+h;return{items:_.slice(M,B).map(Z=>({id:`font-${Z.family.replace(/\s+/g,"-").toLowerCase()}`,family:Z.family,category:Z.category,variants:Z.variants,subsets:["latin"],provider:"fallback",providerLabel:"System Fonts",credit:"System Fonts"})),hasMore:B<_.length}}},[]);l.useCallback(async o=>{const n=(o??"").trim();if(!n){ot([]),ra.current=!1,Lt(1),yt.current=1,bt(!1);return}ra.current=!0,va.current=n,ba(!0),Lt(1),yt.current=1,bt(!0);try{const{items:c,hasMore:h}=await Ra(n,1);ot(c);const g=c.length>0?2:1;Lt(g),yt.current=g,bt(h)}catch(c){console.error("Font search failed:",c),alert("Some font providers are unavailable. Showing fallback fonts instead."),bt(!1)}finally{ba(!1)}},[Ra]);const Ja=l.useCallback(async()=>{if(Ee||!Qe)return;const o=va.current.trim();if(o){ya(!0);try{const{items:n,hasMore:c}=await Ra(o,yt.current);if(n.length>0){ot(g=>[...g,...n]);const h=yt.current+1;Lt(h),yt.current=h}bt(c&&n.length>0)}catch(n){console.error("Load more fonts failed:",n),alert("Unable to load more fonts. Using available fonts."),bt(!1)}finally{ya(!1)}}},[Ra,Qe,Ee]),Ka=l.useRef(Ja);l.useEffect(()=>{Ka.current=Ja},[Ja]),l.useEffect(()=>{if(Nt.length===0||!Qe)return;const o=document.querySelector(".font-loading-indicator"),n=document.querySelector(".builder-sidebar__font-results");if(!o||!n){console.log("Font loading indicator or scroll container not found");return}console.log("Setting up IntersectionObserver for font loading indicator");const c=new IntersectionObserver(h=>{const[g]=h;console.log("Font IntersectionObserver triggered:",{isIntersecting:g.isIntersecting,isLoadingMoreFonts:Ee,hasMoreFonts:Qe,fontSearchResultsLength:Nt.length}),g.isIntersecting&&!Ee&&Qe&&(console.log("Loading more fonts via IntersectionObserver..."),Ka.current())},{root:n,rootMargin:"50px",threshold:.1});return c.observe(o),()=>{console.log("Cleaning up font IntersectionObserver"),c.disconnect()}},[Nt.length,Qe,Ee]),l.useEffect(()=>{const o=document.querySelector(".builder-sidebar__font-results");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const qn=l.useCallback(()=>{!Ee&&Qe&&Ka.current()},[Ee,Qe]),Vn=o=>{if(!N)return;da({family:o.family,weights:o.variants});const n=De("text",N,{name:`${o.family} Text`,content:"Sample text with new font",fontSize:32,fontFamily:`${o.family}, ${o.category}`,fontWeight:"400"});n.frame&&(n.frame=nt(n.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:n})},Jn=l.useCallback(async o=>{const n=(o??"").trim();if(!n){Dt.current=!0,kt(!0),ia(1),Ft.current=1,lt(!0);try{const c=await fetch("https://zenquotes.io/api/random/6");if(!c.ok)throw new Error(`API request failed: ${c.status}`);const h=await c.json();let g=[];Array.isArray(h)&&(g=h.map((j,_)=>({id:`random-quote-${Ft.current}-${_}`,content:j.q||"",author:j.a||"Unknown",category:"inspiration"})).filter(j=>j.content.trim()!=="")),g.length===0&&(g=[{id:"fallback-quote-1",content:"The only way to do great work is to love what you do.",author:"Steve Jobs",category:"motivation"},{id:"fallback-quote-2",content:"Believe you can and you're halfway there.",author:"Theodore Roosevelt",category:"inspiration"},{id:"fallback-quote-3",content:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt",category:"dreams"},{id:"fallback-quote-4",content:"You miss 100% of the shots you don't take.",author:"Wayne Gretzky",category:"opportunity"},{id:"fallback-quote-5",content:"The best way to predict the future is to create it.",author:"Peter Drucker",category:"future"},{id:"fallback-quote-6",content:"Keep your face always toward the sunshine—and shadows will fall behind you.",author:"Walt Whitman",category:"positivity"}]),zt(g);const k=g.length>0?2:1;ia(k),Ft.current=k,lt(!1)}catch(c){console.error("Quote generation failed:",c),alert("Some quote providers are unavailable. Showing fallback quotes instead."),zt([{id:"error-fallback-1",content:"The only way to do great work is to love what you do.",author:"Steve Jobs",category:"motivation"},{id:"error-fallback-2",content:"Believe you can and you're halfway there.",author:"Theodore Roosevelt",category:"inspiration"},{id:"error-fallback-3",content:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt",category:"dreams"}]),lt(!1)}finally{kt(!1)}return}Dt.current=!0,xa.current=n,kt(!0),ia(1),Ft.current=1,lt(!1);try{alert('Quote search is not currently supported. Use "Generate Quotes" for random inspirational quotes.');const c=[{id:"search-quote-1",content:"Success is not final, failure is not fatal: It is the courage to continue that counts.",author:"Winston Churchill",category:"perseverance"},{id:"search-quote-2",content:"The only impossible journey is the one you never begin.",author:"Tony Robbins",category:"journey"},{id:"search-quote-3",content:"Your time is limited, so don't waste it living someone else's life.",author:"Steve Jobs",category:"life"},{id:"search-quote-4",content:"The way to get started is to quit talking and begin doing.",author:"Walt Disney",category:"action"},{id:"search-quote-5",content:"Don't watch the clock; do what it does. Keep going.",author:"Sam Levenson",category:"persistence"}],h=c.filter(g=>g.content.toLowerCase().includes(n.toLowerCase())||g.author.toLowerCase().includes(n.toLowerCase())||g.category.toLowerCase().includes(n.toLowerCase()));zt(h.length>0?h:c)}catch(c){console.error("Quote search failed:",c),alert("Some quote providers are unavailable. Showing fallback quotes instead."),lt(!1)}finally{kt(!1)}},[]),er=l.useCallback(async()=>{if(Le||!Xe)return;if(xa.current.trim())alert('Quote search is not currently supported. Use "Generate Quotes" for random inspirational quotes.');else{wa(!0);try{const n=await fetch("https://zenquotes.io/api/random/6");if(!n.ok)throw new Error(`API request failed: ${n.status}`);const c=await n.json();let h=[];Array.isArray(c)&&(h=c.map((g,k)=>({id:`random-quote-more-${Date.now()}-${k}`,content:g.q||"",author:g.a||"Unknown",category:"inspiration"})).filter(g=>g.content.trim()!=="")),h.length===0&&(h=[{id:`additional-quote-${Date.now()}-1`,content:"The only limit to our realization of tomorrow will be our doubts of today.",author:"Franklin D. Roosevelt",category:"doubts"},{id:`additional-quote-${Date.now()}-2`,content:"What lies behind us and what lies before us are tiny matters compared to what lies within us.",author:"Ralph Waldo Emerson",category:"inner strength"}]),zt(g=>[...g,...h]),lt(!1)}catch(n){console.error("Load more quotes failed:",n),alert("Unable to load more quotes. Using available quotes."),lt(!1)}finally{wa(!1)}}},[Xe,Le]),tr=l.useRef(er);l.useEffect(()=>{tr.current=er},[er]),l.useEffect(()=>{if(Ct.length===0||!Xe)return;const o=document.querySelector(".quote-loading-indicator"),n=document.querySelector(".builder-sidebar__quote-results");if(!o||!n){console.log("Quote loading indicator or scroll container not found");return}console.log("Setting up IntersectionObserver for quote loading indicator");const c=new IntersectionObserver(h=>{const[g]=h;console.log("Quote IntersectionObserver triggered:",{isIntersecting:g.isIntersecting,isLoadingMoreQuotes:Le,hasMoreQuotes:Xe,quoteSearchResultsLength:Ct.length}),g.isIntersecting&&!Le&&Xe&&(console.log("Loading more quotes via IntersectionObserver..."),tr.current())},{root:n,rootMargin:"50px",threshold:.1});return c.observe(o),()=>{console.log("Cleaning up quote IntersectionObserver"),c.disconnect()}},[Ct.length,Xe,Le]),l.useEffect(()=>{const o=document.querySelector(".builder-sidebar__quote-results");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const Kn=l.useCallback(()=>{!Le&&Xe&&tr.current()},[Le,Xe]),ei=o=>{if(!N)return;const n=De("text",N,{name:"Quote",content:`"${o.content}"

— ${o.author}`,fontSize:28,fontFamily:"Georgia, serif",fontWeight:"400",textAlign:"center"});n.frame&&(n.frame=nt(n.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:n})};l.useEffect(()=>{!me.current||!X.current||Ca(X.current)},[Ca,q,re]),l.useEffect(()=>{if(m.length===0||!O)return;const o=document.querySelector(".loading-indicator");if(!o){console.log("Loading indicator not found");return}console.log("Setting up IntersectionObserver for loading indicator");const n=new IntersectionObserver(c=>{const[h]=c;console.log("IntersectionObserver triggered:",{isIntersecting:h.isIntersecting,isLoadingMore:R,hasMore:O}),h.isIntersecting&&!R&&O&&s.trim()&&(console.log("Loading more images via IntersectionObserver..."),Fr.current())},{root:document.querySelector(".builder-sidebar__search-results"),rootMargin:"100px",threshold:.1});return n.observe(o),()=>{console.log("Cleaning up IntersectionObserver"),n.disconnect()}},[m.length,O,R,s]),l.useEffect(()=>{const o=document.querySelector(".builder-sidebar__search-results");if(!o)return;const n=c=>{const{scrollTop:h,scrollHeight:g,clientHeight:k}=c.target,j=h===0,_=h+k>=g;j&&c.deltaY<0||_&&c.deltaY>0||c.stopPropagation()};return o.addEventListener("wheel",n,{passive:!0}),o.addEventListener("touchmove",n,{passive:!0}),()=>{o.removeEventListener("wheel",n),o.removeEventListener("touchmove",n)}},[]);const ti=async o=>{if(!N)return;const n=(o==null?void 0:o.downloadUrl)||(o==null?void 0:o.previewUrl)||(o==null?void 0:o.thumbUrl);if(!n){alert("Unable to load the selected image. Please choose another one.");return}try{const c=await fetch(n);if(!c.ok)throw new Error(`Network error: ${c.status}`);const h=await c.blob(),g=new FileReader;g.onload=()=>{const k=g.result,j=new Image;j.onload=()=>{const _=j.naturalWidth||j.width,M=j.naturalHeight||j.height,B=Math.round(N.width*.85),Y=Math.round(N.height*.85),K=Math.min(1,B/_,Y/M),Z=Math.max(1,Math.round(_*K)),le=Math.max(1,Math.round(M*K)),E=Math.round((N.width-Z)/2),de=Math.round((N.height-le)/2),G=De("image",N,{name:(o==null?void 0:o.description)||`${(o==null?void 0:o.providerLabel)??"Stock"} image`,content:k,metadata:{objectFit:"cover",imageScale:1,imageOffsetX:0,imageOffsetY:0,attribution:o==null?void 0:o.credit}});G.frame={x:E,y:de,width:Z,height:le,rotation:0},G.frame&&(G.frame=nt(G.frame,N,Ve)),ve({type:"ADD_LAYER",pageId:N.id,layer:G})},j.src=k},g.readAsDataURL(h)}catch(c){console.error("Failed to load photo:",c),alert("Failed to load photo. Please try again.")}},ai=()=>{var o;if(!N)return a.jsx("div",{className:"builder-sidebar__empty-state",children:"Create a page to start designing."});switch(r){case"text":return a.jsxs("div",{className:"builder-sidebar__content builder-sidebar__content--text",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsxs("div",{children:[a.jsx("h2",{children:"Text"}),a.jsx("p",{children:"Add quick headings, stylized blocks, or browse the full font library."})]}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("div",{className:"text-panel",children:a.jsxs("div",{className:"text-panel__canvas",ref:Hn,children:[a.jsx("div",{className:"text-panel__quick",style:{marginBottom:"1rem"},children:a.jsxs("div",{className:"text-panel__quick-actions",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[a.jsx("button",{type:"button",className:"text-panel__quick-btn",style:{borderRadius:"0.5rem",border:"1px solid rgba(37, 99, 235, 0.25)",background:"rgba(37, 99, 235, 0.08)",color:"var(--builder-text)",padding:"0.4rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"background 0.15s ease",width:"100%"},onClick:()=>Ya({name:"Heading",content:"Add header",fontSize:52}),onMouseEnter:n=>n.target.style.background="rgba(37, 99, 235, 0.15)",onMouseLeave:n=>n.target.style.background="rgba(37, 99, 235, 0.08)",children:"add header"}),a.jsx("button",{type:"button",className:"text-panel__quick-btn",style:{borderRadius:"0.5rem",border:"1px solid rgba(37, 99, 235, 0.25)",background:"rgba(37, 99, 235, 0.08)",color:"var(--builder-text)",padding:"0.4rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"background 0.15s ease",width:"100%"},onClick:()=>Ya({name:"Subheading",content:"Add sub header",fontSize:34}),onMouseEnter:n=>n.target.style.background="rgba(37, 99, 235, 0.15)",onMouseLeave:n=>n.target.style.background="rgba(37, 99, 235, 0.08)",children:"add sub header"}),a.jsx("button",{type:"button",className:"text-panel__quick-btn",style:{borderRadius:"0.5rem",border:"1px solid rgba(37, 99, 235, 0.25)",background:"rgba(37, 99, 235, 0.08)",color:"var(--builder-text)",padding:"0.4rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"background 0.15s ease",width:"100%"},onClick:()=>Ya({name:"Body text",content:"Add body text",fontSize:26,align:"left"}),onMouseEnter:n=>n.target.style.background="rgba(37, 99, 235, 0.15)",onMouseLeave:n=>n.target.style.background="rgba(37, 99, 235, 0.08)",children:"add body text"})]})}),a.jsxs("div",{className:"text-panel__styled-presets",ref:la,children:[a.jsx("div",{className:"text-panel__styled-grid",children:_t.map(n=>{var c;return a.jsx("button",{type:"button",className:"styled-text-preset",onClick:()=>Qn(n),title:`Add styled combo: ${n.label}`,children:a.jsxs("div",{className:"styled-text-preview multi-layer",children:[(c=n.layers)==null?void 0:c.map((h,g)=>a.jsx("div",{className:"styled-text-preview__line",style:{fontFamily:`${h.family}, ${h.fallback??"sans-serif"}`,fontSize:`${(h.fontSize??28)*.6}px`,fontWeight:h.fontWeight??"400",textAlign:h.align??n.align??"center",textTransform:h.transform??"none",letterSpacing:`${h.letterSpacing??0}px`},children:h.content},`${n.id}-${h.role??g}`)),n.description&&a.jsx("div",{className:"styled-text-preview__description",children:n.description})]})},n.id)})}),a.jsx("div",{className:"styled-loading-indicator",children:(ct||dt)&&a.jsx("span",{children:ct?"Loading styled presets...":"Scroll for more presets"})})]}),Nt.length>0?a.jsxs("div",{className:"builder-sidebar__font-results",children:[Nt.map(n=>a.jsxs("button",{type:"button",className:"search-result-thumb font-result-thumb",onClick:()=>Vn(n),title:`${n.family} (${n.category}) - ${n.providerLabel}`,children:[a.jsx("div",{className:"font-preview",style:{fontFamily:`${n.family}, ${n.category}`,fontSize:"16px",fontWeight:"400",textAlign:"center",padding:"8px",backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"4px",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.family}),a.jsx("span",{className:"search-result-provider-tag",children:n.providerLabel})]},n.id)),Qe&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"font-loading-indicator",children:[a.jsx("div",{className:`spinner ${Ee?"loading":""}`}),a.jsx("span",{children:Ee?"Loading more fonts...":"Scroll for more fonts"})]}),a.jsx("div",{className:"load-more-container",children:a.jsx("button",{type:"button",className:"load-more-btn",onClick:qn,disabled:Ee,children:Ee?"Loading...":"Load More Fonts"})})]})]}):ra.current?a.jsx("div",{className:"builder-sidebar__empty-state",children:Ua?"Searching for fonts...":"No fonts found. Try a different search term."}):null]})})]});case"shapes":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Shapes"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Search for shapes from multiple providers."}),a.jsx("div",{className:"builder-sidebar__provider-note",children:"Shapes from Iconify and Simple Icons. Please display attribution when publishing your design."}),a.jsxs("div",{className:"builder-sidebar__search",children:[a.jsx("input",{ref:n=>{Ma.current=n},type:"text",placeholder:"Search for shapes...",value:L,onChange:n=>T(n.target.value),onKeyDown:n=>n.key==="Enter"&&Dr(n.target.value)}),a.jsx("button",{type:"button",onClick:()=>{var n;return Dr(((n=Ma.current)==null?void 0:n.value)||L)},disabled:ye,children:ye?"Searching...":"Search"})]}),!ca.current&&a.jsx("div",{className:"builder-sidebar__hint",style:{marginBottom:"10px",fontSize:"12px",color:"#666"},children:"Popular shapes (search above for more options):"}),!ca.current&&a.jsx("div",{className:"builder-sidebar__shape-presets",style:{marginBottom:"15px"},children:a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Ht("rectangle"),style:{padding:"8px",fontSize:"12px"},children:"□ Rectangle"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Pa("rectangle"),style:{padding:"8px",fontSize:"12px"},children:"□ + Image"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Ht("circle"),style:{padding:"8px",fontSize:"12px"},children:"○ Circle"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Pa("circle"),style:{padding:"8px",fontSize:"12px"},children:"○ + Image"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Ht("triangle"),style:{padding:"8px",fontSize:"12px"},children:"△ Triangle"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Pa("triangle"),style:{padding:"8px",fontSize:"12px"},children:"△ + Image"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Ht("star"),style:{padding:"8px",fontSize:"12px"},children:"★ Star"}),a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Pa("star"),style:{padding:"8px",fontSize:"12px"},children:"★ + Image"})]})}),ae.length>0?a.jsxs("div",{className:"builder-sidebar__shape-results",children:[ae.map(n=>a.jsxs("button",{type:"button",className:"search-result-thumb",onClick:()=>Zn(n),title:`${n.description} (${n.providerLabel})`,children:[a.jsx("img",{src:n.thumbUrl,alt:n.description,style:{width:64,height:64,objectFit:"contain",backgroundColor:"#fff"},onError:c=>{try{c.target.onerror=null;const g=`<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='%23f3f4f6'/><text x='50%' y='50%' font-size='14' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-family='Arial,Helvetica,sans-serif'>${(n.description||"sh").toUpperCase().slice(0,2)}</text></svg>`;c.target.src="data:image/svg+xml;utf8,"+encodeURIComponent(g)}catch{}}}),n.providerLabel!=="Iconify"&&a.jsx("span",{className:"search-result-provider-tag",children:n.providerLabel})]},n.id)),ft&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"shape-loading-indicator",children:[a.jsx("div",{className:`spinner ${ze?"loading":""}`}),a.jsx("span",{children:ze?"Loading more shapes...":"Scroll for more shapes"})]}),a.jsx("div",{className:"load-more-container",children:a.jsx("button",{type:"button",className:"load-more-btn",onClick:$n,disabled:ze,children:ze?"Loading...":"Load More Shapes"})})]})]}):ca.current?a.jsx("div",{className:"builder-sidebar__empty-state",children:ye?"Searching for shapes...":"No shapes found. Try a different search term."}):null]});case"images":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Upload"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Upload and add images to enhance your design."}),a.jsx("div",{className:"builder-sidebar__tool-actions",children:a.jsx("button",{type:"button",className:"tool-action-btn",onClick:Wn,children:"Upload image"})}),a.jsxs("div",{className:"builder-sidebar__recently-uploaded",children:[a.jsx("h3",{children:"Recently Upload"}),a.jsx("div",{className:"builder-sidebar__recent-items",children:tt.recentlyUploadedImages&&tt.recentlyUploadedImages.length>0?a.jsx("div",{className:"inspector-recent-images",children:tt.recentlyUploadedImages.map(n=>a.jsxs("div",{className:"inspector-recent-image__tile",children:[a.jsx("button",{type:"button",className:"inspector-recent-image",onClick:()=>On(n),title:n.fileName,"aria-label":`Use recently uploaded image: ${n.fileName}`,children:a.jsx("img",{src:n.dataUrl,alt:n.fileName,className:"inspector-recent-image__thumb",onError:c=>{c.target.style.display="none"}})}),a.jsx("button",{type:"button",className:"inspector-recent-image__delete",title:"Delete recent upload","aria-label":`Delete recent upload ${n.fileName}`,onClick:async c=>{c.stopPropagation();try{const h=await fa(()=>import("./recentImagesDB-CO6kquVm.js"),[]);if(n.dataUrl&&n.dataUrl.startsWith("blob:"))try{URL.revokeObjectURL(n.dataUrl)}catch{}await h.deleteImage(n.id),ve({type:"DELETE_RECENTLY_UPLOADED_IMAGE",id:n.id})}catch(h){console.error("Failed to delete recent image",h),alert("Failed to delete recent image. See console for details.")}},children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",style:{width:14,height:14},children:[a.jsx("path",{d:"M3 6h18"}),a.jsx("path",{d:"M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6"}),a.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),a.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"}),a.jsx("path",{d:"M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"})]})})]},n.id))}):a.jsx("div",{className:"builder-sidebar__empty-state",children:"Recently uploaded images will appear here."})})]}),a.jsx("div",{className:"builder-sidebar__hint",children:"Image uploads will connect to the asset library in a future release."})]});case"photos":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Photos"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Search for royalty-free images from Unsplash and Pixabay."}),a.jsx("div",{className:"builder-sidebar__provider-toggle",role:"group","aria-label":"Choose image provider",children:ys.map(n=>a.jsx("button",{type:"button",className:`filter-btn ${q===n.id?"active":""}`,onClick:()=>ce(n.id),children:n.label},n.id))}),a.jsxs("div",{className:"builder-sidebar__provider-note",children:["Showing results from ",$a,". Please display attribution when publishing your design."]}),a.jsx("div",{className:"builder-sidebar__filters",role:"group","aria-label":"Filter results",children:bs.map(n=>a.jsx("button",{type:"button",className:`filter-btn ${re===n.id?"active":""}`,onClick:()=>A(n.id),children:n.label},n.id))}),a.jsxs("div",{className:"builder-sidebar__search",children:[a.jsx("input",{type:"text",placeholder:"Search for photos...",value:s,onChange:n=>d(n.target.value),onKeyDown:n=>n.key==="Enter"&&Ca(n.target.value)}),a.jsx("button",{type:"button",onClick:()=>Ca(s),disabled:p,children:p?"Searching...":"Search"})]}),m.length>0&&a.jsxs("div",{className:"builder-sidebar__search-results",children:[m.map(n=>a.jsx("button",{type:"button",className:"search-result-thumb",onClick:()=>ti(n),title:`${n.description} (${n.providerLabel})`,children:a.jsx("img",{src:n.thumbUrl,alt:n.description,style:{width:96,height:96,objectFit:"cover",backgroundColor:"#f3f4f6"},onError:c=>{try{c.target.onerror=null;const g=`<svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'><rect width='100%' height='100%' fill='%23e5e7eb'/><text x='50%' y='50%' font-size='12' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-family='Arial,Helvetica,sans-serif'>${(n.description||"img").toUpperCase().slice(0,3)}</text></svg>`;c.target.src="data:image/svg+xml;utf8,"+encodeURIComponent(g)}catch{}}})},n.id)),O&&a.jsxs("div",{className:"loading-indicator",children:[a.jsx("div",{className:`spinner ${R?"loading":""}`}),a.jsx("span",{children:R?`Loading more ${$a} images...`:`Scroll for more ${$a} images`})]})]})]});case"background":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Background"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("div",{className:"builder-sidebar__empty-state",children:"Background controls have been removed."})]});case"colors":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Colors"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Generate beautiful color palettes and access color tools for your designs."}),Gn({buttonLabel:"Generate Colors",helperInstruction:"Click a swatch to color the selected layer.",onApply:Br,placeholder:"Search palette type (e.g. birthday, pastel, wedding)"})]});case"quotes":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Quotes"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Generate inspirational quotes to add to your design."}),a.jsx("div",{className:"builder-sidebar__provider-note",children:"Quotes powered by ZenQuotes API. Please display attribution when publishing your design."}),a.jsx("div",{className:"builder-sidebar__tool-actions",children:a.jsx("button",{type:"button",className:"tool-action-btn",onClick:()=>Jn(""),disabled:na,children:na?"Generating...":"Generate Quotes"})}),!Dt.current&&a.jsx("div",{className:"builder-sidebar__hint",style:{marginBottom:"10px",fontSize:"12px",color:"#666"},children:'Click "Generate Quotes" to get inspirational quotes:'}),Ct.length>0?a.jsxs("div",{className:"builder-sidebar__quote-results",children:[Ct.map(n=>a.jsxs("button",{type:"button",className:"quote-result-item",onClick:()=>ei(n),title:`"${n.content}" — ${n.author}`,children:[a.jsxs("div",{className:"quote-content",children:[a.jsxs("blockquote",{children:['"',n.content,'"']}),a.jsxs("cite",{children:["— ",n.author]})]}),n.category&&a.jsx("span",{className:"quote-category",children:n.category})]},n.id)),Xe&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"quote-loading-indicator",children:[a.jsx("div",{className:`spinner ${Le?"loading":""}`}),a.jsx("span",{children:Le?"Loading more quotes...":"Scroll for more quotes"})]}),a.jsx("div",{className:"load-more-container",children:a.jsx("button",{type:"button",className:"load-more-btn",onClick:Kn,disabled:Le,children:Le?"Loading...":"Load More Quotes"})})]})]}):Dt.current?a.jsx("div",{className:"builder-sidebar__empty-state",children:na?"Generating quotes...":"No quotes available. Try generating again."}):null]});case"icons":return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:"Icons"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Search for icons from multiple providers."}),a.jsx("div",{className:"builder-sidebar__provider-note",children:"Icons from Simple Icons, IconFinder, Iconify, and Flaticon. Please display attribution when publishing your design."}),a.jsxs("div",{className:"builder-sidebar__search",children:[a.jsx("input",{ref:n=>{Ma.current=n},type:"text",placeholder:"Search for icons...",value:Kt,onChange:n=>ma(n.target.value),onKeyDown:n=>n.key==="Enter"&&Tr(n.target.value)}),a.jsx("button",{type:"button",onClick:()=>{var n;return Tr(((n=Ma.current)==null?void 0:n.value)||Kt)},disabled:ta,children:ta?"Searching...":"Search"})]}),!jt.current&&a.jsx("div",{className:"builder-sidebar__hint",style:{marginBottom:"10px",fontSize:"12px",color:"#666"},children:"Popular icons (search above for more options):"}),Mt.length>0?a.jsxs("div",{className:"builder-sidebar__icon-results",children:[Mt.map(n=>a.jsxs("button",{type:"button",className:"search-result-thumb",onClick:()=>Xn(n),title:`${n.description} (${n.providerLabel})`,children:[a.jsx("img",{src:n.thumbUrl,alt:n.description,style:{width:64,height:64,objectFit:"contain",backgroundColor:"#fff"},onError:c=>{try{c.target.onerror=null;const g=`<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='100%' height='100%' fill='%23f3f4f6'/><text x='50%' y='50%' font-size='14' dominant-baseline='middle' text-anchor='middle' fill='%236b7280' font-family='Arial,Helvetica,sans-serif'>${(n.description||"ic").toUpperCase().slice(0,2)}</text></svg>`;c.target.src="data:image/svg+xml;utf8,"+encodeURIComponent(g)}catch{}}}),n.providerLabel!=="Iconify"&&a.jsx("span",{className:"search-result-provider-tag",children:n.providerLabel})]},n.id)),Ge&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"icon-loading-indicator",children:[a.jsx("div",{className:`spinner ${Ae?"loading":""}`}),a.jsx("span",{children:Ae?"Loading more icons...":"Scroll for more icons"})]}),a.jsx("div",{className:"load-more-container",children:a.jsx("button",{type:"button",className:"load-more-btn",onClick:Yn,disabled:Ae,children:Ae?"Loading...":"Load More Icons"})})]})]}):jt.current?a.jsx("div",{className:"builder-sidebar__empty-state",children:ta?"Searching for icons...":"No icons found. Try a different search term."}):null]});default:return a.jsxs("div",{className:"builder-sidebar__content",children:[a.jsxs("div",{className:"builder-sidebar__header",children:[a.jsx("h2",{children:((o=tn.find(n=>n.id===r))==null?void 0:o.label)??"Tools"}),a.jsx("button",{type:"button",className:"builder-sidebar-toggle",onClick:t,"aria-label":"Hide sidebar",title:"Hide sidebar",children:a.jsx("i",{className:"fas fa-chevron-left","aria-hidden":"true"})})]}),a.jsx("p",{children:"Additional creative resources will appear here soon."}),a.jsx("div",{className:"builder-sidebar__empty-state",children:"Tool-specific controls will render here as the builder matures."})]})}};return a.jsxs(a.Fragment,{children:[a.jsxs("nav",{className:`builder-sidebar ${e?"is-collapsed":""}`,"aria-label":"Primary design tools",children:[a.jsxs("div",{className:"builder-sidebar__tabs",role:"tablist","aria-orientation":"vertical",children:[tn.map(o=>a.jsxs("button",{type:"button",role:"tab","aria-selected":r===o.id,className:`builder-sidebar__tab ${r===o.id?"is-active":""}`,onClick:()=>i(o.id),children:[a.jsx("i",{className:o.icon,"aria-hidden":"true"}),a.jsx("span",{children:o.label})]},o.id)),e&&a.jsx("button",{type:"button",className:"builder-sidebar__expand-toggle",onClick:t,"aria-label":"Expand sidebar",title:"Expand sidebar",children:a.jsx("i",{className:"fas fa-chevron-right","aria-hidden":"true"})})]}),!e&&a.jsx("div",{className:"builder-sidebar__panel",role:"tabpanel","aria-live":"polite",children:ai()})]}),a.jsx("input",{type:"file",ref:zr,onChange:Un,accept:"image/*",style:{display:"none"}})]})}var mr=si();function Is(e){if(!e)return{top:0,right:0,bottom:0,left:0};const t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const s=parseFloat(i);return Number.isNaN(s)?0:s}return 0},r=t(e.margin??e.all??0);return{top:t(e.top??r),right:t(e.right??r),bottom:t(e.bottom??r),left:t(e.left??r)}}function Ln(e,t,r){const i=r.left,s=t.width-r.right-e.width,d=r.top,m=t.height-r.bottom-e.height;return{...e,x:Math.max(i,Math.min(s,e.x)),y:Math.max(d,Math.min(m,e.y))}}function Ms(e,t,r,i){const s=Math.max(0,r.width-i.left-i.right),d=Math.max(0,r.height-i.top-i.bottom),m=Math.min(e,s),f=Math.min(t,d),p=i.left+Math.round((s-m)/2),b=i.top+Math.round((d-f)/2);return{x:p,y:b,width:Math.max(24,m),height:Math.max(24,f),rotation:0}}function js(e,t,r,i,s){const d=e.x+e.width/2,m=e.y+e.height/2,f={x:Math.round(d-t/2),y:Math.round(m-r/2),width:t,height:r,rotation:e.rotation??0};return Ln(f,i,s)}const Ns=[{id:"rectangle",group:"basic",label:"Rectangle",description:"Standard invitation rectangle",preview:"rectangle",variant:"rectangle",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(110,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"square",group:"basic",label:"Square",description:"Even sides for balanced layouts",preview:"square",variant:"rectangle",borderRadius:8,getSize:({page:e,safeInsets:t})=>{const r=Math.min(e.width-t.left-t.right,e.height-t.top-t.bottom),i=Math.max(120,Math.round(r*.55));return{width:i,height:i}}},{id:"circle",group:"basic",label:"Circle",description:"Perfect circular badge or avatar",preview:"circle",variant:"circle",borderRadius:9999,getSize:({page:e,safeInsets:t})=>{const r=Math.min(e.width-t.left-t.right,e.height-t.top-t.bottom),i=Math.max(120,Math.round(r*.5));return{width:i,height:i}}},{id:"oval",group:"basic",label:"Oval",description:"Elongated oval for decorative layouts",preview:"oval",variant:"rectangle",borderRadius:9999,getSize:({page:e,safeInsets:t})=>{const r=e.width-t.left-t.right,i=Math.max(200,Math.round(r*.7)),s=Math.max(110,Math.round(i*.44));return{width:i,height:s}}},{id:"rounded-rectangle",group:"basic",label:"Rounded Rectangle",description:"Rectangle with soft rounded corners",preview:"rounded-rectangle",variant:"rectangle",borderRadius:16,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(100,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"half-circle",group:"basic",label:"Half Circle",description:"Semi-circle for modern accents",preview:"half-circle",variant:"rectangle",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.5)),height:Math.max(90,Math.round((e.height-t.top-t.bottom)*.18))})},{id:"triangle",group:"basic",label:"Triangle",description:"Simple triangle for pointers or accents",preview:"triangle",variant:"polygon",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.4)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"diamond",group:"basic",label:"Diamond (rhombus)",description:"Rhombus shape for badges",preview:"diamond",variant:"polygon",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(120,Math.round((e.width-t.left-t.right)*.38)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.38))})},{id:"scalloped-rectangle",group:"decorative",label:"Scalloped Edge Rectangle",description:"Decorative scalloped border",preview:"scalloped-rectangle",variant:"rectangle",borderRadius:12,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"wavy-edge-rectangle",group:"decorative",label:"Wavy Edge Rectangle",description:"Soft wavy edges for a playful look",preview:"wavy-edge-rectangle",variant:"rectangle",borderRadius:10,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"curved-edge-square",group:"decorative",label:"Curved Edge Square",description:"Square with curved edges",preview:"curved-edge-square",variant:"rectangle",borderRadius:18,getSize:({page:e,safeInsets:t})=>{const r=Math.min(e.width-t.left-t.right,e.height-t.top-t.bottom),i=Math.max(120,Math.round(r*.45));return{width:i,height:i}}},{id:"cloud-shape",group:"decorative",label:"Cloud Shape",description:"Soft cloud-like outline",preview:"cloud-shape",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(200,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(130,Math.round((e.height-t.top-t.bottom)*.44))})},{id:"hexagon",group:"decorative",label:"Hexagon",description:"Geometric hexagon",preview:"hexagon",variant:"polygon",borderRadius:8,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.42))})},{id:"octagon",group:"decorative",label:"Octagon",description:"Eight-sided geometric shape",preview:"octagon",variant:"polygon",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(140,Math.round((e.height-t.top-t.bottom)*.45))})},{id:"heart",group:"decorative",label:"Heart",description:"Romantic heart shape",preview:"heart",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>{const r=Math.min(e.width-t.left-t.right,e.height-t.top-t.bottom),i=Math.max(140,Math.round(r*.45));return{width:i,height:i}}},{id:"star",group:"decorative",label:"Star",description:"Five-pointed star",preview:"star",variant:"polygon",borderRadius:4,getSize:({page:e,safeInsets:t})=>({width:Math.max(130,Math.round((e.width-t.left-t.right)*.38)),height:Math.max(130,Math.round((e.height-t.top-t.bottom)*.38))})},{id:"flower",group:"decorative",label:"Flower / Petal Shape",description:"Petal-style decorative shape",preview:"flower",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(150,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(150,Math.round((e.height-t.top-t.bottom)*.45))})},{id:"bracket-frame",group:"decorative",label:"Bracket Frame",description:"Classic bracket-style frame",preview:"bracket-frame",variant:"frame",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(130,Math.round((e.height-t.top-t.bottom)*.4))})},{id:"ornate-frame",group:"decorative",label:"Ornate Frame",description:"Vintage ornate border",preview:"ornate-frame",variant:"frame",borderRadius:8,getSize:({page:e,safeInsets:t})=>({width:Math.max(200,Math.round((e.width-t.left-t.right)*.65)),height:Math.max(150,Math.round((e.height-t.top-t.bottom)*.45))})},{id:"shield",group:"decorative",label:"Shield Shape",description:"Heraldic shield-style shape",preview:"shield",variant:"polygon",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(150,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(170,Math.round((e.height-t.top-t.bottom)*.5))})},{id:"tag-shape",group:"decorative",label:"Tag Shape",description:"Gift-tag with a notch",preview:"tag-shape",variant:"tag",borderRadius:8,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(90,Math.round((e.height-t.top-t.bottom)*.28))})},{id:"arch-top-rectangle",group:"decorative",label:"Arch Top Rectangle",description:"Rectangle with an arched top",preview:"arch-top-rectangle",variant:"rectangle",borderRadius:18,getSize:({page:e,safeInsets:t})=>({width:Math.max(160,Math.round((e.width-t.left-t.right)*.55)),height:Math.max(110,Math.round((e.height-t.top-t.bottom)*.34))})},{id:"half-arch",group:"decorative",label:"Half Arch",description:"Modern half-arch accent",preview:"half-arch",variant:"rectangle",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.55)),height:Math.max(90,Math.round((e.height-t.top-t.bottom)*.18))})},{id:"gate-fold",group:"folded",label:"Gate Fold",description:"Double door fold layout",preview:"gate-fold",variant:"layout",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(240,Math.round((e.width-t.left-t.right)*.75)),height:Math.max(200,Math.round((e.height-t.top-t.bottom)*.65))})},{id:"tri-fold",group:"folded",label:"Tri-Fold",description:"Three-panel fold",preview:"tri-fold",variant:"layout",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(240,Math.round((e.width-t.left-t.right)*.75)),height:Math.max(200,Math.round((e.height-t.top-t.bottom)*.65))})},{id:"z-fold",group:"folded",label:"Z-Fold",description:"Z-style folding panels",preview:"z-fold",variant:"layout",borderRadius:0,getSize:({page:e,safeInsets:t})=>({width:Math.max(240,Math.round((e.width-t.left-t.right)*.75)),height:Math.max(200,Math.round((e.height-t.top-t.bottom)*.65))})},{id:"pocket-fold",group:"folded",label:"Pocket Fold",description:"Pocket fold for inserts",preview:"pocket-fold",variant:"layout",borderRadius:4,getSize:({page:e,safeInsets:t})=>({width:Math.max(220,Math.round((e.width-t.left-t.right)*.7)),height:Math.max(180,Math.round((e.height-t.top-t.bottom)*.6))})},{id:"tent-fold",group:"folded",label:"Tent Fold",description:"Greeting-card / tent-style",preview:"tent-fold",variant:"layout",borderRadius:4,getSize:({page:e,safeInsets:t})=>({width:Math.max(220,Math.round((e.width-t.left-t.right)*.7)),height:Math.max(180,Math.round((e.height-t.top-t.bottom)*.6))})},{id:"layered-rectangle",group:"folded",label:"Layered Rectangle",description:"Stacked rectangle borders for layered look",preview:"layered-rectangle",variant:"rectangle",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.6)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"butterfly",group:"creative",label:"Butterfly",description:"Delicate butterfly silhouette",preview:"butterfly",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.5)),height:Math.max(130,Math.round((e.height-t.top-t.bottom)*.38))})},{id:"leaf",group:"creative",label:"Leaf",description:"Natural leaf motif",preview:"leaf",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(160,Math.round((e.width-t.left-t.right)*.45)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"balloon",group:"creative",label:"Balloon",description:"Party balloon outline",preview:"balloon",variant:"organic",borderRadius:9999,getSize:({page:e,safeInsets:t})=>({width:Math.max(120,Math.round((e.width-t.left-t.right)*.35)),height:Math.max(150,Math.round((e.height-t.top-t.bottom)*.45))})},{id:"crown",group:"creative",label:"Crown",description:"Royal crown silhouette",preview:"crown",variant:"organic",borderRadius:4,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.4)),height:Math.max(90,Math.round((e.height-t.top-t.bottom)*.28))})},{id:"ticket-shape",group:"creative",label:"Ticket Shape",description:"Event ticket outline",preview:"ticket-shape",variant:"tag",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(160,Math.round((e.width-t.left-t.right)*.5)),height:Math.max(90,Math.round((e.height-t.top-t.bottom)*.28))})},{id:"puzzle-piece",group:"creative",label:"Puzzle Piece",description:"Fun puzzle piece shape",preview:"puzzle-piece",variant:"organic",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(140,Math.round((e.width-t.left-t.right)*.4)),height:Math.max(140,Math.round((e.height-t.top-t.bottom)*.4))})},{id:"envelope-outline",group:"creative",label:"Envelope Outline",description:"Envelope silhouette",preview:"envelope-outline",variant:"rectangle",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(180,Math.round((e.width-t.left-t.right)*.55)),height:Math.max(120,Math.round((e.height-t.top-t.bottom)*.36))})},{id:"ribbon-banner",group:"creative",label:"Ribbon Banner",description:"Decorative ribbon banner",preview:"ribbon-banner",variant:"organic",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(200,Math.round((e.width-t.left-t.right)*.65)),height:Math.max(80,Math.round((e.height-t.top-t.bottom)*.2))})},{id:"polaroid-frame",group:"creative",label:"Polaroid Frame",description:"Photo-style Polaroid frame",preview:"polaroid-frame",variant:"frame",borderRadius:6,getSize:({page:e,safeInsets:t})=>({width:Math.max(170,Math.round((e.width-t.left-t.right)*.5)),height:Math.max(210,Math.round((e.height-t.top-t.bottom)*.62))})}],Cs=[{id:"align-left",icon:"fa-solid fa-align-left",label:"Align left",apply:e=>({x:0})},{id:"align-center-horizontal",icon:"fa-solid fa-align-center",label:"Center horizontally",apply:(e,t)=>({x:Math.round((t.width-e.width)/2)})},{id:"align-right",icon:"fa-solid fa-align-right",label:"Align right",apply:(e,t)=>({x:Math.round(t.width-e.width)})},{id:"align-top",icon:"fa-solid fa-arrow-up",label:"Align top",apply:()=>({y:0})},{id:"align-center-vertical",icon:"fa-solid fa-arrows-up-down",label:"Center vertically",apply:(e,t)=>({y:Math.round((t.height-e.height)/2)})},{id:"align-bottom",icon:"fa-solid fa-arrow-down",label:"Align bottom",apply:(e,t)=>({y:Math.round(t.height-e.height)})}],ks=[{value:"all",label:"All Shapes"},{value:"basic",label:"Basic Shapes"},{value:"decorative",label:"Decorative / Fancy Shapes"},{value:"folded",label:"Folded or Layered Shapes"},{value:"creative",label:"Creative / Themed Shapes"}],_s=["AIzaSyCSdMyA37wm0nt9gJIZSjTrxEHgXwxBMeM","AIzaSyBRCDdZjTcR4brOsHV_OBsDO11We11BVi0".replace("BRCD","BRCD")];function Ps(e){return`https://www.googleapis.com/webfonts/v1/webfonts?sort=popularity&fields=items(family,category,variants)&key=${e}`}const zn=[{family:"Inter",category:"sans-serif",variants:["400","500","600","700"]},{family:"Poppins",category:"sans-serif",variants:["400","500","600","700"]},{family:"Roboto",category:"sans-serif",variants:["400","500","700"]},{family:"Lato",category:"sans-serif",variants:["400","700"]},{family:"Playfair Display",category:"serif",variants:["400","600"]},{family:"Oswald",category:"sans-serif",variants:["400","500","600"]},{family:"Merriweather",category:"serif",variants:["400","700"]},{family:"Montserrat",category:"sans-serif",variants:["400","500","600"]},{family:"Open Sans",category:"sans-serif",variants:["300","400","600","700"]},{family:"Source Sans Pro",category:"sans-serif",variants:["300","400","600","700"]},{family:"Raleway",category:"sans-serif",variants:["300","400","600","700"]},{family:"Nunito",category:"sans-serif",variants:["300","400","600","700"]},{family:"PT Sans",category:"sans-serif",variants:["400","700"]},{family:"PT Serif",category:"serif",variants:["400","700"]},{family:"Ubuntu",category:"sans-serif",variants:["300","400","500","700"]},{family:"Rubik",category:"sans-serif",variants:["300","400","500","700"]},{family:"Fira Sans",category:"sans-serif",variants:["300","400","700"]},{family:"Work Sans",category:"sans-serif",variants:["300","400","600","700"]},{family:"Quicksand",category:"sans-serif",variants:["300","400","700"]},{family:"Bebas Neue",category:"display",variants:["400"]},{family:"Bitter",category:"serif",variants:["400","700"]},{family:"Cabin",category:"sans-serif",variants:["400","700"]},{family:"Cormorant Garamond",category:"serif",variants:["400","500","600"]},{family:"Dosis",category:"sans-serif",variants:["300","400","600"]},{family:"EB Garamond",category:"serif",variants:["400","700"]},{family:"Exo 2",category:"sans-serif",variants:["300","400","600","700"]},{family:"Inconsolata",category:"monospace",variants:["400","700"]},{family:"Indie Flower",category:"handwriting",variants:["400"]},{family:"Karla",category:"sans-serif",variants:["400","700"]},{family:"Kanit",category:"sans-serif",variants:["300","400","600","700"]},{family:"Lobster",category:"display",variants:["400"]},{family:"Manrope",category:"sans-serif",variants:["300","400","600","700"]},{family:"Merriweather Sans",category:"sans-serif",variants:["300","400","700"]},{family:"Noto Sans",category:"sans-serif",variants:["400","700"]},{family:"Oxygen",category:"sans-serif",variants:["300","400","700"]},{family:"Play",category:"sans-serif",variants:["400","700"]},{family:"Proza Libre",category:"sans-serif",variants:["400","700"]},{family:"Roboto Slab",category:"serif",variants:["300","400","700"]},{family:"Saira",category:"sans-serif",variants:["300","400","600","700"]},{family:"Titillium Web",category:"sans-serif",variants:["200","400","600","700"]},{family:"Varela Round",category:"sans-serif",variants:["400"]},{family:"Zilla Slab",category:"serif",variants:["400","700"]}],La=new Map(zn.map(e=>[e.family,e]));function Rs(){var ct,sa,dt,oa,Pt,la;const{state:e,dispatch:t}=mt(),r=e.pages.find(u=>u.id===e.activePageId)??e.pages[0],i=l.useMemo(()=>Is(r==null?void 0:r.safeZone),[r==null?void 0:r.safeZone]),s=l.useMemo(()=>r?r.nodes.find(u=>u.id===e.selectedLayerId)??null:null,[r,e.selectedLayerId]),d=(s==null?void 0:s.side)??"front",[m,f]=l.useState(()=>{const u=localStorage.getItem("inspector-panel-width");return u?parseInt(u,10):340}),[p,b]=l.useState(!1),v=l.useRef(null),w=l.useRef(new Set),R=l.useRef(!1),[z,O]=l.useState([]),[$,re]=l.useState([]),[A,q]=l.useState(!1),[ce,ne]=l.useState(!1),[X,me]=l.useState(!1),[be,Me]=l.useState(""),[ge,Te]=l.useState("all"),Pe=l.useRef(null),ue=l.useRef(null),[ie,Se]=l.useState(null),[y,I]=l.useState(1),[F,H]=l.useState(0),[Q,S]=l.useState(0),D=l.useRef(null),[ee,W]=l.useState(!1),[te,je]=l.useState(""),[Ce,oe]=l.useState("all"),he=l.useRef(null),fe=l.useRef(null),[U,Ne]=l.useState(null),[xt,Be]=l.useState(null),[ke,Ye]=l.useState(""),[He,St]=l.useState(()=>{var u;return((u=s==null?void 0:s.fontSize)==null?void 0:u.toString())??"48"});l.useEffect(()=>{var u;(s==null?void 0:s.fontSize)!==void 0?St(((u=s.fontSize)==null?void 0:u.toString())??"48"):s||St("48")},[s==null?void 0:s.fontSize,s]);const We=l.useCallback((u,x)=>{const C=lr(u);if(!C||w.current.has(C))return;const L=Es(C,x);if(!L)return;const T=document.createElement("link");T.rel="stylesheet",T.href=L,document.head.appendChild(T),w.current.add(C)},[]),Ze=l.useMemo(()=>{const u=new Map;return z.forEach(x=>{x!=null&&x.family&&u.set(x.family,x)}),u},[z]),we=l.useMemo(()=>lr((s==null?void 0:s.fontFamily)||""),[s==null?void 0:s.fontFamily]),Re=l.useMemo(()=>Ze.get(we)??La.get(we)??null,[Ze,we]),It=l.useMemo(()=>{const u=$.length>0?$:zn,x=(Re==null?void 0:Re.category)??rn(s==null?void 0:s.fontFamily),C=(Re==null?void 0:Re.variants)??[],T=[...we?[{family:we,category:x,variants:C}]:[],...u],ae=new Set,se=[];for(const ye of T)if(!(!ye||!ye.family)&&!ae.has(ye.family)&&(ae.add(ye.family),se.push(ye),se.length>=120))break;return se},[$,Re,we,s==null?void 0:s.fontFamily]),P=l.useMemo(()=>{const u=new Set;return It.forEach(x=>{x!=null&&x.category&&u.add(x.category)}),["all",...Array.from(u)]},[It]),Ue=l.useMemo(()=>{const u=be.trim().toLowerCase();return It.filter(x=>!(x!=null&&x.family)||ge!=="all"&&(x.category??"").toLowerCase()!==ge.toLowerCase()?!1:u?x.family.toLowerCase().includes(u):!0)},[It,be,ge]),it=l.useMemo(()=>{const u=te.trim().toLowerCase();return Ns.filter(x=>Ce!=="all"&&x.group!==Ce?!1:u?x.label.toLowerCase().includes(u)||x.description.toLowerCase().includes(u):!0)},[te,Ce]);l.useEffect(()=>{localStorage.setItem("inspector-panel-width",m.toString())},[m]),l.useEffect(()=>{if(!X)return;const u=C=>{C.key==="Escape"&&me(!1)},x=C=>{const L=Pe.current,T=ue.current;!L||!T||!L.contains(C.target)&&!T.contains(C.target)&&me(!1)};return document.addEventListener("keydown",u),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",u),document.removeEventListener("mousedown",x)}},[X]),l.useEffect(()=>{if(!ee)return;const u=C=>{C.key==="Escape"&&W(!1)},x=C=>{const L=he.current,T=fe.current;L&&(L.contains(C.target)||T&&T.contains(C.target)||W(!1))};return document.addEventListener("keydown",u),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",u),document.removeEventListener("mousedown",x)}},[ee]),l.useEffect(()=>{if(!X)return;function u(){if(!(!ue.current||!v.current))try{const x=ue.current.getBoundingClientRect(),C=v.current.getBoundingClientRect(),L=Math.min(320,Math.max(200,x.width*1.6));let T=C.left-L-12+window.scrollX,ae=x.top+window.scrollY-6;T<8&&(T=C.right+12+window.scrollX);const se=window.scrollY+window.innerHeight-48;ae>se&&(ae=Math.max(window.scrollY+8,se-8)),ae<window.scrollY+8&&(ae=window.scrollY+8),Se({top:ae,left:T,width:L})}catch{}}return u(),window.addEventListener("scroll",u,{passive:!0}),window.addEventListener("resize",u),()=>{window.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[X]),l.useEffect(()=>{if(!ee)return;function u(){if(!(!fe.current||!v.current))try{const x=fe.current.getBoundingClientRect(),C=v.current.getBoundingClientRect(),L=Math.min(320,Math.max(200,x.width*1.6));let T=C.left-L-12+window.scrollX,ae=x.top+window.scrollY-6;T<8&&(T=C.right+12+window.scrollX);const se=window.scrollY+window.innerHeight-48;ae>se&&(ae=Math.max(window.scrollY+8,se-8)),ae<window.scrollY+8&&(ae=window.scrollY+8),Ne({top:ae,left:T,width:L})}catch{}}return u(),window.addEventListener("scroll",u,{passive:!0}),window.addEventListener("resize",u),()=>{window.removeEventListener("scroll",u),window.removeEventListener("resize",u)}},[ee]),l.useEffect(()=>{if(R.current)return;R.current=!0;const u=new AbortController;ne(!0);async function x(){let C=!1;for(const L of _s){if(u.signal.aborted)break;try{const T=Ps(L),ae=await fetch(T,{signal:u.signal});if(!ae.ok)continue;const se=await ae.json(),ye=Array.isArray(se==null?void 0:se.items)?se.items.slice(0,250):[];O(ye),re(ye.slice(0,50)),C=!0;break}catch{if(u.signal.aborted)break;continue}}C||console.error("[InkWise Builder] Failed to load Google Fonts with provided API keys."),u.signal.aborted||ne(!1)}return x(),()=>{u.abort()}},[]);const st=l.useCallback(()=>{A||$.length>=z.length||(q(!0),re(u=>{const x=z.slice(u.length,u.length+100);return[...u,...x]}),q(!1))},[z,$.length,A]);l.useEffect(()=>{if(!we)return;const u=Ze.get(we)??La.get(we);u&&We(we,u.variants)},[we,Ze,We]),l.useEffect(()=>{const u=new Set;e.pages.forEach(x=>{(x.nodes??[]).forEach(C=>{if((C==null?void 0:C.type)==="text"&&C.fontFamily){const L=lr(C.fontFamily);L&&u.add(L)}})}),u.forEach(x=>{const C=Ze.get(x)??La.get(x);C&&We(x,C.variants)})},[e.pages,Ze,We]),l.useEffect(()=>{X&&Ue.slice(0,24).forEach(u=>{u!=null&&u.family&&We(u.family,u.variants)})},[X,Ue,We]),l.useEffect(()=>{!X||A||$.length>=z.length||$.length<100&&st()},[X,$.length,z.length,A,st]);const jr=u=>{b(!0),u.preventDefault()},Zt=u=>{if(!p)return;const x=Math.max(280,Math.min(600,window.innerWidth-u.clientX));f(x)},Oe=()=>{b(!1)};if(l.useEffect(()=>(p?(document.addEventListener("mousemove",Zt),document.addEventListener("mouseup",Oe),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"):(document.removeEventListener("mousemove",Zt),document.removeEventListener("mouseup",Oe),document.body.style.cursor="",document.body.style.userSelect=""),()=>{document.removeEventListener("mousemove",Zt),document.removeEventListener("mouseup",Oe),document.body.style.cursor="",document.body.style.userSelect=""}),[p]),!r)return null;const pe=s?nn(s.frame,r):null,Gt=(s==null?void 0:s.type)==="text",et=(s==null?void 0:s.type)==="image",At=!!((ct=s==null?void 0:s.metadata)!=null&&ct.clipContent),Qt=Number((sa=s==null?void 0:s.metadata)==null?void 0:sa.imageScale),Xt=Number.isFinite(Qt)?$t(Qt,.25,4):1,qt=Number((dt=s==null?void 0:s.metadata)==null?void 0:dt.imageOffsetX),gt=Number((oa=s==null?void 0:s.metadata)==null?void 0:oa.imageOffsetY),Vt=Number.isFinite(qt)?$t(qt,-500,500):0,Jt=Number.isFinite(gt)?$t(gt,-500,500):0,Kt=!!((Pt=s==null?void 0:s.metadata)!=null&&Pt.flipHorizontal),ma=!!((la=s==null?void 0:s.metadata)!=null&&la.flipVertical);l.useEffect(()=>{(s==null?void 0:s.type)==="image"&&(I(Xt),H(Vt),S(Jt))},[s==null?void 0:s.id,Xt,Vt,Jt]),l.useEffect(()=>{try{e.recentlyUploadedImages&&e.recentlyUploadedImages.length>0&&(console.debug("[Inspector] recentlyUploadedImages count=",e.recentlyUploadedImages.length),e.recentlyUploadedImages.forEach((u,x)=>{console.debug(`[Inspector] recent[${x}]`,u.fileName,(u.dataUrl||"").slice(0,80))}))}catch{}},[e.recentlyUploadedImages]);const Mt=u=>{t({type:"UPDATE_PAGE_PROPS",pageId:r.id,props:{background:u.target.value}})},ea=()=>{if(ee)W(!1),je(""),oe("all");else if(W(!0),je(""),oe("all"),fe.current&&v.current)try{const u=fe.current.getBoundingClientRect(),x=v.current.getBoundingClientRect(),C=Math.min(4e3,Math.max(2200,u.width*3)),L=500,T=window.scrollY+8,ae=window.scrollY+window.innerHeight-8,se=Math.max(120,ae-T),ye=Math.min(L,se);let ut=x.left-C-12+window.scrollX;ut<8&&(ut=x.right+12+window.scrollX);let qe=u.top+window.scrollY-6;const ht=Math.max(T,ae-ye);qe>ht&&(qe=ht),qe<T&&(qe=T),Ne({top:qe,left:ut,width:C,height:ye})}catch{Ne(null)}},ta=()=>{t({type:"ADD_PAGE",page:null})},ga=u=>{t({type:"SELECT_PAGE",pageId:u})},Nr=(u,x)=>{x.stopPropagation(),t({type:"DELETE_PAGE",pageId:u})},Et=(u,x)=>{Be(u),Ye(x)},Ae=u=>{Ye(u.target.value)},aa=u=>{ke.trim()&&t({type:"UPDATE_PAGE_PROPS",pageId:u,props:{name:ke.trim()}}),Be(null),Ye("")},Ge=(u,x)=>{u.key==="Enter"?aa(x):u.key==="Escape"&&(Be(null),Ye(""))},J=u=>{if(!s)return;const x={...u};u.metadata&&(x.metadata={...s.metadata??{},...u.metadata}),t({type:"UPDATE_LAYER_PROPS",pageId:r.id,layerId:s.id,props:x})},pt=()=>{J({visible:s.visible===!1})},pa=()=>{J({locked:!s.locked})},jt=u=>{!s||!r||(J({side:u}),t({type:"REORDER_LAYER",pageId:r.id,layerId:s.id,direction:u==="front"?"FRONT":"BACK"}))},Nt=u=>{if(!r)return;const x=u.getSize?u.getSize({page:r,safeInsets:i}):{width:200,height:160};if((s==null?void 0:s.type)==="shape"){const C=nn(s.frame,r),L=js(C,x.width,x.height,r,i);J({name:u.label,variant:u.variant??s.variant,borderRadius:u.borderRadius??s.borderRadius,metadata:{...s.metadata??{},...u.metadata??{}},frame:L})}else if(s){const C=De("shape",r,{name:u.label,variant:u.variant??"rectangle",borderRadius:u.borderRadius??16,metadata:u.metadata??{}});if(C.frame){const L=Ms(x.width,x.height,r,i);C.frame=Ln(L,r,i)}t({type:"ADD_LAYER",pageId:r.id,layer:C}),t({type:"SELECT_LAYER",layerId:C.id})}else{const C={id:u.id,variant:u.variant??"rectangle",borderRadius:u.borderRadius??0};t({type:"UPDATE_PAGE_PROPS",pageId:r.id,props:{shape:C}})}W(!1),je(""),oe("all")},ot=u=>x=>{const C=Number.parseFloat(x.target.value);if(!Number.isFinite(C)||!pe)return;const L={...pe,[u]:u==="width"||u==="height"?Math.max(1,C):C};J({frame:L})},Wa=u=>{if(!Number.isFinite(u))return;const x=$t(u,0,100);J({opacity:x/100})},Cr=u=>{Wa(Number.parseInt(u.target.value,10))},Ua=u=>{Wa(Number.parseInt(u.target.value,10))},ba=u=>{J({fill:u.target.value})},kr=u=>{const x=Number.parseInt(u.target.value,10);Number.isFinite(x)&&J({borderRadius:Math.max(0,x)})},Lt=u=>{J({content:u.target.value})},Ee=u=>{const x=u.target.value;St(x);const C=Number.parseInt(x,10);Number.isFinite(C)&&C>=8&&J({fontSize:C})},ya=u=>{const x=u.target.value,C=(String(x)||"").trim();C&&J({fontWeight:C})},Qe=l.useCallback(u=>{if(!u)return;const x=Ze.get(u)??La.get(u)??null;x&&We(u,x.variants);const C=(x==null?void 0:x.category)??rn(s==null?void 0:s.fontFamily),L=Fn(C),T=L?`${u}, ${L}`:u;J({fontFamily:T})},[Ze,s==null?void 0:s.fontFamily,We,J]),bt=u=>{Qe(u),me(!1)},yt=u=>{Me(u.target.value)},va=u=>{Te(u.target.value)},ra=u=>{je(u.target.value)},_r=u=>{oe(u.target.value)},Pr=()=>{J({metadata:{clipContent:!At}})},Ct=()=>{J({metadata:{imageScale:y,imageOffsetX:F,imageOffsetY:Q}})},zt=()=>{I(1),H(0),S(0),J({metadata:{imageScale:1,imageOffsetX:0,imageOffsetY:0}})},na=u=>()=>{if(!pe)return;const C=((Number.isFinite(pe.rotation)?pe.rotation:0)+u)%360,L=C<0?C+360:C;J({frame:{...pe,rotation:Math.round(L)}})},kt=u=>()=>{J(u==="horizontal"?{metadata:{flipHorizontal:!Kt}}:{metadata:{flipVertical:!ma}})},Rr=()=>{var u;s&&((u=D.current)==null||u.click())},ia=u=>{var T;const x=(T=u.target.files)==null?void 0:T[0];if(!x||!s)return;if(!x.type.startsWith("image/")){alert("Please choose an image file."),u.target.value="";return}const C=10*1024*1024;if(x.size>C){alert("Selected image is too large. Please use a file smaller than 10MB."),u.target.value="";return}const L=new FileReader;L.onload=async ae=>{var ut;const se=(ut=ae.target)==null?void 0:ut.result;if(typeof se!="string"||!se.startsWith("data:image/")){alert("Unable to load the selected image. Please try again.");return}const ye=new Image;ye.onload=async()=>{try{const qe=await fa(()=>import("./recentImagesDB-CO6kquVm.js"),[]),ht=`recent-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;await qe.saveImage(ht,x.name,x),qe.pruneOld(10).catch(()=>{});const ze=URL.createObjectURL(x);t({type:"ADD_RECENTLY_UPLOADED_IMAGE",dataUrl:ze,fileName:x.name})}catch(qe){console.error("Failed to persist recent image:",qe),t({type:"ADD_RECENTLY_UPLOADED_IMAGE",dataUrl:se,fileName:x.name})}J({content:se,name:x.name||s.name,metadata:{objectFit:"contain",imageScale:1,imageOffsetX:0,imageOffsetY:0}})},ye.onerror=()=>{console.error("Preload failed for data URL"),alert("Uploaded image could not be rendered. Try a different file.")},ye.src=se},L.onerror=()=>{alert("There was a problem reading the file. Please try again.")},L.readAsDataURL(x),u.target.value=""},Le=()=>{s&&(I(1),H(0),S(0),J({content:"",metadata:{imageScale:1,imageOffsetX:0,imageOffsetY:0}}),D.current&&(D.current.value=""))},wa=()=>{!s||!window.confirm(`Delete "${s.name}"? You can undo this action if needed.`)||t({type:"REMOVE_LAYER",pageId:r.id,layerId:s.id})},Xe=u=>()=>{if(!s||!pe)return;const x=u(pe,r)??{},C=Math.max(0,r.width-pe.width),L=Math.max(0,r.height-pe.height),T={...pe,...x};typeof T.x=="number"&&(T.x=$t(Math.round(T.x),0,C)),typeof T.y=="number"&&(T.y=$t(Math.round(T.y),0,L)),J({frame:T})},lt=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Pages"}),a.jsx("button",{type:"button",className:"builder-btn inspector-btn--add",onClick:ta,children:"Add page"})]}),a.jsx("div",{className:"inspector-pages__list",role:"list",children:e.pages.map(u=>{const x=u.id===e.activePageId;return a.jsxs("div",{className:"inspector-pages__item-wrapper",children:[a.jsxs("button",{type:"button",className:`inspector-pages__item ${x?"is-active":""}`,onClick:()=>ga(u.id),"aria-pressed":x,children:[a.jsx("span",{className:"inspector-pages__thumb","aria-hidden":"true",children:a.jsx("span",{className:"inspector-pages__thumb-page"})}),xt===u.id?a.jsx("input",{type:"text",className:"inspector-pages__label-input",value:ke,onChange:Ae,onBlur:aa,onKeyDown:Ge,autoFocus:!0}):a.jsx("span",{className:"inspector-pages__label",onClick:()=>Et(u.id,u.name),style:{cursor:"pointer"},children:u.name})]}),e.pages.length>1&&a.jsx("div",{className:"inspector-pages__item-controls",children:a.jsx("button",{type:"button",className:"inspector-pages__control inspector-pages__control--delete",onClick:C=>Nr(u.id,C),"aria-label":`Delete ${u.name}`,title:`Delete ${u.name}`,children:a.jsx("i",{className:"fas fa-trash-alt","aria-hidden":"true"})})})]},u.id)})})]}),Ft=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Page"}),a.jsxs("span",{className:"inspector-section__meta",children:[r.width," × ",r.height,"px"]})]}),a.jsxs("div",{className:"inspector-field",style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[a.jsxs("label",{className:"inspector-field",style:{margin:0},children:[a.jsx("span",{className:"inspector-field__label",children:"Background"}),a.jsx("input",{type:"color",className:"inspector-field__control inspector-field__control--color",value:sn(r.background,"#ffffff"),onChange:Mt,"aria-label":"Page background color"})]}),a.jsx("button",{type:"button",className:"builder-btn inspector-btn",onClick:ea,ref:fe,style:{fontSize:"0.8rem",padding:"0.3rem 0.6rem",height:"auto",alignSelf:"flex-start"},children:"SHAPES"})]})]}),xa=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Position"}),a.jsx("span",{className:"inspector-section__meta",children:"X/Y & rotation"})]}),a.jsx("div",{className:"inspector-alignment",role:"group","aria-label":"Alignment controls",children:Cs.map(u=>a.jsx("button",{type:"button",className:"inspector-alignment__action",onClick:Xe(u.apply),"aria-label":u.label,children:a.jsx("i",{className:u.icon,"aria-hidden":"true"})},u.id))}),a.jsxs("div",{className:"inspector-grid inspector-grid--three",children:[a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"X"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:pe.x,onChange:ot("x"),step:"1"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Y"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:pe.y,onChange:ot("y"),step:"1"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Rotation"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:pe.rotation,onChange:ot("rotation"),step:"1"})]})]})]}),Dt=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Layout"}),a.jsx("span",{className:"inspector-section__meta",children:"Dimensions & flow"})]}),a.jsxs("div",{className:"inspector-grid inspector-grid--two",children:[a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Width"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:pe.width,onChange:ot("width"),min:"1",step:"1"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Height"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:pe.height,onChange:ot("height"),min:"1",step:"1"})]})]}),a.jsxs("label",{className:"inspector-toggle",children:[a.jsx("input",{type:"checkbox",checked:At,onChange:Pr}),a.jsx("span",{children:"Clip content"})]})]}),_t=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Appearance"}),a.jsx("span",{className:"inspector-section__meta",children:"Color & effects"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Fill"}),a.jsx("input",{type:"color",className:"inspector-field__control inspector-field__control--color",value:sn(s.fill,"#2563eb"),onChange:ba})]}),a.jsxs("div",{className:"inspector-opacity",children:[a.jsxs("label",{className:"inspector-field inspector-opacity__slider",children:[a.jsx("span",{className:"inspector-field__label",children:"Opacity"}),a.jsx("input",{type:"range",className:"inspector-field__control inspector-field__control--range",min:"0",max:"100",step:"5",value:Math.round((s.opacity??1)*100),onChange:Cr})]}),a.jsxs("label",{className:"inspector-field inspector-opacity__input",children:[a.jsx("span",{className:"inspector-field__label",children:"%"}),a.jsx("input",{type:"number",className:"inspector-field__control",min:"0",max:"100",step:"5",value:Math.round((s.opacity??1)*100),onChange:Ua})]})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Corner radius"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:s.borderRadius??0,onChange:kr,min:"0",step:"1"})]})]}),Sa=()=>a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Typography"}),a.jsx("span",{className:"inspector-section__meta",children:ce?"Loading fonts...":"Text content & styling"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Content"}),a.jsx("textarea",{className:"inspector-field__control inspector-field__control--textarea",value:s.content??"",onChange:Lt,rows:3})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Font"}),a.jsxs("div",{className:"inspector-font-picker",children:[a.jsxs("button",{type:"button",className:`inspector-field__control inspector-font-picker__trigger${X?" is-open":""}`,onClick:()=>{if(!X&&ue.current&&v.current)try{const u=ue.current.getBoundingClientRect(),x=v.current.getBoundingClientRect(),C=Math.min(320,Math.max(200,u.width*1.6));let L=x.left-C-12+window.scrollX,T=u.top+window.scrollY-6;L<8&&(L=x.right+12+window.scrollX);const ae=window.scrollY+window.innerHeight-48;T>ae&&(T=Math.max(window.scrollY+8,ae-8)),T<window.scrollY+8&&(T=window.scrollY+8),Se({top:T,left:L,width:C})}catch{Se(null)}me(u=>!u)},ref:ue,"aria-expanded":X,children:[a.jsxs("span",{className:"inspector-font-picker__preview",children:[a.jsx("span",{className:"inspector-font-picker__preview-name",style:{fontFamily:(s==null?void 0:s.fontFamily)||we||"Inter, sans-serif"},children:we||"Select font"}),a.jsx("span",{className:"inspector-font-picker__preview-meta",children:we?gr(Re==null?void 0:Re.category):"Choose a font"})]}),a.jsx("span",{className:"inspector-font-picker__chevron","aria-hidden":"true",children:a.jsx("i",{className:`fa-solid ${X?"fa-chevron-up":"fa-chevron-down"}`})})]}),X&&mr.createPortal(a.jsx(As,{ref:Pe,fonts:Ue,categories:P,categoryValue:ge,onCategoryChange:va,searchTerm:be,onSearchChange:yt,onSelect:bt,isLoading:ce,currentFamily:we,ensureFontLoaded:We,loadMoreFonts:st,loadingMore:A,style:ie?{position:"absolute",top:`${ie.top}px`,left:`${ie.left}px`,width:`${ie.width}px`}:{position:"absolute"}}),document.body)]})]}),a.jsxs("div",{className:"inspector-grid inspector-grid--two",children:[a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Font size"}),a.jsx("input",{type:"number",className:"inspector-field__control",value:He,onChange:Ee,min:"8",step:"1"})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Font weight"}),a.jsxs("select",{className:"inspector-field__control",value:String(s.fontWeight??"400"),onChange:ya,children:[a.jsx("option",{value:"100",children:"Thin"}),a.jsx("option",{value:"200",children:"Extra Light / Ultra Light"}),a.jsx("option",{value:"300",children:"Light"}),a.jsx("option",{value:"400",children:"Regular / Normal"}),a.jsx("option",{value:"500",children:"Medium"}),a.jsx("option",{value:"600",children:"Semi Bold / Demi Bold"}),a.jsx("option",{value:"700",children:"Bold"}),a.jsx("option",{value:"800",children:"Extra Bold / Ultra Bold"}),a.jsx("option",{value:"900",children:"Black / Heavy"}),a.jsx("option",{value:"normal",children:"normal"}),a.jsx("option",{value:"bold",children:"bold"})]})]})]})]}),Ia=()=>{var u,x,C;return a.jsxs("div",{className:"inspector-panel__group",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Image"}),a.jsx("span",{className:"inspector-section__meta",children:"Source & display"})]}),a.jsxs("div",{className:"inspector-field inspector-field--actions",children:[a.jsx("button",{type:"button",className:"builder-btn inspector-btn",onClick:Rr,children:"Replace image"}),(s==null?void 0:s.content)&&a.jsx("button",{type:"button",className:"builder-btn inspector-btn is-muted",onClick:Le,children:"Remove image"})]}),a.jsx("div",{className:"inspector-field inspector-field--actions",children:a.jsx("button",{type:"button",className:"builder-btn inspector-btn",onClick:na(90),children:"Rotate +90°"})}),a.jsxs("div",{className:"inspector-field inspector-field--actions",children:[a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${Kt?"is-active":""}`,onClick:kt("horizontal"),children:"Flip horizontal"}),a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${ma?"is-active":""}`,onClick:kt("vertical"),children:"Flip vertical"})]}),a.jsxs("div",{className:"inspector-field inspector-field--actions",children:[a.jsx("button",{type:"button",className:"builder-btn inspector-btn",onClick:Ct,children:"Crop"}),a.jsx("button",{type:"button",className:"builder-btn inspector-btn",onClick:zt,children:"Reset adjustments"})]}),a.jsxs("div",{className:"inspector-grid inspector-grid--three",children:[a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Brightness"}),a.jsx("input",{type:"range",className:"inspector-field__control inspector-field__control--range",min:"0",max:"200",step:"5",value:((u=s.metadata)==null?void 0:u.brightness)??100,onChange:L=>J({metadata:{brightness:Number.parseInt(L.target.value,10)}})})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Contrast"}),a.jsx("input",{type:"range",className:"inspector-field__control inspector-field__control--range",min:"0",max:"200",step:"5",value:((x=s.metadata)==null?void 0:x.contrast)??100,onChange:L=>J({metadata:{contrast:Number.parseInt(L.target.value,10)}})})]}),a.jsxs("label",{className:"inspector-field",children:[a.jsx("span",{className:"inspector-field__label",children:"Saturation"}),a.jsx("input",{type:"range",className:"inspector-field__control inspector-field__control--range",min:"0",max:"200",step:"5",value:((C=s.metadata)==null?void 0:C.saturation)??100,onChange:L=>J({metadata:{saturation:Number.parseInt(L.target.value,10)}})})]})]})]})},Oa=()=>a.jsxs("div",{className:"inspector-panel__group inspector-panel__group--actions",children:[a.jsxs("div",{className:"inspector-section__header",children:[a.jsx("h3",{children:"Layer actions"}),a.jsx("span",{className:"inspector-section__meta",children:"Stacking, visibility & locking"})]}),a.jsxs("div",{className:"inspector-field inspector-field--actions",children:[a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${d==="front"?"is-active":""}`,onClick:()=>jt("front"),children:"Bring to front"}),a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${d==="back"?"is-active":""}`,onClick:()=>jt("back"),children:"Send to back"})]}),a.jsxs("div",{className:"inspector-field inspector-field--actions",children:[a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${s.visible===!1?"is-muted":""}`,onClick:pt,children:s.visible===!1?"Show layer":"Hide layer"}),a.jsx("button",{type:"button",className:`builder-btn inspector-btn ${s.locked?"is-active":""}`,onClick:pa,children:s.locked?"Unlock layer":"Lock layer"}),a.jsx("button",{type:"button",className:"builder-btn inspector-btn inspector-btn--danger",onClick:wa,children:"Delete layer"})]})]});return a.jsxs(a.Fragment,{children:[a.jsxs("section",{ref:v,className:"inspector-panel",style:{width:`${m}px`,right:0,top:0,bottom:0,position:"absolute"},"aria-label":"Layer inspector",children:[a.jsxs("header",{className:"inspector-panel__header",children:[a.jsx("h2",{children:"Inspector"}),a.jsx("span",{className:`inspector-chip ${s?"":"inspector-chip--muted"}`,children:s?s.name:"No layer selected"})]}),a.jsxs("div",{className:"inspector-panel__body inspector-panel__body--unified",children:[lt(),Ft(),!s&&a.jsx("p",{className:"inspector-panel__empty",children:"Select a layer on the canvas to adjust its position, layout, and appearance."}),s&&a.jsxs(a.Fragment,{children:[xa(),Dt(),Gt&&Sa(),et&&Ia(),_t(),Oa()]})]}),a.jsx("div",{className:"inspector-panel__resize-handle",onMouseDown:jr,"aria-label":"Resize inspector panel"}),a.jsx("input",{type:"file",ref:D,onChange:ia,accept:"image/*",style:{display:"none"}})]}),ee&&mr.createPortal(a.jsxs("div",{ref:he,className:"inspector-shape-modal",role:"dialog","aria-label":"Choose a shape",style:U?{position:"absolute",top:`${U.top}px`,left:`${U.left}px`,width:`${U.width}px`,height:`${U.height}px`}:{position:"absolute"},children:[a.jsxs("div",{className:"inspector-shape-modal__header",children:[a.jsxs("div",{children:[a.jsx("h4",{children:"Select a shape"}),a.jsx("p",{children:"Search or pick a shape to add or update."})]}),a.jsx("button",{type:"button",className:"inspector-shape-modal__close",onClick:()=>{W(!1),je(""),oe("all")},"aria-label":"Close shape picker",children:a.jsx("span",{"aria-hidden":"true",children:"×"})})]}),a.jsx("div",{className:"inspector-field inspector-shape-modal__search",children:a.jsx("input",{type:"search",className:"inspector-field__control",value:te,onChange:ra,placeholder:"Search shapes","aria-label":"Search shapes",autoFocus:!0})}),a.jsx("div",{className:"inspector-field inspector-shape-modal__filter",children:a.jsx("select",{className:"inspector-field__control",value:Ce,onChange:_r,"aria-label":"Filter shapes by category",children:ks.map(u=>a.jsx("option",{value:u.value,children:u.label},u.value))})}),a.jsx("div",{className:"inspector-shape-modal__grid",children:it.length>0?it.map(u=>a.jsxs("button",{type:"button",className:"inspector-shape-modal__item",onClick:()=>Nt(u),children:[a.jsx("span",{className:`inspector-shape-modal__preview inspector-shape-modal__preview--${u.preview}`,"aria-hidden":"true"}),a.jsxs("span",{className:"inspector-shape-modal__info",children:[a.jsx("span",{className:"inspector-shape-modal__name",children:u.label}),a.jsx("span",{className:"inspector-shape-modal__description",children:u.description})]})]},u.id)):a.jsx("div",{className:"inspector-shape-modal__empty",children:"No shapes match your search."})})]}),document.body)]})}const As=Ba.forwardRef(function({fonts:t,categories:r,categoryValue:i,onCategoryChange:s,searchTerm:d,onSearchChange:m,onSelect:f,isLoading:p,currentFamily:b,ensureFontLoaded:v,loadMoreFonts:w,loadingMore:R,style:z},O){const $=l.useRef(null),re=l.useRef(null);return l.useEffect(()=>{$.current&&$.current.focus()},[]),l.useEffect(()=>{t.slice(0,16).forEach(A=>{A!=null&&A.family&&v(A.family,A.variants)})},[t,v]),l.useEffect(()=>{const A=re.current;if(!A)return;const q=()=>{const{scrollTop:ce,scrollHeight:ne,clientHeight:X}=A;ce+X>=ne-200&&w()};return A.addEventListener("scroll",q),()=>A.removeEventListener("scroll",q)},[w]),a.jsxs("div",{className:"inspector-font-modal",ref:O,role:"dialog","aria-label":"Choose font",style:z,children:[a.jsxs("div",{className:"inspector-font-modal__header",children:[a.jsx("input",{ref:$,type:"text",className:"inspector-font-modal__search",placeholder:"Search fonts",value:d,onChange:m,"aria-label":"Search fonts"}),a.jsx("select",{className:"inspector-font-modal__filter",value:i,onChange:s,"aria-label":"Filter fonts by category",children:r.map(A=>a.jsx("option",{value:A,children:A==="all"?"All fonts":gr(A)},A))})]}),a.jsxs("div",{className:"inspector-font-modal__list",ref:re,role:"listbox",children:[p&&t.length===0&&a.jsxs("div",{className:"inspector-font-modal__status inspector-font-modal__status--loading",children:[a.jsx("div",{className:"inspector-font-modal__spinner"}),"Loading fonts..."]}),!p&&t.length===0&&a.jsx("div",{className:"inspector-font-modal__status",children:"No fonts match your search."}),t.map(A=>{const q=Fn(A.category),ce=q?`${A.family}, ${q}`:A.family,ne=b&&A.family.toLowerCase()===b.toLowerCase();return a.jsxs("button",{type:"button",className:`inspector-font-modal__item${ne?" is-active":""}`,onClick:()=>f(A.family),style:{fontFamily:ce},role:"option","aria-selected":ne,children:[a.jsx("span",{className:"inspector-font-modal__item-name",children:A.family}),a.jsx("span",{className:"inspector-font-modal__item-meta",children:gr(A.category)})]},A.family)}),R&&a.jsxs("div",{className:"inspector-font-modal__status inspector-font-modal__status--loading",children:[a.jsx("div",{className:"inspector-font-modal__spinner"}),"Loading more fonts..."]})]})]})});function lr(e){return!e||typeof e!="string"?"":e.replace(/["']/g,"").split(",")[0].trim()}function Es(e,t){if(!e)return"";const r=e.trim().replace(/\s+/g,"+");let i="";if(Array.isArray(t)){const s=t.filter(d=>/^\d+$/.test(d));s.length>0&&(i=`:wght@${Array.from(new Set(s)).slice(0,4).join(";")}`)}return`https://fonts.googleapis.com/css2?family=${r}${i}&display=swap`}function Fn(e){switch((e||"").toLowerCase()){case"serif":return"serif";case"monospace":return"monospace";case"handwriting":return"cursive";case"display":return"sans-serif";default:return"sans-serif"}}function rn(e){if(!e||typeof e!="string")return"sans-serif";const t=e.toLowerCase();return t.includes("mono")?"monospace":t.includes("serif")?"serif":t.includes("script")||t.includes("cursive")||t.includes("handwriting")?"handwriting":"sans-serif"}function gr(e){return!e||typeof e!="string"?"Mixed":e.split(/[-_\s]+/).filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function $t(e,t,r){return Number.isFinite(e)?Math.min(Math.max(e,t),r):t}function nn(e,t){return e&&typeof e=="object"?{x:ua(e.x),y:ua(e.y),width:Math.max(1,ua(e.width??t.width/2)),height:Math.max(1,ua(e.height??t.height/2.5)),rotation:ua(e.rotation??0)}:{x:Math.round(t.width*.1),y:Math.round(t.height*.1),width:Math.round(t.width*.6),height:Math.round(t.height*.25),rotation:0}}function sn(e,t="#2563eb"){if(typeof e=="string"){const r=e.trim();if(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/.test(r))return r;if(/^#([a-fA-F0-9]{8})$/.test(r))return`#${r.slice(1,7)}`}return t}function ua(e){return Number.isFinite(e)?Math.round(e):0}const Ls=.25,zs=3,cr=.1;function Fs(){const{state:e,dispatch:t}=mt(),r=Math.round(e.zoom*100),i=e.pages.find(v=>v.id===e.activePageId)??e.pages[0],s=v=>{t({type:"UPDATE_ZOOM",value:v})},d=()=>s(e.zoom-cr),m=()=>s(e.zoom+cr),f=()=>s(1),p=v=>{const w=parseInt(v.target.value,10);!isNaN(w)&&w>0&&i&&t({type:"UPDATE_PAGE_PROPS",pageId:i.id,props:{width:w}})},b=v=>{const w=parseInt(v.target.value,10);!isNaN(w)&&w>0&&i&&t({type:"UPDATE_PAGE_PROPS",pageId:i.id,props:{height:w}})};return a.jsxs("div",{className:"canvas-toolbar",role:"toolbar","aria-label":"Canvas controls",children:[a.jsx("div",{className:"canvas-toolbar__group",children:a.jsxs("div",{className:"canvas-toolbar__page-size",children:[a.jsx("label",{className:"canvas-toolbar__label",children:"Page"}),a.jsxs("div",{className:"canvas-toolbar__dimensions",children:[a.jsx("input",{type:"number",className:"canvas-toolbar__input",value:(i==null?void 0:i.width)??400,onChange:p,min:"1",max:"5000","aria-label":"Page width"}),a.jsx("span",{className:"canvas-toolbar__separator",children:"×"}),a.jsx("input",{type:"number",className:"canvas-toolbar__input",value:(i==null?void 0:i.height)??400,onChange:b,min:"1",max:"5000","aria-label":"Page height"}),a.jsx("span",{className:"canvas-toolbar__unit",children:"px"})]})]})}),a.jsxs("div",{className:"canvas-toolbar__group",children:[a.jsx("button",{type:"button",onClick:d,className:"builder-btn","aria-label":"Zoom out",children:"−"}),a.jsx("input",{className:"canvas-toolbar__slider",type:"range",min:Ls*100,max:zs*100,step:cr*100,value:r,onChange:v=>s(Number(v.target.value)/100),"aria-label":"Zoom level"}),a.jsx("button",{type:"button",onClick:m,className:"builder-btn","aria-label":"Zoom in",children:"+"})]}),a.jsxs("div",{className:"canvas-toolbar__group",children:[a.jsxs("span",{className:"canvas-toolbar__label",children:[r,"%"]}),a.jsx("button",{type:"button",onClick:f,className:"builder-btn","aria-label":"Reset zoom",children:"Reset"}),a.jsx("button",{type:"button",className:"builder-btn",disabled:!0,"aria-label":"Fit to page",children:"Fit"})]})]})}function on(e){if(!e)return{top:0,right:0,bottom:0,left:0};const t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const s=parseFloat(i);return Number.isNaN(s)?0:s}return 0},r=t(e.margin??e.all??0);return{top:t(e.top??r),right:t(e.right??r),bottom:t(e.bottom??r),left:t(e.left??r)}}function ln(e,t,r){const i=r.left,s=t.width-r.right-e.width,d=r.top,m=t.height-r.bottom-e.height;return{...e,x:Math.max(i,Math.min(s,e.x)),y:Math.max(d,Math.min(m,e.y))}}const Ds=["background","page background","page-background","bg","backdrop","base layer"];function pr(e,t){if(e!=null){if(typeof e=="string"){t.push(e.toLowerCase());return}if(Array.isArray(e)){e.forEach(r=>pr(r,t));return}typeof e=="object"&&Object.values(e).forEach(r=>pr(r,t))}}function Ts(e){if(!e||typeof e!="object")return 1;const t=e.metadata??{},r=typeof e.name=="string"?e.name.toLowerCase():"",i=[];return pr(t,i),Ds.some(d=>d?r.includes(d)?!0:i.some(m=>m.includes(d)):!1)||e.type==="background"?0:1}function Bs(e){const t=(e==null?void 0:e.metadata)??{},r=["zIndex","z_index","stackIndex","stack_index","order","sortOrder","sort_order"];for(const i of r)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];if(typeof s=="number"&&Number.isFinite(s))return s;if(typeof s=="string"){const d=Number.parseFloat(s);if(Number.isFinite(d))return d}}return null}function xr({page:e,canvasRef:t}){const{state:r,dispatch:i}=mt(),s=l.useRef(null),d=l.useRef(null),m=l.useRef(null),[f,p]=l.useState(null),[b,v]=l.useState(null);if(!e)return null;const w=r.zoom??1,R=r.panX??0,z=r.panY??0,O=r.selectedLayerId,$=y=>{i({type:"SELECT_LAYER",layerId:y})},re=y=>{if(y.target.closest(".canvas-layer"))return;const I=y.pointerId;d.current={pointerId:I,start:{x:y.clientX,y:y.clientY},startPan:{x:R,y:z}};try{y.currentTarget.setPointerCapture(I)}catch{}y.preventDefault()},A=y=>{const I=d.current;if(!I||y.pointerId!==I.pointerId)return;const F=y.clientX-I.start.x,H=y.clientY-I.start.y,Q=I.startPan.x+F,S=I.startPan.y+H;i({type:"UPDATE_PAN",panX:Q,panY:S})},q=y=>{const I=d.current;if(!(!I||y.pointerId!==I.pointerId)){try{y.currentTarget.releasePointerCapture(I.pointerId)}catch{}d.current=null}},ce=(y,I,F)=>{if(I.locked)return;i({type:"BEGIN_LAYER_TRANSFORM"}),p(I.id);const H=y.pointerId;s.current={pointerId:H,layerId:I.id,start:{x:y.clientX,y:y.clientY},startFrame:{...F}};try{y.currentTarget.setPointerCapture(H)}catch{}y.preventDefault()},ne=y=>{const I=s.current;if(I&&y.pointerId===I.pointerId){const Q=(y.clientX-I.start.x)/w,S=(y.clientY-I.start.y)/w,D={x:I.startFrame.x+Q,y:I.startFrame.y+S,width:I.startFrame.width,height:I.startFrame.height,rotation:I.startFrame.rotation??0},ee=ln(D,e,ge);i({type:"UPDATE_LAYER_FRAME",pageId:e.id,layerId:I.layerId,frame:ee,trackHistory:!1});return}const F=m.current;if(F&&y.pointerId===F.pointerId){be(y);return}const H=d.current;if(H&&y.pointerId===H.pointerId){const Q=y.clientX-H.start.x,S=y.clientY-H.start.y,D=H.startPan.x+Q,ee=H.startPan.y+S;i({type:"UPDATE_PAN",panX:D,panY:ee})}},X=y=>{const I=s.current;if(!(!I||y.pointerId!==I.pointerId)){try{y.currentTarget.releasePointerCapture(I.pointerId)}catch{}s.current=null,p(null)}},me=(y,I,F,H)=>{if(I.locked)return;y.stopPropagation(),i({type:"BEGIN_LAYER_TRANSFORM"}),v(I.id);const Q=y.pointerId,S=y.currentTarget;m.current={pointerId:Q,layerId:I.id,corner:H,start:{x:y.clientX,y:y.clientY},startFrame:{...F},hasMoved:!1,captureTarget:S};try{S.setPointerCapture(Q)}catch(D){console.warn("Failed to capture pointer for resize:",D)}y.preventDefault()},be=y=>{const I=m.current;if(!I||y.pointerId!==I.pointerId)return;const F=I.start.x+8,H=I.start.y+8,Q=(y.clientX-F)/w,S=(y.clientY-H)/w,D=3,ee=Math.abs(Q*w)>D||Math.abs(S*w)>D;if(!I.hasMoved&&ee&&(I.hasMoved=!0),!I.hasMoved)return;let W={...I.startFrame};switch(I.corner){case"nw":W.width=Math.max(20,I.startFrame.width-Q),W.height=Math.max(20,I.startFrame.height-S),W.x=I.startFrame.x+(I.startFrame.width-W.width),W.y=I.startFrame.y+(I.startFrame.height-W.height);break;case"ne":W.width=Math.max(20,I.startFrame.width+Q),W.height=Math.max(20,I.startFrame.height-S),W.y=I.startFrame.y+(I.startFrame.height-W.height);break;case"sw":W.width=Math.max(20,I.startFrame.width-Q),W.height=Math.max(20,I.startFrame.height+S),W.x=I.startFrame.x+(I.startFrame.width-W.width);break;case"se":W.width=Math.max(20,I.startFrame.width+Q),W.height=Math.max(20,I.startFrame.height+S);break}i({type:"UPDATE_LAYER_FRAME",pageId:e.id,layerId:I.layerId,frame:ln(W,e,ge),trackHistory:!1})},Me=y=>{const I=m.current;if(!(!I||y.pointerId!==I.pointerId)){if(I.captureTarget)try{I.captureTarget.releasePointerCapture(I.pointerId)}catch(F){console.warn("Failed to release pointer capture:",F)}I.hasMoved?i({type:"COMMIT_LAYER_TRANSFORM"}):i({type:"CANCEL_LAYER_TRANSFORM"}),m.current=null,v(null)}},ge=on(e.safeZone),Te=on(e.bleed),Pe=e.shape??null,ie=l.useMemo(()=>Array.isArray(e.nodes)?e.nodes.map((y,I)=>({layer:y,originalIndex:I,priority:Ts(y),explicitStackIndex:Bs(y)})).sort((y,I)=>{if(y.priority!==I.priority)return y.priority-I.priority;const F=Number.isFinite(y.explicitStackIndex)?y.explicitStackIndex:y.originalIndex,H=Number.isFinite(I.explicitStackIndex)?I.explicitStackIndex:I.originalIndex;return F!==H?F-H:y.originalIndex-I.originalIndex}):[],[e.nodes]),Se=y=>{if(!y)return{};const{variant:I,id:F,borderRadius:H}=y;switch(I){case"circle":return{borderRadius:"50%",overflow:"hidden"};case"polygon":return{clipPath:{triangle:"polygon(50% 0%, 0% 100%, 100% 100%)",diamond:"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",hexagon:"polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%)",octagon:"polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)",star:"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)",shield:"polygon(50% 0%, 100% 20%, 100% 80%, 50% 100%, 0% 80%, 0% 20%)"}[F]||"none",overflow:"hidden"};case"organic":return{clipPath:{heart:'path("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z")',"cloud-shape":"ellipse(60% 40% at 50% 50%)",flower:"polygon(50% 0%, 65% 35%, 100% 50%, 65% 65%, 50% 100%, 35% 65%, 0% 50%, 35% 35%)",butterfly:"polygon(50% 0%, 70% 20%, 90% 40%, 70% 60%, 50% 80%, 30% 60%, 10% 40%, 30% 20%)",leaf:"polygon(50% 0%, 100% 30%, 90% 70%, 50% 100%, 10% 70%, 0% 30%)",balloon:"ellipse(50% 60% at 50% 50%)",crown:"polygon(50% 0%, 60% 25%, 85% 25%, 75% 50%, 95% 50%, 80% 75%, 100% 75%, 85% 100%, 15% 100%, 0% 75%, 20% 75%, 5% 50%, 25% 50%, 15% 25%, 40% 25%)","puzzle-piece":"polygon(0% 0%, 70% 0%, 70% 30%, 100% 30%, 100% 70%, 70% 70%, 70% 100%, 30% 100%, 30% 70%, 0% 70%)","ribbon-banner":"polygon(0% 0%, 10% 50%, 0% 100%, 100% 100%, 90% 50%, 100% 0%)"}[F]||"none",overflow:"hidden"};case"frame":return{borderRadius:typeof H=="number"?`${H}px`:H||0,overflow:"hidden"};case"tag":return{clipPath:{"tag-shape":"polygon(0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%)","ticket-shape":"polygon(0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%)"}[F]||"none",overflow:"hidden"};case"layout":return{borderRadius:typeof H=="number"?`${H}px`:H||0,overflow:"hidden"};case"rectangle":default:return{borderRadius:typeof H=="number"?`${H}px`:H||0,overflow:"hidden"}}};return a.jsx("section",{className:"canvas-viewport","aria-label":"Template canvas",children:a.jsx("div",{className:"canvas-viewport__surface",role:"img","aria-label":`Design surface for ${e.name}`,onPointerDown:re,onPointerMove:A,onPointerUp:q,onPointerCancel:q,children:a.jsx("div",{className:"canvas-viewport__stage",style:Hs(w,e,R,z),children:a.jsxs("div",{className:"canvas-viewport__page",style:{width:e.width,height:e.height,background:e.background||"#ffffff",...Se(Pe)},onClick:()=>$(null),"data-zoom":w,ref:t??null,children:[a.jsx("div",{className:"canvas-viewport__grid","aria-hidden":"true"}),a.jsx("div",{className:"canvas-viewport__bleed",style:cn(Te),"aria-hidden":"true"}),a.jsx("div",{className:"canvas-viewport__safe-zone",style:cn(ge),"aria-hidden":"true"}),ie.length===0&&a.jsxs("div",{className:"canvas-viewport__empty-state",children:[a.jsx("h2",{children:"Canvas ready"}),a.jsx("p",{children:"Start by selecting a tool on the left. You can add live text, image placeholders, or vector shapes."})]}),ie.map(({layer:y,originalIndex:I,explicitStackIndex:F},H)=>{const Q=Us(y,I,e),S=y.id===O,D=y.visible===!1,ee=y.locked===!0,W=y.type==="text",te=y.type==="image",je=y.type==="shape",Ce=y.id===f,oe=(y==null?void 0:y.metadata)??{},he=typeof oe.objectFit=="string"?oe.objectFit:"cover",fe=Number(oe.imageScale),U=Number.isFinite(fe)?dr(fe,.25,4):1,Ne=Number(oe.imageOffsetX),xt=Number(oe.imageOffsetY),Be=Number.isFinite(Ne)?dr(Ne,-500,500):0,ke=Number.isFinite(xt)?dr(xt,-500,500):0,Ye=!!oe.flipHorizontal,He=!!oe.flipVertical,St=Ye?-U:U,We=He?-U:U,Ze=y.id===b,we=Number.isFinite(F)?F:H,Re=Math.max(2,Math.round(10+we)),It=Ws(y,Q,{hidden:D,opacity:y.opacity,isSelected:S,zIndex:Re});return a.jsxs("div",{className:`canvas-layer${S?" is-selected":""}${D?" is-hidden":""}${ee?" is-locked":""}${W?" is-text":""}${te?" is-image":""}${Ce?" is-dragging":""}${Ze?" is-resizing":""}`,style:It,role:"button",tabIndex:0,onClick:P=>{P.stopPropagation(),$(y.id)},onPointerDown:P=>{P.target.classList.contains("canvas-layer__resize-handle")||P.target.closest(".canvas-layer__resize-handle")||($(y.id),ce(P,y,Q))},onPointerMove:ne,onPointerUp:P=>{Me(P),X(P)},onPointerCancel:P=>{Me(P),X(P)},onKeyDown:P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),$(y.id))},"aria-label":`${y.name} layer`,"aria-pressed":S,"data-layer-id":y.id,"data-preview-node":y.id,"data-changeable":te?"image":void 0,children:[W&&a.jsx("div",{className:"canvas-layer__text","data-preview-node":y.id,style:{color:y.fill||"#0f172a",fontSize:y.fontSize?`${y.fontSize}px`:void 0,fontFamily:y.fontFamily,fontWeight:y.fontWeight??void 0,textAlign:y.textAlign??"center"},children:y.content||"Add your text"}),te&&y.content&&typeof y.content=="string"&&(y.content.startsWith("data:")||y.content.startsWith("blob:"))&&a.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"},children:[a.jsx("img",{src:y.content,alt:y.name||"Uploaded image",className:"canvas-layer__image","data-preview-node":y.id,"data-changeable":"image",style:{width:"100%",height:"100%",objectFit:he,borderRadius:y.borderRadius??0,display:"block",transform:`translate(${Be}px, ${ke}px) scale(${St}, ${We})`,transformOrigin:"center"},onError:P=>{var it,st;console.error("Failed to load image:",((it=y.content)==null?void 0:it.substring(0,100))+"..."),P.target.style.display="none";const Ue=(st=P.target.parentElement)==null?void 0:st.querySelector(".image-error");Ue&&(Ue.style.display="flex")},onLoad:P=>{var it;console.log("Image loaded successfully:",y.name),P.target.style.display="block";const Ue=(it=P.target.parentElement)==null?void 0:it.querySelector(".image-error");Ue&&(Ue.style.display="none")}}),a.jsxs("div",{className:"image-error",style:{display:"none",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"0.4rem",fontSize:"0.8rem",color:"rgba(239, 68, 68, 0.8)",textAlign:"center",padding:"0.5rem",background:"rgba(255, 255, 255, 0.9)",borderRadius:"4px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[a.jsx("span",{children:"⚠️"}),a.jsx("p",{children:"Failed to load image"})]})]}),S&&(te&&y.content||W)&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"canvas-layer__resize-handle canvas-layer__resize-handle--nw",onPointerDown:P=>{P.stopPropagation(),me(P,y,Q,"nw")},onClick:P=>P.stopPropagation(),style:{position:"absolute",top:"-8px",left:"-8px",width:"16px",height:"16px",backgroundColor:"#3b82f6",border:"2px solid #ffffff",borderRadius:"3px",cursor:"nw-resize",zIndex:1e3,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",transition:"all 0.1s ease",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:P=>{P.currentTarget.style.transform="scale(1.2)",P.currentTarget.style.backgroundColor="#1d4ed8"},onMouseLeave:P=>{P.currentTarget.style.transform="scale(1)",P.currentTarget.style.backgroundColor="#3b82f6"},children:a.jsx("div",{style:{width:"4px",height:"4px",backgroundColor:"#ffffff",borderRadius:"1px",opacity:.8,pointerEvents:"none"}})}),a.jsx("div",{className:"canvas-layer__resize-handle canvas-layer__resize-handle--ne",onPointerDown:P=>{P.stopPropagation(),me(P,y,Q,"ne")},onClick:P=>P.stopPropagation(),style:{position:"absolute",top:"-8px",right:"-8px",width:"16px",height:"16px",backgroundColor:"#3b82f6",border:"2px solid #ffffff",borderRadius:"3px",cursor:"ne-resize",zIndex:1e3,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",transition:"all 0.1s ease",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:P=>{P.currentTarget.style.transform="scale(1.2)",P.currentTarget.style.backgroundColor="#1d4ed8"},onMouseLeave:P=>{P.currentTarget.style.transform="scale(1)",P.currentTarget.style.backgroundColor="#3b82f6"},children:a.jsx("div",{style:{width:"4px",height:"4px",backgroundColor:"#ffffff",borderRadius:"1px",opacity:.8,pointerEvents:"none"}})}),a.jsx("div",{className:"canvas-layer__resize-handle canvas-layer__resize-handle--sw",onPointerDown:P=>{P.stopPropagation(),me(P,y,Q,"sw")},onClick:P=>P.stopPropagation(),style:{position:"absolute",bottom:"-8px",left:"-8px",width:"16px",height:"16px",backgroundColor:"#3b82f6",border:"2px solid #ffffff",borderRadius:"3px",cursor:"sw-resize",zIndex:1e3,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",transition:"all 0.1s ease",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:P=>{P.currentTarget.style.transform="scale(1.2)",P.currentTarget.style.backgroundColor="#1d4ed8"},onMouseLeave:P=>{P.currentTarget.style.transform="scale(1)",P.currentTarget.style.backgroundColor="#3b82f6"},children:a.jsx("div",{style:{width:"4px",height:"4px",backgroundColor:"#ffffff",borderRadius:"1px",opacity:.8,pointerEvents:"none"}})}),a.jsx("div",{className:"canvas-layer__resize-handle canvas-layer__resize-handle--se",onPointerDown:P=>{P.stopPropagation(),me(P,y,Q,"se")},onClick:P=>P.stopPropagation(),style:{position:"absolute",bottom:"-8px",right:"-8px",width:"16px",height:"16px",backgroundColor:"#3b82f6",border:"2px solid #ffffff",borderRadius:"3px",cursor:"se-resize",zIndex:1e3,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.3)",transition:"all 0.1s ease",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:P=>{P.currentTarget.style.transform="scale(1.2)",P.currentTarget.style.backgroundColor="#1d4ed8"},onMouseLeave:P=>{P.currentTarget.style.transform="scale(1)",P.currentTarget.style.backgroundColor="#3b82f6"},children:a.jsx("div",{style:{width:"4px",height:"4px",backgroundColor:"#ffffff",borderRadius:"1px",opacity:.8,pointerEvents:"none"}})})]}),je&&!W&&!te&&a.jsx("span",{className:"canvas-layer__label",children:y.name})]},y.id)})]})})})})}xr.propTypes={page:V.shape({id:V.string.isRequired,name:V.string.isRequired,width:V.number.isRequired,height:V.number.isRequired,nodes:V.array}).isRequired,canvasRef:V.shape({current:V.any})};xr.defaultProps={canvasRef:null};function Hs(e,t,r,i){return{transform:`translate(${r}px, ${i}px) scale(${e})`,transformOrigin:"top left",width:t.width,height:t.height}}function Ws(e,t,{hidden:r,opacity:i,isSelected:s,zIndex:d}){const m=r?.35:Math.max(.1,i??1),f={left:t.x,top:t.y,width:t.width,height:t.height,opacity:m,borderColor:e.stroke??"rgba(15, 23, 42, 0.18)",borderRadius:e.borderRadius??0,transform:t.rotation?`rotate(${t.rotation}deg)`:void 0,transformOrigin:"center"};return Number.isFinite(d)&&(f.zIndex=d),e.type==="text"?(f.background="transparent",f.borderStyle="dashed",f.borderWidth=1):e.type==="image"?e.content?(f.background="transparent",f.borderStyle="solid",f.borderWidth=2,f.borderColor=s?"#3b82f6":"rgba(148, 163, 184, 0.5)",f.padding=0):(f.background="transparent",f.borderStyle="dashed",f.borderWidth=2,f.borderColor=s?"#3b82f6":"rgba(148, 163, 184, 0.3)"):(f.background=e.fill?Os(e.fill,e.opacity):"rgba(37, 99, 235, 0.12)",f.borderStyle="solid",f.borderWidth=1),f}function cn({top:e,right:t,bottom:r,left:i}){return{top:e,right:t,bottom:r,left:i}}function Us(e,t,r){const{width:i,height:s}=r,d=e.frame;if(d)return{x:d.x,y:d.y,width:d.width,height:d.height,rotation:d.rotation??0};const m=48,f=i*.6,p=Math.min(160,s*.18),b=t*32;return{x:m+b%120,y:m+b,width:f,height:p,rotation:0}}function Os(e,t=1){return typeof e!="string"?e||"rgba(37, 99, 235, 0.12)":t>=.999?e:$s(e,t)||e}function $s(e,t){if(!e)return null;if(e.startsWith("#")){const r=e.slice(1),i=parseInt(r,16);if(Number.isNaN(i))return null;const s=r.length===8,d=i>>(s?24:16)&255,m=i>>(s?16:8)&255,f=i>>(s?8:0)&255;return`rgba(${d}, ${m}, ${f}, ${t})`}if(e.startsWith("rgb")){const r=e.match(/rgba?\(([^)]+)\)/);if(!r)return null;const i=r[1].split(",").map(f=>Number.parseFloat(f.trim())).filter((f,p)=>p<3&&Number.isFinite(f));if(i.length!==3)return null;const[s,d,m]=i;return`rgba(${s}, ${d}, ${m}, ${t})`}return null}function dr(e,t,r){return!Number.isFinite(e)||e<t?t:e>r?r:e}function Ys(e,t){switch(e){case"saving":return"Autosaving...";case"dirty":return"Unsaved changes";case"error":return"Autosave failed";case"saved":{if(!t)return"All changes saved";const r=new Date(t);return Number.isNaN(r.getTime())?"All changes saved":`Saved at ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}case"idle":default:if(t){const r=new Date(t);if(!Number.isNaN(r.getTime()))return`Last saved at ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}return"Ready"}}function Zs({isSavingTemplate:e,saveError:t,lastManualSaveAt:r}){if(e)return"Saving template…";if(t)return t;if(r){const i=new Date(r);if(!Number.isNaN(i.getTime()))return`Template saved at ${i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}return null}function Sr({autosaveStatus:e,lastSavedAt:t,onSaveTemplate:r,isSavingTemplate:i,saveError:s,lastManualSaveAt:d}){var X,me;const{state:m,dispatch:f,routes:p}=mt(),b=((X=m.template)==null?void 0:X.name)??"Untitled template",v=()=>f({type:"UNDO"}),w=()=>f({type:"REDO"}),R=()=>f({type:"SHOW_PREVIEW_MODAL"}),z=()=>{typeof r=="function"&&!i&&r()},O=Ys(e,t),$=e==="saving",re=e==="error",A=Zs({isSavingTemplate:i,saveError:s,lastManualSaveAt:d}),q=s?"builder-topbar__status--error":i?"builder-topbar__status--saving":"builder-topbar__status--success",ce=i?"Saving template…":"Save template",ne=typeof r!="function"||i;return a.jsxs("header",{className:"builder-topbar",role:"banner",children:[a.jsxs("div",{className:"builder-topbar__left",children:[a.jsx("a",{href:p.index,className:"builder-topbar__back","aria-label":"Back to templates",children:"← Templates"}),a.jsxs("div",{className:"builder-topbar__title",children:[a.jsx("span",{className:"builder-topbar__template-name",title:b,children:b}),((me=m.template)==null?void 0:me.category)&&a.jsx("span",{className:"builder-topbar__meta",children:m.template.category})]})]}),a.jsxs("div",{className:"builder-topbar__center",role:"toolbar","aria-label":"Canvas actions",children:[a.jsx("button",{type:"button",onClick:v,className:"builder-btn","aria-label":"Undo",children:"Undo"}),a.jsx("button",{type:"button",onClick:w,className:"builder-btn","aria-label":"Redo",children:"Redo"}),a.jsx("button",{type:"button",className:"builder-btn","aria-label":"Toggle rulers",disabled:!0,children:"Rulers"}),a.jsx("button",{type:"button",className:"builder-btn","aria-label":"Toggle guides",disabled:!0,children:"Guides"})]}),a.jsxs("div",{className:"builder-topbar__right",children:[a.jsxs("div",{className:"builder-topbar__status-column",role:"status","aria-live":"polite",children:[a.jsx("span",{className:`builder-topbar__status${$?" builder-topbar__status--saving":""}${re?" builder-topbar__status--error":""}`,children:O}),A&&a.jsx("span",{className:`builder-topbar__status builder-topbar__status--sub ${q}`,children:A})]}),a.jsx("button",{type:"button",className:"builder-btn","aria-label":"Preview",onClick:R,children:"Preview"}),a.jsx("button",{type:"button",className:"builder-btn builder-btn--primary","aria-label":"Save template",onClick:z,disabled:ne,children:ce})]})]})}Sr.propTypes={autosaveStatus:V.string,lastSavedAt:V.string,onSaveTemplate:V.func,isSavingTemplate:V.bool,saveError:V.string,lastManualSaveAt:V.string};Sr.defaultProps={autosaveStatus:"idle",lastSavedAt:null,onSaveTemplate:null,isSavingTemplate:!1,saveError:null,lastManualSaveAt:null};function Gs(){const{state:e}=mt(),t=e.pages.find(f=>f.id===e.activePageId)??e.pages[0],r=Array.isArray(t==null?void 0:t.nodes)?t.nodes:[];r.find(f=>f.id===e.selectedLayerId);const i=Math.round((e.zoom??1)*100),s=e.history.undoStack.length,d=e.history.redoStack.length,m=r.length;return a.jsxs("footer",{className:"builder-statusbar",role:"contentinfo","aria-live":"polite",children:[a.jsxs("div",{className:"builder-statusbar__segment",children:["Page: ",t.name," (",t.width," × ",t.height,"px)"]}),a.jsxs("div",{className:"builder-statusbar__segment",children:["Layers: ",m]}),a.jsxs("div",{className:"builder-statusbar__segment",children:["Zoom: ",i,"%"]}),a.jsxs("div",{className:"builder-statusbar__segment",children:["History: ",s," undo • ",d," redo"]})]})}const dn=.1,Qs=.25,Xs=3;function un(e){return Math.min(Math.max(e,Qs),Xs)}function qs(){const{state:e,dispatch:t}=mt();return l.useEffect(()=>{const r=i=>{if(i.defaultPrevented)return;const s=i.target;if(s instanceof HTMLElement){const b=s.tagName;if(s.isContentEditable||b==="INPUT"||b==="TEXTAREA"||b==="SELECT")return}const d=e.pages.find(b=>b.id===e.activePageId)??e.pages[0],m=e.selectedLayerId,f=d==null?void 0:d.nodes.find(b=>b.id===m);if(i.ctrlKey||i.metaKey){let b=!1,v=e.zoom??1;switch(i.key){case"=":case"+":v=un(v+dn),b=!0;break;case"-":case"_":v=un(v-dn),b=!0;break;case"0":v=1,b=!0;break}b&&(i.preventDefault(),t({type:"UPDATE_ZOOM",value:v}));return}if(!(!d||!f||f.locked))switch(i.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{const b=i.shiftKey?10:1;let v=0,w=0;i.key==="ArrowLeft"&&(v=-b),i.key==="ArrowRight"&&(v=b),i.key==="ArrowUp"&&(w=-b),i.key==="ArrowDown"&&(w=b),t({type:"BEGIN_LAYER_TRANSFORM"}),t({type:"NUDGE_LAYER",pageId:d.id,layerId:m,dx:v,dy:w,trackHistory:!1}),i.preventDefault();break}case"Delete":case"Backspace":{window.confirm(`Delete "${f.name}"? You can undo this action if needed.`)&&(t({type:"REMOVE_LAYER",pageId:d.id,layerId:m}),i.preventDefault());break}}};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[t,e]),null}function hn(e){if(!e)return{top:0,right:0,bottom:0,left:0};const t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const s=parseFloat(i);return Number.isNaN(s)?0:s}return 0},r=t(e.margin??e.all??0);return{top:t(e.top??r),right:t(e.right??r),bottom:t(e.bottom??r),left:t(e.left??r)}}function fn(e,t="None"){if(!e)return t;const r=[e.top,e.right,e.bottom,e.left];return r.some(s=>s>0)?`${r[0]}px / ${r[1]}px / ${r[2]}px / ${r[3]}px`:t}function Dn({isOpen:e,onClose:t}){var Q;const{state:r,dispatch:i}=mt(),s=(r==null?void 0:r.pages)??[];if(!e||s.length===0)return null;const d=s.find(S=>S.id===r.activePageId)??s[0],m=hn(d.safeZone),f=hn(d.bleed),p=Object.values(m).some(S=>S>0),b=Object.values(f).some(S=>S>0),[v,w]=l.useState(()=>p),[R,z]=l.useState(!1),[O,$]=l.useState("light");l.useEffect(()=>{w(p),z(!1)},[p,d.id]);const re=Math.max(Number(d.width)||0,1),A=Math.max(Number(d.height)||0,1),ne=Math.min(760/re,520/A,1),X=Math.round(re*ne),me=Math.round(A*ne),be=Array.isArray(d.nodes)?d.nodes:[],Me=l.useMemo(()=>be.filter(S=>S.visible!==!1),[be]),ge=l.useMemo(()=>Me.reduce((S,D)=>{const ee=D.type||"other";return S.total+=1,S[ee]=(S[ee]||0)+1,S},{total:0}),[Me]),Te=new Set(["Aurora Atelier","Visual storytelling & editorial craft","Playfair Display headline with Source Sans Pro narrative subcopy.","Lumina Forge","Product strategy & venture labs","DM Serif Display hero matched with crisp Inter labels.","Saffron Harbor","Artisanal markets & seaside residencies","Cormorant Garamond headline with welcoming Nunito Sans body.","Meridian Labs","Insight decks • Research memos","Libre Baskerville deck titles with Manrope research notes.","Celestial Grid","Futurist observatory narratives","Cinzel monograms paired with Space Grotesk captions.","Radiant Market","Seasonal florals & gifting studio","Abril Fatface display balanced by Work Sans merchandising notes.","Atelier North","Boutique identity consultancy","Lora type paired with crisp Poppins service line.","Solstice Audio","Soundscapes for modern retreats","Volkhov warmth with Mulish modernity.","Harvest Lane","Slow food residencies & journals","Cardo editorial serif with Questrial market notes.","Paragon Museum","Annual symposium schedule","Tickets • Archives • Tours","Marcellus title with IBM Plex Sans itinerary details.","Velvet Horizon","Sunset editorials & travel essays","Rosarivo curves with airy Raleway notes.","Meteora Studio","Speculative interiors & lighting labs","Prata elegance with grounded Figtree descriptors.","Ember Studio","Culinary films & sonic diaries","Spectral prose headlines with Karla annotations.","Glasshouse","Greenhouse culture & creative labs","Gloock statement paired with Montserrat details.","Nova Lounge","Midnight tastings & listening rooms","Noto Serif Display paired with Urbanist lounge notes.","Terrace Agency","Landscape narratives & brand sites","Quattrocento headlines with DM Sans service info.","Lucid Canvas","Immersive art fair programming","Ysabeau contrasts with approachable Cabin body.","Citrine Summit","Sustainability briefings & labs","Crimson Pro titles with Open Sans agenda text.","Frame Factory","Gallery systems & product drops","Fraunces curves with minimalist Outfit copy.","Indigo Manor","Cultural residences & salons","EB Garamond editorial voice with Hind Madurai support.","Marble Coast","Coastal architecture dossiers","Tenor Sans structure with Gentium Plus narrative.","Orchid Bureau","Trend reports • Field interviews","Newsreader gravitas with Heebo clarity.","Lux Atelier","Made-to-measure wardrobe plans","Baskervville elegance with utilitarian Lato captions.","Cobalt Grove","Botanical research & residency notes","Zilla Slab hero text with Rubik supporting copy."]),Pe=l.useMemo(()=>{const S=Me.filter(D=>D.type==="text"&&D.content&&D.content.trim()).map(D=>D.content.trim()).filter(D=>!Te.has(D));return[...new Set(S)]},[Me,Te]),ue=l.useMemo(()=>{const S={back:0,middle:1,front:2};return[...be].sort((D,ee)=>{const W=D.side||"middle",te=ee.side||"middle";return(S[W]??1)-(S[te]??1)})},[be]),ie=d.shape??null,Se=v&&p?{position:"absolute",top:m.top,right:m.right,bottom:m.bottom,left:m.left,border:"1px dashed rgba(37, 99, 235, 0.55)",borderRadius:"inherit",pointerEvents:"none"}:null,y=R&&b?{position:"absolute",top:-f.top,right:-f.right,bottom:-f.bottom,left:-f.left,border:"1px solid rgba(220, 38, 38, 0.4)",borderRadius:"inherit",pointerEvents:"none"}:null,I=S=>{!S||S===d.id||i({type:"SELECT_PAGE",pageId:S})},F=S=>{if(!S)return{};const{variant:D,id:ee,borderRadius:W}=S;switch(D){case"circle":return{borderRadius:"50%",overflow:"hidden"};case"polygon":return{clipPath:{triangle:"polygon(50% 0%, 0% 100%, 100% 100%)",diamond:"polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)",hexagon:"polygon(30% 0%, 70% 0%, 100% 50%, 70% 100%, 30% 100%, 0% 50%)",octagon:"polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)",star:"polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)",shield:"polygon(50% 0%, 100% 20%, 100% 80%, 50% 100%, 0% 80%, 0% 20%)"}[ee]||"none",overflow:"hidden"};case"organic":return{clipPath:{heart:'path("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z")',"cloud-shape":"ellipse(60% 40% at 50% 50%)",flower:"polygon(50% 0%, 65% 35%, 100% 50%, 65% 65%, 50% 100%, 35% 65%, 0% 50%, 35% 35%)",butterfly:"polygon(50% 0%, 70% 20%, 90% 40%, 70% 60%, 50% 80%, 30% 60%, 10% 40%, 30% 20%)",leaf:"polygon(50% 0%, 100% 30%, 90% 70%, 50% 100%, 10% 70%, 0% 30%)",balloon:"ellipse(50% 60% at 50% 50%)",crown:"polygon(50% 0%, 60% 25%, 85% 25%, 75% 50%, 95% 50%, 80% 75%, 100% 75%, 85% 100%, 15% 100%, 0% 75%, 20% 75%, 5% 50%, 25% 50%, 15% 25%, 40% 25%)","puzzle-piece":"polygon(0% 0%, 70% 0%, 70% 30%, 100% 30%, 100% 70%, 70% 70%, 70% 100%, 30% 100%, 30% 70%, 0% 70%)","ribbon-banner":"polygon(0% 0%, 10% 50%, 0% 100%, 100% 100%, 90% 50%, 100% 0%)"}[ee]||"none",overflow:"hidden"};case"frame":case"layout":case"rectangle":return{borderRadius:typeof W=="number"?`${W}px`:W||0,overflow:"hidden"};case"tag":return{clipPath:{"tag-shape":"polygon(0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%)","ticket-shape":"polygon(0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%)"}[ee]||"none",overflow:"hidden"};default:return{}}},H=a.jsx("div",{className:"preview-modal-overlay",onClick:t,children:a.jsxs("div",{className:"preview-modal",onClick:S=>S.stopPropagation(),children:[a.jsxs("div",{className:"preview-modal__header",children:[a.jsxs("div",{className:"preview-modal__title-group",children:[a.jsx("h2",{children:"Template Preview"}),a.jsxs("p",{children:[((Q=r.template)==null?void 0:Q.name)||"Untitled template"," - ",s.length," page",s.length===1?"":"s"]})]}),a.jsxs("div",{className:"preview-modal__actions",role:"toolbar","aria-label":"Preview options",children:[p&&a.jsx("button",{type:"button",className:`preview-toggle ${v?"is-active":""}`,onClick:()=>w(S=>!S),children:"Safe zone"}),b&&a.jsx("button",{type:"button",className:`preview-toggle ${R?"is-active":""}`,onClick:()=>z(S=>!S),children:"Bleed"}),a.jsxs("div",{className:"preview-toggle-group",role:"group","aria-label":"Preview background",children:[a.jsx("button",{type:"button",className:`preview-toggle ${O==="light"?"is-active":""}`,onClick:()=>$("light"),children:"Light"}),a.jsx("button",{type:"button",className:`preview-toggle ${O==="dark"?"is-active":""}`,onClick:()=>$("dark"),children:"Dark"})]}),a.jsx("button",{type:"button",className:"preview-modal__close",onClick:t,"aria-label":"Close preview",children:"×"})]})]}),a.jsxs("div",{className:"preview-modal__content",children:[a.jsxs("aside",{className:"preview-modal__sidebar","aria-label":"Template details",children:[a.jsxs("div",{className:"preview-sidebar__section",children:[a.jsx("h3",{children:"Page info"}),a.jsxs("dl",{className:"preview-info-list",children:[a.jsxs("div",{children:[a.jsx("dt",{children:"Title"}),a.jsx("dd",{children:d.name||"Untitled page"})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Dimensions"}),a.jsxs("dd",{children:[re," × ",A,"px"]})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Scale"}),a.jsxs("dd",{children:[Math.round(ne*100),"%"]})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Safe zone"}),a.jsx("dd",{children:fn(p?m:null)})]}),a.jsxs("div",{children:[a.jsx("dt",{children:"Bleed"}),a.jsx("dd",{children:fn(b?f:null)})]})]})]}),s.length>1&&a.jsxs("div",{className:"preview-sidebar__section",children:[a.jsx("h3",{children:"Pages"}),a.jsx("ul",{className:"preview-page-list",children:s.map(S=>a.jsx("li",{children:a.jsxs("button",{type:"button",className:S.id===d.id?"is-active":"",onClick:()=>I(S.id),children:[a.jsx("span",{className:"preview-page-list__name",children:S.name||"Untitled page"}),a.jsxs("span",{className:"preview-page-list__meta",children:[S.width," × ",S.height,"px"]})]})},S.id))})]}),a.jsxs("div",{className:"preview-sidebar__section",children:[a.jsx("h3",{children:"Layer summary"}),a.jsxs("ul",{className:"preview-layer-stats",children:[a.jsxs("li",{children:[a.jsx("span",{children:"Total layers"}),a.jsx("span",{children:ge.total})]}),a.jsxs("li",{children:[a.jsx("span",{children:"Text"}),a.jsx("span",{children:ge.text||0})]}),a.jsxs("li",{children:[a.jsx("span",{children:"Images"}),a.jsx("span",{children:ge.image||0})]}),a.jsxs("li",{children:[a.jsx("span",{children:"Shapes"}),a.jsx("span",{children:ge.shape||0})]})]})]}),Pe.length>0&&a.jsxs("div",{className:"preview-sidebar__section",children:[a.jsx("h3",{children:"Text content"}),a.jsx("ul",{className:"preview-text-list",children:Pe.map((S,D)=>a.jsx("li",{title:S,children:S.length>30?`${S.substring(0,30)}...`:S},D))})]})]}),a.jsx("section",{className:`preview-modal__canvas preview-modal__canvas--${O}`,"aria-label":"Canvas preview",children:a.jsxs("div",{className:"preview-canvas",children:[a.jsxs("header",{className:"preview-canvas__toolbar",children:[a.jsx("span",{children:d.name||"Untitled page"}),a.jsxs("span",{children:[X," × ",me,"px · ",Math.round(ne*100),"%"]})]}),a.jsx("div",{className:"preview-canvas__viewport",children:a.jsx("div",{className:"preview-canvas__stage",style:{width:X,height:me},children:a.jsxs("div",{className:"preview-page",style:{position:"relative",width:re,height:A,background:d.background||"#ffffff",...F(ie),borderRadius:"12px",boxShadow:"0 18px 40px rgba(15, 23, 42, 0.25)",transform:`scale(${ne})`,transformOrigin:"top left"},children:[y&&a.jsx("div",{className:"preview-bleed-guide",style:y}),Se&&a.jsx("div",{className:"preview-safezone",style:Se}),ue.map(S=>{if(S.visible===!1)return null;const D=S.frame;if(!D)return null;const ee=S.type==="text",W=S.type==="image",te=(S==null?void 0:S.metadata)??{},je=typeof te.objectFit=="string"?te.objectFit:"cover",Ce=Number(te.imageScale),oe=Number.isFinite(Ce)?Math.max(.25,Math.min(4,Ce)):1,he=Number(te.imageOffsetX),fe=Number(te.imageOffsetY),U=Number.isFinite(he)?Math.max(-500,Math.min(500,he)):0,Ne=Number.isFinite(fe)?Math.max(-500,Math.min(500,fe)):0,xt=!!te.flipHorizontal,Be=!!te.flipVertical,ke=xt?-oe:oe,Ye=Be?-oe:oe,He={position:"absolute",left:D.x,top:D.y,width:D.width,height:D.height,opacity:S.opacity??1,borderRadius:S.borderRadius??0,transform:D.rotation?`rotate(${D.rotation}deg)`:void 0,transformOrigin:"center",overflow:"hidden"};return a.jsxs("div",{style:He,children:[ee&&a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:S.textAlign==="left"?"flex-start":S.textAlign==="right"?"flex-end":"center",color:S.fill||"#0f172a",fontSize:S.fontSize?`${S.fontSize}px`:"16px",fontFamily:S.fontFamily||"Arial, sans-serif",fontWeight:S.fontWeight??"normal",textAlign:S.textAlign??"center",padding:"8px",boxSizing:"border-box",wordWrap:"break-word"},children:S.content||"Add your text"}),W&&S.content&&typeof S.content=="string"&&(S.content.startsWith("data:")||S.content.startsWith("blob:"))&&a.jsx("img",{src:S.content,alt:S.name||"Template image",style:{width:"100%",height:"100%",objectFit:je,borderRadius:S.borderRadius??0,display:"block",transform:`translate(${U}px, ${Ne}px) scale(${ke}, ${Ye})`,transformOrigin:"center"}}),S.type==="shape"&&!ee&&!W&&a.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:S.fill||"rgba(37, 99, 235, 0.12)",borderRadius:S.borderRadius??0,...F(S.shape)}})]},S.id)})]})})})]})})]}),a.jsxs("footer",{className:"preview-modal__footer",children:[a.jsxs("div",{className:"preview-modal__footer-tip",children:[a.jsx("strong",{children:"Tip:"})," Toggle guides to validate bleed and safety before exporting previews."]}),a.jsx("button",{type:"button",className:"builder-btn",onClick:t,children:"Close preview"})]})]})});return typeof document>"u"?H:mr.createPortal(H,document.body)}Dn.propTypes={isOpen:V.bool.isRequired,onClose:V.func.isRequired};function mn(e){return{pages:Array.isArray(e.pages)?e.pages.map(r=>({id:r.id,name:r.name,width:r.width,height:r.height,background:r.background,safeZone:r.safeZone??null,bleed:r.bleed??null,metadata:r.metadata??{},nodes:Array.isArray(r.nodes)?r.nodes.map(i=>({id:i.id,name:i.name,type:i.type,visible:i.visible!==!1,locked:!!i.locked,opacity:typeof i.opacity=="number"?i.opacity:1,frame:i.frame?{...i.frame}:null,fill:i.fill??null,stroke:i.stroke??null,content:i.content??"",fontSize:i.fontSize??null,fontFamily:i.fontFamily??null,fontWeight:i.fontWeight??null,textAlign:i.textAlign??null,borderRadius:i.borderRadius??0,variant:i.variant??null,metadata:i.metadata??{}})):[]})):[],activePageId:e.activePageId??null,selectedLayerId:e.selectedLayerId??null,canvas:{zoom:e.zoom??1,panX:e.panX??0,panY:e.panY??0}}}class Ir extends Ba.Component{constructor(r){super(r);Hr(this,"handleReset",()=>{const{onReset:r}=this.props;this.setState({error:null,info:null},()=>{typeof r=="function"&&r()})});this.state={error:null,info:null}}static getDerivedStateFromError(r){return{error:r}}componentDidCatch(r,i){console.error("[InkWise Builder] A runtime error occurred.",r,i),this.setState({info:i}),typeof window<"u"&&(window.__INKWISE_LAST_ERROR__={message:r==null?void 0:r.message,stack:r==null?void 0:r.stack,componentStack:i==null?void 0:i.componentStack,templateId:this.props.templateId??null})}render(){const{error:r,info:i}=this.state,{children:s}=this.props;return r?a.jsx("div",{className:"builder-error-boundary",role:"alert","aria-live":"assertive",children:a.jsxs("div",{className:"builder-error-boundary__card",children:[a.jsx("h1",{children:"Template builder hit a snag"}),a.jsx("p",{className:"builder-error-boundary__message",children:r.message||"Unknown runtime error."}),(i==null?void 0:i.componentStack)&&a.jsxs("details",{className:"builder-error-boundary__details",children:[a.jsx("summary",{children:"Show technical details"}),a.jsx("pre",{children:i.componentStack})]}),a.jsx("button",{type:"button",className:"builder-error-boundary__action",onClick:this.handleReset,children:"Reload editor"})]})}):s}}Ir.propTypes={children:V.node.isRequired,onReset:V.func,templateId:V.oneOfType([V.string,V.number])};Ir.defaultProps={onReset:void 0,templateId:null};const gn=1.2,Vs=960,br=.62,Tn=15e5;function Bn(e){if(typeof e!="string")return 0;const t=e.indexOf(","),r=t!==-1?e.slice(t+1):e;return Math.ceil(r.length*3/4)}function Js(e){return new Promise((t,r)=>{const i=new Image;i.onload=()=>t(i),i.onerror=s=>r(s),i.src=e})}function pn(e,t,r){const i=Math.max(1,Math.round(e.width*t)),s=Math.max(1,Math.round(e.height*t)),d=document.createElement("canvas");d.width=i,d.height=s;const m=d.getContext("2d");return m?(m.drawImage(e,0,0,i,s),d.toDataURL("image/jpeg",r)):null}async function Ks(e,t={}){if(!e||typeof document>"u")return e;const{maxEdge:r=Vs,quality:i=br,maxBytes:s=Tn}=t;try{const d=await Js(e),m=Math.max(d.width,d.height);let f=m>r&&r>0?r/m:1,p=i,b=pn(d,f,p)||e;for(;Bn(b)>s&&f>.3;){f=Math.max(.3,f*.85),p=Math.max(.4,p-.08);const v=pn(d,f,p);if(!v)break;b=v}return b}catch(d){return console.warn("[InkWise Builder] Failed to compress preview image.",d),e}}function eo(e){if(typeof e!="string")return null;if(!e.startsWith("data:image/svg+xml"))return e;const t=e.indexOf(",");if(t===-1)return e;const r=e.slice(t+1);try{return decodeURIComponent(r)}catch(i){return console.warn("[InkWise Builder] Failed to decode SVG markup payload.",i),r}}function to(e){return typeof e!="string"?e:e.replace(/<!--.*?-->/gs,"").replace(/\s*\n+\s*/g," ").replace(/\s{2,}/g," ").trim()}function ao(e){if(!e||typeof e!="string")return e;const t=to(e);try{if(typeof window<"u"&&typeof window.btoa=="function")return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(r){console.warn("[InkWise Builder] Failed to encode SVG markup payload.",r)}return t}function ro(){var Te,Pe,ue;const{state:e,routes:t,csrfToken:r,dispatch:i}=mt(),s=e.pages.find(ie=>ie.id===e.activePageId)??e.pages[0],[d,m]=l.useState(!1),[f,p]=l.useState("idle"),[b,v]=l.useState(((Te=e.template)==null?void 0:Te.updated_at)??null),[w,R]=l.useState(!1),[z,O]=l.useState(null),[$,re]=l.useState(null),A=l.useRef(null),q=l.useRef(null),ce=l.useRef(null),ne=l.useRef(!0),X=l.useRef(null),me=l.useCallback(()=>{typeof window<"u"&&window.location.reload()},[]),be=()=>{m(!d)};l.useEffect(()=>()=>{A.current&&(clearTimeout(A.current),A.current=null),ce.current&&ce.current.abort()},[]),l.useEffect(()=>{if(!(t!=null&&t.autosave)||!r)return;const ie=mn(e),Se=JSON.stringify(ie);if(ne.current){ne.current=!1,q.current=Se;return}if(Se!==q.current)return q.current=Se,A.current&&clearTimeout(A.current),p("dirty"),A.current=setTimeout(()=>{var I;if(!(t!=null&&t.autosave)||!r)return;ce.current&&ce.current.abort();const y=new AbortController;ce.current=y,p("saving"),fetch(t.autosave,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":r},credentials:"same-origin",body:JSON.stringify({design:ie,canvas:ie.canvas,template_name:((I=e.template)==null?void 0:I.name)??null}),signal:y.signal}).then(async F=>{if(!F.ok){const H=await F.text();throw new Error(H||"Autosave request failed")}return F.json()}).then(F=>{p("saved"),F!=null&&F.saved_at&&v(F.saved_at),ce.current===y&&(ce.current=null)}).catch(F=>{y.signal.aborted||(ce.current===y&&(ce.current=null),console.error("[InkWise Builder] Autosave failed:",F),p("error"),q.current=null)})},1500),()=>{A.current&&(clearTimeout(A.current),A.current=null)}},[e.pages,e.activePageId,e.zoom,e.panX,e.panY,(Pe=e.template)==null?void 0:Pe.name,t==null?void 0:t.autosave,r]);const Me=(t==null?void 0:t.saveTemplate)??(t==null?void 0:t.saveCanvas),ge=l.useCallback(async()=>{var y;if(!Me){O("Save route is unavailable.");return}if(!r){O("Missing CSRF token.");return}if(!X.current){O("Canvas not ready yet.");return}if(w)return;R(!0),O(null);const ie=typeof document<"u"?document.body:null,Se=typeof window<"u"?Math.min(Math.max(window.devicePixelRatio||1,1),gn):gn;try{i({type:"SHOW_PREVIEW_MODAL"}),ie==null||ie.classList.add("builder-exporting");const I=mn(e);let F=null,H=null;try{F=await rs(X.current,{cacheBust:!0,pixelRatio:Se,quality:br,backgroundColor:"#ffffff"})}catch(he){console.warn("[InkWise Builder] JPEG preview capture failed, falling back to PNG.",he);try{F=await as(X.current,{cacheBust:!0,pixelRatio:Se,quality:br})}catch(fe){console.warn("[InkWise Builder] PNG preview capture failed.",fe)}}try{H=await Nn(X.current,{cacheBust:!0,filter:he=>{var fe;return!((fe=he.classList)!=null&&fe.contains("canvas-layer__resize-handle"))}})}catch(he){console.warn("[InkWise Builder] SVG snapshot capture failed.",he)}const Q=await Ks(F),S=eo(H),D=ao(S),ee=Q&&Bn(Q)<=Tn,W={design:I,template_name:((y=e.template)==null?void 0:y.name)??null};ee&&(W.preview_image=Q),D&&(W.svg_markup=D);const te=await fetch(Me,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":r},credentials:"same-origin",body:JSON.stringify(W)});if(!te.ok){let he="Failed to save template";if((te.headers.get("Content-Type")||"").includes("application/json"))try{const U=await te.clone().json();if(typeof(U==null?void 0:U.message)=="string"&&U.message.trim()!=="")he=U.message.trim();else if(U!=null&&U.errors&&typeof U.errors=="object"){const Ne=Object.values(U.errors)[0];Array.isArray(Ne)&&typeof Ne[0]=="string"&&(he=Ne[0])}}catch(U){console.warn("[InkWise Builder] Failed to parse error response JSON.",U)}else{const U=await te.text();U&&U.trim().length>0&&(he=U.trim())}throw new Error(he)}const je=await te.json().catch(()=>({})),Ce=new Date().toISOString();re(Ce);const oe=(je==null?void 0:je.redirect)||(t==null?void 0:t.index)||"/staff/templates";window.location.href=oe}catch(I){console.error("[InkWise Builder] Template save failed:",I),O(I.message||"Failed to save template"),i({type:"HIDE_PREVIEW_MODAL"})}finally{ie==null||ie.classList.remove("builder-exporting"),R(!1)}},[Me,r,w,e,t,i]);return a.jsx(Ir,{onReset:me,templateId:(ue=e.template)==null?void 0:ue.id,children:a.jsxs("div",{className:"builder-shell",role:"application","aria-label":"InkWise template builder",children:[a.jsx(qs,{}),a.jsx(Sr,{autosaveStatus:f,lastSavedAt:b,onSaveTemplate:ge,isSavingTemplate:w,lastManualSaveAt:$,saveError:z}),a.jsxs("div",{className:"builder-workspace",style:{gridTemplateColumns:d?"60px minmax(0, 1fr) 340px":"600px minmax(0, 1fr) 340px"},children:[a.jsx(Ss,{isSidebarHidden:d,onToggleSidebar:be}),a.jsxs("main",{className:"builder-canvas-column","aria-live":"polite",children:[a.jsx("div",{className:"builder-canvas-header",children:a.jsx(Fs,{})}),a.jsx(xr,{page:s,canvasRef:X}),a.jsx(Gs,{})]}),a.jsx("aside",{className:"builder-right-column","aria-label":"Inspector panels",children:a.jsx(Rs,{})})]}),a.jsx(Dn,{isOpen:e.showPreviewModal,onClose:()=>i({type:"HIDE_PREVIEW_MODAL"})})]})})}function Mr({bootstrap:e}){const t=(e==null?void 0:e.template)??{},r=(e==null?void 0:e.routes)??{},i=(e==null?void 0:e.flags)??{},s=(e==null?void 0:e.user)??null,d=(e==null?void 0:e.csrfToken)??"";return a.jsx(wr,{template:t,routes:r,flags:i,user:s,csrfToken:d,children:a.jsx(ro,{})})}Mr.propTypes={bootstrap:V.shape({template:V.object,routes:V.object,flags:V.object,user:V.object,csrfToken:V.string})};Mr.defaultProps={bootstrap:{}};function no(){const e=document.getElementById("inkwise-builder-bootstrap");if(!e)return console.warn("[InkWise Builder] Bootstrap JSON not found. Falling back to legacy window payload."),window.inkwiseTemplateBootstrap||{};try{return JSON.parse(e.textContent||"{}")}catch(t){return console.error("[InkWise Builder] Failed to parse bootstrap JSON.",t),{}}}const io=no(),ur=document.getElementById("template-builder-app");ur?(ur.classList.add("inkwise-builder--hydrated"),oi.createRoot(ur).render(a.jsx(Ba.StrictMode,{children:a.jsx(Mr,{bootstrap:io})}))):console.error("[InkWise Builder] Root element not found.");
