import{r as A,j as n,c as Cs,R as ks}from"./client-Cv0X-2PX.js";class Sa{constructor(u,l={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",u),this.svg=u,this.options={onImageChange:l.onImageChange||null,onTextChange:l.onTextChange||null,...l};const m=document&&document.body&&document.body.dataset?document.body.dataset:{},h=(m.imageReplacementMode||"").toLowerCase();let R="full";h==="panel-only"||h==="disabled"?R=h:m.allowImageReplacement==="false"&&(R="disabled"),this.imageReplacementMode=R,this.allowCanvasImageTools=R!=="disabled",this.changeableImages=[],this.textElements=[],this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const u=this.svg.dataset.svgData;if(u){const l=JSON.parse(u);this.changeableImages=l.changeable_images||[],this.textElements=l.text_elements||[]}}toSvgPoint(u,l){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const m=this.svg.createSVGPoint();m.x=u,m.y=l;const h=this.svg.getScreenCTM();return h?m.matrixTransform(h.inverse()):null}setupImageHandlers(){const u=this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image]');if(console.log("SvgTemplateEditor: Found",u.length,"changeable image elements"),!this.allowCanvasImageTools){u.forEach(l=>{if(l.style.cursor="default",l.classList.remove("svg-changeable-image"),l.classList.remove("changeable-image-hover"),l._boundingBox){try{l._boundingBox.remove()}catch{}l._boundingBox=null}});return}setTimeout(()=>{u.forEach((l,m)=>{console.log("SvgTemplateEditor: Setting up element",m,l),l.style.cursor="pointer",l.classList.add("svg-changeable-image"),l.classList.add("changeable-image-hover"),l.addEventListener("mouseenter",function(){l.classList.add("changeable-image-active")}),l.addEventListener("mouseleave",function(){l.classList.remove("changeable-image-active")});const h=this.createBoundingBox(l);l._boundingBox=h,this.makeDraggable(l)})},200)}createBoundingBox(u){const l=u.getBBox(),m=document.createElementNS("http://www.w3.org/2000/svg","g");m.classList.add("svg-bounding-box");const h=document.createElementNS("http://www.w3.org/2000/svg","rect");return h.classList.add("svg-bounding-box__rect"),h.setAttribute("fill","none"),h.setAttribute("stroke","#007cba"),h.setAttribute("stroke-width","2"),h.setAttribute("stroke-dasharray","5,5"),h.setAttribute("rx","3"),h.style.pointerEvents="none",m.appendChild(h),this.createResizeHandles().forEach($=>m.appendChild($)),this.svg.appendChild(m),this.positionBoundingElements(m,l),m}createResizeHandles(){const u=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(m=>{const h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.setAttribute("r","4"),h.setAttribute("fill","#007cba"),h.setAttribute("stroke","#ffffff"),h.setAttribute("stroke-width","1"),h.classList.add("resize-handle",`handle-${m.name}`),h.style.pointerEvents="all",h.style.cursor=`${m.name}-resize`,u.push(h)}),u}positionBoundingElements(u,l){const m=u.querySelector(".svg-bounding-box__rect");if(!m)return;const h=5,R=l.x-h,$=l.y-h,M=l.width+h*2,I=l.height+h*2;m.setAttribute("x",R),m.setAttribute("y",$),m.setAttribute("width",Math.max(M,0)),m.setAttribute("height",Math.max(I,0)),u.querySelectorAll(".resize-handle").forEach(k=>{k.classList.contains("handle-nw")?(k.setAttribute("cx",R),k.setAttribute("cy",$)):k.classList.contains("handle-ne")?(k.setAttribute("cx",R+M),k.setAttribute("cy",$)):k.classList.contains("handle-sw")?(k.setAttribute("cx",R),k.setAttribute("cy",$+I)):k.classList.contains("handle-se")?(k.setAttribute("cx",R+M),k.setAttribute("cy",$+I)):k.classList.contains("handle-n")?(k.setAttribute("cx",R+M/2),k.setAttribute("cy",$)):k.classList.contains("handle-s")?(k.setAttribute("cx",R+M/2),k.setAttribute("cy",$+I)):k.classList.contains("handle-e")?(k.setAttribute("cx",R+M),k.setAttribute("cy",$+I/2)):k.classList.contains("handle-w")&&(k.setAttribute("cx",R),k.setAttribute("cy",$+I/2))})}updateBoundingBox(u){if(!u._boundingBox)return;const l=u.getBBox();this.positionBoundingElements(u._boundingBox,l)}makeDraggable(u){let l=!1,m=0,h=0,R=0,$=0,M=0,I=0;const z=q=>{if(q.target.closest(".resize-handle"))return;const H=this.toSvgPoint(q.clientX,q.clientY);if(!H)return;const ye=u.getBBox();m=parseFloat(u.getAttribute("x")),h=parseFloat(u.getAttribute("y")),Number.isNaN(m)&&(m=ye.x,u.setAttribute("x",m)),Number.isNaN(h)&&(h=ye.y,u.setAttribute("y",h)),R=H.x-m,$=H.y-h,M=m,I=h,l=!0,u.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",q.preventDefault()},k=q=>{if(!l)return;const H=this.toSvgPoint(q.clientX,q.clientY);H&&(M=H.x-R,I=H.y-$,u.removeAttribute("transform"),u.setAttribute("x",M),u.setAttribute("y",I),this.updateBoundingBox(u),q.preventDefault())},B=q=>{if(!l)return;l=!1,u.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(u);const H=new CustomEvent("svgImageMoved",{detail:{element:u,x:M,y:I}});this.svg.dispatchEvent(H),q.preventDefault()};u.addEventListener("mousedown",z),document.addEventListener("mousemove",k),document.addEventListener("mouseup",B),u._boundingBox.querySelectorAll(".resize-handle").forEach(q=>{this.makeResizable(u,q)})}makeResizable(u,l){let m=!1,h=null,R=0,$=0,M=0,I=0,z="",k=0;const B=H=>{const ye=this.toSvgPoint(H.clientX,H.clientY);if(!ye)return;const te=u.getBBox();R=te.width,$=te.height,M=parseFloat(u.getAttribute("x")),I=parseFloat(u.getAttribute("y")),Number.isNaN(M)&&(M=te.x,u.setAttribute("x",M)),Number.isNaN(I)&&(I=te.y,u.setAttribute("y",I)),k=parseFloat(u.getAttribute("font-size"))||parseFloat(window.getComputedStyle(u).fontSize)||16,h=ye,z=Array.from(l.classList).find(D=>D.startsWith("handle-"))||"",m=!0,u.style.cursor=l.style.cursor,this.svg.style.cursor=l.style.cursor,document.body.style.userSelect="none",H.preventDefault(),H.stopPropagation()},ie=H=>{if(!m)return;const ye=this.toSvgPoint(H.clientX,H.clientY);if(!ye)return;const te=ye.x-h.x,D=ye.y-h.y;let Z=R,V=$,ae=M,Oe=I;switch(z){case"handle-se":Z=R+te,V=$+D;break;case"handle-sw":Z=R-te,V=$+D,ae=M+te;break;case"handle-ne":Z=R+te,V=$-D,Oe=I+D;break;case"handle-nw":Z=R-te,V=$-D,ae=M+te,Oe=I+D;break}Z=Math.max(20,Z),V=Math.max(20,V);const dt=u.tagName.toLowerCase();if(dt==="image"||dt==="rect")u.setAttribute("width",Z),u.setAttribute("height",V),u.setAttribute("x",ae),u.setAttribute("y",Oe);else{const _e=Math.max(1,R),Rt=Math.max(1,$),at=Z/_e,He=V/Rt,Ae=Math.max(at,He),Pt=Math.max(6,k*Ae);u.setAttribute("font-size",Pt)}this.updateBoundingBox(u),H.preventDefault(),H.stopPropagation()},q=H=>{if(!m)return;m=!1,u.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const ye={element:u,width:parseFloat(u.getAttribute("width")),height:parseFloat(u.getAttribute("height")),x:parseFloat(u.getAttribute("x")),y:parseFloat(u.getAttribute("y"))},te=new CustomEvent("svgImageResized",{detail:ye});this.svg.dispatchEvent(te),H.preventDefault(),H.stopPropagation()};l.addEventListener("mousedown",B),document.addEventListener("mousemove",ie),document.addEventListener("mouseup",q)}setupTextHandlers(){const u=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(m=>{m.style.cursor="pointer",m.classList.add("svg-editable-text"),m.addEventListener("click",function(h){h.preventDefault(),u.showTextEditDialog(m)}),m.addEventListener("mouseenter",function(){m.classList.add("editable-text-hover")}),m.addEventListener("mouseleave",function(){m.classList.remove("editable-text-hover")})})}showImageUploadDialog(u){const l=this,m=document.createElement("input");m.type="file",m.accept="image/*",m.style.display="none",m.addEventListener("change",function(h){const R=h.target.files[0];R&&l.handleImageUpload(R,u),document.body.removeChild(m)}),document.body.appendChild(m),m.click()}handleImageUpload(u,l){const m=this,h=new FileReader;h.onload=function(R){const $=R.target.result;if(l.tagName.toLowerCase()==="image")l.setAttribute("href",$),l.hasAttribute("xlink:href")&&l.removeAttribute("xlink:href");else if(l.tagName.toLowerCase()==="rect"){const I=document.createElementNS("http://www.w3.org/2000/svg","image");I.setAttribute("x",l.getAttribute("x")||"0"),I.setAttribute("y",l.getAttribute("y")||"0"),I.setAttribute("width",l.getAttribute("width")||"100"),I.setAttribute("height",l.getAttribute("height")||"100"),I.setAttribute("href",$),I.setAttribute("preserveAspectRatio","xMidYMid slice"),I.classList.add("uploaded-image"),l.parentNode.replaceChild(I,l),l=I}const M=new CustomEvent("svgImageChanged",{detail:{element:l,imageUrl:$,file:u}});m.svg.dispatchEvent(M),m.options.onImageChange&&m.options.onImageChange(l,$,u)},h.readAsDataURL(u)}showTextEditDialog(u){const l=this,m=u.textContent||"",h=document.createElement("input");h.type="text",h.value=m,h.className="svg-text-editor";const R=u.getBoundingClientRect(),$=l.svg.getBoundingClientRect();h.style.position="absolute",h.style.left=R.left-$.left+"px",h.style.top=R.top-$.top+"px",h.style.width=Math.max(R.width,100)+"px",h.style.fontSize=window.getComputedStyle(u).fontSize,h.style.fontFamily=window.getComputedStyle(u).fontFamily,h.style.border="1px solid #007cba",h.style.padding="2px",h.style.background="white",h.style.zIndex="1000",u.style.visibility="hidden",l.svg.parentNode.appendChild(h),h.focus(),h.select();const M=function(){const I=h.value;for(;u.firstChild;)u.removeChild(u.firstChild);u.appendChild(document.createTextNode(I)),u.style.visibility="visible",h.parentNode&&h.parentNode.removeChild(h);const z=new CustomEvent("svgTextChanged",{detail:{element:u,oldText:m,newText:I}});l.svg.dispatchEvent(z),l.options.onTextChange&&l.options.onTextChange(u,m,I)};h.addEventListener("blur",M),h.addEventListener("keydown",function(I){I.key==="Enter"?M():I.key==="Escape"&&(u.style.visibility="visible",h.parentNode&&h.parentNode.removeChild(h))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const u=document.createElement("style");u.id="svg-editor-styles",u.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
        `,document.head.appendChild(u)}getSvgString(){return new XMLSerializer().serializeToString(this.svg)}getSvgDataUrl(){const u=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(u)))}async saveSvg(u,l="front"){const m=this.getSvgString();try{return await(await fetch(`/staff/templates/${u}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:m,side:l})})).json()}catch(h){return console.error("Failed to save SVG:",h),{success:!1,error:h.message}}}}function Es(){const pe=()=>{const u=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",u.length,"SVGs with data-svg-editor attribute"),u.forEach((l,m)=>{l.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",m,"for SVG:",l),l.__inkwiseSvgTemplateEditor=new Sa(l))})};if(document.readyState==="complete"||document.readyState==="interactive"?pe():document.addEventListener("DOMContentLoaded",pe,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const u=new MutationObserver(l=>{l.forEach(m=>{m.addedNodes.forEach(h=>{h.nodeType===1&&h.matches&&h.matches("svg[data-svg-editor]")&&(h.__inkwiseSvgTemplateEditor||(h.__inkwiseSvgTemplateEditor=new Sa(h)))})})});u.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=u}}typeof window<"u"&&(window.SvgTemplateEditor=Sa,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,Es()));function As(pe={}){const{collectSnapshot:u,routes:l={},statusLabel:m=null,statusDot:h=null,csrfToken:R=null,debounce:$=1200,onAfterSave:M=null}=pe;if(typeof u!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let I=null,z=null,k=null,B=null;const ie=(D,Z={})=>{if(h instanceof HTMLElement&&h.setAttribute("data-state",D),m instanceof HTMLElement)switch(D){case"saving":m.textContent="Saving…";break;case"dirty":m.textContent="Unsaved changes";break;case"error":m.textContent="Save failed";break;case"saved":{const ae=(Z.timestamp instanceof Date?Z.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});m.textContent=`Saved ${ae}`;break}default:m.textContent="Saved";break}},q=async D=>{const Z=l.autosave;if(!Z)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const V=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...R?{"X-CSRF-TOKEN":R}:{}},credentials:"same-origin",body:JSON.stringify(D)});if(!V.ok){const ae=new Error(`Autosave responded with ${V.status}`);throw ae.status=V.status,ae.responseText=await V.text().catch(()=>null),ae}try{return await V.json()}catch{return{}}},H=async D=>{if(k)try{await k}catch{}z=null,ie("saving");let Z;try{Z=await u(D)}catch(V){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",V),ie("error"),V}if(!Z||typeof Z!="object")return ie("saved",{timestamp:new Date}),null;k=q(Z);try{const V=await k;if(B=new Date,ie("saved",{timestamp:B}),typeof M=="function")try{M(V,Z)}catch(ae){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",ae)}return V}catch(V){throw console.error("[InkWise Studio] Autosave request failed.",V),ie("error"),V}finally{k=null}};return{schedule:(D="change")=>{z=D,I&&clearTimeout(I),ie("dirty"),I=window.setTimeout(()=>{I=null,H(z).catch(()=>{})},Math.max(250,$))},flush:async(D="flush")=>(I&&(clearTimeout(I),I=null),k&&await k,z!==null?H(D):null),isSaving:()=>!!k,getLastSavedAt:()=>B,notifyError:()=>ie("error"),markDirty:()=>ie("dirty")}}function Ls(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const pe=()=>{var er,tr,ar;const u=document.querySelectorAll("[data-preview-target]"),l=document.querySelector(".preview-card-bg"),m=document.getElementById("preview-svg"),h=document.querySelectorAll("[data-card-thumb]"),R=document.querySelectorAll("[data-card-view]"),$=document.getElementById("extraPreviewContainer"),M=document.getElementById("textFieldList"),I=document.querySelector("[data-add-text-field]"),z=document.querySelectorAll(".sidenav-btn"),k=document.querySelector(".canvas-stage"),B="http://www.w3.org/2000/svg",ie=document.querySelector(".canvas-measure-horizontal .measure-value"),q=document.querySelector(".canvas-measure-vertical .measure-value"),H=document.querySelector(".preview-canvas-wrapper");let ye=1;const te=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{},D=(te==null?void 0:te.routes)??{},Z=((er=document.querySelector('meta[name="csrf-token"]'))==null?void 0:er.getAttribute("content"))||((tr=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:tr.getAttribute("content"))||null,V=document.querySelector(".topbar-status-label"),ae=document.querySelector(".topbar-status-dot"),Oe=t=>{if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null},dt=t=>{if(!t||typeof t!="string")return null;try{const e=t.startsWith("<?xml")?t:`<?xml version="1.0" encoding="UTF-8"?>${t}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(e)))}`}catch(e){return console.warn("[InkWise Studio] Failed to encode SVG preview.",e),null}},_e=t=>{var i,o;if(!l)return null;const e=window.getComputedStyle(l),r=((e==null?void 0:e.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(r&&r[2])return r[2];const s=`${t}Image`;return s&&((i=l.dataset)!=null&&i[s])?l.dataset[s]:((o=l.dataset)==null?void 0:o.frontImage)||null},Rt=()=>M?Array.from(M.querySelectorAll("input[data-preview-target]")).map(t=>{var r,s;const e=t.closest(".text-field-item"),a=((s=(r=e==null?void 0:e.querySelector(".text-field-label"))==null?void 0:r.textContent)==null?void 0:s.trim())||t.dataset.previewTarget||"";return{key:t.dataset.previewTarget||"",label:a,value:t.value||"",defaultValue:t.dataset.defaultValue||""}}):[],at=t=>{if(typeof t=="number")return Number.isFinite(t)?t:Number.NaN;if(typeof t=="string"){const e=t.trim();if(!e)return Number.NaN;const a=e.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return a?parseFloat(a[0]):Number.NaN}return Number.NaN},He=t=>{if(!t)return null;if(typeof t=="string"){const d=t.trim();if(!d)return null;try{const C=JSON.parse(d);return He(C)}catch{return null}}if(typeof t!="object")return null;const e=Array.isArray(t)?t.reduce((d,C)=>C&&typeof C=="object"?Object.assign(d,C):d,{}):Object.assign({},t),a=e.width??e.Width??e.canvasWidth??e.w??e.maxWidth??e.naturalWidth,r=e.height??e.Height??e.canvasHeight??e.h??e.maxHeight??e.naturalHeight,s=at(a),i=at(r);if(!Number.isFinite(s)||s<=0||!Number.isFinite(i)||i<=0)return null;const o=e.shape??e.Shape??e.canvasShape??null,f=e.unit??e.Unit??e.canvasUnit??null;return{width:s,height:i,shape:typeof o=="string"&&o.trim()!==""?o.trim():null,unit:typeof f=="string"&&f.trim()!==""?f.trim():"px"}},Ae=(t,e="px")=>{if(!Number.isFinite(t))return Number.NaN;switch((e||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return t;case"mm":return t/25.4;case"cm":return t/2.54;case"pt":return t/72;default:return t/96}},Pt=He(H==null?void 0:H.dataset);let P=He(((ar=te==null?void 0:te.template)==null?void 0:ar.canvas)??null)||Pt||null;const ta=720,Nt=920,ut=new Map;let Ie=null;const be=new Map,Be=new Map;let pt=null,fe=null,oe=null,Ee=null,Le=()=>{},re="front",Re=null,Je=null,b=null,de=null,ue=null,We=!1,Te=null;const Ca=()=>{if(!l)return null;const t=new Date,e=re||"front",a=oe;let r=null;if(a)try{r=new XMLSerializer().serializeToString(a),r&&!/xmlns=/i.test(r)&&(r=r.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(g){console.warn("[InkWise Studio] Unable to serialize current SVG.",g),r=null}const s=r?dt(r):_e(e),i=Rt(),o=i.filter(g=>{const w=(g.value||"").trim(),x=(g.defaultValue||"").trim();return w===""||x!==""&&w===x}).map(g=>g.label||g.key).map(g=>(g||"").trim()).filter((g,w,x)=>g!==""&&x.indexOf(g)===w),f=[];if(a){const g=new Set;a.querySelectorAll('image,img,[data-changeable="image"]').forEach(w=>{const x=w.getAttribute("href")||w.getAttribute("xlink:href")||w.getAttributeNS("http://www.w3.org/1999/xlink","href")||w.getAttribute("data-src");if(!x)return;const L=w.getAttribute("data-preview-node")||w.id||`image-${f.length+1}`;g.has(L)||(g.add(L),f.push({key:L,href:x,x:w.getAttribute("x")||null,y:w.getAttribute("y")||null,width:w.getAttribute("width")||null,height:w.getAttribute("height")||null}))})}const d=l?{width:Oe(l.dataset.canvasWidth),height:Oe(l.dataset.canvasHeight),unit:l.dataset.canvasUnit||null,shape:l.dataset.canvasShape||null}:null,C=s?[s]:[];return{design:{updated_at:t.toISOString(),sides:{[e]:{svg:r,preview:s}},texts:i,images:f,canvas:d},preview:{image:s,images:C},placeholders:o}};try{b=As({collectSnapshot:Ca,routes:D,csrfToken:Z,statusLabel:V,statusDot:ae})}catch(t){console.warn("[InkWise Studio] Autosave controller failed to initialize.",t),b=null}const $e=document.querySelector('[data-action="proceed-review"]');if($e){const t=$e.dataset.destination||D.review||$e.getAttribute("href")||window.location.href;$e.addEventListener("click",async e=>{if(e.preventDefault(),$e.dataset.navigating==="1")return;$e.dataset.navigating="1",$e.disabled=!0;const a=()=>{window.location.href=t};if(!b){a();return}try{await b.flush("navigate"),a()}catch(r){console.error("[InkWise Studio] Unable to save before navigating.",r),b.notifyError(),$e.disabled=!1,$e.dataset.navigating="0"}})}const Ct=t=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=a=>{const r=a.target.files&&a.target.files[0];if(!r)return;const s=new FileReader;s.onload=i=>{var f;const o=(f=i.target)==null?void 0:f.result;o&&(t instanceof SVGImageElement?(t.setAttributeNS("http://www.w3.org/1999/xlink","href",o),t.setAttribute("href",o)):t instanceof HTMLImageElement&&(t.src=o),W(),b==null||b.schedule("image-replace"))},s.readAsDataURL(r)},e.click()},ka=()=>l?((!Ie||!Ie.isConnected)&&(Ie=document.createElement("div"),Ie.className="canvas-overlay-layer",l.appendChild(Ie)),Ie):null,kt=()=>{be.forEach(({overlay:t})=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),be.clear(),Be.clear(),Ie&&(Ie.innerHTML=""),de=null,ue=null,Vt(),document.body.classList.remove("text-toolbar-visible"),Yt()},rt=(t,e)=>{if(t==null)return e;const a=t.toString().split(/[\s,]+/).filter(Boolean);if(a.length===0)return e;const r=parseFloat(a[0]);return Number.isFinite(r)?r:e},Ze=t=>{if(!l)return;const e=be.get(t);if(!e||!e.overlay)return;const a=e.overlay,r=l.getBoundingClientRect(),s=t.getBoundingClientRect();if(r.width===0||r.height===0)return;const i=e.type==="text"?18:12,o=Math.max(i,s.width),f=Math.max(i,s.height);a.style.left=`${s.left-r.left}px`,a.style.top=`${s.top-r.top}px`,a.style.width=`${o}px`,a.style.height=`${f}px`},aa=()=>{be.forEach((t,e)=>{Ze(e)})},W=()=>{be.size!==0&&(pt&&cancelAnimationFrame(pt),pt=window.requestAnimationFrame(()=>{pt=null,aa()}))},ft=(t=3)=>{t<=0||requestAnimationFrame(()=>{W(),ft(t-1)})};window.addEventListener("resize",W),document.addEventListener("scroll",W,!0),window.addEventListener("load",W);const $t=(t,e)=>{const a=oe||m;if(!a||typeof a.createSVGPoint!="function")return null;const r=a.createSVGPoint();r.x=t,r.y=e;const s=a.getScreenCTM();return s?r.matrixTransform(s.inverse()):null},ra=(t,e,a)=>{const r=$t(a.clientX,a.clientY);if(!r)return null;const{node:s}=t,i=s.getBBox?s.getBBox():{x:0,y:0,width:0,height:0},o={data:t,overlay:t.overlay,node:s,type:t.type,handle:e,mode:e?"resize":"move",pointerId:a.pointerId,startPoint:r,startClient:{x:a.clientX,y:a.clientY},initialBBox:i,moved:!1};if(t.type==="text"){o.fontSize=parseFloat(s.getAttribute("font-size"))||parseFloat(window.getComputedStyle(s).fontSize)||16,o.x=rt(s.getAttribute("x"),i.x);const f=i.y+i.height;o.y=rt(s.getAttribute("y"),f)}else o.x=rt(s.getAttribute("x"),i.x),o.y=rt(s.getAttribute("y"),i.y),o.width=rt(s.getAttribute("width"),Math.max(1,i.width)),o.height=rt(s.getAttribute("height"),Math.max(1,i.height));return o},Ea=(t,e,a)=>{if(t.type==="text"){const r=t.x+e,s=t.y+a;Number.isFinite(r)&&t.node.setAttribute("x",r),Number.isFinite(s)&&t.node.setAttribute("y",s)}else t.node.setAttribute("x",t.x+e),t.node.setAttribute("y",t.y+a)},Ut=(t,e,a)=>{if(t.type==="image"){let r=t.x,s=t.y,i=t.width,o=t.height;t.handle.includes("e")&&(i=t.width+e),t.handle.includes("w")&&(i=t.width-e,r=t.x+e),t.handle.includes("s")&&(o=t.height+a),t.handle.includes("n")&&(o=t.height-a,s=t.y+a);const f=4;i<f&&(r+=i-f,i=f),o<f&&(s+=o-f,o=f),t.node.setAttribute("x",r),t.node.setAttribute("y",s),t.node.setAttribute("width",i),t.node.setAttribute("height",o)}else if(t.type==="text"){const r=Math.max(1,t.initialBBox.width),s=Math.max(1,t.initialBBox.height);let i=0,o=0;t.handle.includes("e")?i=e:t.handle.includes("w")&&(i=-e),t.handle.includes("s")?o=a:t.handle.includes("n")&&(o=-a);const f=Math.max(4,r+i),d=Math.max(4,s+o),C=f/r,g=d/s,w=Math.max(C,g),x=Math.max(6,t.fontSize*w);t.node.setAttribute("font-size",x)}},ve=t=>{if(!fe||t.pointerId!==fe.pointerId)return;const e=$t(t.clientX,t.clientY);if(!e)return;const a=e.x-fe.startPoint.x,r=e.y-fe.startPoint.y;!fe.moved&&(Math.abs(a)>.5||Math.abs(r)>.5)&&(fe.moved=!0),fe.mode==="move"?Ea(fe,a,r):Ut(fe,a,r),W()},st=t=>{if(!fe||t.pointerId!==fe.pointerId)return;try{fe.overlay.releasePointerCapture(fe.pointerId)}catch{}fe.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",ve),document.removeEventListener("pointerup",st),document.removeEventListener("pointercancel",st);const e=fe;fe=null,W(),e.moved?b==null||b.schedule("element-transform"):e.type==="text"?Le(e.data.previewKey):e.type==="image"&&Ct(e.node)},Dt=t=>{if(!t.isPrimary||t.button!==0)return;const e=t.target.closest(".editor-overlay");if(!e||e.dataset.cropSessionActive==="true")return;const a=Be.get(e);if(!a)return;a.type==="text"?lt(a.previewKey||null):a.type==="image"&&Xt(a.previewKey||null);const r=ra(a,t.target.dataset.handle||null,t);if(r){t.preventDefault(),fe=r,e.classList.add("editor-overlay--active");try{e.setPointerCapture(t.pointerId)}catch{}document.addEventListener("pointermove",ve),document.addEventListener("pointerup",st),document.addEventListener("pointercancel",st)}},Se=t=>{const e=ka();if(!e)return null;let a=be.get(t);if(a)return a;const r=typeof t.tagName=="string"?t.tagName.toLowerCase():"",s=r==="image"||r==="img"?"image":"text",i=t.getAttribute("data-preview-node")||"",o=document.createElement("div");return o.className=`editor-overlay editor-overlay--${s}`,o.dataset.previewNode=i,o.tabIndex=0,o.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(d=>{const C=document.createElement("div");C.className=`editor-overlay__handle editor-overlay__handle--${d}`,C.dataset.handle=d,o.appendChild(C)}),o.addEventListener("pointerdown",Dt),o.addEventListener("dblclick",()=>{s==="text"?Le(i):s==="image"&&Ct(t)}),o.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),s==="text"?Le(i):s==="image"&&Ct(t))}),e.appendChild(o),a={overlay:o,node:t,type:s,previewKey:i},be.set(t,a),Be.set(o,a),t.dataset.locked==="true"&&(o.classList.add("editor-overlay--locked"),o.style.pointerEvents="none"),Vt(),W(),a},it=(t,e,a={})=>{if(!l)return;const r=l.closest(".preview-canvas-wrapper"),s=Number(t),i=Number(e),o=a.persist===void 0?!0:!!a.persist,f=typeof a.unit=="string"&&a.unit?a.unit:(P==null?void 0:P.unit)??"px",d=typeof a.shape=="string"&&a.shape?a.shape:(P==null?void 0:P.shape)??null;if(!r||!Number.isFinite(s)||!Number.isFinite(i)||s<=0||i<=0)return;const C=ta/s,g=Nt/i,w=Math.min(1,C,g),x=Math.max(1,Math.round(s*w)),L=Math.max(1,Math.round(i*w));r.style.setProperty("--canvas-width",`${x}px`),r.style.setProperty("--canvas-height",`${L}px`),r.dataset.sourceWidth=s.toString(),r.dataset.sourceHeight=i.toString(),r.dataset.displayScale=w.toString(),r.dataset.canvasWidth=s.toString(),r.dataset.canvasHeight=i.toString(),r.dataset.canvasUnit=f,d&&(r.dataset.canvasShape=d),l.dataset.canvasWidth=s.toString(),l.dataset.canvasHeight=i.toString(),l.dataset.canvasUnit=f,d&&(l.dataset.canvasShape=d),k&&k.style.setProperty("--stage-width",`${x+112}px`),o&&(P={width:s,height:i,unit:f,shape:d}),W()},nt=(t,e,a,r=0)=>{ie&&(Number.isFinite(t)?ie.textContent=`${t.toFixed(r)}${a}`:ie.textContent="—"),q&&(Number.isFinite(e)?q.textContent=`${e.toFixed(r)}${a}`:q.textContent="—")};P&&(it(P.width,P.height,{unit:P.unit,shape:P.shape}),nt(Ae(P.width,P.unit),Ae(P.height,P.unit),"in",2));const je=t=>{if(typeof t!="string"||!t.trim())return Number.NaN;const e=t.trim(),a=e.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!a)return Number.NaN;const r=parseFloat(a[1]);if(!Number.isFinite(r))return Number.NaN;const s=e.match(/([a-z%]+)$/i);switch(s?s[1].toLowerCase():""){case"":case"px":return r;case"mm":return r*(96/25.4);case"cm":return r*(96/2.54);case"in":return r*96;case"pt":return r*(96/72);default:return r}},zt=t=>{if(!t)return;if(ut.has(t)){const a=ut.get(t);if(a){const r=a.unit||"px";it(a.width,a.height,{unit:r,shape:P==null?void 0:P.shape}),nt(Ae(a.width,r),Ae(a.height,r),"in",2)}return}const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const a={width:e.naturalWidth,height:e.naturalHeight,unit:"px"};ut.set(t,a),it(a.width,a.height,{unit:a.unit,shape:P==null?void 0:P.shape}),nt(Ae(a.width,a.unit),Ae(a.height,a.unit),"in",2),W()},e.onerror=()=>{ut.set(t,null)},e.src=t},Et={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},qt=document.querySelectorAll("[data-modal-close]"),sa=t=>{if(!t)return[];const e=Array.from(t.querySelectorAll("[data-preview-node]"));return e.length>0?e:(t.querySelectorAll(".canvas-layer[data-layer-id]").forEach(i=>{const o=i.getAttribute("data-layer-id");if(!o)return;const f=(i.getAttribute("aria-label")||o).replace(/\s+layer$/i,"")||o,d=i.querySelector(".canvas-layer__text");if(d&&(d.hasAttribute("data-preview-node")||d.setAttribute("data-preview-node",o),d.dataset.previewLabel||(d.dataset.previewLabel=f),!d.dataset.defaultText)){const g=(d.textContent||"").trim();g&&(d.dataset.defaultText=g)}const C=i.querySelector("img, image");if(C){const g=`${o}-image`;C.hasAttribute("data-preview-node")||C.setAttribute("data-preview-node",g),C.dataset.previewLabel||(C.dataset.previewLabel=f)}if(!d&&!C&&(i.hasAttribute("data-preview-node")||i.setAttribute("data-preview-node",o),i.dataset.previewLabel||(i.dataset.previewLabel=f),!i.dataset.defaultText)){const g=(i.textContent||"").trim();g&&(i.dataset.defaultText=g)}}),t.querySelectorAll("image, img").forEach((i,o)=>{i.hasAttribute("data-preview-node")||i.setAttribute("data-preview-node",`auto-image-${o}`)}),t.querySelectorAll("text, tspan").forEach((i,o)=>{i.hasAttribute("data-preview-node")||i.setAttribute("data-preview-node",`auto-text-${o}`)}),Array.from(t.querySelectorAll("[data-preview-node]")))},ot=t=>{if(!t)return;t.classList.remove("is-open"),t.setAttribute("aria-hidden","true");const e=t.dataset.section;if(e){const a=document.querySelector(`.sidenav-btn[data-nav="${e}"]`);a==null||a.classList.remove("active"),e==="background"&&We&&(We=!1,la(),Yt())}},mt=()=>{Object.values(Et).forEach(t=>ot(t))},Ge=t=>{const e=Et[t];if(!e)return;e.classList.add("is-open"),e.setAttribute("aria-hidden","false");const a=e.querySelector('input:not([type="hidden"])');if(a==null||a.focus({preventScroll:!0}),t==="background"&&Cr(),t==="graphics"){const r=document.querySelector('.graphics-category-button[data-category="image"]');r?na(r):(Wt(),Ye())}};z.length&&z.forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.nav||"text",a=Et[e],r=a==null?void 0:a.classList.contains("is-open");mt(),z.forEach(s=>s.classList.remove("active")),r||(Ge(e),t.classList.add("active"))})}),qt.forEach(t=>{t.addEventListener("click",()=>{const e=t.closest(".modal");ot(e)})}),window.addEventListener("click",t=>{t.target.classList.contains("modal")&&t.target.classList.contains("is-open")&&ot(t.target)}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.querySelector(".modal.is-open");e&&ot(e)}});const ht=document.querySelector(".graphics-categories-labels"),S=document.getElementById("graphics-browser-samples"),At=document.querySelectorAll(".graphics-category-button"),Ue=document.getElementById("graphics-search-form"),Fe=document.getElementById("graphics-search-input"),Ot="53250708-d3f88461e75cb0c2c5366a181",ia={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:Ot,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:Ot,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},Ve=new Map;let Ht=0;function gt(t,e){const a=(e||"").trim();return a||t.query||t.defaultQuery||""}function Ye(){S&&(S.innerHTML="",S.dataset.category="",S.dataset.page="0",S.dataset.loading="0",S.dataset.hasMore="0",S.dataset.searchTerm="",S.dataset.requestToken="")}function Wt(){if(!ht||!S)return;ht.querySelectorAll(".category-row").forEach(e=>{e.style.display="flex",e.dataset.expanded="0"}),At.forEach(e=>{e.setAttribute("aria-expanded","false"),e.classList.remove("is-open")}),S.scrollTop=0,S.innerHTML="",S.dataset.category="",S.dataset.page="0",S.dataset.loading="0",S.dataset.hasMore="0",S.dataset.searchTerm="",S.dataset.requestToken="",Ue&&(Ue.classList.add("is-hidden"),Ue.dataset.category=""),Fe&&(Fe.value="",Fe.blur())}function Gt(t){return ia[t]||null}async function na(t){var w,x,L;const e=t.dataset.category;if(!e||!S||!ht)return;if(t.getAttribute("aria-expanded")==="true"){Wt(),Ye();return}const r=Gt(e);if(!r){console.warn(`[InkWise Studio] No graphics configuration found for category "${e}".`);return}Wt();const s=Ve.get(e)||"",i=r.label||"",o=(L=(x=(w=t.closest(".category-row"))==null?void 0:w.querySelector(".category-label"))==null?void 0:x.textContent)==null?void 0:L.trim(),f=i||o||e,d=r.searchPlaceholder||`Search ${f.toLowerCase()}`;Ue&&(Ue.classList.remove("is-hidden"),Ue.dataset.category=e),Fe&&(Fe.placeholder=d,Fe.value=s),t.setAttribute("aria-expanded","true"),t.classList.add("is-open"),ht.querySelectorAll(".category-row").forEach(U=>{U.dataset.categoryRow===e?(U.style.display="flex",U.dataset.expanded="1"):U.style.display="none"}),S.innerHTML="",S.dataset.category=e,S.dataset.page="0",S.dataset.loading="0",S.dataset.hasMore="1",S.dataset.searchTerm=s,S.scrollTop=0;const g=String(++Ht);S.dataset.requestToken=g,p(),await xe(e,1,s,g)}function p(){if(!S)return;const t=S.querySelector(".graphics-loading");if(t){t.style.display="flex";return}const e=document.createElement("div");e.className="graphics-loading",e.textContent="Loading assets…",S.appendChild(e)}function N(){if(!S)return;const t=S.querySelector(".graphics-loading");t&&t.remove()}function Y(t){if(!S)return;S.innerHTML="";const e=document.createElement("div");e.className="graphics-error",e.textContent=t||"Unable to load assets at the moment.",S.appendChild(e)}function ge(t){if(!S||!Array.isArray(t))return;const e=document.createDocumentFragment();t.forEach(a=>{if(!a||!a.thumbUrl)return;const r=document.createElement("div");r.className="graphics-sample",r.title=a.alt||"Graphic sample";const s=document.createElement("img");if(s.src=a.thumbUrl,s.alt=a.alt||"Graphic sample",s.loading="lazy",r.appendChild(s),a.label){const i=document.createElement("span");i.className="sample-label",i.textContent=a.label,r.appendChild(i)}r.addEventListener("click",()=>{console.log("Selected asset",a)}),e.appendChild(r)}),N(),S.appendChild(e)}async function xe(t,e,a,r){if(!S)return;const s=Gt(t);if(!s)return;const i=S.dataset.requestToken||"",o=r||i||String(++Ht);if(!(S.dataset.loading==="1"&&o===i)){S.dataset.loading="1",p();try{const f=typeof a=="string"?a:S.dataset.searchTerm||"",d=await Ne(s,e,f);if(S.dataset.requestToken!==o)return;if(S.dataset.loading="0",N(),!d.length&&e===1){Y("No assets found for this category right now. Try again in a moment."),S.dataset.hasMore="0";return}ge(d),S.dataset.page=String(e);const C=s.perPage||12;S.dataset.hasMore=d.length>=C?"1":"0"}catch(f){if(console.error("[InkWise Studio] Failed to load graphics assets:",f),S.dataset.requestToken!==o)return;S.dataset.loading="0",Y("We ran into a problem loading assets. Please try again."),S.dataset.hasMore="0"}}}async function Ne(t,e,a){switch(t.provider){case"unsplash":return De(t,e,a);case"pixabay":return Xe(t,e,a);case"flaticon":return Qe(t,e,a);case"iconify":return La(t,e,a);default:return console.warn("[InkWise Studio] Unknown graphics provider:",t.provider),[]}}async function De(t,e,a){const r=t.perPage||12,s=gt(t,a),i=s?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",o=new URLSearchParams({per_page:String(r),page:String(e),client_id:t.apiKey});s&&(o.set("query",s),o.set("orientation","portrait"));const f=`${i}?${o.toString()}`,d=await fetch(f);if(!d.ok)throw new Error(`Unsplash API error: ${d.status}`);const C=await d.json();return(Array.isArray(C)?C:Array.isArray(C.results)?C.results:[]).map(w=>{const x=w.urls||{};return{id:`unsplash-${w.id}`,thumbUrl:x.small||x.thumb||x.regular||"",fullUrl:x.full||x.regular||x.raw||"",alt:w.alt_description||w.description||w.slug||"Unsplash image"}}).filter(w=>!!w.thumbUrl)}async function Xe(t,e,a){const r=t.perPage||18,s=new URLSearchParams({key:t.apiKey,q:gt(t,a),per_page:String(r),page:String(e),safesearch:"true",order:"popular"});t.imageType&&s.set("image_type",t.imageType),t.category&&s.set("category",t.category);const i=await fetch(`https://pixabay.com/api/?${s.toString()}`);if(!i.ok)throw new Error(`Pixabay API error: ${i.status}`);const o=await i.json();return(Array.isArray(o==null?void 0:o.hits)?o.hits:[]).map(d=>({id:`pixabay-${d.id}`,thumbUrl:d.previewURL||d.webformatURL||"",fullUrl:d.largeImageURL||d.webformatURL||"",alt:d.tags||"Pixabay asset",label:d.user?`@${d.user}`:null})).filter(d=>!!d.thumbUrl)}async function Qe(t,e,a){const r=t.perPage||48,s=new URLSearchParams({q:gt(t,a)||"icon",limit:String(r),page:String(e)});s.set("apikey",t.apiKey);const i=await fetch(`https://api.flaticon.com/v3/search/icons?${s.toString()}`,{headers:{Accept:"application/json",apikey:t.apiKey,Authorization:`Bearer ${t.apiKey}`}});if(!i.ok)throw new Error(`Flaticon API error: ${i.status}`);const o=await i.json();return(Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o==null?void 0:o.icons)?o.icons:Array.isArray(o==null?void 0:o.result)?o.result:[]).map(d=>{var U;const C=(d==null?void 0:d.images)||d,g=(C==null?void 0:C.png)||{},w=(C==null?void 0:C.svg)||(C==null?void 0:C.svg)||null,x=g[128]||g[256]||w||(C==null?void 0:C["64"])||null,L=g[512]||g[256]||w||x;return x?{id:`flaticon-${(d==null?void 0:d.id)||(d==null?void 0:d.icon_id)||(d==null?void 0:d.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:x,fullUrl:L,alt:(d==null?void 0:d.description)||(Array.isArray(d==null?void 0:d.tags)?d.tags.join(", "):"Icon asset"),label:((U=d==null?void 0:d.uploader)==null?void 0:U.name)||(d==null?void 0:d.category)||null}:null}).filter(Boolean)}async function La(t,e,a){const r=t.perPage||36,s=Math.max(0,(e-1)*r),i=new URLSearchParams({query:gt(t,a)||"shape",limit:String(r),offset:String(s)});t.prefix&&i.set("prefix",t.prefix);const o=(t.baseUrl||"https://api.iconify.design").replace(/\/$/,""),f=await fetch(`${o}/search?${i.toString()}`,{headers:{Accept:"application/json"}});if(!f.ok)throw new Error(`Iconify API error: ${f.status}`);const d=await f.json(),C=Array.isArray(d==null?void 0:d.icons)?d.icons:[],g=Array.isArray(d==null?void 0:d.prefixes)&&d.prefixes.length===1?d.prefixes[0]:(d==null?void 0:d.prefix)||t.prefix||"";return C.map(w=>{if(typeof w=="string"){const x=w.includes(":")?w:g?`${g}:${w}`:w;if(!x)return null;const L=x.split(":").map(Q=>encodeURIComponent(Q)).join(":"),U=x.split(":").pop()||x;return{id:`iconify-${x.replace(/[^a-zA-Z0-9:]/g,"-")}-${e}`,thumbUrl:`${o}/${L}.svg?height=120&width=120`,fullUrl:`${o}/${L}.svg`,alt:U.replace(/[-_]/g," "),label:U.replace(/[-_]/g," ")}}if(w&&typeof w=="object"){const x=w.name||w.icon||w.id||"";if(!x)return null;const L=w.prefix||g,U=L?`${L}:${x}`:x,Q=U.split(":").map(he=>encodeURIComponent(he)).join(":"),me=w.label||x;return{id:`iconify-${U.replace(/[^a-zA-Z0-9:]/g,"-")}-${e}`,thumbUrl:`${o}/${Q}.svg?height=120&width=120`,fullUrl:`${o}/${Q}.svg`,alt:me.replace(/[-_]/g," "),label:me.replace(/[-_]/g," ")}}return null}).filter(w=>!!(w!=null&&w.thumbUrl))}async function Ia(){if(!S)return;const t=S.dataset.category;if(!t||S.dataset.loading==="1"||S.dataset.hasMore==="0")return;if(S.scrollTop+S.clientHeight>=S.scrollHeight-180){const a=Number(S.dataset.page||"1")+1,r=S.dataset.searchTerm||"";await xe(t,a,r)}}At.forEach(t=>{t.addEventListener("click",()=>na(t))}),S&&(S.addEventListener("scroll",()=>{Ia().catch(t=>{console.error("[InkWise Studio] graphics scroll handler error:",t)})}),Ye()),Ue&&Fe&&Ue.addEventListener("submit",async t=>{if(t.preventDefault(),!S)return;const e=S.dataset.category;if(!e||!Gt(e))return;const a=Fe.value.trim();Ve.set(e,a),S.scrollTop=0,S.innerHTML="",S.dataset.page="0",S.dataset.hasMore="1",S.dataset.searchTerm=a,S.dataset.loading="0";const r=String(++Ht);S.dataset.requestToken=r;try{await xe(e,1,a,r)}catch(s){console.error("[InkWise Studio] graphics search failed:",s)}}),mt(),Ge("text");const yt=document.querySelector('.sidenav-btn[data-nav="text"]');yt==null||yt.classList.add("active");const oa=t=>!t||!M?null:M.querySelector(`input[data-preview-target="${t}"]`),wr=t=>!t||!$?null:$.querySelector(`[data-preview-node="${t}"]`),Da=(()=>{let t=!1;return()=>{if(t||typeof document>"u")return;const e=document.createElement("style");e.id="inkwise-crop-overlay-styles",e.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(e),t=!0}})(),bt=()=>{Te&&(Te.teardown(),Te=null)},Sr=(t,e)=>{if(!t||!e)return null;Da(),getComputedStyle(t).position==="static"&&(t.style.position="relative");const a=(c,y,F)=>Math.min(Math.max(c,y),F);(()=>{if(e.dataset.cropSourceWidth&&e.dataset.cropSourceHeight)return;let c=null;try{c=e.getBBox()}catch{c=null}const y=c&&Number.isFinite(c.width)&&c.width>0?c.width:parseFloat(e.getAttribute("width"))||0,F=c&&Number.isFinite(c.height)&&c.height>0?c.height:parseFloat(e.getAttribute("height"))||0,E=c&&Number.isFinite(c.x)?c.x:parseFloat(e.getAttribute("x"))||0,G=c&&Number.isFinite(c.y)?c.y:parseFloat(e.getAttribute("y"))||0;y>0&&F>0&&(e.dataset.cropSourceWidth=y,e.dataset.cropSourceHeight=F,e.dataset.cropSourceX=E,e.dataset.cropSourceY=G)})();const s=document.createElement("div");s.className="crop-overlay";const i=(()=>{const c=typeof e.dataset.cropRect=="string"?e.dataset.cropRect:"",y=e.getAttribute("clip-path")||"",F=e.style&&typeof e.style.clipPath=="string"?e.style.clipPath:"",E=e.style&&typeof e.style.webkitClipPath=="string"?e.style.webkitClipPath:"",G=e.dataset.cropClipId||"",ne=(()=>{const O=y.match(/^url\(#(.+)\)$/);return O?O[1]:""})(),se=G||ne;let K=null;if(se){const O=wt(e.ownerSVGElement||null),_=O==null?void 0:O.querySelector(`#${se}`),J=_==null?void 0:_.querySelector("rect");J&&(K={x:J.getAttribute("x")||"",y:J.getAttribute("y")||"",width:J.getAttribute("width")||"",height:J.getAttribute("height")||""})}return{rectString:c,clipPathAttr:y,clipId:se,clipRect:K,clipPathStyle:F,webkitClipPathStyle:E}})(),o=[],f=document.createElement("div");f.className="crop-overlay__scrim crop-overlay__scrim--top";const d=document.createElement("div");d.className="crop-overlay__scrim crop-overlay__scrim--right";const C=document.createElement("div");C.className="crop-overlay__scrim crop-overlay__scrim--bottom";const g=document.createElement("div");g.className="crop-overlay__scrim crop-overlay__scrim--left",[f,d,C,g].forEach(c=>{c.style.pointerEvents="none",s.appendChild(c)});const x=document.createElement("div");x.className="crop-frame",s.appendChild(x);const L=document.createElement("div");L.className="crop-overlay__controls";const U=document.createElement("button");U.type="button",U.className="crop-overlay__button crop-overlay__button--cancel",U.textContent="Cancel";const Q=document.createElement("button");Q.type="button",Q.className="crop-overlay__button crop-overlay__button--apply",Q.textContent="Crop",L.appendChild(U),L.appendChild(Q),s.appendChild(L);const me=["top-left","top-right","bottom-left","bottom-right"],he=[],Ke={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};me.forEach(c=>{const y=document.createElement("div");y.className=`crop-frame__corner crop-frame__corner--${c}`,y.dataset.corner=c,y.style.pointerEvents="auto",y.style.cursor=Ke[c]||"nwse-resize";const F=document.createElement("span");F.className="corner-arm corner-arm--horizontal",F.style.pointerEvents="none";const E=document.createElement("span");E.className="corner-arm corner-arm--vertical",E.style.pointerEvents="none",y.appendChild(F),y.appendChild(E),x.appendChild(y),he.push(y)});const ya=["top","right","bottom","left"],Zt=[];ya.forEach(c=>{const y=document.createElement("div");y.className=`crop-frame__edge-handle crop-frame__edge-handle--${c}`,y.dataset.edge=c,y.style.pointerEvents="auto",y.style.cursor=c==="top"||c==="bottom"?"ns-resize":"ew-resize",x.appendChild(y),Zt.push(y)}),t.appendChild(s);let ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth,j=ee.height||t.offsetHeight,Qt=T,ea=j;if(!T||!j)return s.remove(),null;be.forEach(c=>{!c||!c.overlay||c.overlay!==t&&(c.overlay.classList.contains("editor-overlay--hidden-for-crop")||(c.overlay.classList.add("editor-overlay--hidden-for-crop"),o.push(c.overlay)))}),t.classList.add("editor-overlay--crop-active"),t.dataset.cropSessionActive="true",W(),s.style.pointerEvents="none",x.style.pointerEvents="auto";const St=(()=>{const c=e.dataset.cropRect;if(!c)return null;const y=c.split(",").map(F=>Number(F));return y.length!==4||y.some(F=>!Number.isFinite(F))?null:{left:a(y[0],0,1),top:a(y[1],0,1),width:a(y[2],0,1),height:a(y[3],0,1)}})(),rr=parseFloat(e.dataset.cropSourceWidth)||0,sr=parseFloat(e.dataset.cropSourceHeight)||0;let le,ce;const _t=()=>{ce=Math.min(T,Math.max(48,T*.08)),le=Math.min(j,Math.max(48,j*.08))};_t();const v={left:0,top:0,width:0,height:0};if(St&&St.width>0&&St.height>0){const c=St.width*T,y=St.height*j;v.width=a(c,ce,T),v.height=a(y,le,j),v.left=a(St.left*T,0,T-v.width),v.top=a(St.top*j,0,j-v.height)}else{const c=rr>0&&sr>0?rr/sr:T>0&&j>0?T/j:1;let y,F;c>=1?(y=T*.85,F=y/c):(F=j*.85,y=F*c),v.width=a(y,ce,T),v.height=a(F,le,j),v.left=Math.max(0,(T-v.width)/2),v.top=Math.max(0,(j-v.height)/2)}v.width=a(v.width,ce,T),v.height=a(v.height,le,j),v.left=a(v.left,0,T-v.width),v.top=a(v.top,0,j-v.height);const hs=()=>{const c=v.left+v.width,y=v.top+v.height;f.style.top="0px",f.style.left="0px",f.style.width="100%",f.style.height=`${Math.max(0,v.top)}px`,f.style.display=v.top>0?"block":"none",C.style.top=`${y}px`,C.style.left="0px",C.style.width="100%",C.style.height=`${Math.max(0,j-y)}px`,C.style.display=y<j?"block":"none",g.style.top=`${v.top}px`,g.style.left="0px",g.style.width=`${Math.max(0,v.left)}px`,g.style.height=`${v.height}px`,g.style.display=v.left>0?"block":"none",d.style.top=`${v.top}px`,d.style.left=`${c}px`,d.style.width=`${Math.max(0,T-c)}px`,d.style.height=`${v.height}px`,d.style.display=c<T?"block":"none"},ir=(c,y,F,E)=>{const G=e.ownerSVGElement;if(!G)return;const ne=parseFloat(e.dataset.cropSourceWidth)||0,se=parseFloat(e.dataset.cropSourceHeight)||0,K=parseFloat(e.dataset.cropSourceX)||0,O=parseFloat(e.dataset.cropSourceY)||0;let _=ne,J=se,Pe=K,wa=O;if(!_||!J){let we=null;try{we=e.getBBox()}catch{we=null}_=we&&Number.isFinite(we.width)&&we.width>0?we.width:parseFloat(e.getAttribute("width"))||0,J=we&&Number.isFinite(we.height)&&we.height>0?we.height:parseFloat(e.getAttribute("height"))||0,Pe=we&&Number.isFinite(we.x)?we.x:parseFloat(e.getAttribute("x"))||0,wa=we&&Number.isFinite(we.y)?we.y:parseFloat(e.getAttribute("y"))||0}if(!_||!J)return;if(e instanceof HTMLImageElement){const we=a(y,0,1)*100,xr=a(c,0,1)*100,Ss=a(1-(y+E),0,1)*100,Ns=a(1-(c+F),0,1)*100,Pa=`inset(${we}% ${Ns}% ${Ss}% ${xr}%)`;e.style.clipPath=Pa,e.style.webkitClipPath=Pa,delete e.dataset.cropClipId,e.dataset.cropCssClip=Pa;return}const Bt=wt(G);if(!Bt)return;const tt=e.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let ze=Bt.querySelector(`#${tt}`);ze||(ze=document.createElementNS(B,"clipPath"),ze.id=tt,ze.setAttribute("clipPathUnits","userSpaceOnUse"),Bt.appendChild(ze));let qe=ze.querySelector("rect");qe||(qe=document.createElementNS(B,"rect"),ze.appendChild(qe));const bs=_*F,xs=J*E,vs=Pe+_*c,ws=wa+J*y;qe.setAttribute("x",vs),qe.setAttribute("y",ws),qe.setAttribute("width",bs),qe.setAttribute("height",xs),e.dataset.cropClipId=tt,e.setAttribute("clip-path",`url(#${tt})`),e.style.removeProperty("clip-path"),e.style.removeProperty("-webkit-clip-path"),delete e.dataset.cropCssClip},gs=()=>{if(!T||!j)return;const c=e.dataset.cropRect||"",y=typeof e.getAttribute("clip-path")=="string"&&e.getAttribute("clip-path").length>0,F=e.ownerSVGElement,E=v.left/T,G=v.top/j,ne=v.width/T,se=v.height/j,K=a(E,0,1),O=a(G,0,1),_=a(ne,0,1-K),J=a(se,0,1-O),Pe=K+_,wa=O+J;if(K<=.001&&O<=.001&&Pe>=.999&&wa>=.999){const tt=e.dataset.cropClipId;if(tt){const ze=wt(F),qe=ze==null?void 0:ze.querySelector(`#${tt}`);qe==null||qe.remove(),delete e.dataset.cropClipId}e.removeAttribute("clip-path"),e.style.removeProperty("clip-path"),e.style.removeProperty("-webkit-clip-path"),delete e.dataset.cropCssClip,delete e.dataset.cropRect,(c||y)&&(b==null||b.schedule("image-crop"),W());return}const Bt=[K,O,_,J].map(tt=>tt.toFixed(6)).join(",");e.dataset.cropRect=Bt,ir(K,O,_,J),c!==Bt&&(b==null||b.schedule("image-crop"),W())},nr=()=>{var O;const c=e.dataset.cropRect||"",y=e.getAttribute("clip-path")||"",F=e.dataset.cropClipId||"",E=e.ownerSVGElement,G=e.dataset.cropClipId;if(G&&G!==i.clipId){const _=wt(E);(O=_==null?void 0:_.querySelector(`#${G}`))==null||O.remove()}if(i.rectString){e.dataset.cropRect=i.rectString,i.clipId?e.dataset.cropClipId=i.clipId:delete e.dataset.cropClipId;const _=i.rectString.split(",").map(J=>Number(J));_.length===4&&_.every(J=>Number.isFinite(J))&&ir(_[0],_[1],_[2],_[3]),i.clipPathAttr?e.setAttribute("clip-path",i.clipPathAttr):e.removeAttribute("clip-path"),i.clipPathStyle?(e.style.clipPath=i.clipPathStyle,e.dataset.cropCssClip=i.clipPathStyle):(e.style.removeProperty("clip-path"),delete e.dataset.cropCssClip),i.webkitClipPathStyle?e.style.webkitClipPath=i.webkitClipPathStyle:e.style.removeProperty("-webkit-clip-path")}else{if(delete e.dataset.cropRect,i.clipId){if(e.dataset.cropClipId=i.clipId,i.clipRect){const _=wt(E);if(_){let J=_.querySelector(`#${i.clipId}`);J||(J=document.createElementNS(B,"clipPath"),J.id=i.clipId,J.setAttribute("clipPathUnits","userSpaceOnUse"),_.appendChild(J));let Pe=J.querySelector("rect");Pe||(Pe=document.createElementNS(B,"rect"),J.appendChild(Pe)),Pe.setAttribute("x",i.clipRect.x),Pe.setAttribute("y",i.clipRect.y),Pe.setAttribute("width",i.clipRect.width),Pe.setAttribute("height",i.clipRect.height)}}i.clipPathAttr&&e.setAttribute("clip-path",i.clipPathAttr)}else delete e.dataset.cropClipId,i.clipPathAttr?e.setAttribute("clip-path",i.clipPathAttr):e.removeAttribute("clip-path");i.clipPathStyle?(e.style.clipPath=i.clipPathStyle,e.dataset.cropCssClip=i.clipPathStyle):(e.style.removeProperty("clip-path"),delete e.dataset.cropCssClip),i.webkitClipPathStyle?e.style.webkitClipPath=i.webkitClipPathStyle:e.style.removeProperty("-webkit-clip-path")}const ne=e.dataset.cropRect||"",se=e.getAttribute("clip-path")||"",K=e.dataset.cropClipId||"";(c!==ne||y!==se||F!==K)&&(b==null||b.schedule("image-crop"),W())},et=()=>{x.style.left=`${v.left}px`,x.style.top=`${v.top}px`,x.style.width=`${v.width}px`,x.style.height=`${v.height}px`,hs(),gs()};et();let Ce=null,X=null;const or=c=>{if(c.button!==0||c.target!==x)return;c.preventDefault(),ee=t.getBoundingClientRect();const y=ee.width||T,F=ee.height||j;Ce={pointerId:c.pointerId,startX:c.clientX,startY:c.clientY,widthLimit:y,heightLimit:F,startLeft:v.left,startTop:v.top},x.setPointerCapture(c.pointerId)},lr=c=>{if(!Ce||c.pointerId!==Ce.pointerId)return;c.preventDefault();const y=c.clientX-Ce.startX,F=c.clientY-Ce.startY,E=Math.max(0,Ce.widthLimit-v.width),G=Math.max(0,Ce.heightLimit-v.height);v.left=a(Ce.startLeft+y,0,E),v.top=a(Ce.startTop+F,0,G),et()},ba=c=>{if(!(!Ce||c.pointerId!==Ce.pointerId)){try{x.releasePointerCapture(c.pointerId)}catch{}Ce=null}};x.addEventListener("pointerdown",or),x.addEventListener("pointermove",lr),x.addEventListener("pointerup",ba),x.addEventListener("pointercancel",ba);const cr=()=>{Ce=null};x.addEventListener("lostpointercapture",cr);const dr=c=>{c.button===0&&(c.preventDefault(),c.stopPropagation(),ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth||T,j=ee.height||t.offsetHeight||j,_t(),X={pointerId:c.pointerId,mode:"edge",edge:c.currentTarget.dataset.edge,anchor:{left:v.left,top:v.top,right:v.left+v.width,bottom:v.top+v.height},target:c.currentTarget},c.currentTarget.setPointerCapture(c.pointerId))},ur=c=>{if(!X||c.pointerId!==X.pointerId||X.mode!=="edge")return;c.preventDefault(),ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth||T,j=ee.height||t.offsetHeight||j,_t();const y=c.clientX-ee.left,F=c.clientY-ee.top,E=X.anchor;let G=E.left,ne=E.top,se=a(E.right-E.left,ce,T),K=a(E.bottom-E.top,le,j);if(X.edge==="top"){const O=Math.min(E.bottom-le,j-le),_=a(F,0,Math.max(0,O));ne=_,K=Math.max(le,E.bottom-_)}else if(X.edge==="bottom"){const O=E.top+le,_=a(F,O,j);ne=E.top,K=Math.max(le,_-E.top)}else if(X.edge==="left"){const O=Math.min(E.right-ce,T-ce),_=a(y,0,Math.max(0,O));G=_,se=Math.max(ce,E.right-_)}else if(X.edge==="right"){const O=E.left+ce,_=a(y,O,T);G=E.left,se=Math.max(ce,_-E.left)}se=a(se,ce,T),K=a(K,le,j),G=a(G,0,T-se),ne=a(ne,0,j-K),v.left=G,v.top=ne,v.width=se,v.height=K,et()},xa=c=>{var y;if(!(!X||c.pointerId!==X.pointerId)){try{(y=X.target)==null||y.releasePointerCapture(c.pointerId)}catch{}X=null,et()}},pr=()=>{X=null},fr=c=>{c.button===0&&(c.preventDefault(),c.stopPropagation(),ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth||T,j=ee.height||t.offsetHeight||j,_t(),X={pointerId:c.pointerId,mode:"corner",corner:c.currentTarget.dataset.corner,anchor:{left:v.left,top:v.top,right:v.left+v.width,bottom:v.top+v.height},target:c.currentTarget},c.currentTarget.setPointerCapture(c.pointerId))},mr=c=>{if(!X||c.pointerId!==X.pointerId||X.mode!=="corner")return;c.preventDefault(),ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth||T,j=ee.height||t.offsetHeight||j,_t();const y=c.clientX-ee.left,F=c.clientY-ee.top,E=X.anchor;let G=E.left,ne=E.top,se=a(E.right-E.left,ce,T),K=a(E.bottom-E.top,le,j);switch(X.corner){case"top-left":{const O=a(y,0,E.right-ce),_=a(F,0,E.bottom-le);G=O,ne=_,se=Math.max(ce,E.right-O),K=Math.max(le,E.bottom-_);break}case"top-right":{const O=a(y,E.left+ce,T),_=a(F,0,E.bottom-le);G=E.left,ne=_,se=Math.max(ce,O-E.left),K=Math.max(le,E.bottom-_);break}case"bottom-left":{const O=a(y,0,E.right-ce),_=a(F,E.top+le,j);G=O,ne=E.top,se=Math.max(ce,E.right-O),K=Math.max(le,_-E.top);break}case"bottom-right":{const O=a(y,E.left+ce,T),_=a(F,E.top+le,j);G=E.left,ne=E.top,se=Math.max(ce,O-E.left),K=Math.max(le,_-E.top);break}default:return}se=a(se,ce,T),K=a(K,le,j),G=a(G,0,T-se),ne=a(ne,0,j-K),v.left=G,v.top=ne,v.width=se,v.height=K,et()},va=c=>{var y;if(!(!X||c.pointerId!==X.pointerId)){try{(y=X.target)==null||y.releasePointerCapture(c.pointerId)}catch{}X=null,et()}},hr=()=>{X=null};Zt.forEach(c=>{c.addEventListener("pointerdown",dr),c.addEventListener("pointermove",ur),c.addEventListener("pointerup",xa),c.addEventListener("pointercancel",xa),c.addEventListener("lostpointercapture",pr)}),he.forEach(c=>{c.addEventListener("pointerdown",fr),c.addEventListener("pointermove",mr),c.addEventListener("pointerup",va),c.addEventListener("pointercancel",va),c.addEventListener("lostpointercapture",hr)});const gr=c=>{c.preventDefault(),c.stopPropagation(),nr(),bt()},yr=c=>{c.preventDefault(),c.stopPropagation(),et()};U.addEventListener("click",gr),Q.addEventListener("click",yr);const br=c=>{c.key==="Escape"&&(c.preventDefault(),nr(),bt()),c.key==="Enter"&&(c.metaKey||c.ctrlKey)&&(c.preventDefault(),et(),bt())};document.addEventListener("keydown",br);const Ra=()=>{if(ee=t.getBoundingClientRect(),T=ee.width||t.offsetWidth||T,j=ee.height||t.offsetHeight||j,!T||!j)return;_t();const c=e.dataset.cropRect||null;if(c){const y=c.split(",").map(F=>Number(F));if(y.length===4&&y.every(F=>Number.isFinite(F))){const F=a(y[2]*T,ce,T),E=a(y[3]*j,le,j),G=a(y[0]*T,0,T-F),ne=a(y[1]*j,0,j-E);v.left=G,v.top=ne,v.width=F,v.height=E}}else{const y=Qt?v.width/Qt:1,F=ea?v.height/ea:1,E=Qt?v.left/Qt:0,G=ea?v.top/ea:0;v.width=a(y*T,ce,T),v.height=a(F*j,le,j),v.left=a(E*T,0,T-v.width),v.top=a(G*j,0,j-v.height)}Qt=T,ea=j,et()};return window.addEventListener("resize",Ra),{overlay:t,refresh:Ra,teardown:()=>{var c;if(Ce&&typeof Ce.pointerId<"u"){try{x.releasePointerCapture(Ce.pointerId)}catch{}Ce=null}if(X&&typeof X.pointerId<"u"){try{(c=X.target)==null||c.releasePointerCapture(X.pointerId)}catch{}X=null}window.removeEventListener("resize",Ra),x.removeEventListener("pointerdown",or),x.removeEventListener("pointermove",lr),x.removeEventListener("pointerup",ba),x.removeEventListener("pointercancel",ba),x.removeEventListener("lostpointercapture",cr),Zt.forEach(y=>{y.removeEventListener("pointerdown",dr),y.removeEventListener("pointermove",ur),y.removeEventListener("pointerup",xa),y.removeEventListener("pointercancel",xa),y.removeEventListener("lostpointercapture",pr)}),he.forEach(y=>{y.removeEventListener("pointerdown",fr),y.removeEventListener("pointermove",mr),y.removeEventListener("pointerup",va),y.removeEventListener("pointercancel",va),y.removeEventListener("lostpointercapture",hr)}),U.removeEventListener("click",gr),Q.removeEventListener("click",yr),document.removeEventListener("keydown",br),t.classList.remove("editor-overlay--crop-active"),delete t.dataset.cropSessionActive,o.forEach(y=>y.classList.remove("editor-overlay--hidden-for-crop")),o.length=0,W(),s.parentNode===t?t.removeChild(s):s.remove()}}},la=()=>{de||ue||We?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},Vt=()=>{be.forEach(({overlay:t,type:e})=>{var i;if(!t)return;const a=((i=t.dataset)==null?void 0:i.previewNode)||"",r=!!de&&a===de&&e==="text",s=!!ue&&a===ue&&e==="image";t.classList.toggle("editor-overlay--selected",r||s)})},Me=()=>We?"background":ue?"image":de?"text":null,za=t=>{if(typeof t!="string")return null;const e=t.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!e)return null;const a=Number(e[1]),r=Number(e[2]),s=Number(e[3]);if([a,r,s].some(o=>Number.isNaN(o)||o<0||o>255))return null;const i=o=>o.toString(16).padStart(2,"0");return`#${i(a)}${i(r)}${i(s)}`.toUpperCase()};function Nr(t){var e;try{if(t==="background"){if(!l)return null;const r=window.getComputedStyle(l).backgroundColor||l.style.backgroundColor||"";return Tt(r)||za(r)||null}if(t==="text"){const a=Lt();if(!a.length)return null;const r=a[0],s=r.getAttribute("fill")||r.style.fill||r.dataset.color||"";return Tt(s)||za(s)||null}if(t==="image"){const a=xt();if(!a.length)return null;const s=((e=a[0].dataset)==null?void 0:e.tintColor)||"";return Tt(s)||null}}catch{return null}return null}const Yt=()=>{if(typeof window>"u")return;const t=Me(),e=t==="text"?de:t==="image"?ue:null,a=Nr(t);try{const r=new CustomEvent("inkwise:active-element",{detail:{type:t,key:e,color:a}});window.dispatchEvent(r)}catch{if(typeof document<"u"&&document.createEvent){const s=document.createEvent("CustomEvent");s.initCustomEvent("inkwise:active-element",!0,!0,{type:t,key:e,color:a}),window.dispatchEvent(s)}}},lt=t=>{const e=typeof t=="string"&&t.trim()!==""?t.trim():null;de===e&&!ue||(bt(),de=e,e&&(ue=null,We=!1),Vt(),la(),Yt())},Xt=t=>{const e=typeof t=="string"&&t.trim()!==""?t.trim():null;ue===e&&!de||(ue!==e&&bt(),ue=e,e&&(de=null,We=!1),Vt(),la(),Yt())},Cr=()=>{We||(bt(),We=!0,de=null,ue=null,Vt(),la(),Yt())},Lt=()=>{if(!de)return[];const t=oe||m||document;if(!t)return[];const e=`[data-preview-node="${de}"]`,a=new Set;return t.querySelectorAll(e).forEach(r=>{if(!r)return;const s=(r.tagName||"").toLowerCase();if(s==="text"){a.add(r);return}if(s==="tspan"||s==="g"){const i=r.closest("text");i&&a.add(i)}}),Array.from(a)},xt=()=>{if(!ue)return[];const t=oe||m||document;if(!t)return[];const e=`[data-preview-node="${ue}"]`;return Array.from(t.querySelectorAll(e)).filter(a=>{if(!a)return!1;const r=(a.tagName||"").toLowerCase();return r==="image"||r==="img"})},It=()=>oa(de),vt=(t,e,a)=>{const r=Number(t);return Number.isFinite(r)?Math.min(Math.max(r,e),a):e},Tt=t=>{if(typeof t!="string")return null;let e=t.trim();return!e||(e.startsWith("#")||(e=`#${e}`),/^#([0-9a-f]{3})$/i.test(e)&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),!/^#([0-9a-f]{6})$/i.test(e))?null:e.toUpperCase()},ca=t=>{var i,o;if(!t||typeof t.getBBox!="function")return;const e=[],a=Number(((i=t.dataset)==null?void 0:i.rotation)||t.getAttribute("data-rotation")||0);if(Number.isFinite(a)&&a!==0)try{const f=t.getBBox(),d=f.x+f.width/2,C=f.y+f.height/2;e.push(`rotate(${a} ${d} ${C})`)}catch{e.push(`rotate(${a})`)}((o=t.dataset)==null?void 0:o.effectShape)==="curve"&&e.push("skewX(-8) skewY(4)");const s=e.join(" ").trim();s?t.setAttribute("transform",s):t.removeAttribute("transform")},ke=(t,e={})=>{const a=Lt();if(!a.length)return!1;if(a.forEach(r=>{try{t(r)}catch(s){console.warn("[InkWise Studio] Toolbar mutation failed.",s)}}),e.skipTransformUpdate||a.forEach(r=>{try{ca(r)}catch{}}),e.skipOverlaySync||W(),e.autosaveReason!==!1){const r=typeof e.autosaveReason=="string"&&e.autosaveReason.trim()!==""?e.autosaveReason:"text-style";b==null||b.schedule(r)}return!0},jt=(t,e={})=>{const a=xt();if(!a.length)return!1;if(a.forEach(r=>{try{t(r)}catch(s){console.warn("[InkWise Studio] Image mutation failed.",s)}}),e.skipTransformUpdate||a.forEach(r=>{try{ca(r)}catch{}}),e.skipOverlaySync||W(),e.autosaveReason!==!1){const r=typeof e.autosaveReason=="string"&&e.autosaveReason.trim()!==""?e.autosaveReason:"image-style";b==null||b.schedule(r)}return!0},wt=(t=null)=>{var r;let e=oe;if(!e&&t&&(e=t),!e)return null;if(typeof e.tagName=="string"&&e.tagName.toLowerCase()!=="svg"){const s=(r=e.closest)==null?void 0:r.call(e,"svg");s?e=s:t&&t!==e&&(e=t)}if(!e)return null;let a=e.querySelector('defs[data-inkwise-runtime="true"]');return a||(a=document.createElementNS(B,"defs"),a.setAttribute("data-inkwise-runtime","true"),e.insertBefore(a,e.firstChild||null)),a},da=t=>{const e=t.dataset.previewTarget;if(!e)return;const a=document.querySelector(`[data-preview-node="${e}"]`),r=a?a.dataset.defaultText||a.textContent:"",s=()=>{if(!a)return;const i=t.value.trim();a.textContent=i||r||"",W()};t.dataset.defaultValue||(t.dataset.defaultValue=r||""),t.addEventListener("focus",()=>{lt(e)}),t.addEventListener("input",()=>{s(),b==null||b.schedule("text-change")}),s()};u.forEach(da);const kr=(t,e="")=>{const a=document.createElement("div");a.className="text-field-item";const r=document.createElement("span");r.className="text-field-label",r.textContent="Custom",a.appendChild(r);const s=document.createElement("input");s.type="text",s.className="text-field-input",s.placeholder="Add your text",s.dataset.previewTarget=t,s.value=e,s.dataset.defaultValue=e||"",a.appendChild(s);const i=document.createElement("button");i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',a.appendChild(i),M.appendChild(a);const o=document.createElement("div");return o.className="pill",o.dataset.previewNode=t,o.dataset.defaultText=e||"CUSTOM TEXT",o.textContent=e||"CUSTOM TEXT",$.appendChild(o),da(s),ua(a),b==null||b.schedule("add-text-field"),s},Kt=()=>{m&&(kt(),oe=null,Ee=null,m.innerHTML="",m.style.display="none")},Er=t=>{if(typeof t!="string")return!1;const e=t.trim();return e?e.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(e):!1},Ar=async t=>{if(!m||!t)return Kt(),!1;try{let e="";if(t.startsWith("data:image/svg+xml")){const[,g=""]=t.split(",",2);try{e=decodeURIComponent(g)}catch{e=g}}else{const g=await fetch(t,{cache:"no-store"});if(!g.ok)return console.warn("Failed to fetch SVG:",g.status),Kt(),!1;e=await g.text()}if(!e)return Kt(),!1;m.innerHTML=e,m.style.display="block",m.setAttribute("preserveAspectRatio","xMidYMid meet"),m.setAttribute("width","100%"),m.setAttribute("height","100%"),m.style.width="100%",m.style.height="100%",m.style.maxWidth="100%",m.style.maxHeight="100%";const a=m.querySelector("svg");a?(a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",oe=a):oe=m,oe&&(oe.setAttribute("data-svg-editor","true"),oe.__inkwiseSvgTemplateEditor||(oe.__inkwiseSvgTemplateEditor=new Sa(oe)),Ee=oe.__inkwiseSvgTemplateEditor);const s=new DOMParser().parseFromString(e,"image/svg+xml").documentElement;let i=je(s==null?void 0:s.getAttribute("width")),o=je(s==null?void 0:s.getAttribute("height"));if(!Number.isFinite(i)||!Number.isFinite(o)){const g=s==null?void 0:s.getAttribute("viewBox");if(g){const w=g.split(/[\s,]+/).map(Number),x=w[2],L=w[3];!Number.isNaN(x)&&!Number.isNaN(L)&&x>0&&L>0&&(i=x,o=L)}}let f=Number.isFinite(i)?i:Number.NaN,d=Number.isFinite(o)?o:Number.NaN;if(P&&Number.isFinite(P.width)&&Number.isFinite(P.height)){const g=P.width/P.height,w=Number.isFinite(f)&&Number.isFinite(d)?f/d:g,x=Math.abs(w-g)/g,L=Number.isFinite(f)?Math.abs(f-P.width)/P.width:Number.POSITIVE_INFINITY,U=Number.isFinite(d)?Math.abs(d-P.height)/P.height:Number.POSITIVE_INFINITY;(!Number.isFinite(f)||!Number.isFinite(d)||x>.02||L>.05&&U>.05)&&(f=P.width,d=P.height)}if(Number.isFinite(f)&&Number.isFinite(d)){const g=(P==null?void 0:P.unit)??"px";it(f,d,{unit:g,shape:P==null?void 0:P.shape}),nt(Ae(f,g),Ae(d,g),"in",2)}const C=sa(m);if(kt(),M){M.innerHTML="";const g=(x,L="",U="")=>{const Q=document.createElement("div");Q.className="text-field-item";const me=document.createElement("span");me.className="text-field-label",me.textContent=U||x,Q.appendChild(me);const he=document.createElement("input");he.type="text",he.className="text-field-input",he.dataset.previewTarget=x,he.value=L||"",he.dataset.defaultValue=L||"",Q.appendChild(he);const Ke=document.createElement("button");return Ke.type="button",Ke.className="text-field-delete",Ke.setAttribute("aria-label","Delete field"),Ke.innerHTML='<i class="fa-regular fa-trash-can"></i>',Q.appendChild(Ke),M.appendChild(Q),da(he),ua(Q),he},w=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([L,U])=>g(L,"",U))};if(C.length>0){let x=!1;C.forEach(L=>{var Ke,ya;const U=L.getAttribute("data-preview-node");if(!U)return;const Q=typeof L.tagName=="string"?L.tagName.toLowerCase():"";if(!(Q==="image"||Q==="img")){x=!0;const Zt=((Ke=L.dataset)==null?void 0:Ke.previewLabel)||U,ee=((ya=L.dataset)==null?void 0:ya.defaultText)||L.textContent||"";g(U,ee,Zt)}}),x||w()}else w()}return C.forEach(g=>{const w=g.getAttribute("data-preview-node");if(!w)return;const x=typeof g.tagName=="string"?g.tagName.toLowerCase():"",L=x==="image"||x==="img",U=!L;L&&g.setAttribute("data-changeable","image"),Se(g)&&Ze(g),U?(g.setAttribute("contenteditable","true"),g.style.cursor="text",g.style.userSelect="text",g.addEventListener("input",()=>{const he=document.querySelector(`#textFieldList input[data-preview-target="${w}"]`);he&&(he.value=g.textContent),g.dataset.currentText=g.textContent||"",W(),b==null||b.schedule("text-edit")}),g.addEventListener("click",()=>{lt(w),pa(w)})):L&&(g.style.cursor="pointer",g.addEventListener("click",()=>{g.dataset.locked!=="true"&&(Xt(w),Ct(g))}));const me=document.querySelector(`#textFieldList input[data-preview-target="${w}"]`);me&&U&&(me.addEventListener("input",()=>{g.textContent=me.value,g.dataset.currentText=me.value,b==null||b.schedule("text-change")}),me.value&&me.value.trim()!==""?g.textContent=me.value:me.value=g.textContent||"")}),requestAnimationFrame(()=>W()),ft(10),!0}catch(e){return console.warn("Could not load SVG for binding:",e),Kt(),!1}},ua=t=>{if(!t)return;const e=t.querySelector(".text-field-delete"),a=t.querySelector("input[data-preview-target]");if(!e||!a||e.disabled||e.getAttribute("aria-disabled")==="true")return;e.replaceWith(e.cloneNode(!0)),t.querySelector(".text-field-delete").addEventListener("click",()=>{const s=a.dataset.previewTarget;if(t.remove(),$){const i=$.querySelector(`[data-preview-node="${s}"]`);i==null||i.remove()}if(oe){const i=oe.querySelector(`[data-preview-node="${s}"]`);i==null||i.remove()}b==null||b.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(t=>ua(t));const pa=t=>{if(!t)return;mt(),Ge("text"),z.forEach(a=>a.classList.remove("active"));const e=document.querySelector('.sidenav-btn[data-nav="text"]');e==null||e.classList.add("active"),setTimeout(()=>{const a=document.querySelector(`#textFieldList input[data-preview-target="${t}"]`);if(a){try{a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const i=document.getElementById("textFieldList");i&&(i.scrollTop=a.offsetTop-12)}a.focus({preventScroll:!1});return}const r=document.querySelector("[data-add-text-field]");r==null||r.focus({preventScroll:!1})},60)};Le=pa;const Ft=async t=>{if(re=t,!l)return;let e="",a="";t==="front"&&Re?(e=Re,a=Re):t==="back"&&Je?(e=Je,a=Je):(a=l.dataset[`${t}Svg`]||"",e=l.dataset[`${t}Image`]||"");let r=!1;if(a&&Er(a)&&await Ar(a)&&(r=!0,l.style.backgroundImage="none",l.style.backgroundSize=""),!r){const s=e||l.dataset[`${t}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",t,s||"<empty>"),Kt(),l.style.backgroundImage=s?`url('${s}')`:"",l.style.backgroundSize="",l.style.backgroundPosition="",l.style.backgroundRepeat="",s&&zt(s),kt(),oe=null}R.forEach(s=>{s.classList.toggle("active",s.dataset.cardView===t)}),h.forEach(s=>{const i=s.dataset.cardThumb===t;s.classList.toggle("active",i),s.setAttribute("aria-pressed",i?"true":"false")})};R.forEach(t=>{t.addEventListener("click",()=>{Ft(t.dataset.cardView)})}),h.forEach(t=>{t.addEventListener("click",()=>{Ft(t.dataset.cardThumb)})});const Ta=Ft("front");Ta&&typeof Ta.then=="function"?Ta.catch(()=>{}).then(()=>{ft(6),b==null||b.schedule("initial-load")}):(ft(6),b==null||b.schedule("initial-load"));const qa=document.querySelector(".preview-overlay");qa&&qa.addEventListener("click",t=>{const e=t.target.closest("[data-preview-node]");if(e){t.stopPropagation();const a=e.dataset.previewNode;if(a){const r=(e.tagName||"").toLowerCase();r==="image"||r==="img"?Xt(a):(lt(a),pa(a))}}}),I&&M&&I.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const t=`custom_${Date.now()}_${ye}`;ye+=1;const e=document.createElement("div");e.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",e.appendChild(a);const r=document.createElement("input");r.type="text",r.className="text-field-input",r.placeholder="Add your text",r.dataset.previewTarget=t,e.appendChild(r);const s=document.createElement("button");if(s.type="button",s.className="text-field-delete",s.setAttribute("aria-label","Delete field"),s.innerHTML='<i class="fa-regular fa-trash-can"></i>',e.appendChild(s),M.appendChild(e),$){const o=document.createElement("div");o.className="pill",o.dataset.previewNode=t,o.dataset.defaultText="CUSTOM TEXT",o.textContent="CUSTOM TEXT",$.appendChild(o)}let i=null;console.log("[InkWise Studio] currentSvgRoot:",oe),oe?(console.log("[InkWise Studio] Creating SVG text element"),i=document.createElementNS("http://www.w3.org/2000/svg","text"),i.setAttribute("id",t),i.setAttribute("data-preview-node",t),i.setAttribute("data-default-text","CUSTOM TEXT"),i.setAttribute("x","50%"),i.setAttribute("y","50%"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","middle"),i.setAttribute("font-family","Arial, sans-serif"),i.setAttribute("font-size","24"),i.setAttribute("fill","#000000"),i.textContent="CUSTOM TEXT",i.setAttribute("contenteditable","true"),i.style.cursor="text",i.style.userSelect="text",i.addEventListener("input",()=>{r&&(r.value=i.textContent),i.dataset.currentText=i.textContent||"",W(),b==null||b.schedule("text-edit")}),i.addEventListener("click",()=>{lt(t),pa(t)}),oe.appendChild(i),Se(i)&&Ze(i),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),da(r),r.addEventListener("input",()=>{i&&(i.textContent=r.value,i.dataset.currentText=r.value),b==null||b.schedule("text-change")}),lt(t),i&&i.textContent&&i.textContent.trim()!==""?r.value=i.textContent:(r.value="CUSTOM TEXT",i&&(i.textContent="CUSTOM TEXT")),ua(e),setTimeout(()=>{try{M.scrollHeight>M.clientHeight&&M.scrollTo({top:M.scrollHeight,behavior:"smooth"})}catch{M.scrollTop=M.scrollHeight}r.focus({preventScroll:!1})},60)}),Re=null,Je=null,re="front";const Jt=document.getElementById("image-upload"),Oa=document.getElementById("upload-button"),Ha=document.getElementById("quick-upload-button"),fa=document.getElementById("recentUploadsGrid"),ma=document.getElementById("quickRecentUploads"),ja="inkwise_recent_uploads",Wa=12,Fa=()=>{try{const t=localStorage.getItem(ja);return t?JSON.parse(t):[]}catch{return[]}},Lr=(t,e,a)=>{const r=Fa(),s={id:Date.now(),dataUrl:t,filename:e,side:a,timestamp:new Date().toISOString()},i=r.filter(f=>f.filename!==e);i.unshift(s);const o=i.slice(0,Wa);try{localStorage.setItem(ja,JSON.stringify(o))}catch{const d=o.slice(0,Math.floor(Wa/2));localStorage.setItem(ja,JSON.stringify(d))}Va(),Ya()},Ga=(t,e,a="front")=>{t&&(Lr(t,e||`upload-${Date.now()}`,a),a==="front"?Re=t:a==="back"&&(Je=t),re===a&&Ft(a),b==null||b.schedule("image-upload"))},Va=()=>{if(!fa)return;const t=Fa();if(t.length===0){fa.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const e=t.map(r=>`
            <div class="recent-upload-item" data-upload-id="${r.id}" data-image-url="${r.dataUrl}" data-side="${r.side}">
                <img src="${r.dataUrl}" alt="${r.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${r.filename}</span>
                </div>
            </div>
        `).join("");fa.innerHTML=e;const a=fa.querySelectorAll(".recent-upload-item");a.forEach(r=>{r.addEventListener("click",()=>{const s=r.dataset.imageUrl,i=r.dataset.side;a.forEach(o=>o.classList.remove("selected")),r.classList.add("selected"),i==="front"?Re=s:Je=s,re===i&&Ft(i),r.style.transform="scale(0.95)",setTimeout(()=>{r.style.transform=""},150),b==null||b.schedule("image-select")})})},Ya=()=>{if(!ma)return;const e=Fa().slice(0,5);if(e.length===0){ma.innerHTML="";return}const a=e.map(s=>`
            <div class="quick-recent-upload-item" data-upload-id="${s.id}" data-image-url="${s.dataUrl}" data-side="${s.side}" title="${s.filename}">
                <img src="${s.dataUrl}" alt="${s.filename}" loading="lazy">
            </div>
        `).join("");ma.innerHTML=a;const r=ma.querySelectorAll(".quick-recent-upload-item");r.forEach(s=>{s.addEventListener("click",()=>{const i=s.dataset.imageUrl,o=s.dataset.side;r.forEach(f=>f.classList.remove("selected")),s.classList.add("selected"),o==="front"?Re=i:Je=i,re===o&&Ft(o),s.style.transform="scale(0.9)",setTimeout(()=>{s.style.transform=""},150),b==null||b.schedule("image-select")})})},Ir=t=>{const e=t.files[0];if(!e)return;const a=new FileReader;a.onload=r=>{const s=r.target.result;Ga(s,e.name,"front")},a.readAsDataURL(e)};Jt&&Jt.addEventListener("change",()=>Ir(Jt)),Oa&&Oa.addEventListener("click",()=>{Jt.click()}),Ha&&Ha.addEventListener("click",()=>{Jt.click()});const Tr=t=>{var a;const e=(a=t.clipboardData)==null?void 0:a.items;if(!(!e||e.length===0))for(const r of e){if(!r||typeof r.type!="string"||!r.type.startsWith("image/"))continue;const s=r.getAsFile();if(!s)continue;const i=new FileReader;i.onload=o=>{const f=o.target.result,d=s.name||`pasted-${Date.now()}.png`;Ga(f,d,re||"front")},i.readAsDataURL(s),t.preventDefault();break}};Va(),Ya(),document.addEventListener("paste",Tr);const Ma=document.querySelectorAll(".pill-with-tooltip"),_a=document.querySelector(".preview-canvas-wrapper"),Ba=document.querySelector(".preview-guides"),Xa=(t,e)=>{t==="safety-pill"&&(_a==null||_a.classList.toggle("highlight-safety",e)),t==="bleed-pill"&&(Ba==null||Ba.classList.toggle("highlight-bleed",e))},ha=t=>{const e=t==null?void 0:t.querySelector(".canvas-pill"),a=t==null?void 0:t.querySelector(".tooltip");!e||!a||(t.classList.remove("is-active"),e.setAttribute("aria-expanded","false"),a.setAttribute("aria-hidden","true"),Xa(e.id,!1))};Ma.forEach(t=>{const e=t.querySelector(".canvas-pill"),a=t.querySelector(".tooltip");!e||!a||(e.addEventListener("click",r=>{r.preventDefault();const s=!t.classList.contains("is-active");Ma.forEach(i=>{i!==t&&ha(i)}),s?(t.classList.add("is-active"),e.setAttribute("aria-expanded","true"),a.setAttribute("aria-hidden","false"),Xa(e.id,!0)):ha(t)}),e.addEventListener("mouseenter",()=>{a.setAttribute("aria-hidden","false")}),e.addEventListener("focus",()=>{a.setAttribute("aria-hidden","false")}),t.addEventListener("mouseleave",()=>{t.classList.contains("is-active")||a.setAttribute("aria-hidden","true")}),e.addEventListener("blur",()=>{!t.contains(document.activeElement)&&!t.classList.contains("is-active")&&a.setAttribute("aria-hidden","true")}),e.addEventListener("keydown",r=>{r.key==="Escape"&&(ha(t),e.blur())}))}),document.addEventListener("click",t=>{t.target.closest(".pill-with-tooltip")||Ma.forEach(a=>ha(a))});const jr=t=>{if(!t)return!1;const e=ke(a=>{a.setAttribute("font-family",t),a.style.fontFamily=t},{autosaveReason:"text-font",skipTransformUpdate:!0});if(e){const a=It();a&&(a.dataset.fontFamily=t)}return e},Fr=t=>{const e=vt(t,6,400),a=ke(r=>{r.setAttribute("font-size",e),r.style.fontSize=`${e}px`},{autosaveReason:"text-size"});if(a){const r=It();r&&(r.dataset.fontSize=String(e))}return a},Mr=t=>{const e=vt(t,8,400),a=39;return jt(r=>{const s=typeof r.getBBox=="function"?r.getBBox():null,i=parseFloat(r.getAttribute("width")),o=parseFloat(r.getAttribute("height")),f=Number(r.dataset.baseWidth)||(Number.isFinite(i)?i:(s==null?void 0:s.width)||1),d=Number(r.dataset.baseHeight)||(Number.isFinite(o)?o:(s==null?void 0:s.height)||1);r.dataset.baseWidth||(r.dataset.baseWidth=f),r.dataset.baseHeight||(r.dataset.baseHeight=d);const C=e/a,g=Math.max(1,f*C),w=Math.max(1,d*C);r.setAttribute("width",g),r.setAttribute("height",w)},{autosaveReason:"image-scale"})},_r=t=>{const e=Tt(t);if(!e)return!1;const a=ke(r=>{r.setAttribute("fill",e),r.style.fill=e},{autosaveReason:"text-color",skipTransformUpdate:!0});if(a){const r=It();r&&(r.dataset.color=e)}return a},Br=t=>{const e=Tt(t);if(!e||!l)return!1;try{return l.style.backgroundColor=e,l.dataset.backgroundColor=e,b==null||b.schedule("background-color"),!0}catch(a){return console.warn("[InkWise Studio] Failed to apply background color",a),!1}},Rr=t=>{const e=Tt(t);return e?jt(a=>{if(e==="#FFFFFF"){const x=a.dataset.tintFilterId;if(x){const L=wt(a.ownerSVGElement||null),U=L==null?void 0:L.querySelector(`#${x}`);U==null||U.remove(),delete a.dataset.tintFilterId}a.removeAttribute("filter");try{delete a.dataset.tintColor}catch{}return}const r=wt(a.ownerSVGElement||null);if(!r)return;const s=a.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,i=parseInt(e.slice(1,3),16)/255,o=parseInt(e.slice(3,5),16)/255,f=parseInt(e.slice(5,7),16)/255;let d=r.querySelector(`#${s}`);if(!d){d=document.createElementNS(B,"filter"),d.id=s,d.setAttribute("color-interpolation-filters","sRGB");const x=document.createElementNS(B,"feColorMatrix");x.setAttribute("type","matrix"),x.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),d.appendChild(x);const L=document.createElementNS(B,"feComponentTransfer"),U=document.createElementNS(B,"feFuncR");U.setAttribute("type","linear"),L.appendChild(U);const Q=document.createElementNS(B,"feFuncG");Q.setAttribute("type","linear"),L.appendChild(Q);const me=document.createElementNS(B,"feFuncB");me.setAttribute("type","linear"),L.appendChild(me);const he=document.createElementNS(B,"feFuncA");he.setAttribute("type","identity"),L.appendChild(he),d.appendChild(L),r.appendChild(d)}const C=d.querySelector("feFuncR"),g=d.querySelector("feFuncG"),w=d.querySelector("feFuncB");C&&C.setAttribute("slope",i.toString()),g&&g.setAttribute("slope",o.toString()),w&&w.setAttribute("slope",f.toString()),a.dataset.tintFilterId=s,a.setAttribute("filter",`url(#${s})`);try{a.dataset.tintColor=e}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},Pr=()=>ke(t=>{const e=t.getAttribute("font-weight")||t.style.fontWeight||"",a=Number(e);e==="bold"||a>=600?(t.setAttribute("font-weight","400"),t.style.fontWeight="400"):(t.setAttribute("font-weight","700"),t.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),$r=()=>ke(t=>{const e=t.getAttribute("font-style")||t.style.fontStyle||"normal";e==="italic"||e==="oblique"?(t.setAttribute("font-style","normal"),t.style.fontStyle="normal"):(t.setAttribute("font-style","italic"),t.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ka=t=>ke(e=>{const r=(e.style.textDecoration||e.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),s=new Set(r);s.has(t)?s.delete(t):s.add(t);const i=Array.from(s).join(" ");i?(e.style.textDecoration=i,e.setAttribute("text-decoration",i)):(e.style.textDecoration="",e.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ur=t=>{const e={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},a={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},r=e[t]||"start",s=a[t]||"left",i=ke(o=>{o.setAttribute("text-anchor",r);const f=o.getAttribute("x");f&&o.querySelectorAll("tspan").forEach(d=>d.setAttribute("x",f)),o.style.textAlign=s},{autosaveReason:"text-align",skipTransformUpdate:!0});if(i){const o=It();o&&(o.dataset.align=s)}return i},Dr=t=>{let e=null;const a=ke(r=>{const s=r.textContent||"";let i=s;t==="uppercase"?i=s.toUpperCase():t==="lowercase"&&(i=s.toLowerCase()),r.textContent=i,r.dataset.currentText=i,e=i},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(a){const r=It();r&&e!==null&&(r.value=e)}return a},zr=()=>{const t=It();return ke(e=>{const r=(e.textContent||"").split(/\r?\n/),s=e.dataset.listType==="bullet"||r.every(o=>o.trim().startsWith("•")),i=s?r.map(o=>o.replace(/^\s*•\s*/u,"")).join(`
`):r.map(o=>{const f=o.trim();return f?`• ${f}`:"•"}).join(`
`);s?delete e.dataset.listType:e.dataset.listType="bullet",e.textContent=i,e.dataset.currentText=i,t&&t.dataset.previewTarget===de&&(t.value=i)},{autosaveReason:"text-list",skipTransformUpdate:!0})},qr=t=>{const e=vt(t,.5,5);return ke(a=>{a.dataset.lineHeight=e,a.style.lineHeight=e},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},Or=t=>{if(t==null)return!1;const e=Number(t);return Number.isFinite(e)?ke(a=>{if(Math.abs(e)<1e-4)a.style.letterSpacing="",a.removeAttribute("letter-spacing"),delete a.dataset.letterSpacing;else{const r=`${e.toFixed(2)}em`;a.style.letterSpacing=r,a.setAttribute("letter-spacing",r),a.dataset.letterSpacing=e.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},Hr=t=>{const e=typeof t=="string"?t:"none";return ke(a=>{switch(e){case"shadow":a.dataset.effectStyle="shadow",a.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"highlight":a.dataset.effectStyle="highlight",a.style.filter="none",a.style.paintOrder="stroke fill",a.style.stroke="rgba(253, 224, 71, 0.85)",a.style.strokeWidth=6;break;case"glitch":a.dataset.effectStyle="glitch",a.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"echo":a.dataset.effectStyle="echo",a.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;default:delete a.dataset.effectStyle,a.style.filter="",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},Wr=t=>{const e=t==="curve"?"curve":"none";return ke(a=>{e==="curve"?a.dataset.effectShape="curve":delete a.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},Gr=t=>{const e=vt(t,0,100)/100;return ke(a=>{a.style.opacity=e,a.setAttribute("opacity",e)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},Vr=t=>{const e=vt(t,0,100)/100;return jt(a=>{a.style.opacity=e,a.setAttribute("opacity",e)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},Yr=t=>{const e=vt(t,-180,180);return ke(a=>{Math.abs(e)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=e,a.setAttribute("data-rotation",e))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},Xr=t=>{const e=vt(t,-180,180);return jt(a=>{Math.abs(e)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=e,a.setAttribute("data-rotation",e))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},Ja=(t="text")=>{const e=t.replace(/[^a-z0-9_-]+/gi,"")||"text";let a=`${e}_${Date.now()}`,r=1;for(;document.querySelector(`[data-preview-node="${a}"]`);)a=`${e}_${Date.now()}_${r}`,r+=1;return a},Kr=()=>{const t=Lt();if(t.length===0)return!1;const e=t[0];if(!e||!e.parentNode)return!1;const a=Ja(de||"text"),r=e.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a,r.dataset.defaultText=r.dataset.defaultText||r.textContent||"",e.parentNode.appendChild(r),ca(r),Se(r)&&Ze(r);const i=kr(a,r.textContent||"");return i&&(i.value=r.textContent||"",setTimeout(()=>{try{i.focus({preventScroll:!1})}catch{}},0)),lt(a),W(),b==null||b.schedule("duplicate-text-node"),!0},Jr=()=>{const t=Lt();if(!t.length)return!1;const e=de;if(t.forEach(a=>{var s;const r=(s=be.get(a))==null?void 0:s.overlay;r&&(r.remove(),Be.delete(r)),be.delete(a),a.remove()}),e){const a=oa(e),r=a==null?void 0:a.closest(".text-field-item");r&&r.remove();const s=wr(e);s==null||s.remove()}return lt(null),W(),b==null||b.schedule("remove-text-node"),!0},Zr=()=>{const t=xt();if(!t.length)return!1;const e=t[0];if(!e||!e.parentNode)return!1;const a=Ja(ue||"image"),r=e.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a;const s=parseFloat(e.getAttribute("x"))||0,i=parseFloat(e.getAttribute("y"))||0;return r.setAttribute("x",s+10),r.setAttribute("y",i+10),r.dataset.tintFilterId&&(delete r.dataset.tintFilterId,r.removeAttribute("filter")),e.parentNode.appendChild(r),ca(r),Se(r)&&Ze(r),Xt(a),W(),b==null||b.schedule("duplicate-image-node"),!0},Qr=()=>{const t=xt();return t.length?(t.forEach(e=>{var r;const a=(r=be.get(e))==null?void 0:r.overlay;a&&(a.remove(),Be.delete(a)),be.delete(e),e.remove()}),Xt(null),W(),b==null||b.schedule("remove-image-node"),!0):!1},es=()=>{const t=Me();if(t==="text"){const e=ke(a=>{var o;const s=!(a.dataset.locked==="true");s?a.dataset.locked="true":delete a.dataset.locked;const i=(o=be.get(a))==null?void 0:o.overlay;i&&(i.classList.toggle("editor-overlay--locked",s),i.style.pointerEvents=s?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return e&&W(),e}if(t==="image"){const e=jt(a=>{var o;const s=!(a.dataset.locked==="true");s?a.dataset.locked="true":delete a.dataset.locked;const i=(o=be.get(a))==null?void 0:o.overlay;i&&(i.classList.toggle("editor-overlay--locked",s),i.style.pointerEvents=s?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return e&&W(),e}return!1},ts=()=>{var a;const t=Lt();if(!t.length)return!1;const e=t[0].textContent||"";if(!e)return!1;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return navigator.clipboard.writeText(e).catch(r=>{console.warn("[InkWise Studio] Clipboard write failed.",r)}),!0;try{const r=document.createElement("textarea");return r.value=e,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),r.remove(),!0}catch(r){return console.warn("[InkWise Studio] Clipboard fallback failed.",r),!1}},as=()=>{var r;const t=xt();if(!t.length)return!1;const e=t[0],a=e.getAttribute("href")||e.getAttribute("xlink:href")||e.getAttributeNS("http://www.w3.org/1999/xlink","href")||e.dataset.src||"";if(!a)return!1;if((r=navigator==null?void 0:navigator.clipboard)!=null&&r.writeText)return navigator.clipboard.writeText(a).catch(s=>{console.warn("[InkWise Studio] Clipboard write failed for image.",s)}),!0;try{const s=document.createElement("textarea");return s.value=a,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),s.remove(),!0}catch(s){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",s),!1}},rs=()=>{const t=Me();return t==="text"?ts():t==="image"?as():!1},ss=()=>{const t=Me();return t==="text"?Kr():t==="image"?Zr():!1},is=()=>{const t=Me();return t==="text"?Jr():t==="image"?Qr():!1},ns=t=>{const e=Me();return e==="text"?us(t):e==="image"?ps(t):!1},os=t=>{const e=Me();return e==="text"?Gr(t):e==="image"?Vr(t):!1},ls=t=>{const e=Me();return e==="text"?Yr(t):e==="image"?Xr(t):!1},cs=t=>{const e=Me();return e==="text"?_r(t):e==="image"?Rr(t):e==="background"?Br(t):!1},ds=t=>{const e=Me();return e==="text"?Fr(t):e==="image"?Mr(t):!1},us=t=>{const e=Lt();if(!e.length)return!1;const a=e[0],r=a.parentNode;if(!r)return!1;const s=Array.from(r.children),i=s.indexOf(a);if(i===-1)return!1;if(t==="bring-to-front")r.appendChild(a);else if(t==="send-to-back")r.insertBefore(a,s[0]);else if(t==="bring-forward"){const o=Math.min(s.length-1,i+1);if(o!==i){const f=s[o+1]||null;r.insertBefore(a,f)}}else if(t==="send-backward"){const o=Math.max(0,i-1);if(o!==i){const f=s[o];r.insertBefore(a,f)}}else return!1;return W(),b==null||b.schedule("text-layer"),!0},ps=t=>{const e=xt();if(!e.length)return!1;const a=e[0],r=a.parentNode;if(!r)return!1;const s=Array.from(r.children),i=s.indexOf(a);if(i===-1)return!1;if(t==="bring-to-front")r.appendChild(a);else if(t==="send-to-back")r.insertBefore(a,s[0]);else if(t==="bring-forward"){const o=Math.min(s.length-1,i+1);if(o!==i){const f=s[o+1]||null;r.insertBefore(a,f)}}else if(t==="send-backward"){const o=Math.max(0,i-1);if(o!==i){const f=s[o];r.insertBefore(a,f)}}else return!1;return W(),b==null||b.schedule("image-layer"),!0},fs={setFontFamily:t=>Me()!=="text"?!1:jr(t),setFontSize:t=>ds(t),setColor:t=>cs(t),getActiveKey:()=>de,getSelection:()=>{const t=Me();return{type:t,key:t==="text"?de:t==="image"?ue:null,textKey:de,imageKey:ue}},dispatch(t,e){const a=Me();switch(t){case"bold":a==="text"&&Pr();break;case"italic":a==="text"&&$r();break;case"underline":a==="text"&&Ka("underline");break;case"strikethrough":a==="text"&&Ka("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":a==="text"&&Ur(t);break;case"list-bullets":a==="text"&&zr();break;case"line-spacing":a==="text"&&qr(e);break;case"letter-spacing":a==="text"&&Or(e);break;case"uppercase":case"lowercase":a==="text"&&Dr(t);break;case"effect-style":a==="text"&&Hr(e);break;case"effect-shape":a==="text"&&Wr(e);break;case"opacity":os(e);break;case"rotation":ls(e);break;case"layer":ns(e);break;case"more":e==="duplicate"?ss():e==="delete"?is():e==="lock"?es():e==="copy"&&rs();break;case"replace-image":const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=s=>{const i=s.target.files[0];if(i){const o=new FileReader;o.onload=f=>{const d=f.target.result;jt(C=>{C.setAttribute("href",d),C.setAttributeNS("http://www.w3.org/1999/xlink","href",d)}),b==null||b.schedule("image-replace")},o.readAsDataURL(i)}},r.click();break;case"crop":{const s=xt();if(!s.length)break;const i=be.get(s[0]),o=i==null?void 0:i.overlay;if(!o)break;if(Da(),(Te==null?void 0:Te.overlay)===o)Te.refresh();else{bt();const f=Sr(o,s[0]);f&&(Te=f)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",t,e);break}}};typeof window<"u"&&(window.inkwiseToolbar=fs);const Mt=document.getElementById("canvas-zoom-select"),Za=document.getElementById("canvas-zoom-display"),ms=document.querySelectorAll("[data-zoom-step]"),Qa=document.querySelector(".preview-canvas-wrapper"),ga=k,ct=[.25,.5,.75,1,1.5,2,3];if(Mt&&Qa&&ga){const t=a=>{ga.style.setProperty("--canvas-scale",a.toString()),Qa.style.removeProperty("transform"),Mt.value=a.toString(),Za&&(Za.textContent=`${Math.round(a*100)}%`),W()},e=a=>{const r=parseFloat(Mt.value)||1,s=ct.indexOf(r);if(s===-1)return;let i=s;a==="up"&&s<ct.length-1&&(i=s+1),a==="down"&&s>0&&(i=s-1),i!==s&&t(ct[i])};Mt.addEventListener("change",a=>{const r=parseFloat(a.target.value)||1;t(r)}),ms.forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.zoomStep;r&&e(r==="up"?"up":"down")})}),ga&&ga.addEventListener("wheel",a=>{a.preventDefault();const r=parseFloat(Mt.value)||1;let s=r;if(a.deltaY>0){const i=ct.indexOf(r);i>0&&(s=ct[i-1])}else{const i=ct.indexOf(r);i<ct.length-1&&(s=ct[i+1])}s!==r&&t(s)},{passive:!1}),t(parseFloat(Mt.value)||1)}document.addEventListener("focusin",t=>{t.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",t=>{t.target.matches("#textFieldList input")&&setTimeout(()=>{const e=document.activeElement;(!e||!e.matches("#textFieldList input")&&!e.closest(".studio-react-widgets"))&&document.body.classList.remove("text-toolbar-visible")},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",pe,{once:!0}):pe()}const vr=[{name:"Lobster",family:"Lobster",weight:"400",style:"normal"},{name:"Fredoka One",family:"Fredoka One",weight:"400",style:"normal"},{name:"Pacifico",family:"Pacifico",weight:"400",style:"normal"},{name:"Baloo 2",family:"Baloo 2",weight:"400",style:"normal"},{name:"Poppins Bold",family:"Poppins",weight:"700",style:"normal"},{name:"Anton",family:"Anton",weight:"400",style:"normal"},{name:"Gochi Hand",family:"Gochi Hand",weight:"400",style:"normal"},{name:"Bangers",family:"Bangers",weight:"400",style:"normal"},{name:"Chewy",family:"Chewy",weight:"400",style:"normal"},{name:"Rubik ExtraBold",family:"Rubik",weight:"800",style:"normal"},{name:"Comic Neue Bold",family:"Comic Neue",weight:"700",style:"normal"},{name:"Amatic SC Bold",family:"Amatic SC",weight:"700",style:"normal"},{name:"Luckiest Guy",family:"Luckiest Guy",weight:"400",style:"normal"},{name:"Kalam Bold",family:"Kalam",weight:"700",style:"normal"},{name:"Bubblegum Sans",family:"Bubblegum Sans",weight:"400",style:"normal"},{name:"Shrikhand",family:"Shrikhand",weight:"400",style:"normal"},{name:"Jua",family:"Jua",weight:"400",style:"normal"},{name:"DynaPuff",family:"DynaPuff",weight:"400",style:"normal"},{name:"Cabin Sketch",family:"Cabin Sketch",weight:"400",style:"normal"},{name:"Titan One",family:"Titan One",weight:"400",style:"normal"},{name:"Montserrat SemiBold",family:"Montserrat",weight:"600",style:"normal"},{name:"Helvetica Neue",family:"Helvetica Neue",weight:"400",style:"normal"},{name:"Lato Bold",family:"Lato",weight:"700",style:"normal"},{name:"Source Sans Pro",family:"Source Sans Pro",weight:"400",style:"normal"},{name:"Poppins Medium",family:"Poppins",weight:"500",style:"normal"},{name:"Roboto Condensed",family:"Roboto Condensed",weight:"400",style:"normal"},{name:"Open Sans",family:"Open Sans",weight:"400",style:"normal"},{name:"Oswald",family:"Oswald",weight:"400",style:"normal"},{name:"Nunito Sans",family:"Nunito Sans",weight:"400",style:"normal"},{name:"Inter SemiBold",family:"Inter",weight:"600",style:"normal"},{name:"Futura PT",family:"Futura PT",weight:"400",style:"normal"},{name:"Avenir Next",family:"Avenir Next",weight:"400",style:"normal"},{name:"Work Sans Medium",family:"Work Sans",weight:"500",style:"normal"},{name:"Proxima Nova",family:"Proxima Nova",weight:"400",style:"normal"},{name:"IBM Plex Sans",family:"IBM Plex Sans",weight:"400",style:"normal"},{name:"Barlow SemiCondensed",family:"Barlow Semi Condensed",weight:"400",style:"normal"},{name:"Sora",family:"Sora",weight:"400",style:"normal"},{name:"Metropolis",family:"Metropolis",weight:"400",style:"normal"},{name:"Urbanist",family:"Urbanist",weight:"400",style:"normal"},{name:"Manrope",family:"Manrope",weight:"400",style:"normal"},{name:"Quicksand Light",family:"Quicksand",weight:"300",style:"normal"},{name:"Great Vibes",family:"Great Vibes",weight:"400",style:"normal"},{name:"Parisienne",family:"Parisienne",weight:"400",style:"normal"},{name:"Nunito Light",family:"Nunito",weight:"300",style:"normal"},{name:"Cormorant Garamond",family:"Cormorant Garamond",weight:"400",style:"normal"},{name:"Playfair Display",family:"Playfair Display",weight:"400",style:"normal"},{name:"Allura",family:"Allura",weight:"400",style:"normal"},{name:"DM Sans",family:"DM Sans",weight:"400",style:"normal"},{name:"Satisfy",family:"Satisfy",weight:"400",style:"normal"},{name:"Karla",family:"Karla",weight:"400",style:"normal"},{name:"Josefin Light",family:"Josefin Sans",weight:"300",style:"normal"},{name:"Merriweather Light",family:"Merriweather",weight:"300",style:"normal"},{name:"Sacramento",family:"Sacramento",weight:"400",style:"normal"},{name:"Dancing Script",family:"Dancing Script",weight:"400",style:"normal"},{name:"Marcellus",family:"Marcellus",weight:"400",style:"normal"},{name:"Crimson Pro",family:"Crimson Pro",weight:"400",style:"normal"},{name:"ABeeZee",family:"ABeeZee",weight:"400",style:"normal"},{name:"GFS Didot",family:"GFS Didot",weight:"400",style:"normal"},{name:"Overlock Light",family:"Overlock",weight:"300",style:"normal"},{name:"Hind Soft",family:"Hind",weight:"400",style:"normal"},{name:"Cinzel",family:"Cinzel",weight:"400",style:"normal"},{name:"Cormorant Infant",family:"Cormorant Infant",weight:"400",style:"normal"},{name:"Playfair Display Italic",family:"Playfair Display",weight:"400",style:"italic"},{name:"Alex Brush",family:"Alex Brush",weight:"400",style:"normal"},{name:"Montserrat Light",family:"Montserrat",weight:"300",style:"normal"},{name:"Bodoni Moda",family:"Bodoni Moda",weight:"400",style:"normal"},{name:"Cormorant Upright",family:"Cormorant Upright",weight:"400",style:"normal"},{name:"Libre Baskerville Italic",family:"Libre Baskerville",weight:"400",style:"italic"},{name:"Tangerine",family:"Tangerine",weight:"400",style:"normal"},{name:"Cinzel Decorative",family:"Cinzel Decorative",weight:"400",style:"normal"},{name:"Forum",family:"Forum",weight:"400",style:"normal"},{name:"Cardo Italic",family:"Cardo",weight:"400",style:"italic"},{name:"Unna Italic",family:"Unna",weight:"400",style:"italic"},{name:"Prata",family:"Prata",weight:"400",style:"normal"},{name:"Gilda Display",family:"Gilda Display",weight:"400",style:"normal"},{name:"Cormorant SC",family:"Cormorant SC",weight:"400",style:"normal"},{name:"Quattrocento",family:"Quattrocento",weight:"400",style:"normal"},{name:"Marcellus SC",family:"Marcellus SC",weight:"400",style:"normal"}],Is=[12,14,16,18,24,32,36,39,42,48,60];function $a(pe,u,l){return Math.min(Math.max(pe,u),l)}function Ts({onFontChange:pe=()=>{},onSizeChange:u=()=>{},onAction:l=()=>{},onColorChange:m=()=>{},activeElementType:h=null}){const R=A.useMemo(()=>vr[0],[]),[$,M]=A.useState(R),[I,z]=A.useState(39),[k,B]=A.useState(!1),[ie,q]=A.useState(!1),H=A.useRef(null),ye=A.useRef(null),[te,D]=A.useState(!1),Z=A.useRef(null),[V,ae]=A.useState(!1),Oe=A.useRef(null),[dt,_e]=A.useState(!1),Rt=A.useRef(null),[at,He]=A.useState("#FFFFFF"),[Ae,Pt]=A.useState([]),Na=A.useMemo(()=>[{label:"Grayscale",colors:["#FFFFFF","#E5E7EB","#9CA3AF","#4B5563","#111827"]},{label:"Blues",colors:["#DCEEFB","#A8D1FF","#4DA1FF","#2563EB","#0B3D91"]},{label:"Greens",colors:["#DEF7EC","#BFEBD3","#34D399","#059669","#064E3B"]},{label:"Yellows",colors:["#FFFBEB","#FEF3C7","#FBBF24","#F59E0B","#B45309"]},{label:"Oranges",colors:["#FFF1E6","#FFD8B5","#FB923C","#F97316","#7C2D12"]},{label:"Reds",colors:["#FFEFF2","#FFD6DD","#EF4444","#DC2626","#58151C"]}],[]),[P,ta]=A.useState(0),[Nt,ut]=A.useState(0),[Ie,be]=A.useState(100),[Be,pt]=A.useState("swatches"),fe=A.useRef(null),oe=A.useRef(!1),Ee=h==="text",Le=h==="image",re=Ee||Le,[Re,Je]=A.useState(0),[b,de]=A.useState(0),[ue,We]=A.useState(0),[Te,Ca]=A.useState(0);function $e(p,N,Y,ge){const xe=p/100,Ne=N/100,De=Y/100,Xe=ge/100,Qe=Math.round(255*(1-xe)*(1-Xe)),La=Math.round(255*(1-Ne)*(1-Xe)),Ia=Math.round(255*(1-De)*(1-Xe)),yt=oa=>oa.toString(16).padStart(2,"0").toUpperCase();return`#${yt(Qe)}${yt(La)}${yt(Ia)}`}A.useEffect(()=>{if(Be==="cmyk")try{const p=$e(Re,b,ue,Te);He(p),m(p)}catch{}},[Re,b,ue,Te,Be]);function Ct(p){const N=p.replace("#",""),Y=parseInt(N,16),ge=Y>>16&255,xe=Y>>8&255,Ne=Y&255;return{r:ge,g:xe,b:Ne}}function ka(p,N,Y){p/=255,N/=255,Y/=255;const ge=Math.max(p,N,Y),xe=Math.min(p,N,Y);let Ne=0,De=0,Xe=(ge+xe)/2;if(ge!==xe){const Qe=ge-xe;switch(De=Xe>.5?Qe/(2-ge-xe):Qe/(ge+xe),ge){case p:Ne=(N-Y)/Qe+(N<Y?6:0);break;case N:Ne=(Y-p)/Qe+2;break;case Y:Ne=(p-N)/Qe+4;break}Ne/=6}return{h:Math.round(Ne*360),s:Math.round(De*100),l:Math.round(Xe*100)}}function kt(p,N,Y){N/=100,Y/=100;const ge=De=>(De+p/30)%12,xe=N*Math.min(Y,1-Y),Ne=De=>{const Xe=Y-xe*Math.max(-1,Math.min(ge(De)-3,Math.min(9-ge(De),1)));return Math.round(255*Xe).toString(16).padStart(2,"0")};return`#${Ne(0)}${Ne(8)}${Ne(4)}`.toUpperCase()}A.useEffect(()=>{try{const p=Ct(at.replace("#","")),{h:N,s:Y,l:ge}=ka(p.r,p.g,p.b);ta(N),ut(Y),be(ge)}catch{}},[at]),A.useEffect(()=>{const p=kt(P,Nt,Ie);He(p)},[P,Nt,Ie]);const rt=p=>{oe.current=!0,Ze(p),window.addEventListener("mousemove",Ze),window.addEventListener("mouseup",aa)},Ze=p=>{if(!fe.current)return;const N=fe.current.getBoundingClientRect(),Y=Math.min(Math.max(0,(p.clientX-N.left)/N.width),1),ge=Math.min(Math.max(0,(p.clientY-N.top)/N.height),1),xe=Math.round(Y*100),Ne=Math.round((1-ge)*100);ut(xe),be(Ne)},aa=()=>{oe.current=!1,window.removeEventListener("mousemove",Ze),window.removeEventListener("mouseup",aa)};A.useEffect(()=>{const p=N=>{(k&&H.current&&!H.current.contains(N.target)||ie&&ye.current&&!ye.current.contains(N.target)||te&&Z.current&&!Z.current.contains(N.target)||V&&Oe.current&&!Oe.current.contains(N.target)||Ut&&st.current&&!st.current.contains(N.target)||Dt&&it.current&&!it.current.contains(N.target)||nt&&zt.current&&!zt.current.contains(N.target)||mt&&At.current&&!At.current.contains(N.target))&&(B(!1),q(!1),D(!1),ae(!1),ve(!1),Se(!1),je(!1),Ge(!1))};return(k||ie||te||V||Ut||Dt||nt||dt||mt||Ue||ia||gt)&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[k,ie]);const W=p=>{Ee&&(M(p),pe(p.family),B(!1))},ft=p=>{const N=(p||"#FFFFFF").toUpperCase();He(N),m(N),Pt(Y=>[N,...Y.filter(xe=>xe!==N)].slice(0,8)),q(!1)},$t=p=>{const N=$a(p,8,96);z(N),u(N)},ra=p=>{re&&$t(I+p)},Ea=p=>{if(!re)return;const N=Number(p.target.value);Number.isFinite(N)&&$t(N)},[Ut,ve]=A.useState(!1),st=A.useRef(null),[Dt,Se]=A.useState(!1),it=A.useRef(null),[nt,je]=A.useState(!1),zt=A.useRef(null),[Et,qt]=A.useState(1.4),[sa,ot]=A.useState(.12),[mt,Ge]=A.useState(!1),[ht,S]=A.useState(100),At=A.useRef(null),[Ue,Fe]=A.useState(!1),[Ot,Aa]=A.useState(0),Ua=A.useRef(null),[ia,Ve]=A.useState(!1),Ht=A.useRef(null),[gt,Ye]=A.useState(!1),Wt=A.useRef(null);A.useEffect(()=>{Ee||(B(!1),D(!1),ae(!1),ve(!1),Se(!1),je(!1),_e(!1))},[Ee]),A.useEffect(()=>{re||(q(!1),Ge(!1),Fe(!1),Ve(!1),Ye(!1))},[re]);const Gt=()=>{Ee&&(qt(1.4),l("line-spacing")(1.4))},na=()=>{Ee&&(ot(.12),l("letter-spacing")(.12))};return n.jsxs("div",{className:"text-mini-toolbar",role:"toolbar","aria-label":Le?"Image editing toolbar":"Text editing toolbar",children:[n.jsxs("div",{className:"toolbar-group toolbar-group--font",children:[Le?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>l("replace-image"),children:"Replace Image"}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("button",{type:"button",className:"ghost-button",onClick:()=>l("crop"),children:[n.jsx("i",{className:"fa-solid fa-crop-simple"})," Crop"]})]}):n.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>{Ee&&B(p=>!p)},"aria-label":Ee?"Choose font family":"Font selection available for text elements",disabled:!Ee,children:[Ee?$.name:"Select element"," ",n.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),Ee&&k&&n.jsx("div",{className:"font-modal",ref:H,children:n.jsx("div",{className:"font-modal-content",children:vr.map(p=>n.jsx("button",{type:"button",className:"font-option",onClick:()=>W(p),style:{fontFamily:p.family,fontWeight:p.weight,fontStyle:p.style},children:p.name},p.name))})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--size",role:"group","aria-label":Le?"Image scale":"Font size",children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":Le?"Decrease image scale":"Decrease font size",onClick:()=>ra(-2),disabled:!re,children:n.jsx("i",{className:"fa-solid fa-minus","aria-hidden":"true"})}),n.jsx("label",{className:"sr-only",htmlFor:"mini-toolbar-size",children:Le?"Image scale":"Font size"}),n.jsx("select",{id:"mini-toolbar-size",className:"size-select",value:I,onChange:Ea,disabled:!re,children:Is.map(p=>n.jsx("option",{value:p,children:p},p))}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":Le?"Increase image scale":"Increase font size",onClick:()=>ra(2),disabled:!re,children:n.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"color-swatch","aria-label":Le?"Choose image tint":"Choose text color",onClick:()=>{re&&(B(!1),q(p=>!p))},disabled:!re,children:n.jsx("span",{className:"color-swatch__chip",style:{background:at}})}),ie&&n.jsx("div",{className:"color-modal",ref:ye,children:n.jsxs("div",{className:"color-modal-content",children:[n.jsxs("div",{className:"color-modal-header",children:[n.jsx("div",{className:"color-modal-title",children:Le?"Image tint":"Text color"}),n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>q(!1),"aria-label":"Close color picker",children:n.jsx("i",{className:"fa-solid fa-x"})})]}),n.jsx("div",{className:"color-picker-area",children:n.jsx("div",{className:"inline-color-picker",children:n.jsxs("div",{className:"spectrum-picker",children:[n.jsx("div",{className:"spectrum-area",ref:fe,onMouseDown:rt,style:{background:`linear-gradient(to right, #fff, hsl(${P}, 100%, 50%)), linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,1))`},role:"application","aria-label":"Color spectrum",children:n.jsx("div",{className:"spectrum-handle",style:{left:`${Nt}%`,top:`${100-Ie}%`},"aria-hidden":"true"})}),n.jsx("div",{className:"hue-row",children:n.jsx("input",{className:"hue-range",type:"range",min:"0",max:"360",value:P,onChange:p=>ta(Number(p.target.value)),style:{background:`linear-gradient(to right, ${Array.from({length:13}).map((p,N)=>`hsl(${N*30},100%,50%)`).join(",")})`},"aria-label":"Hue"})}),n.jsxs("div",{className:"hex-row",children:[n.jsx("input",{type:"text",className:"hex-input",value:kt(P,Nt,Ie),onChange:p=>He(p.target.value),"aria-label":"Hex color value"}),n.jsx("button",{type:"button",className:"eyedropper-button",title:"Eyedropper","aria-label":"Eyedropper",children:n.jsx("i",{className:"fa-solid fa-eye-dropper"})})]})]})})}),n.jsxs("div",{className:"swatch-sections",children:[n.jsxs("div",{className:"tabs",children:[n.jsx("div",{className:`tab ${Be==="swatches"?"active":""}`,onClick:()=>pt("swatches"),children:"Swatches"}),n.jsx("div",{className:`tab ${Be==="cmyk"?"active":""}`,onClick:()=>pt("cmyk"),children:"CMYK"})]}),n.jsx("div",{className:"section-divider","aria-hidden":"true"}),Be==="swatches"&&n.jsxs(n.Fragment,{children:[Ae.length>0&&n.jsxs("div",{className:"swatch-section",children:[n.jsx("div",{className:"swatch-title",children:"Recent colors"}),n.jsx("div",{className:"swatches-grid",children:Ae.map(p=>n.jsx("button",{type:"button",className:"swatch",style:{background:p},onClick:()=>ft(p)},p))})]}),Ae.length>0&&Na.length>0&&n.jsx("div",{className:"section-divider","aria-hidden":"true"}),n.jsx("div",{className:"swatch-section",children:n.jsx("div",{className:"preset-groups",children:Na.map((p,N)=>n.jsx("div",{className:"swatch-group",children:n.jsx("div",{className:"swatches-grid preset",children:p.colors.map(Y=>n.jsx("button",{type:"button",className:"swatch",style:{background:Y},onClick:()=>ft(Y)},Y))})},N))})})]}),Be==="cmyk"&&n.jsxs("div",{className:"swatch-section cmyk-section",children:[n.jsx("div",{className:"swatch-title",children:"CMYK (preview)"}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"C"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Re,onChange:p=>Je(Number(p.target.value)),className:"cmyk-range c-range","aria-label":"Cyan"}),n.jsxs("div",{className:"cmyk-value",children:[Re,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"M"}),n.jsx("input",{type:"range",min:"0",max:"100",value:b,onChange:p=>de(Number(p.target.value)),className:"cmyk-range m-range","aria-label":"Magenta"}),n.jsxs("div",{className:"cmyk-value",children:[b,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"Y"}),n.jsx("input",{type:"range",min:"0",max:"100",value:ue,onChange:p=>We(Number(p.target.value)),className:"cmyk-range y-range","aria-label":"Yellow"}),n.jsxs("div",{className:"cmyk-value",children:[ue,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"K"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Te,onChange:p=>Ca(Number(p.target.value)),className:"cmyk-range k-range","aria-label":"Key Black"}),n.jsxs("div",{className:"cmyk-value",children:[Te,"%"]})]})]})]})]})})]}),Ee&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--actions",role:"group","aria-label":"Text format actions",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bold",onClick:()=>{D(p=>!p),q(!1),B(!1)},children:n.jsx("span",{className:"toolbar-label",children:"B"})}),te&&n.jsx("div",{className:"format-modal",ref:Z,role:"dialog","aria-label":"Text formatting options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option",title:"Bold",onClick:()=>{l("bold"),D(!1)},children:n.jsx("i",{className:"fi fi-ss-bold","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Italic",onClick:()=>{l("italic"),D(!1)},children:n.jsx("i",{className:"fi fi-br-italic","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Underline",onClick:()=>{l("underline"),D(!1)},children:n.jsx("i",{className:"fi fi-br-underline","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Strikethrough",onClick:()=>{l("strikethrough"),D(!1)},children:n.jsx("i",{className:"fi fi-br-strikethrough","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Align center",onClick:()=>{ve(p=>!p),D(!1),q(!1),B(!1)},children:n.jsx("i",{className:"fa-solid fa-align-center","aria-hidden":"true"})}),Ut&&n.jsx("div",{className:"align-modal",ref:st,role:"dialog","aria-label":"Alignment options",children:n.jsxs("div",{className:"align-modal-content",children:[n.jsx("button",{type:"button",className:"align-option",title:"Align-justify",onClick:()=>{l("align-justify"),ve(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-center",onClick:()=>{l("align-center"),ve(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"5",y:"4",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"5",y:"14",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-left",onClick:()=>{l("align-left"),ve(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-right",onClick:()=>{l("align-right"),ve(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"9",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"9",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bulleted list",onClick:()=>{Se(p=>!p),ve(!1),D(!1),q(!1),B(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})}),Dt&&n.jsx("div",{className:"list-modal",ref:it,role:"dialog","aria-label":"List options",children:n.jsxs("div",{className:"list-modal-content",children:[n.jsx("button",{type:"button",className:"list-option",title:"Numbered list",onClick:()=>{Se(!1),je(!0)},children:n.jsx("i",{className:"fa-solid fa-list-ol","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"list-option",title:"Bulleted list",onClick:()=>{l("list-bullets"),Se(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Numbered list",onClick:()=>{je(p=>!p),Se(!1),ve(!1),D(!1),q(!1),B(!1)},children:n.jsx("i",{className:"fa-solid fa-text-height","aria-hidden":"true"})}),nt&&n.jsx("div",{className:"number-modal",ref:zt,role:"dialog","aria-label":"Text spacing options",children:n.jsxs("div",{className:"number-modal-content",children:[n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Line spacing"}),n.jsx("input",{type:"range",min:"0.8",max:"3",step:"0.01",value:Et,onChange:p=>{const N=Number(p.target.value);qt(N),l("line-spacing")(N)},className:"number-range line-range","aria-label":"Line spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:Gt,"aria-label":"Reset line spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:Et,onChange:p=>{const N=Number(p.target.value);qt(N),l("line-spacing")(N)}})]}),n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Letter spacing"}),n.jsx("input",{type:"range",min:"-0.5",max:"1",step:"0.01",value:sa,onChange:p=>{const N=Number(p.target.value);ot(N),l("letter-spacing")(N)},className:"number-range letter-range","aria-label":"Letter spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:na,"aria-label":"Reset letter spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:sa,onChange:p=>{const N=Number(p.target.value);ot(N),l("letter-spacing")(N)}})]})]})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--menu",role:"group","aria-label":"Text styles",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"text-button",onClick:()=>{ae(p=>!p),Se(!1),ve(!1),q(!1),B(!1),je(!1),D(!1),_e(!1)},"aria-label":"Format",children:"Format"}),V&&n.jsx("div",{className:"case-modal format-modal",ref:Oe,role:"dialog","aria-label":"Case options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option ",title:"Lowercase",onClick:()=>{l("lowercase"),ae(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"a"})}),n.jsx("button",{type:"button",className:"format-option ",title:"Uppercase",onClick:()=>{l("uppercase"),ae(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"A"})})]})}),n.jsxs("button",{type:"button",className:"text-button",onClick:()=>{_e(p=>!p),ae(!1),Se(!1),ve(!1),D(!1),q(!1),B(!1),je(!1)},children:["T",n.jsx("span",{className:"text-button__super",children:"+"})," Effects"]}),dt&&n.jsxs("div",{className:"effects-modal",ref:Rt,role:"dialog","aria-label":"Text effects",children:[n.jsx("button",{type:"button",className:"modal-close-btn","aria-label":"Close effects",onClick:()=>_e(!1),children:n.jsx("i",{className:"fa-solid fa-x","aria-hidden":"true"})}),n.jsxs("div",{className:"effects-modal-content",children:[n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Style"}),n.jsxs("div",{className:"effects-grid",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-style")("none")},children:n.jsx("div",{className:"effect-preview none",children:n.jsx("i",{className:"fa-solid fa-ban","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Shadow",onClick:()=>{l("effect-style")("shadow")},children:n.jsx("div",{className:"effect-preview shadow",children:n.jsx("i",{className:"fi fi-rr-text-shadow","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Highlight",onClick:()=>{l("effect-style")("highlight")},children:n.jsx("div",{className:"effect-preview highlight",children:n.jsx("i",{className:"fa-solid fa-highlighter","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Glitch",onClick:()=>{l("effect-style")("glitch")},children:n.jsx("div",{className:"effect-preview glitch",children:n.jsx("span",{className:"glitch-mark",children:"/A"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Echo",onClick:()=>{l("effect-style")("echo")},children:n.jsx("div",{className:"effect-preview echo",children:n.jsx("span",{className:"echo-mark",children:"//A"})})})]})]}),n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Shape"}),n.jsxs("div",{className:"effects-grid two",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-shape")("none")},children:n.jsx("div",{className:"effect-preview none",children:"None"})}),n.jsx("button",{type:"button",className:"effect-option",title:"Curve",onClick:()=>{l("effect-shape")("curve")},children:n.jsx("div",{className:"effect-preview curve",children:"Curve"})})]})]})]})]})]})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--utility",role:"group","aria-label":"Utility actions",style:{position:"relative"},children:[n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Spacing",onClick:()=>{re&&(Ge(p=>!p),_e(!1),ae(!1),Se(!1),ve(!1),D(!1),q(!1),B(!1),je(!1))},disabled:!re,children:n.jsx("i",{className:"fi fi-rr-chess-board","aria-hidden":"true"})}),mt&&n.jsx("div",{className:"opacity-modal",ref:At,role:"dialog","aria-label":"Opacity",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"opacity-modal-content",children:[n.jsxs("div",{className:"opacity-row",children:[n.jsx("label",{className:"opacity-label",children:"Opacity"}),n.jsx("input",{className:"opacity-input",type:"number",min:"0",max:"100",value:ht,onChange:p=>{const N=$a(Number(p.target.value)||0,0,100);S(N),l("opacity")(N)},"aria-label":"Opacity percent"})]}),n.jsx("div",{className:"opacity-slider-row",children:n.jsx("input",{type:"range",min:"0",max:"100",value:ht,onChange:p=>{const N=Number(p.target.value);S(N),l("opacity")(N)},className:"opacity-slider","aria-label":"Opacity slider",style:{background:"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1))"}})})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Layers",onClick:()=>{re&&(Ve(p=>!p),Fe(!1),Ge(!1),_e(!1),ae(!1),Se(!1),ve(!1),D(!1),q(!1),B(!1),je(!1))},disabled:!re,children:n.jsx("i",{className:"fa-solid fa-layer-group","aria-hidden":"true"})}),ia&&n.jsx("div",{className:"layers-modal",ref:Ht,role:"dialog","aria-label":"Layer management",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"layers-modal-content",children:[n.jsxs("button",{type:"button",className:"layer-option",title:"Bring to front",onClick:()=>{l("layer")("bring-to-front"),Ve(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring to front"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Bring forward",onClick:()=>{l("layer")("bring-forward"),Ve(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring forward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send backward",onClick:()=>{l("layer")("send-backward"),Ve(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send backward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send to back",onClick:()=>{l("layer")("send-to-back"),Ve(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send to back"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Share / Rotation",onClick:()=>{re&&(Fe(p=>!p),Ge(!1),_e(!1),ae(!1),Se(!1),ve(!1),D(!1),q(!1),B(!1),je(!1))},disabled:!re,children:n.jsx("i",{className:"fi fi-rr-refresh","aria-hidden":"true"})}),Ue&&n.jsx("div",{className:"rotation-modal",ref:Ua,role:"dialog","aria-label":"Rotation",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"rotation-modal-content",children:[n.jsxs("div",{className:"rotation-row",children:[n.jsx("label",{className:"rotation-label",children:"Rotation"}),n.jsx("input",{className:"rotation-input",type:"number",min:"-180",max:"180",value:Ot,onChange:p=>{const N=$a(Number(p.target.value)||0,-180,180);Aa(N),l("rotation")(N)},"aria-label":"Rotation degrees"})]}),n.jsxs("div",{className:"rotation-slider-row",children:[n.jsx("input",{type:"range",min:"-180",max:"180",value:Ot,onChange:p=>{const N=Number(p.target.value);Aa(N),l("rotation")(N)},className:"rotation-slider","aria-label":"Rotation slider"}),n.jsx("i",{className:"fa-solid fa-rotate-right rotation-icon","aria-hidden":"true"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"More options",onClick:()=>{re&&(Ye(p=>!p),Ve(!1),Fe(!1),Ge(!1),_e(!1),ae(!1),Se(!1),ve(!1),D(!1),q(!1),B(!1),je(!1))},disabled:!re,children:n.jsx("i",{className:"fa-solid fa-ellipsis","aria-hidden":"true"})}),gt&&n.jsx("div",{className:"more-modal",ref:Wt,role:"dialog","aria-label":"More options",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"more-modal-content",children:[n.jsxs("button",{type:"button",className:"more-option",title:"Duplicate",onClick:()=>{l("more")("duplicate"),Ye(!1)},children:[n.jsx("i",{className:"fa-solid fa-clone","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Duplicate"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Delete",onClick:()=>{l("more")("delete"),Ye(!1)},children:[n.jsx("i",{className:"fi fi-rr-trash","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Delete"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Lock",onClick:()=>{l("more")("lock"),Ye(!1)},children:[n.jsx("i",{className:"fi fi-rr-unlock","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Lock"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Copy",onClick:()=>{l("more")("copy"),Ye(!1)},children:[n.jsx("i",{className:"fa-solid fa-copy","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Copy"})]})]})})]})]})]})}function js(){const pe=document.getElementById("inkwise-customer-studio-bootstrap");if(pe)try{const u=JSON.parse(pe.textContent||"{}");if(u&&typeof u=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=u),u}catch(u){console.error("[InkWise Studio] Failed to parse bootstrap payload.",u)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Fs(){const pe=A.useMemo(()=>js(),[]),[u,l]=A.useState("initializing"),[m,h]=A.useState(null);if(A.useEffect(()=>{Ls(),l("ready")},[]),A.useEffect(()=>{if(typeof window>"u")return;const z=B=>{const ie=(B==null?void 0:B.detail)||{};h(ie.type||null)};window.addEventListener("inkwise:active-element",z);const k=window.inkwiseToolbar;if(k&&typeof k.getSelection=="function")try{const B=k.getSelection();B&&B.type&&h(B.type)}catch(B){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",B)}return()=>{window.removeEventListener("inkwise:active-element",z)}},[]),!pe||Object.keys(pe).length===0)return null;const R=z=>{const k=typeof window<"u"?window.inkwiseToolbar:null;if(!k||typeof k.setFontFamily!="function"){console.debug("[InkWise Studio] Font change ignored (bridge unavailable).",z);return}k.setFontFamily(z)},$=z=>{const k=typeof window<"u"?window.inkwiseToolbar:null;if(!k||typeof k.setFontSize!="function"){console.debug("[InkWise Studio] Size change ignored (bridge unavailable).",z);return}k.setFontSize(z)},M=z=>{const k=typeof window<"u"?window.inkwiseToolbar:null;if(!k||typeof k.setColor!="function"){console.debug("[InkWise Studio] Color change ignored (bridge unavailable).",z);return}k.setColor(z)},I=z=>{const k=typeof window<"u"?window.inkwiseToolbar:null;return!k||typeof k.dispatch!="function"?(console.debug("[InkWise Studio] Toolbar action ignored (bridge unavailable).",z),()=>{}):new Set(["line-spacing","letter-spacing","effect-style","effect-shape","opacity","rotation","layer","more"]).has(z)?ie=>{k.dispatch(z,ie)}:(k.dispatch(z),()=>{})};return n.jsx("div",{className:"studio-react-widgets",children:n.jsx(Ts,{onAction:I,onFontChange:R,onSizeChange:$,onColorChange:M,activeElementType:m})})}function Ms(){const pe=()=>{const u=document.getElementById("inkwise-customer-studio-root");if(!u)return;Cs.createRoot(u).render(n.jsx(ks.StrictMode,{children:n.jsx(Fs,{})}))};if(document.readyState==="complete"||document.readyState==="interactive"){pe();return}document.addEventListener("DOMContentLoaded",pe,{once:!0})}Ms();
