import{r as $,j as d,c as Qs,R as ei}from"./editing-BTZOiJLl.js";import"./vendor-CRB3T2We.js";const fa="http://www.w3.org/2000/svg",ti="http://www.w3.org/1999/xlink";let ga=class{constructor(i,o={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",i),this.svg=i,this.options={onImageChange:o.onImageChange||null,onTextChange:o.onTextChange||null,...o};const l=document&&document.body&&document.body.dataset?document.body.dataset:{},c=(l.imageReplacementMode||"").toLowerCase();let g="full";c==="panel-only"||c==="disabled"?g=c:l.allowImageReplacement==="false"&&(g="disabled"),this.imageReplacementMode=g,this.allowCanvasImageTools=g!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const i=this.svg.dataset.svgData;if(i)try{const o=JSON.parse(i);this.changeableImages=o.changeable_images||[],this.textElements=o.text_elements||[]}catch(o){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",o)}}readDatasetTokens(i){return!i||!i.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(l=>i.dataset[l]).filter(l=>typeof l=="string"&&l.trim()!=="").map(l=>l.trim().toLowerCase())}findImageContentNode(i){return!i||typeof i.querySelector!="function"?null:i.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(i){if(!i)return!1;const o=typeof i.tagName=="string"?i.tagName.toLowerCase():"";if(o==="image"||o==="img"||this.readDatasetTokens(i).some(c=>c==="image"||c==="photo"||c==="graphic")||typeof i.hasAttribute=="function"&&(i.hasAttribute("data-editable-image")||i.hasAttribute("data-changeable-image")))return!0;if(i.classList){for(const c of this.imageClassTokens)if(i.classList.contains(c))return!0}return o==="foreignobject"?!!this.findImageContentNode(i):!1}resolveImageNode(i){if(!i)return null;if(this.nodeRepresentsImage(i))return i;if(typeof i.closest=="function"){const o=i.closest("[data-preview-node]");if(o&&o!==i&&this.nodeRepresentsImage(o))return o}return this.findImageContentNode(i)}resolveImageHandleNodes(i){const o=this.resolveImageNode(i);return o?{interactionNode:typeof o.closest=="function"&&o.closest("foreignObject")||o,contentNode:o}:null}applyImageSourceToNode(i,o){if(!i||!o)return null;const l=typeof i.tagName=="string"?i.tagName.toLowerCase():"";if(l==="image")return i.setAttributeNS(ti,"href",o),i.setAttribute("href",o),i.dataset&&(i.dataset.src=o),i;if(l==="img")return i.setAttribute("src",o),i.dataset&&(i.dataset.src=o),i;if(l==="foreignobject"){const c=this.findImageContentNode(i);return c&&c!==i?this.applyImageSourceToNode(c,o):null}return l==="rect"?this.convertRectToImage(i,o):(i.style&&typeof i.style.setProperty=="function"&&(i.style.backgroundImage=`url('${o}')`),i.dataset&&(i.dataset.src=o,i.dataset.replacedImage="true"),i)}convertRectToImage(i,o){if(!i||!i.parentNode)return null;const l=document.createElementNS(fa,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(g=>{i.hasAttribute&&i.hasAttribute(g)&&l.setAttribute(g,i.getAttribute(g))}),Array.from(i.attributes||[]).forEach(g=>{(g.name==="id"||g.name.startsWith("data-"))&&l.setAttribute(g.name,g.value)}),i.classList&&i.classList.length&&i.classList.forEach(g=>l.classList.add(g)),l.setAttribute("href",o),l.setAttributeNS(ti,"href",o),l.hasAttribute("preserveAspectRatio")||l.setAttribute("preserveAspectRatio","xMidYMid slice"),i.parentNode.replaceChild(l,i),l}escapeSelector(i){return typeof i!="string"||!i.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(i):i.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(i){if(!i||typeof i!="object")return null;const o=i.id||i.element_id||i.node_id;if(o){const c=`#${this.escapeSelector(o)}`,g=this.svg.querySelector(c);if(g)return g}const l=i.selector||i.css_selector;if(l)try{const c=this.svg.querySelector(l);if(c)return c}catch(c){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",l,c)}return null}collectImageCandidates(){const i=new Set;return this.changeableImages.forEach(l=>{const c=this.resolveNodeFromMetadata(l);c&&i.add(c)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(l=>{i.add(l)}),Array.from(i)}getBBoxSafe(i){if(!i||typeof i.getBBox!="function")return null;try{return i.getBBox()}catch(o){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",o,i),null}}toSvgPoint(i,o){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const l=this.svg.createSVGPoint();l.x=i,l.y=o;const c=this.svg.getScreenCTM();return c?l.matrixTransform(c.inverse()):null}setupImageHandlers(){const i=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",i.length,"changeable image elements"),!this.allowCanvasImageTools){i.forEach(o=>{const l=this.resolveImageHandleNodes(o);if(!l)return;const{interactionNode:c}=l;if(c.style.cursor="default",c.classList.remove("svg-changeable-image"),c.classList.remove("changeable-image-hover"),c._boundingBox){try{c._boundingBox.remove()}catch{}c._boundingBox=null}});return}setTimeout(()=>{i.forEach((o,l)=>{const c=this.resolveImageHandleNodes(o);if(!c)return;const{interactionNode:g,contentNode:N}=c;if(!g||g.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",l,g),g.__inkwiseSvgImageBound=!0,g.__inkwiseImageContent=N||g,g.style.cursor="pointer",g.classList.add("svg-changeable-image"),g.classList.add("changeable-image-hover"),g.addEventListener("mouseenter",()=>{g.classList.add("changeable-image-active")}),g.addEventListener("mouseleave",()=>{g.classList.remove("changeable-image-active")}),g.addEventListener("click",I=>{I.preventDefault(),this.showImageUploadDialog(g)});const w=this.createBoundingBox(g);w&&(g._boundingBox=w),this.makeDraggable(g)})},200)}createBoundingBox(i){const o=this.getBBoxSafe(i);if(!o)return null;const l=document.createElementNS(fa,"g");l.classList.add("svg-bounding-box");const c=document.createElementNS(fa,"rect");return c.classList.add("svg-bounding-box__rect"),c.setAttribute("fill","none"),c.setAttribute("stroke","#007cba"),c.setAttribute("stroke-width","2"),c.setAttribute("stroke-dasharray","5,5"),c.setAttribute("rx","3"),c.style.pointerEvents="none",l.appendChild(c),this.createResizeHandles().forEach(N=>l.appendChild(N)),this.svg.appendChild(l),this.positionBoundingElements(l,o),l}createResizeHandles(){const i=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(l=>{const c=document.createElementNS(fa,"circle");c.setAttribute("r","4"),c.setAttribute("fill","#007cba"),c.setAttribute("stroke","#ffffff"),c.setAttribute("stroke-width","1"),c.classList.add("resize-handle",`handle-${l.name}`),c.style.pointerEvents="all",c.style.cursor=`${l.name}-resize`,i.push(c)}),i}positionBoundingElements(i,o){if(!i||!o)return;const l=i.querySelector(".svg-bounding-box__rect");if(!l)return;const c=5,g=o.x-c,N=o.y-c,w=o.width+c*2,I=o.height+c*2;l.setAttribute("x",g),l.setAttribute("y",N),l.setAttribute("width",Math.max(w,0)),l.setAttribute("height",Math.max(I,0)),i.querySelectorAll(".resize-handle").forEach(L=>{L.classList.contains("handle-nw")?(L.setAttribute("cx",g),L.setAttribute("cy",N)):L.classList.contains("handle-ne")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N)):L.classList.contains("handle-sw")?(L.setAttribute("cx",g),L.setAttribute("cy",N+I)):L.classList.contains("handle-se")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N+I)):L.classList.contains("handle-n")?(L.setAttribute("cx",g+w/2),L.setAttribute("cy",N)):L.classList.contains("handle-s")?(L.setAttribute("cx",g+w/2),L.setAttribute("cy",N+I)):L.classList.contains("handle-e")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N+I/2)):L.classList.contains("handle-w")&&(L.setAttribute("cx",g),L.setAttribute("cy",N+I/2))})}updateBoundingBox(i){if(!i||!i._boundingBox)return;const o=this.getBBoxSafe(i);this.positionBoundingElements(i._boundingBox,o)}focusElementById(i){if(!i||!this.svg)return!1;const o=`#${this.escapeSelector(i)}`;let l=null;try{l=this.svg.querySelector(o)}catch(w){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",i,w),!1}if(l||(l=this.svg.querySelector(`[data-element-id="${i}"]`)),!l)return!1;const g=(this.resolveImageHandleNodes(l)||{interactionNode:l}).interactionNode||l;return this.getBBoxSafe(g)?(this.updateBoundingBox(g),g._boundingBox&&(g._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{g._boundingBox&&g._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof g.scrollIntoView=="function"&&g.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),g.classList.add("changeable-image-active"),setTimeout(()=>g.classList.remove("changeable-image-active"),1200),!0):!1}makeDraggable(i){let o=!1,l=0,c=0,g=0,N=0,w=0,I=0;const ie=O=>{if(O.target.closest(".resize-handle"))return;const G=this.toSvgPoint(O.clientX,O.clientY);if(!G)return;const X=this.getBBoxSafe(i);if(!X)return;const ce=typeof i.getAttribute=="function",ee=typeof i.setAttribute=="function";l=ce?parseFloat(i.getAttribute("x")):X.x,c=ce?parseFloat(i.getAttribute("y")):X.y,Number.isNaN(l)&&(l=X.x,ee&&i.setAttribute("x",l)),Number.isNaN(c)&&(c=X.y,ee&&i.setAttribute("y",c)),g=G.x-l,N=G.y-c,w=l,I=c,o=!0,i.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",O.preventDefault()},L=O=>{if(!o)return;const G=this.toSvgPoint(O.clientX,O.clientY);G&&(w=G.x-g,I=G.y-N,typeof i.removeAttribute=="function"&&i.removeAttribute("transform"),typeof i.setAttribute=="function"&&(i.setAttribute("x",w),i.setAttribute("y",I)),this.updateBoundingBox(i),O.preventDefault())},q=O=>{if(!o)return;o=!1,i.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(i);const G=new CustomEvent("svgImageMoved",{detail:{element:i,x:w,y:I}});this.svg.dispatchEvent(G),O.preventDefault()};i.addEventListener("mousedown",ie),document.addEventListener("mousemove",L),document.addEventListener("mouseup",q),i._boundingBox&&i._boundingBox.querySelectorAll(".resize-handle").forEach(G=>{this.makeResizable(i,G)})}makeResizable(i,o){let l=!1,c=null,g=0,N=0,w=0,I=0,ie="",L=0;const q=X=>{const ce=this.toSvgPoint(X.clientX,X.clientY);if(!ce)return;const ee=this.getBBoxSafe(i);if(!ee)return;g=ee.width,N=ee.height;const U=typeof i.getAttribute=="function",D=typeof i.setAttribute=="function";w=U?parseFloat(i.getAttribute("x")):ee.x,I=U?parseFloat(i.getAttribute("y")):ee.y,Number.isNaN(w)&&(w=ee.x,D&&i.setAttribute("x",w)),Number.isNaN(I)&&(I=ee.y,D&&i.setAttribute("y",I)),L=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,c=ce,ie=Array.from(o.classList).find(Z=>Z.startsWith("handle-"))||"",l=!0,i.style.cursor=o.style.cursor,this.svg.style.cursor=o.style.cursor,document.body.style.userSelect="none",X.preventDefault(),X.stopPropagation()},O=X=>{if(!l)return;const ce=this.toSvgPoint(X.clientX,X.clientY);if(!ce)return;const ee=ce.x-c.x,U=ce.y-c.y;let D=g,Z=N,ae=w,ge=I;switch(ie){case"handle-se":D=g+ee,Z=N+U;break;case"handle-sw":D=g-ee,Z=N+U,ae=w+ee;break;case"handle-ne":D=g+ee,Z=N-U,ge=I+U;break;case"handle-nw":D=g-ee,Z=N-U,ae=w+ee,ge=I+U;break}D=Math.max(20,D),Z=Math.max(20,Z);const Ce=i.tagName.toLowerCase();if((Ce==="image"||Ce==="rect")&&typeof i.setAttribute=="function")i.setAttribute("width",D),i.setAttribute("height",Z),i.setAttribute("x",ae),i.setAttribute("y",ge);else{const xe=Math.max(1,g),Ae=Math.max(1,N),tt=D/xe,K=Z/Ae,Be=Math.max(tt,K),$e=Math.max(6,L*Be);typeof i.setAttribute=="function"&&i.setAttribute("font-size",$e)}this.updateBoundingBox(i),X.preventDefault(),X.stopPropagation()},G=X=>{if(!l)return;l=!1,i.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const ce={element:i,width:parseFloat(i.getAttribute?i.getAttribute("width"):"")||g,height:parseFloat(i.getAttribute?i.getAttribute("height"):"")||N,x:parseFloat(i.getAttribute?i.getAttribute("x"):"")||w,y:parseFloat(i.getAttribute?i.getAttribute("y"):"")||I},ee=new CustomEvent("svgImageResized",{detail:ce});this.svg.dispatchEvent(ee),X.preventDefault(),X.stopPropagation()};o.addEventListener("mousedown",q),document.addEventListener("mousemove",O),document.addEventListener("mouseup",G)}setupTextHandlers(){const i=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(l=>{l.style.cursor="pointer",l.classList.add("svg-editable-text"),l.addEventListener("click",function(c){c.preventDefault(),i.showTextEditDialog(l)}),l.addEventListener("mouseenter",function(){l.classList.add("editable-text-hover")}),l.addEventListener("mouseleave",function(){l.classList.remove("editable-text-hover")})})}showImageUploadDialog(i){const o=this,l=document.createElement("input");l.type="file",l.accept="image/*",l.style.display="none",l.addEventListener("change",function(c){const g=c.target.files[0];g&&o.handleImageUpload(g,i),l.parentNode&&l.parentNode.removeChild(l)}),document.body.appendChild(l),l.click()}async handleImageUpload(i,o){var L;const l=this,c=o&&o.__inkwiseImageContent?o.__inkwiseImageContent:o,g=((L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.getAttribute("content"))||null,N=new FormData;N.append("image",i),g&&N.append("_token",g);let w=null;try{const q=await fetch("/design/upload-image",{method:"POST",body:N,credentials:"same-origin"});if(!q.ok){const G=await q.text().catch(()=>"");throw new Error(`Upload failed (${q.status}): ${G}`)}const O=await q.json();w=O.url||O.path||null}catch(q){console.error("SvgTemplateEditor: Failed to upload image",q),alert("We could not upload your image. Please try again.");const O=new CustomEvent("svgImageUploadFailed",{detail:{error:q,file:i}});l.svg.dispatchEvent(O);return}if(!w){alert("Upload did not return a usable image URL.");return}const I=l.applyImageSourceToNode(c,w)||c;o&&I&&o.__inkwiseImageContent!==I&&(o.__inkwiseImageContent=I);const ie=new CustomEvent("svgImageChanged",{detail:{element:I,imageUrl:w,file:i}});l.svg.dispatchEvent(ie),l.options.onImageChange&&l.options.onImageChange(I,w,i),l.updateBoundingBox(o||I)}showTextEditDialog(i){const o=this,l=i.textContent||"",c=document.createElement("input");c.type="text",c.value=l,c.className="svg-text-editor";const g=i.getBoundingClientRect(),N=o.svg.getBoundingClientRect();c.style.position="absolute",c.style.left=g.left-N.left+"px",c.style.top=g.top-N.top+"px",c.style.width=Math.max(g.width,100)+"px",c.style.fontSize=window.getComputedStyle(i).fontSize,c.style.fontFamily=window.getComputedStyle(i).fontFamily,c.style.border="1px solid #007cba",c.style.padding="2px",c.style.background="white",c.style.zIndex="1000",i.style.visibility="hidden",o.svg.parentNode.appendChild(c),c.focus(),c.select();const w=function(){const I=c.value;for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(I)),i.style.visibility="visible",c.parentNode&&c.parentNode.removeChild(c);const ie=new CustomEvent("svgTextChanged",{detail:{element:i,oldText:l,newText:I}});o.svg.dispatchEvent(ie),o.options.onTextChange&&o.options.onTextChange(i,l,I)};c.addEventListener("blur",w),c.addEventListener("keydown",function(I){I.key==="Enter"?w():I.key==="Escape"&&(i.style.visibility="visible",c.parentNode&&c.parentNode.removeChild(c))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const i=document.createElement("style");i.id="svg-editor-styles",i.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(i)}getSvgString(){const i=this.svg.cloneNode(!0);i.querySelectorAll('.svg-bounding-box, .inkwise-editor-marker, [data-editor-only="true"]').forEach(c=>{var g;(g=c.parentNode)==null||g.removeChild(c)}),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.style.width="",i.style.height="",i.style.maxWidth="",i.style.maxHeight="",i.removeAttribute("preserveAspectRatio");const o=document.createElementNS(fa,"style");return o.id="inkwise-export-styles",o.textContent=`
            @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            text { white-space: pre; }
        `,i.insertBefore(o,i.firstChild),new XMLSerializer().serializeToString(i)}getSvgDataUrl(){const i=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))}async saveSvg(i,o="front"){const l=this.getSvgString();try{const c=await fetch(`/staff/templates/${i}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:l,side:o})});if(!c.ok){const N=await c.text().catch(()=>"");throw new Error(N||`Request failed with status ${c.status}`)}let g;try{g=await c.json()}catch(N){console.warn("SvgTemplateEditor: Failed to parse save response",N),g={success:!1,error:"Invalid response from server"}}return g}catch(c){return console.error("Failed to save SVG:",c),{success:!1,error:c.message}}}};function vr(){const W=()=>{const i=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",i.length,"SVGs with data-svg-editor attribute"),i.forEach((o,l)=>{o.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",l,"for SVG:",o),o.__inkwiseSvgTemplateEditor=new ga(o))})};if(document.readyState==="complete"||document.readyState==="interactive"?W():document.addEventListener("DOMContentLoaded",W,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const i=new MutationObserver(o=>{o.forEach(l=>{l.addedNodes.forEach(c=>{c.nodeType===1&&c.matches&&c.matches("svg[data-svg-editor]")&&(c.__inkwiseSvgTemplateEditor||(c.__inkwiseSvgTemplateEditor=new ga(c)))})})});i.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=i}}typeof window<"u"&&(window.SvgTemplateEditor=ga,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,vr()));function wr(W={}){const{collectSnapshot:i,routes:o={},statusLabel:l=null,statusDot:c=null,csrfToken:g=null,debounce:N=1200,onAfterSave:w=null}=W;if(typeof i!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let I=null,ie=null,L=null,q=null;const O=(U,D={})=>{const Z=c instanceof HTMLElement&&c.parentElement||l instanceof HTMLElement&&l.parentElement;if(Z instanceof HTMLElement&&(Z.classList.remove("topbar-status--saving","topbar-status--error","topbar-status--dirty"),U==="saving"?Z.classList.add("topbar-status--saving"):U==="error"?Z.classList.add("topbar-status--error"):U==="dirty"&&Z.classList.add("topbar-status--dirty")),c instanceof HTMLElement&&c.setAttribute("data-state",U),l instanceof HTMLElement)switch(U){case"saving":l.textContent="Savingâ€¦";break;case"dirty":l.textContent="Unsaved changes";break;case"error":l.textContent="Save failed";break;case"saved":{const ge=(D.timestamp instanceof Date?D.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});l.textContent=`Saved ${ge}`;break}default:l.textContent="Saved";break}},G=async U=>{const D=o.autosave;if(!D)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const Z=JSON.stringify(U);console.debug("[Autosave] sendRequest",{endpoint:D,payloadSize:typeof Z=="string"?Z.length:null});const ae=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...g?{"X-CSRF-TOKEN":g}:{}},credentials:"same-origin",body:Z});if(!ae.ok){const ge=await ae.text().catch(()=>null);console.error("[Autosave] sendRequest non-OK response",{status:ae.status,body:ge});const Ce=new Error(`Autosave responded with ${ae.status}`);throw Ce.status=ae.status,Ce.responseText=ge,Ce}try{return await ae.json()}catch(ge){return console.warn("[Autosave] sendRequest JSON parse failed, returning empty object.",ge),{}}},X=async U=>{var Z;if(console.log("[Autosave] Saving",U),L)try{await L}catch{}ie=null,O("saving");let D;try{D=await i(U)}catch(ae){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",ae),O("error"),ae}if(!D||typeof D!="object")return O("saved",{timestamp:new Date}),null;try{const ge=JSON.stringify(D).length,Ce=(W==null?void 0:W.maxPayloadSize)||5e5;ge>Ce&&(console.warn("[Autosave] Snapshot exceeds size threshold; attempting to trim payload",{size:ge,threshold:Ce}),D.preview&&(delete D.preview.image,delete D.preview.images),D.design&&D.design.sides&&typeof D.design.sides=="object"&&Object.keys(D.design.sides).forEach(xe=>{const Ae=D.design.sides[xe]||{};typeof Ae.svg=="string"&&Ae.svg.length>0&&(Ae.svg=Ae.svg.replace(/data:image\/(png|jpeg|jpg|webp);base64,[A-Za-z0-9+/=\n\r]+/g,""),D.design.sides[xe]=Ae)}),Array.isArray((Z=D.design)==null?void 0:Z.images)&&(D.design.images=D.design.images.map(xe=>{const Ae=Object.assign({},xe);return Ae.href&&typeof Ae.href=="string"&&Ae.href.startsWith("data:image/")&&(Ae.href=null),Ae})),D._autosave_trimmed=!0,console.debug("[Autosave] Snapshot trimmed for autosave",{newSize:JSON.stringify(D).length}))}catch(ae){console.warn("[Autosave] Failed to trim snapshot for size",ae)}L=G(D);try{const ae=await L;if(q=new Date,O("saved",{timestamp:q}),typeof w=="function")try{w(ae,D)}catch(ge){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",ge)}return ae}catch(ae){throw console.error("[InkWise Studio] Autosave request failed.",ae),O("error"),ae}finally{L=null}};return{schedule:(U="change")=>{console.log("[Autosave] Scheduling",U),ie=U,I&&clearTimeout(I),O("dirty"),I=window.setTimeout(()=>{I=null,X(ie).catch(()=>{})},N)},flush:async(U="flush")=>(I&&(clearTimeout(I),I=null),L&&await L,ie!==null?X(U):null),isSaving:()=>!!L,getLastSavedAt:()=>q,notifyError:()=>O("error"),markDirty:()=>O("dirty")}}function xr(W,i,o){if(!i||typeof i!="string")return!1;const l=(W||"front").toString().toLowerCase(),c=i.toString().toLowerCase();return!(l===c||o)}function Sr(W){const i=typeof document<"u"?document.getElementById("upload-side-label"):null,o=typeof document<"u"?document.getElementById("upload-button"):null,l=typeof W=="string"&&W.length?W.charAt(0).toUpperCase()+W.slice(1):"Front";return i&&(i.textContent=l),o&&o.setAttribute("aria-label",`Upload image for: ${l}`),l}function kr(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const W=()=>{var Ms,Rs,Ps;const i=document.querySelectorAll("[data-preview-target]"),o=document.querySelector(".preview-card-bg"),l=document.getElementById("preview-svg"),c=document.querySelectorAll("[data-card-thumb]"),g=document.querySelectorAll("[data-card-view]"),N=document.getElementById("extraPreviewContainer"),w=document.getElementById("textFieldList"),I=document.querySelector("[data-add-text-field]"),ie=document.querySelectorAll(".sidenav-btn"),L=document.querySelector(".canvas-stage"),q="http://www.w3.org/2000/svg",O=document.querySelector(".canvas-measure-horizontal .measure-value"),G=document.querySelector(".canvas-measure-vertical .measure-value"),X=document.querySelector(".preview-canvas-wrapper");let ce=1;const ee=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),U=e=>!e||!e.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(a=>e.dataset[a]).filter(a=>typeof a=="string"&&a.trim()!=="").map(a=>a.trim().toLowerCase()),D=e=>!e||typeof e.querySelector!="function"?null:e.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image'),Z=e=>{if(!e)return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="image"||t==="img"||U(e).some(s=>s==="image"||s==="photo"||s==="graphic")||typeof e.hasAttribute=="function"&&(e.hasAttribute("data-editable-image")||e.hasAttribute("data-changeable-image")))return!0;if(e.classList){for(const s of ee)if(e.classList.contains(s))return!0}return!!(t==="foreignobject"&&D(e))},ae=e=>{if(!e||Z(e))return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="style"||t==="script"||t==="defs"||t==="title"||t==="metadata")return!1;if(t==="text"||t==="tspan"||U(e).some(n=>n.includes("text")||n==="names"||n==="heading"))return!0;const s=(e.textContent||"").trim();return!(!s||/\{[^}]*\}|;/.test(s)&&s.length>80)},ge=e=>{if(!e)return"";const t=e.querySelectorAll("tspan");return t&&t.length>0?vt(Array.from(t).map(a=>a.textContent||"").join(`
`)):vt(e.textContent||"")},Ce=(e,t)=>{if(!e)return;const a=vt(t),s=e.querySelectorAll("tspan");if(s&&s.length>0){const r=String(a??"").split(/\r?\n/);s.forEach((n,u)=>{n.textContent=r[u]??""})}else e.textContent=a??"";e.dataset&&(e.dataset.currentText=a??"")},xe=e=>{if(!e)return null;if(Z(e))return e;if(typeof e.closest=="function"){const a=e.closest("[data-preview-node]");if(a&&a!==e&&Z(a))return a}const t=D(e);return t||null},Ae=(e,t)=>{if(!e||!t)return!1;const a=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(a==="image")return e.setAttributeNS("http://www.w3.org/1999/xlink","href",t),e.setAttribute("href",t),e.dataset.src=t,!0;if(a==="img")return e.setAttribute("src",t),e.dataset.src=t,!0;if(a==="foreignobject"){const s=D(e);return s&&s!==e?Ae(s,t):!1}return e.style&&(e.style.backgroundImage=`url('${t}')`),e.dataset&&(e.dataset.src=t,e.dataset.replacedImage="true"),!0},tt=e=>{if(!e||typeof e.insertBefore!="function"||e.querySelector('[data-inkwise-bg="true"]'))return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#ffffff"),a.setAttribute("data-inkwise-bg","true"),e.insertBefore(a,e.firstChild)},K=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{};console.log("[InkWise Studio] Bootstrap payload:",K);const Be=(K==null?void 0:K.routes)??{};console.log("[InkWise Studio] Routes:",Be);const $e=((Ms=document.querySelector('meta[name="csrf-token"]'))==null?void 0:Ms.getAttribute("content"))||((Rs=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:Rs.getAttribute("content"))||null,ma=document.querySelector(".topbar-status-label"),Ct=document.querySelector(".topbar-status-dot"),ot=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},Mt=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},Rt=e=>{var n,u;if(!o)return null;const t=window.getComputedStyle(o),s=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(s&&s[2])return s[2];const r=e?`${e}Image`:null;return r&&((n=o.dataset)!=null&&n[r])?o.dataset[r]:((u=o.dataset)==null?void 0:u.frontImage)||null},Pt=e=>{!e||!M||(e.texts&&Array.isArray(e.texts)&&e.texts.forEach(t=>{const{key:a,value:s,fontFamily:r,fontSize:n,color:u}=t,f=M.querySelector(`[data-preview-node="${a}"]`);if(f){if(s!==void 0){Ce(f,s);const p=document.querySelector(`input[data-preview-target="${a}"]`);p&&(p.value=s)}if(r){f.setAttribute("font-family",r),f.style.fontFamily=r;try{f.dataset.fontFamily=r}catch{}}if(n){f.setAttribute("font-size",n),f.style.fontSize=n;try{f.dataset.fontSize=n}catch{}}if(u){f.setAttribute("fill",u),f.style.fill=u;try{f.dataset.color=u}catch{}}}}),e.images&&Array.isArray(e.images)&&e.images.forEach(t=>{const{key:a,href:s,x:r,y:n,width:u,height:f}=t,p=M.querySelector(`[data-preview-node="${a}"]`);p&&(s&&(p.setAttribute("href",s),p.setAttribute("xlink:href",s)),r!==void 0&&p.setAttribute("x",r),n!==void 0&&p.setAttribute("y",n),u!==void 0&&p.setAttribute("width",u),f!==void 0&&p.setAttribute("height",f))}))},ha=()=>w?Array.from(w.querySelectorAll("input[data-preview-target]")).map(e=>{var p,v;const t=e.closest(".text-field-item"),a=((v=(p=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:p.textContent)==null?void 0:v.trim())||e.dataset.previewTarget||"",s=e.dataset.previewTarget||"",r=M==null?void 0:M.querySelector(`[data-preview-node="${s}"]`);let n=null,u=null,f=null;return r&&(n=r.getAttribute("font-family")||r.style.fontFamily||r.dataset.fontFamily,u=r.getAttribute("font-size")||r.style.fontSize||r.dataset.fontSize,f=r.getAttribute("fill")||r.style.fill||r.dataset.color),{key:s,label:a,value:e.value||"",defaultValue:e.dataset.defaultValue||"",fontFamily:n,fontSize:u,color:f}}):[],lt=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const a=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return a?parseFloat(a[0]):Number.NaN}return Number.NaN},zt=e=>{if(!e)return null;if(typeof e=="string"){const p=e.trim();if(!p)return null;try{const v=JSON.parse(p);return zt(v)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((p,v)=>v&&typeof v=="object"?Object.assign(p,v):p,{}):Object.assign({},e),a=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,s=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,r=lt(a),n=lt(s);if(!Number.isFinite(r)||r<=0||!Number.isFinite(n)||n<=0)return null;const u=t.shape??t.Shape??t.canvasShape??null,f=t.unit??t.Unit??t.canvasUnit??null;return{width:r,height:n,shape:typeof u=="string"&&u.trim()!==""?u.trim():null,unit:typeof f=="string"&&f.trim()!==""?f.trim():"px"}},Ge=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},ya=zt(X==null?void 0:X.dataset);let Y=zt(((Ps=K==null?void 0:K.template)==null?void 0:Ps.canvas)??null)||ya||null;const Ne=720,$t=920,Dt=new Map;let qe=null;const Te=new Map,at=new Map;let qt=null,Se=null,M=null,ea=null,Wt=()=>{},ke="front",st=null,it=null,E=null,It=null,be=null,he=null,We=!1,Oe=null;const Xe=[],ct=[],Le=50;let bt=!0;const dt=()=>{if(!bt||!M)return;const t=new XMLSerializer().serializeToString(M);Xe.length>0&&Xe[Xe.length-1]===t||(Xe.push(t),ct.length=0,Xe.length>Le&&Xe.shift(),Me())},ze=()=>{if(Xe.length<2)return;const t=new XMLSerializer().serializeToString(M);ct.push(t);const a=Xe.pop();Ot(a),Me()},ta=()=>{if(ct.length===0)return;const t=new XMLSerializer().serializeToString(M);Xe.push(t);const a=ct.pop();Ot(a),Me()},Ot=e=>{if(!M||!e)return;const t=bt;bt=!1;try{const s=new DOMParser().parseFromString(e,"image/svg+xml").documentElement;for(;M.firstChild;)M.removeChild(M.firstChild);for(;s.firstChild;)M.appendChild(s.firstChild.cloneNode(!0));for(let r of s.attributes)M.setAttribute(r.name,r.value);M.__inkwiseSvgTemplateEditor&&(M.__inkwiseSvgTemplateEditor=null),M.setAttribute("data-svg-editor","true"),M.__inkwiseSvgTemplateEditor=new ga(M,{onTextChange:(r,n,u)=>{dt(),E&&E.schedule("text-change")},onImageChange:(r,n,u)=>{dt(),E&&E.schedule("image-change")}}),ea=M.__inkwiseSvgTemplateEditor,updatePreview()}catch(a){console.error("Failed to restore SVG state:",a)}finally{bt=t}},Me=()=>{const e=document.querySelector('button[aria-label="Undo"]'),t=document.querySelector('button[aria-label="Redo"]');e&&(e.disabled=Xe.length<2),t&&(t.disabled=ct.length===0)},Ut=8,ba=4,vt=e=>{const a=(e||"").toString().trim();return/::before|\{[^}]*\}|;/.test(a)&&a.length>120?"":a},va=e=>{if(!e||e==="front"||e!=="back")return!0;if(!o)return!1;if(it)return!0;const t=o.dataset||{};return t.hasBack==="true"?!0:!!(t.backImage||t.backSvg)},aa=async e=>{if(!e||typeof e!="string")return null;if(e.startsWith("data:"))return e;try{const t=new Image;if(t.crossOrigin="anonymous",await new Promise(s=>{t.onload=()=>s(!0),t.onerror=()=>s(!1);const r=e.includes("?")?"&":"?";t.src=e+r+"_t="+Date.now()})&&t.naturalWidth>0&&t.naturalHeight>0){const s=document.createElement("canvas");s.width=t.naturalWidth,s.height=t.naturalHeight,s.getContext("2d").drawImage(t,0,0);try{const n=s.toDataURL("image/png");if(n&&n!=="data:,")return n}catch{console.warn("[InkWise Studio] Canvas tainted, trying fetch approach:",e)}}}catch(t){console.warn("[InkWise Studio] Canvas approach failed:",e,t)}try{const t=await fetch(e,{credentials:"include",mode:"cors"});if(!t.ok)return console.warn("[InkWise Studio] Failed to fetch image for base64 conversion:",e,t.status),null;const a=await t.blob();return new Promise(s=>{const r=new FileReader;r.onloadend=()=>s(r.result),r.onerror=()=>s(null),r.readAsDataURL(a)})}catch(t){console.warn("[InkWise Studio] Fetch approach also failed:",e,t)}try{const a=await(await fetch(e,{mode:"no-cors"})).blob();if(a.size>0)return new Promise(s=>{const r=new FileReader;r.onloadend=()=>s(r.result),r.onerror=()=>s(null),r.readAsDataURL(a)})}catch(t){console.warn("[InkWise Studio] No-cors fetch also failed:",e,t)}return null},sa=async e=>{[".svg-bounding-box",".resize-handle",".selection-indicator",".inkwise-selection",".inkwise-overlay",'[data-ui-element="true"]','[data-temp-element="true"]',"g.svg-bounding-box"].forEach(n=>{e.querySelectorAll(n).forEach(u=>u.remove())}),e.querySelectorAll("text").forEach(n=>{n.removeAttribute("contenteditable"),n.style.cursor="",n.style.userSelect=""}),e.querySelectorAll("image").forEach(n=>{n.style.cursor="",n.style.pointerEvents=""});const a=n=>{if(!n||n.startsWith("data:"))return n;try{const u=new URL(n,window.location.origin),f=[/\/InkWise-Web\/ink-wise\/public\/storage\//gi,/\/ink-wise\/public\/storage\//gi,/\/public\/storage\//gi];let p=u.pathname;for(const v of f)if(v.test(p)){p=p.replace(v,"/storage/");break}return u.pathname=p,(u.hostname==="localhost"||u.hostname==="127.0.0.1")&&(u.hostname=window.location.hostname,u.port=window.location.port,u.protocol=window.location.protocol),u.href}catch{return n}},s=e.querySelectorAll("image");console.log("[InkWise Studio] Found",s.length,"image elements to convert");const r=Array.from(s).map(async n=>{let u=n.getAttribute("href")||n.getAttribute("xlink:href")||n.getAttributeNS("http://www.w3.org/1999/xlink","href");if(console.log("[InkWise Studio] Processing image with href:",u),!u||u.startsWith("data:")){console.log("[InkWise Studio] Image already embedded or no href, skipping");return}const f=a(u);console.log("[InkWise Studio] Normalized URL:",f);const p=await aa(f);p?(console.log("[InkWise Studio] Successfully converted image to base64, length:",p.length),n.removeAttribute("href"),n.removeAttribute("xlink:href"),n.removeAttributeNS("http://www.w3.org/1999/xlink","href"),n.removeAttribute("data-src"),n.setAttribute("href",p),n.setAttribute("xlink:href",p),n.setAttributeNS("http://www.w3.org/1999/xlink","href",p),console.log("[InkWise Studio] Image href attributes updated to base64")):console.warn("[InkWise Studio] Failed to embed image, keeping original URL:",f)});await Promise.all(r),console.log("[InkWise Studio] All image conversions completed")},Ue=async(e,t=null)=>{var b,k,m;if(console.debug("[Autosave] collectDesignSnapshot called",{reason:e,side:t,currentSide:ke,hasCardBg:!!o}),!o)return console.debug("[Autosave] collectDesignSnapshot aborted: no cardBg"),null;const a=new Date,s=t||ke||"front";let r=M;if(t&&t!==ke){const x=o.dataset[`${t}Svg`]||"";if(x&&xs(x))try{let C="";if(x.startsWith("data:image/svg+xml")){const P=x.indexOf(","),re=P>=0?x.slice(0,P):x,se=P>=0?x.slice(P+1):"";if(/;base64/i.test(re))try{const H=se.replace(/\s+/g,"");C=typeof window<"u"&&typeof window.atob=="function"?window.atob(H):atob(H)}catch(H){try{C=decodeURIComponent(se)}catch(j){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",H,j),C=""}}else try{C=decodeURIComponent(se)}catch{C=se}}else{const P=await fetch(x,{cache:"no-store"});P.ok&&(C=await P.text())}if(C){const se=new DOMParser().parseFromString(C,"image/svg+xml").documentElement;se&&se.tagName==="svg"&&(r=se)}}catch(C){console.warn("[InkWise Studio] Failed to load SVG for side:",t,C)}}let n=null;if(r)try{const x=r.cloneNode(!0),C=(b=o==null?void 0:o.dataset)==null?void 0:b.canvasWidth,P=(k=o==null?void 0:o.dataset)==null?void 0:k.canvasHeight;C&&P&&(x.setAttribute("width",C),x.setAttribute("height",P),x.style.width=C+"px",x.style.height=P+"px"),x.setAttribute("preserveAspectRatio","xMidYMid meet"),await sa(x);let re=x.querySelector("style#inkwise-export-styles");re||(re=document.createElementNS(q,"style"),re.id="inkwise-export-styles",x.insertBefore(re,x.firstChild)),re.textContent=`
            @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            text { white-space: pre; }
          `,n=new XMLSerializer().serializeToString(x),n&&!/xmlns=/i.test(n)&&(n=n.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(x){console.warn("[InkWise Studio] Unable to serialize current SVG.",x),n=null}const u=n?Mt(n):Rt(s),f=ha(),p=f.filter(x=>{const C=(x.value||"").trim(),P=(x.defaultValue||"").trim();return C===""||P!==""&&C===P}).map(x=>x.label||x.key).map(x=>(x||"").trim()).filter((x,C,P)=>x!==""&&P.indexOf(x)===C),v=[];if(r){const x=new Set;r.querySelectorAll('image,img,[data-changeable="image"]').forEach(C=>{const P=C.getAttribute("href")||C.getAttribute("xlink:href")||C.getAttributeNS("http://www.w3.org/1999/xlink","href")||C.getAttribute("data-src");if(!P)return;const re=C.getAttribute("data-preview-node")||C.id||`image-${v.length+1}`;x.has(re)||(x.add(re),v.push({key:re,href:P,x:C.getAttribute("x")||null,y:C.getAttribute("y")||null,width:C.getAttribute("width")||null,height:C.getAttribute("height")||null}))})}const A=o?{width:ot(o.dataset.canvasWidth),height:ot(o.dataset.canvasHeight),unit:o.dataset.canvasUnit||null,shape:o.dataset.canvasShape||null}:null,h=u?[u]:[];return{design:{updated_at:a.toISOString(),sides:{[s]:{svg:n,preview:u}},texts:f,images:v,canvas:A,placeholders:p},preview:{image:u,images:h},svg_markup:n,placeholders:p,product_id:((m=K==null?void 0:K.product)==null?void 0:m.id)??null}},wa=(e={},t={})=>{var p,v;const a=e&&e.summary?e.summary:{},s=Array.isArray(a.previewImages)?a.previewImages.filter(Boolean):Array.isArray(a.preview_images)?a.preview_images.filter(Boolean):[],r=Array.isArray((p=t==null?void 0:t.preview)==null?void 0:p.images)?t.preview.images.filter(Boolean):[],n=s.length?s:r,u=a.previewImage||a.preview_image||a.preview||((v=t==null?void 0:t.preview)==null?void 0:v.image)||n[0]||null;if(!u&&!n.length)return;const f={templateName:a.productName||a.templateName||document.title||"Saved template",previewImage:u||"",previewImages:n.length?n:u?[u]:[],metadata:{template:{name:a.productName||a.templateName||"Saved template"}}};try{window.sessionStorage.setItem("inkwise-finalstep",JSON.stringify(f))}catch{}try{const A={id:null,name:f.templateName,preview:f.previewImage};window.sessionStorage.setItem("inkwise-saved-template",JSON.stringify(A)),window.savedCustomerTemplate=A}catch{}},xa=async e=>{var t,a,s;console.debug("[Autosave] collectSnapshotWithPersist invoked",{reason:e});try{const r=await Ue(e);try{const n=!!(r&&typeof r=="object"&&Object.keys(r).length),u=((t=r==null?void 0:r.design)==null?void 0:t.sides)??{},f=Object.keys(u),p=f.length?u[f[0]]:null,v=!!(p&&p.svg),A=((a=r==null?void 0:r.preview)==null?void 0:a.image)??(p==null?void 0:p.preview)??null,h=Array.isArray((s=r==null?void 0:r.preview)==null?void 0:s.images)?r.preview.images.length:0,b=(()=>{try{return JSON.stringify(r).length}catch{return null}})();console.debug("[Autosave] snapshot summary",{reason:e,hasDesign:n,sideKeys:f,hasSvg:v,previewImageExists:!!A,previewCount:h,jsonLength:b})}catch(n){console.debug("[Autosave] snapshot summary failed to compute",n)}return r}catch(r){return console.error("[Autosave] collectSnapshotWithPersist failed",r),null}},ia=async e=>{try{const t=await fetch("/design/load-autosave?side="+encodeURIComponent(e),{method:"GET",headers:{"X-CSRF-TOKEN":$e,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to load autosave data");return await t.json()}catch(t){return console.warn("[InkWise Studio] Failed to load autosave data for side:",e,t),null}},ut=e=>{E?E.schedule(e):typeof window<"u"&&window.inkwiseAutosaveController&&window.inkwiseAutosaveController.schedule(e)};try{E=wr({collectSnapshot:xa,routes:Be,csrfToken:$e,statusLabel:ma,statusDot:Ct,debounce:0,onAfterSave:(s,r)=>{try{wa(s,r)}catch{}}}),typeof window<"u"&&(window.inkwiseAutosaveController=E,window.forceAutosave=async(s="manual")=>{try{if(console.log("[Autosave] forceAutosave invoked",s),!window.inkwiseAutosaveController)return console.warn("[Autosave] Controller not available"),null;await window.inkwiseAutosaveController.flush(s),console.log("[Autosave] forceAutosave completed")}catch(r){throw console.error("[Autosave] forceAutosave failed",r),r}}),console.log("[InkWise Studio] Autosave initialized",E);const e=s=>{if(E)try{E.flush(s)}catch(r){console.debug("[InkWise Studio] Autosave flush skipped.",r)}},t=()=>{document.visibilityState==="hidden"&&e("visibility-hidden")},a=()=>{e("page-hide")};document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",a),window.addEventListener("beforeunload",a),It=window.setInterval(()=>{e("heartbeat")},6e4),window.addEventListener("unload",()=>{It&&(window.clearInterval(It),It=null),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",a),window.removeEventListener("beforeunload",a)}),setInterval(()=>{E&&(console.log("[InkWise Studio] Periodic autosave trigger"),E.schedule("periodic"))},1e4)}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),E=null}const Tt=async()=>{var m,x,C,P,re,se;console.log("[InkWise Studio] Building review save payload..."),console.log("[InkWise Studio] Bootstrap payload:",K),console.log("[InkWise Studio] Template in bootstrap:",K==null?void 0:K.template);const e=await Ue("proceed-review"),t=(e==null?void 0:e.design)||{},a=t.sides||{},s=Object.keys(a)[0],r=s?a[s]:null,n=JSON.parse(JSON.stringify(t||{})),u=(r==null?void 0:r.svg)||(e==null?void 0:e.svg_markup)||null,f=(r==null?void 0:r.preview)||((m=e==null?void 0:e.preview)==null?void 0:m.image)||Rt(s||"front")||null,p=(Array.isArray((x=e==null?void 0:e.preview)==null?void 0:x.images)?e.preview.images:[]).filter(fe=>typeof fe=="string"&&fe.trim()!=="");f&&!p.length&&p.push(f);const v=n.canvas||{},A=v.width??(o?ot(o.dataset.canvasWidth):null),h=v.height??(o?ot(o.dataset.canvasHeight):null),b=(()=>{var fe,H;try{if(!o)return null;const j=window.getComputedStyle(o);return(j==null?void 0:j.backgroundColor)||((fe=o.dataset)==null?void 0:fe.backgroundColor)||((H=o.style)==null?void 0:H.backgroundColor)||null}catch{return null}})(),k={design_svg:u,design_json:n,preview_image:f,preview_images:p,canvas_width:A,canvas_height:h,background_color:b,template_id:((C=K==null?void 0:K.template)==null?void 0:C.id)??(K==null?void 0:K.template_id)??null,order_item_id:((P=K==null?void 0:K.orderSummary)==null?void 0:P.order_item_id)??((re=K==null?void 0:K.orderSummary)==null?void 0:re.orderItemId)??((se=K==null?void 0:K.orderSummary)==null?void 0:se.item_id)??null};try{const H=JSON.stringify(k).length,j=7e5;H>j&&(console.warn("[InkWise Studio] Review payload too large; trimming before send",{size:H,reviewThreshold:j}),k.preview_image=null,typeof k.design_svg=="string"&&k.design_svg.length>0&&(k.design_svg=k.design_svg.replace(/data:image\/(png|jpeg|jpg|webp);base64,[A-Za-z0-9+/=\n\r]+/g,"")),k._trimmed_for_review=!0,console.debug("[InkWise Studio] Review payload trimmed; new size estimate",JSON.stringify(k).length))}catch(fe){console.warn("[InkWise Studio] Failed to measure/trim review payload",fe)}return console.log("[InkWise Studio] Built payload:",k),console.log("[InkWise Studio] Template ID:",k.template_id),k},Sa=async(e,t)=>{var k,m;const a=(e==null?void 0:e.design)||{},r=(a.sides||{})[t]||null,n=JSON.parse(JSON.stringify(a||{})),u=(r==null?void 0:r.svg)||(e==null?void 0:e.svg_markup)||null,f=(r==null?void 0:r.preview)||((k=e==null?void 0:e.preview)==null?void 0:k.image)||Rt(t)||null,p=(Array.isArray((m=e==null?void 0:e.preview)==null?void 0:m.images)?e.preview.images:[]).filter(x=>typeof x=="string"&&x.trim()!=="");f&&!p.length&&p.push(f);const v=n.canvas||{},A=v.width??(o?ot(o.dataset.canvasWidth):null),h=v.height??(o?ot(o.dataset.canvasHeight):null),b=(()=>{var x,C;try{if(!o)return null;const P=window.getComputedStyle(o);return(P==null?void 0:P.backgroundColor)||((x=o.dataset)==null?void 0:x.backgroundColor)||((C=o.style)==null?void 0:C.backgroundColor)||null}catch{return null}})();return{design_svg:u,design_json:n,preview_image:f,preview_images:p,canvas_width:A,canvas_height:h,background_color:b}},Ye=document.querySelector('[data-action="proceed-review"]');if(Ye){const e=Ye.dataset.destination||Be.review||Ye.getAttribute("href")||window.location.href,t=Be.saveReview||Be.reviewSave||Be.review_design||Be.reviewDesign||null;Ye.addEventListener("click",async a=>{var n,u;if(a.preventDefault(),Ye.dataset.navigating==="1")return;Ye.dataset.navigating="1",Ye.disabled=!0;const s=()=>{window.location.href=e},r=()=>{Ye.disabled=!1,Ye.dataset.navigating="0"};try{console.log("[InkWise Studio] Proceeding to review..."),E&&await E.flush("navigate");const f=await Tt();if(console.log("[InkWise Studio] Payload built:",f),!f.template_id){const A=((n=K==null?void 0:K.product)==null?void 0:n.template_id)??((u=K==null?void 0:K.product)==null?void 0:u.id)??null;if(A)f.template_id=A,console.warn("[InkWise Studio] Missing template_id in payload; using fallback from product:",A);else throw console.error("[InkWise Studio] Missing template_id in payload and no fallback available:",f,K),new Error("Missing template identifier.")}if(!t)throw new Error("Save endpoint unavailable.");const p={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};$e&&(p["X-CSRF-TOKEN"]=$e),console.log("[InkWise Studio] Saving to review endpoint",{reviewSaveUrl:t,csrfTokenPresent:!!$e}),console.log("[InkWise Studio] Headers:",p),console.log("[InkWise Studio] Payload preview:",{template_id:f.template_id,design_svg_length:typeof f.design_svg=="string"?f.design_svg.length:null,preview_image_exists:!!f.preview_image,canvas_width:f.canvas_width,canvas_height:f.canvas_height});const v=await fetch(t,{method:"POST",headers:p,credentials:"same-origin",body:JSON.stringify(f)});if(!v.ok){const A=await v.text().catch(()=>"");throw console.error("[InkWise Studio] Review save failed response",{status:v.status,body:A}),new Error(`Save failed (${v.status}): ${A}`)}try{const A=await Ue("proceed-review","back");if(A){const h=await Sa(A,"back");await fetch("/design/save-to-review",{method:"POST",headers:p,credentials:"same-origin",body:JSON.stringify(h)})}}catch(A){console.warn("[InkWise Studio] Failed to save to REVIEW2",A)}s()}catch(f){console.error("[InkWise Studio] Unable to save before navigating.",f),E&&E.notifyError(),alert("We could not save your latest design. Please try again before continuing."),r()}})}const ft=document.getElementById("save-template-btn");ft&&ft.addEventListener("click",async e=>{if(e.preventDefault(),ft.disabled)return;const t=prompt("Enter a name for your template:");if(!(!t||t.trim()==="")){ft.disabled=!0,ft.textContent="Savingâ€¦";try{E&&await E.flush("save-template");const a=await Ue("save-template"),s=Object.assign({},a&&a.design?a.design:{}),r=o&&o.dataset.hasBack==="true",n=n||"front",u=n==="front"?"back":"front";if(r&&!s.sides[u]){const m=await Ue("save-template",u);m&&m.design&&m.design.sides&&m.design.sides[u]&&(s.sides=s.sides||{},s.sides[u]=m.design.sides[u])}const f=a&&Array.isArray(a.placeholders)?a.placeholders:[];s.placeholders=f,a&&a.product_id&&(s.product_id=a.product_id);const p=a&&a.preview&&a.preview.image||null,v=a&&a.preview&&Array.isArray(a.preview.images)?a.preview.images.filter(Boolean):[],A={template_name:t.trim(),design:s,preview_image:p,preview_images:v,placeholders:f,svg_markup:a.svg_markup},h={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};$e&&(h["X-CSRF-TOKEN"]=$e);try{const m=JSON.stringify(A);console.debug("[InkWise Studio] saveTemplate payload size",m.length);const x=7e5;m.length>x&&(console.warn("[InkWise Studio] saveTemplate payload too large; trimming",{size:m.length,saveThreshold:x}),A.preview_image=null,A.preview_images=[],A._trimmed_for_save=!0,typeof A.svg_markup=="string"&&(A.svg_markup=A.svg_markup.replace(/data:image\/(png|jpeg|jpg|webp);base64,[A-Za-z0-9+/=\n\r]+/g,"")),A.design&&A.design.sides&&Object.keys(A.design.sides).forEach(C=>{const P=A.design.sides[C];P&&typeof P.svg=="string"&&(P.svg=P.svg.replace(/data:image\/(png|jpeg|jpg|webp);base64,[A-Za-z0-9+/=\n\r]+/g,""),A.design.sides[C]=P)}),console.debug("[InkWise Studio] saveTemplate trimmed payload new size",JSON.stringify(A).length))}catch(m){console.warn("[InkWise Studio] Failed to measure/trim saveTemplate payload",m)}console.log("[InkWise Studio] Sending saveTemplate request to",Be.saveTemplate);const b=await fetch(Be.saveTemplate,{method:"POST",headers:h,credentials:"same-origin",body:JSON.stringify(A)});if(!b.ok){const m=await b.text().catch(()=>"");throw console.error("[InkWise Studio] saveTemplate failed response",{status:b.status,body:m}),new Error(`Server responded with ${b.status}: ${m}`)}const k=await b.json();alert(`Template "${k.template_name}" saved successfully!`)}catch(a){console.error("[InkWise Studio] Failed to save template.",a),alert("Failed to save template. Please try again.")}finally{ft.disabled=!1,ft.textContent="Save Template"}}});const Lt=e=>{const t=xe(e);if(!t)return;const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=s=>{const r=s.target.files&&s.target.files[0];if(!r)return;const n=new FileReader;n.onload=u=>{var v;const f=(v=u.target)==null?void 0:v.result;if(!f)return;Ae(t,f)&&(le(),ut("image-replace"))},n.readAsDataURL(r)},a.click()},rt=()=>o?((!qe||!qe.isConnected)&&(qe=document.createElement("div"),qe.className="canvas-overlay-layer",o.appendChild(qe)),qe):null,ra=()=>{Te.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),Te.clear(),at.clear(),qe&&(qe.innerHTML=""),be=null,he=null,la(),document.body.classList.remove("text-toolbar-visible"),ca()},pt=(e,t)=>{if(e==null)return t;const a=e.toString().split(/[\s,]+/).filter(Boolean);if(a.length===0)return t;const s=parseFloat(a[0]);return Number.isFinite(s)?s:t},Re=e=>{if(!o)return;const t=Te.get(e);if(!t||!t.overlay)return;const a=t.overlay,s=o.getBoundingClientRect(),r=e.getBoundingClientRect();if(s.width===0||s.height===0)return;const n=t.type==="text"?18:12,u=Math.max(n,r.width),f=Math.max(n,r.height);a.style.left=`${r.left-s.left}px`,a.style.top=`${r.top-s.top}px`,a.style.width=`${u}px`,a.style.height=`${f}px`},Da=()=>{Te.forEach((e,t)=>{Re(t)})},le=()=>{Te.size!==0&&(qt&&cancelAnimationFrame(qt),qt=window.requestAnimationFrame(()=>{qt=null,Da()}))},Ht=(e=3)=>{e<=0||requestAnimationFrame(()=>{le(),Ht(e-1)})};window.addEventListener("resize",le),document.addEventListener("scroll",le,!0),window.addEventListener("load",le);const S=(e,t)=>{const a=M||l;if(!a||typeof a.createSVGPoint!="function")return null;const s=a.createSVGPoint();s.x=e,s.y=t;const r=a.getScreenCTM();return r?s.matrixTransform(r.inverse()):null},F=(e,t,a)=>{const s=S(a.clientX,a.clientY);if(!s)return null;const{node:r}=e,n=r.getBBox?r.getBBox():{x:0,y:0,width:0,height:0},u={data:e,overlay:e.overlay,node:r,type:e.type,handle:t,mode:t?"resize":"move",pointerId:a.pointerId,startPoint:s,startClient:{x:a.clientX,y:a.clientY},initialBBox:n,moved:!1};if(e.type==="text"){u.fontSize=parseFloat(r.getAttribute("font-size"))||parseFloat(window.getComputedStyle(r).fontSize)||16,u.x=pt(r.getAttribute("x"),n.x);const f=n.y+n.height;u.y=pt(r.getAttribute("y"),f)}else u.x=pt(r.getAttribute("x"),n.x),u.y=pt(r.getAttribute("y"),n.y),u.width=pt(r.getAttribute("width"),Math.max(1,n.width)),u.height=pt(r.getAttribute("height"),Math.max(1,n.height));return u},te=(e,t,a)=>{if(e.type==="text"){const s=e.x+t,r=e.y+a;Number.isFinite(s)&&e.node.setAttribute("x",s),Number.isFinite(r)&&e.node.setAttribute("y",r)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+a)},ve=(e,t,a,s=!1)=>{if(e.type==="image"){let r=e.x,n=e.y,u=e.width,f=e.height;const p=["nw","ne","sw","se"].some(b=>e.handle===b),v=s||p,A=e.width/e.height;if(v&&p){const b=Math.abs(t),k=Math.abs(a);b>k?(e.handle.includes("e")?u=e.width+t:e.handle.includes("w")&&(u=e.width-t,r=e.x+t),f=u/A,e.handle.includes("n")&&(n=e.y+(e.height-f))):(e.handle.includes("s")?f=e.height+a:e.handle.includes("n")&&(f=e.height-a,n=e.y+a),u=f*A,e.handle.includes("w")&&(r=e.x+(e.width-u)))}else e.handle.includes("e")&&(u=e.width+t),e.handle.includes("w")&&(u=e.width-t,r=e.x+t),e.handle.includes("s")&&(f=e.height+a),e.handle.includes("n")&&(f=e.height-a,n=e.y+a);const h=4;u<h&&(r+=u-h,u=h),f<h&&(n+=f-h,f=h),e.node.setAttribute("x",r),e.node.setAttribute("y",n),e.node.setAttribute("width",u),e.node.setAttribute("height",f)}else if(e.type==="text"){const r=Math.max(1,e.initialBBox.width),n=Math.max(1,e.initialBBox.height);let u=0,f=0;e.handle.includes("e")?u=t:e.handle.includes("w")&&(u=-t),e.handle.includes("s")?f=a:e.handle.includes("n")&&(f=-a);const p=Math.max(4,r+u),v=Math.max(4,n+f),A=p/r,h=v/n,b=Math.max(A,h),k=Math.max(6,e.fontSize*b);e.node.setAttribute("font-size",k)}},_e=e=>{if(!Se||e.pointerId!==Se.pointerId)return;const t=S(e.clientX,e.clientY);if(!t)return;const a=t.x-Se.startPoint.x,s=t.y-Se.startPoint.y;!Se.moved&&(Math.abs(a)>.5||Math.abs(s)>.5)&&(Se.moved=!0),Se.mode==="move"?te(Se,a,s):ve(Se,a,s),le()},Ee=e=>{if(!Se||e.pointerId!==Se.pointerId)return;try{Se.overlay.releasePointerCapture(Se.pointerId)}catch{}Se.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",_e),document.removeEventListener("pointerup",Ee),document.removeEventListener("pointercancel",Ee);const t=Se;Se=null,le(),t.moved?ut("element-transform"):t.type==="text"?Wt(t.data.previewKey):t.type==="image"&&Lt(t.node)},Ze=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t||t.dataset.cropSessionActive==="true")return;const a=at.get(t);if(!a)return;a.type==="text"?St(a.previewKey||null):a.type==="image"&&kt(a.previewKey||null);const s=F(a,e.target.dataset.handle||null,e);if(s){e.preventDefault(),Se=s,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",_e),document.addEventListener("pointerup",Ee),document.addEventListener("pointercancel",Ee)}},Fe=e=>{const t=rt();if(!t)return null;let a=Te.get(e);if(a)return a;const s=Z(e)?"image":"text",r=e.getAttribute("data-preview-node")||"",n=document.createElement("div");return n.className=`editor-overlay editor-overlay--${s}`,n.dataset.previewNode=r,n.tabIndex=0,n.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(f=>{const p=document.createElement("div");p.className=`editor-overlay__handle editor-overlay__handle--${f}`,p.dataset.handle=f,n.appendChild(p)}),n.addEventListener("pointerdown",Ze),n.addEventListener("dblclick",()=>{s==="text"?Wt(r):s==="image"&&Lt(e)}),n.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),s==="text"?Wt(r):s==="image"&&Lt(e))}),t.appendChild(n),a={overlay:n,node:e,type:s,previewKey:r},Te.set(e,a),at.set(n,a),e.dataset.locked==="true"&&(n.classList.add("editor-overlay--locked"),n.style.pointerEvents="none"),la(),le(),a},Ke=(e,t,a={})=>{if(!o)return;const s=o.closest(".preview-canvas-wrapper"),r=Number(e),n=Number(t),u=a.persist===void 0?!0:!!a.persist,f=typeof a.unit=="string"&&a.unit?a.unit:(Y==null?void 0:Y.unit)??"px",p=typeof a.shape=="string"&&a.shape?a.shape:(Y==null?void 0:Y.shape)??null;if(!s||!Number.isFinite(r)||!Number.isFinite(n)||r<=0||n<=0)return;const v=Ne/r,A=$t/n,h=Math.min(1,v,A),b=Math.max(1,Math.round(r*h)),k=Math.max(1,Math.round(n*h));s.style.setProperty("--canvas-width",`${b}px`),s.style.setProperty("--canvas-height",`${k}px`),s.dataset.sourceWidth=r.toString(),s.dataset.sourceHeight=n.toString(),s.dataset.displayScale=h.toString(),s.dataset.canvasWidth=r.toString(),s.dataset.canvasHeight=n.toString(),s.dataset.canvasUnit=f,p&&(s.dataset.canvasShape=p),o.dataset.canvasWidth=r.toString(),o.dataset.canvasHeight=n.toString(),o.dataset.canvasUnit=f,p&&(o.dataset.canvasShape=p),l&&(l.setAttribute("viewBox",`0 0 ${r} ${n}`),l.setAttribute("preserveAspectRatio","xMidYMid meet")),M&&!M.getAttribute("viewBox")&&(M.setAttribute("viewBox",`0 0 ${r} ${n}`),M.setAttribute("preserveAspectRatio","xMidYMid meet")),L&&L.style.setProperty("--stage-width",`${b+112}px`),u&&(Y={width:r,height:n,unit:f,shape:p}),le()},Vt=(e,t,a,s=0)=>{O&&(Number.isFinite(e)?O.textContent=`${e.toFixed(s)}${a}`:O.textContent="â€”"),G&&(Number.isFinite(t)?G.textContent=`${t.toFixed(s)}${a}`:G.textContent="â€”")};Y&&(Ke(Y.width,Y.height,{unit:Y.unit,shape:Y.shape}),Vt(Ge(Y.width,Y.unit),Ge(Y.height,Y.unit),"in",2));const ka=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),a=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!a)return Number.NaN;const s=parseFloat(a[1]);if(!Number.isFinite(s))return Number.NaN;const r=t.match(/([a-z%]+)$/i);switch(r?r[1].toLowerCase():""){case"":case"px":return s;case"mm":return s*(96/25.4);case"cm":return s*(96/2.54);case"in":return s*96;case"pt":return s*(96/72);default:return s}},na=()=>!!(Y&&Number.isFinite(Y.width)&&Y.width>0&&Number.isFinite(Y.height)&&Y.height>0),qa=e=>{if(!e||na())return;if(Dt.has(e)){const a=Dt.get(e);if(a){const s=a.unit||"px";Ke(a.width,a.height,{unit:s,shape:Y==null?void 0:Y.shape}),Vt(Ge(a.width,s),Ge(a.height,s),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};Dt.set(e,a),Ke(a.width,a.height,{unit:a.unit,shape:Y==null?void 0:Y.shape}),Vt(Ge(a.width,a.unit),Ge(a.height,a.unit),"in",2),le()},t.onerror=()=>{Dt.set(e,null)},t.src=e},Wa={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},ii=document.querySelectorAll("[data-modal-close]"),ri=e=>{if(!e)return[];const t=new Map;let a=0;const s=(h,b,k="node")=>{let m=(h||"").toString().trim();m||(m=`${k}-${a+=1}`);let x=m,C=2;for(;t.has(x)&&t.get(x)!==b;)x=`${m}-${C}`,C+=1;return x},r=(h,b,k=null,m=null,x="node")=>{if(!h)return;const C=s(b,h,x);return h.setAttribute("data-preview-node",C),k&&!h.dataset.previewLabel&&(h.dataset.previewLabel=k),m&&!h.dataset.defaultText&&(h.dataset.defaultText=m),t.set(C,h),C};e.querySelectorAll("[data-preview-node]").forEach(h=>{var k,m;const b=h.getAttribute("data-preview-node");b&&r(h,b,((k=h.dataset)==null?void 0:k.previewLabel)||null,((m=h.dataset)==null?void 0:m.defaultText)||null,"node")});const u=[];e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(h=>{const b=h.getAttribute("data-layer-id");if(!b)return;const k=(h.getAttribute("aria-label")||b).replace(/\s+layer$/i,"")||b,m=h.querySelector(".canvas-layer__text");if(m){if(m.hasAttribute("data-preview-node")||m.setAttribute("data-preview-node",b),m.dataset.previewLabel||(m.dataset.previewLabel=k),!m.dataset.defaultText){const C=(m.textContent||"").trim();C&&(m.dataset.defaultText=C)}u.push(m)}const x=h.querySelector("img, image");if(x){const C=`${b}-image`;x.hasAttribute("data-preview-node")||x.setAttribute("data-preview-node",C),x.dataset.previewLabel||(x.dataset.previewLabel=k),u.push(x)}if(!m&&!x){if(h.hasAttribute("data-preview-node")||h.setAttribute("data-preview-node",b),h.dataset.previewLabel||(h.dataset.previewLabel=k),!h.dataset.defaultText){const C=(h.textContent||"").trim();C&&(h.dataset.defaultText=C)}u.push(h)}}),e.querySelectorAll("image, img").forEach((h,b)=>{var m;const k=h.getAttribute("data-preview-node")||`auto-image-${b+1}`;r(h,k,((m=h.dataset)==null?void 0:m.previewLabel)||null,null,"image")}),e.querySelectorAll("text, tspan").forEach((h,b)=>{var x,C;const k=(((x=h.dataset)==null?void 0:x.defaultText)||h.textContent||"").trim()||null,m=h.getAttribute("data-preview-node")||`auto-text-${b+1}`;r(h,m,((C=h.dataset)==null?void 0:C.previewLabel)||null,k,"text")}),u.length>0&&u.forEach((h,b)=>{var m,x;const k=h.getAttribute("data-preview-node")||`fallback-${b+1}`;r(h,k,((m=h.dataset)==null?void 0:m.previewLabel)||null,((x=h.dataset)==null?void 0:x.defaultText)||null,"node")});const A=[];return e.querySelectorAll("text[data-preview-node], tspan[data-preview-node]").forEach(h=>{const b=h.getAttribute("data-preview-node");if(b&&t.has(b)){const k=t.get(b);k&&!A.includes(k)&&A.push(k)}}),A.length>0?A:Array.from(t.values())},Aa=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const a=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);a==null||a.classList.remove("active"),t==="background"&&We&&(We=!1,oa(),ca())}},ls=()=>{Object.values(Wa).forEach(e=>Aa(e))},cs=e=>{const t=Wa[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const a=t.querySelector('input:not([type="hidden"])');if(a==null||a.focus({preventScroll:!0}),e==="background"&&yi(),e==="graphics"){const s=document.querySelector('.graphics-category-button[data-category="image"]');s?ms(s):(Ha(),Ua())}};ie.length&&ie.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",a=Wa[t],s=a==null?void 0:a.classList.contains("is-open");ls(),ie.forEach(r=>r.classList.remove("active")),s||(cs(t),e.classList.add("active"))})});const ds=document.querySelector('button[aria-label="Undo"]'),us=document.querySelector('button[aria-label="Redo"]');ds&&ds.addEventListener("click",ze),us&&us.addEventListener("click",ta),Me(),ii.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");Aa(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&Aa(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&Aa(t)}});async function ni(e){if(!e||!e.fullUrl){console.error("[InkWise Studio] Invalid graphic item:",e);return}const t=document.getElementById("background-modal");if(t&&t.classList.contains("is-open")&&We){try{const r=await fetch(e.fullUrl);if(!r.ok)throw new Error(`Failed to fetch background image: ${r.status}`);const n=await r.blob(),u=await Li(n);Ti(u),console.log("[InkWise Studio] Applied graphic as background image")}catch(r){console.error("[InkWise Studio] Failed to apply background graphic:",r),alert("Failed to apply background image. Please try again.")}return}const s=getSvgRoot(ke);if(!s){console.error("[InkWise Studio] No SVG root found for side:",ke);return}try{const n=`graphic-${`graphic-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}`;if(e.fullUrl.includes(".svg")||e.id.startsWith("iconify-")){const f=await fetch(e.fullUrl);if(!f.ok)throw new Error(`Failed to fetch SVG: ${f.status}`);const p=await f.text(),v=document.createElementNS("http://www.w3.org/2000/svg","g");v.setAttribute("data-preview-node",n),v.setAttribute("data-preview-label",e.alt||"Graphic"),v.setAttribute("class","inserted-graphic"),v.setAttribute("data-editable-image","true"),v.setAttribute("transform","translate(100, 100) scale(0.5)");const b=new DOMParser().parseFromString(p,"image/svg+xml").documentElement;for(;b.firstChild;)v.appendChild(b.firstChild);s.appendChild(v);const k=Fe(v);k&&(v.style.cursor="pointer",v.addEventListener("click",m=>{m.stopPropagation(),gt();const x=Xa(k.overlay,v);x&&(Oe=x)})),console.log("[InkWise Studio] Inserted SVG graphic:",n)}else{const f=document.createElementNS("http://www.w3.org/2000/svg","image");f.setAttribute("data-preview-node",n),f.setAttribute("data-preview-label",e.alt||"Graphic"),f.setAttribute("class","inserted-graphic"),f.setAttribute("data-editable-image","true"),f.setAttribute("x","100"),f.setAttribute("y","100"),f.setAttribute("width","200"),f.setAttribute("height","200"),f.setAttribute("preserveAspectRatio","xMidYMid meet"),f.setAttributeNS("http://www.w3.org/1999/xlink","href",e.fullUrl),s.appendChild(f);const p=Fe(f);p&&(f.style.cursor="pointer",f.addEventListener("click",v=>{v.stopPropagation(),gt();const A=Xa(p.overlay,f);A&&(Oe=A)})),console.log("[InkWise Studio] Inserted raster graphic:",n)}updatePreview(ke),flushAutosave("graphic-inserted"),console.log("[InkWise Studio] Graphic inserted successfully")}catch(r){console.error("[InkWise Studio] Failed to insert graphic:",r),alert("Failed to insert graphic. Please try again.")}}const Na=document.querySelector(".graphics-categories-labels"),R=document.getElementById("graphics-browser-samples"),fs=document.querySelectorAll(".graphics-category-button"),wt=document.getElementById("graphics-search-form"),xt=document.getElementById("graphics-search-input"),ps="53250708-d3f88461e75cb0c2c5366a181",oi={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:ps,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:ps,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},gs=new Map;let Oa=0;function Ea(e,t){const a=(t||"").trim();return a||e.query||e.defaultQuery||""}function Ua(){R&&(R.innerHTML="",R.dataset.category="",R.dataset.page="0",R.dataset.loading="0",R.dataset.hasMore="0",R.dataset.searchTerm="",R.dataset.requestToken="")}function Ha(){if(!Na||!R)return;Na.querySelectorAll(".category-row").forEach(t=>{t.style.display="flex",t.dataset.expanded="0"}),fs.forEach(t=>{t.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}),R.scrollTop=0,R.innerHTML="",R.dataset.category="",R.dataset.page="0",R.dataset.loading="0",R.dataset.hasMore="0",R.dataset.searchTerm="",R.dataset.requestToken="",wt&&(wt.classList.add("is-hidden"),wt.dataset.category=""),xt&&(xt.value="",xt.blur())}function Va(e){return oi[e]||null}async function ms(e){var h,b,k;const t=e.dataset.category;if(!t||!R||!Na)return;if(e.getAttribute("aria-expanded")==="true"){Ha(),Ua();return}const s=Va(t);if(!s){console.warn(`[InkWise Studio] No graphics configuration found for category "${t}".`);return}Ha();const r=gs.get(t)||"",n=s.label||"",u=(k=(b=(h=e.closest(".category-row"))==null?void 0:h.querySelector(".category-label"))==null?void 0:b.textContent)==null?void 0:k.trim(),f=n||u||t,p=s.searchPlaceholder||`Search ${f.toLowerCase()}`;wt&&(wt.classList.remove("is-hidden"),wt.dataset.category=t),xt&&(xt.placeholder=p,xt.value=r),e.setAttribute("aria-expanded","true"),e.classList.add("is-open"),Na.querySelectorAll(".category-row").forEach(m=>{m.dataset.categoryRow===t?(m.style.display="flex",m.dataset.expanded="1"):m.style.display="none"}),R.innerHTML="",R.dataset.category=t,R.dataset.page="0",R.dataset.loading="0",R.dataset.hasMore="1",R.dataset.searchTerm=r,R.scrollTop=0;const A=String(++Oa);R.dataset.requestToken=A,hs(),await Ga(t,1,r,A)}function hs(){if(!R)return;const e=R.querySelector(".graphics-loading");if(e){e.style.display="flex";return}const t=document.createElement("div");t.className="graphics-loading",t.textContent="Loading assetsâ€¦",R.appendChild(t)}function ys(){if(!R)return;const e=R.querySelector(".graphics-loading");e&&e.remove()}function bs(e){if(!R)return;R.innerHTML="";const t=document.createElement("div");t.className="graphics-error",t.textContent=e||"Unable to load assets at the moment.",R.appendChild(t)}function li(e){if(!R||!Array.isArray(e))return;const t=document.createDocumentFragment();e.forEach(a=>{if(!a||!a.thumbUrl)return;const s=document.createElement("div");s.className="graphics-sample",s.title=a.alt||"Graphic sample";const r=document.createElement("img");if(r.src=a.thumbUrl,r.alt=a.alt||"Graphic sample",r.loading="lazy",s.appendChild(r),a.label){const n=document.createElement("span");n.className="sample-label",n.textContent=a.label,s.appendChild(n)}s.addEventListener("click",async()=>{console.log("Selected asset",a);try{await ni(a)}catch(n){console.error("[InkWise Studio] Failed to insert graphic:",n)}}),t.appendChild(s)}),ys(),R.appendChild(t)}async function Ga(e,t,a,s){if(!R)return;const r=Va(e);if(!r)return;const n=R.dataset.requestToken||"",u=s||n||String(++Oa);if(!(R.dataset.loading==="1"&&u===n)){R.dataset.loading="1",hs();try{const f=typeof a=="string"?a:R.dataset.searchTerm||"",p=await ci(r,t,f);if(R.dataset.requestToken!==u)return;if(R.dataset.loading="0",ys(),!p.length&&t===1){bs("No assets found for this category right now. Try again in a moment."),R.dataset.hasMore="0";return}li(p),R.dataset.page=String(t);const v=r.perPage||12;R.dataset.hasMore=p.length>=v?"1":"0"}catch(f){if(console.error("[InkWise Studio] Failed to load graphics assets:",f),R.dataset.requestToken!==u)return;R.dataset.loading="0",bs("We ran into a problem loading assets. Please try again."),R.dataset.hasMore="0"}}}async function ci(e,t,a){switch(e.provider){case"unsplash":return di(e,t,a);case"pixabay":return ui(e,t,a);case"flaticon":return fi(e,t,a);case"iconify":return pi(e,t,a);default:return console.warn("[InkWise Studio] Unknown graphics provider:",e.provider),[]}}async function di(e,t,a){const s=e.perPage||12,r=Ea(e,a),n=r?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",u=new URLSearchParams({per_page:String(s),page:String(t),client_id:e.apiKey});r&&(u.set("query",r),u.set("orientation","portrait"));const f=`${n}?${u.toString()}`,p=await fetch(f);if(!p.ok)throw new Error(`Unsplash API error: ${p.status}`);const v=await p.json();return(Array.isArray(v)?v:Array.isArray(v.results)?v.results:[]).map(h=>{const b=h.urls||{};return{id:`unsplash-${h.id}`,thumbUrl:b.small||b.thumb||b.regular||"",fullUrl:b.full||b.regular||b.raw||"",alt:h.alt_description||h.description||h.slug||"Unsplash image"}}).filter(h=>!!h.thumbUrl)}async function ui(e,t,a){const s=e.perPage||18,r=new URLSearchParams({key:e.apiKey,q:Ea(e,a),per_page:String(s),page:String(t),safesearch:"true",order:"popular"});e.imageType&&r.set("image_type",e.imageType),e.category&&r.set("category",e.category);const n=await fetch(`https://pixabay.com/api/?${r.toString()}`);if(!n.ok)throw new Error(`Pixabay API error: ${n.status}`);const u=await n.json();return(Array.isArray(u==null?void 0:u.hits)?u.hits:[]).map(p=>({id:`pixabay-${p.id}`,thumbUrl:p.previewURL||p.webformatURL||"",fullUrl:p.largeImageURL||p.webformatURL||"",alt:p.tags||"Pixabay asset",label:p.user?`@${p.user}`:null})).filter(p=>!!p.thumbUrl)}async function fi(e,t,a){const s=e.perPage||48,r=new URLSearchParams({q:Ea(e,a)||"icon",limit:String(s),page:String(t)});r.set("apikey",e.apiKey);const n=await fetch(`https://api.flaticon.com/v3/search/icons?${r.toString()}`,{headers:{Accept:"application/json",apikey:e.apiKey,Authorization:`Bearer ${e.apiKey}`}});if(!n.ok)throw new Error(`Flaticon API error: ${n.status}`);const u=await n.json();return(Array.isArray(u==null?void 0:u.data)?u.data:Array.isArray(u==null?void 0:u.icons)?u.icons:Array.isArray(u==null?void 0:u.result)?u.result:[]).map(p=>{var m;const v=(p==null?void 0:p.images)||p,A=(v==null?void 0:v.png)||{},h=(v==null?void 0:v.svg)||(v==null?void 0:v.svg)||null,b=A[128]||A[256]||h||(v==null?void 0:v["64"])||null,k=A[512]||A[256]||h||b;return b?{id:`flaticon-${(p==null?void 0:p.id)||(p==null?void 0:p.icon_id)||(p==null?void 0:p.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:b,fullUrl:k,alt:(p==null?void 0:p.description)||(Array.isArray(p==null?void 0:p.tags)?p.tags.join(", "):"Icon asset"),label:((m=p==null?void 0:p.uploader)==null?void 0:m.name)||(p==null?void 0:p.category)||null}:null}).filter(Boolean)}async function pi(e,t,a){const s=e.perPage||36,r=Math.max(0,(t-1)*s),n=new URLSearchParams({query:Ea(e,a)||"shape",limit:String(s),offset:String(r)});e.prefix&&n.set("prefix",e.prefix);const u=(e.baseUrl||"https://api.iconify.design").replace(/\/$/,""),f=await fetch(`${u}/search?${n.toString()}`,{headers:{Accept:"application/json"}});if(!f.ok)throw new Error(`Iconify API error: ${f.status}`);const p=await f.json(),v=Array.isArray(p==null?void 0:p.icons)?p.icons:[],A=Array.isArray(p==null?void 0:p.prefixes)&&p.prefixes.length===1?p.prefixes[0]:(p==null?void 0:p.prefix)||e.prefix||"";return v.map(h=>{if(typeof h=="string"){const b=h.includes(":")?h:A?`${A}:${h}`:h;if(!b)return null;const k=b.split(":").map(x=>encodeURIComponent(x)).join(":"),m=b.split(":").pop()||b;return{id:`iconify-${b.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${u}/${k}.svg?height=120&width=120`,fullUrl:`${u}/${k}.svg`,alt:m.replace(/[-_]/g," "),label:m.replace(/[-_]/g," ")}}if(h&&typeof h=="object"){const b=h.name||h.icon||h.id||"";if(!b)return null;const k=h.prefix||A,m=k?`${k}:${b}`:b,x=m.split(":").map(P=>encodeURIComponent(P)).join(":"),C=h.label||b;return{id:`iconify-${m.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${u}/${x}.svg?height=120&width=120`,fullUrl:`${u}/${x}.svg`,alt:C.replace(/[-_]/g," "),label:C.replace(/[-_]/g," ")}}return null}).filter(h=>!!(h!=null&&h.thumbUrl))}async function gi(){if(!R)return;const e=R.dataset.category;if(!e||R.dataset.loading==="1"||R.dataset.hasMore==="0")return;if(R.scrollTop+R.clientHeight>=R.scrollHeight-180){const a=Number(R.dataset.page||"1")+1,s=R.dataset.searchTerm||"";await Ga(e,a,s)}}fs.forEach(e=>{e.addEventListener("click",()=>ms(e))}),R&&(R.addEventListener("scroll",()=>{gi().catch(e=>{console.error("[InkWise Studio] graphics scroll handler error:",e)})}),Ua()),wt&&xt&&wt.addEventListener("submit",async e=>{if(e.preventDefault(),!R)return;const t=R.dataset.category;if(!t||!Va(t))return;const a=xt.value.trim();gs.set(t,a),R.scrollTop=0,R.innerHTML="",R.dataset.page="0",R.dataset.hasMore="1",R.dataset.searchTerm=a,R.dataset.loading="0";const s=String(++Oa);R.dataset.requestToken=s;try{await Ga(t,1,a,s)}catch(r){console.error("[InkWise Studio] graphics search failed:",r)}});const vs=e=>!e||!w?null:w.querySelector(`input[data-preview-target="${e}"]`),mi=e=>!e||!N?null:N.querySelector(`[data-preview-node="${e}"]`),ws=(()=>{let e=!1;return()=>{if(e||typeof document>"u")return;const t=document.createElement("style");t.id="inkwise-crop-overlay-styles",t.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(t),e=!0}})(),gt=()=>{Oe&&(Oe.teardown(),Oe=null)},Xa=(e,t)=>{if(!e||!t)return null;ws(),getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=(y,T,V)=>Math.min(Math.max(y,T),V);(()=>{if(t.dataset.cropSourceWidth&&t.dataset.cropSourceHeight)return;let y=null;try{y=t.getBBox()}catch{y=null}const T=y&&Number.isFinite(y.width)&&y.width>0?y.width:parseFloat(t.getAttribute("width"))||0,V=y&&Number.isFinite(y.height)&&y.height>0?y.height:parseFloat(t.getAttribute("height"))||0,B=y&&Number.isFinite(y.x)?y.x:parseFloat(t.getAttribute("x"))||0,de=y&&Number.isFinite(y.y)?y.y:parseFloat(t.getAttribute("y"))||0;T>0&&V>0&&(t.dataset.cropSourceWidth=T,t.dataset.cropSourceHeight=V,t.dataset.cropSourceX=B,t.dataset.cropSourceY=de)})();const r=document.createElement("div");r.className="crop-overlay";const n=(()=>{const y=typeof t.dataset.cropRect=="string"?t.dataset.cropRect:"",T=t.getAttribute("clip-path")||"",V=t.style&&typeof t.style.clipPath=="string"?t.style.clipPath:"",B=t.style&&typeof t.style.webkitClipPath=="string"?t.style.webkitClipPath:"",de=t.dataset.cropClipId||"",pe=(()=>{const ne=T.match(/^url\(#(.+)\)$/);return ne?ne[1]:""})(),me=de||pe;let oe=null;if(me){const ne=Bt(t.ownerSVGElement||null),J=ne==null?void 0:ne.querySelector(`#${me}`),Q=J==null?void 0:J.querySelector("rect");Q&&(oe={x:Q.getAttribute("x")||"",y:Q.getAttribute("y")||"",width:Q.getAttribute("width")||"",height:Q.getAttribute("height")||""})}return{rectString:y,clipPathAttr:T,clipId:me,clipRect:oe,clipPathStyle:V,webkitClipPathStyle:B}})(),u=[],f=document.createElement("div");f.className="crop-overlay__scrim crop-overlay__scrim--top";const p=document.createElement("div");p.className="crop-overlay__scrim crop-overlay__scrim--right";const v=document.createElement("div");v.className="crop-overlay__scrim crop-overlay__scrim--bottom";const A=document.createElement("div");A.className="crop-overlay__scrim crop-overlay__scrim--left",[f,p,v,A].forEach(y=>{y.style.pointerEvents="none",r.appendChild(y)});const b=document.createElement("div");b.className="crop-frame",r.appendChild(b);const k=document.createElement("div");k.className="crop-overlay__controls";const m=document.createElement("button");m.type="button",m.className="crop-overlay__button crop-overlay__button--cancel",m.textContent="Cancel";const x=document.createElement("button");x.type="button",x.className="crop-overlay__button crop-overlay__button--apply",x.textContent="Crop",k.appendChild(m),k.appendChild(x),r.appendChild(k);const C=["top-left","top-right","bottom-left","bottom-right"],P=[],re={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};C.forEach(y=>{const T=document.createElement("div");T.className=`crop-frame__corner crop-frame__corner--${y}`,T.dataset.corner=y,T.style.pointerEvents="auto",T.style.cursor=re[y]||"nwse-resize";const V=document.createElement("span");V.className="corner-arm corner-arm--horizontal",V.style.pointerEvents="none";const B=document.createElement("span");B.className="corner-arm corner-arm--vertical",B.style.pointerEvents="none",T.appendChild(V),T.appendChild(B),b.appendChild(T),P.push(T)});const se=["top","right","bottom","left"],fe=[];se.forEach(y=>{const T=document.createElement("div");T.className=`crop-frame__edge-handle crop-frame__edge-handle--${y}`,T.dataset.edge=y,T.style.pointerEvents="auto",T.style.cursor=y==="top"||y==="bottom"?"ns-resize":"ew-resize",b.appendChild(T),fe.push(T)}),e.appendChild(r);let H=e.getBoundingClientRect(),j=H.width||e.offsetWidth,z=H.height||e.offsetHeight,Ve=j,Et=z;if(!j||!z)return r.remove(),null;Te.forEach(y=>{!y||!y.overlay||y.overlay!==e&&(y.overlay.classList.contains("editor-overlay--hidden-for-crop")||(y.overlay.classList.add("editor-overlay--hidden-for-crop"),u.push(y.overlay)))}),e.classList.add("editor-overlay--crop-active"),e.dataset.cropSessionActive="true",le(),r.style.pointerEvents="none",b.style.pointerEvents="auto";const nt=(()=>{const y=t.dataset.cropRect;if(!y)return null;const T=y.split(",").map(V=>Number(V));return T.length!==4||T.some(V=>!Number.isFinite(V))?null:{left:a(T[0],0,1),top:a(T[1],0,1),width:a(T[2],0,1),height:a(T[3],0,1)}})(),Kt=parseFloat(t.dataset.cropSourceWidth)||0,Ma=parseFloat(t.dataset.cropSourceHeight)||0;let ye,we;const Jt=()=>{we=Math.min(j,Math.max(48,j*.08)),ye=Math.min(z,Math.max(48,z*.08))};Jt();const _={left:0,top:0,width:0,height:0};if(nt&&nt.width>0&&nt.height>0){const y=nt.width*j,T=nt.height*z;_.width=a(y,we,j),_.height=a(T,ye,z),_.left=a(nt.left*j,0,j-_.width),_.top=a(nt.top*z,0,z-_.height)}else{const y=Kt>0&&Ma>0?Kt/Ma:j>0&&z>0?j/z:1;let T,V;y>=1?(T=j*.85,V=T/y):(V=z*.85,T=V*y),_.width=a(T,we,j),_.height=a(V,ye,z),_.left=Math.max(0,(j-_.width)/2),_.top=Math.max(0,(z-_.height)/2)}_.width=a(_.width,we,j),_.height=a(_.height,ye,z),_.left=a(_.left,0,j-_.width),_.top=a(_.top,0,z-_.height);const dr=()=>{const y=_.left+_.width,T=_.top+_.height;f.style.top="0px",f.style.left="0px",f.style.width="100%",f.style.height=`${Math.max(0,_.top)}px`,f.style.display=_.top>0?"block":"none",v.style.top=`${T}px`,v.style.left="0px",v.style.width="100%",v.style.height=`${Math.max(0,z-T)}px`,v.style.display=T<z?"block":"none",A.style.top=`${_.top}px`,A.style.left="0px",A.style.width=`${Math.max(0,_.left)}px`,A.style.height=`${_.height}px`,A.style.display=_.left>0?"block":"none",p.style.top=`${_.top}px`,p.style.left=`${y}px`,p.style.width=`${Math.max(0,j-y)}px`,p.style.height=`${_.height}px`,p.style.display=y<j?"block":"none"},zs=(y,T,V,B)=>{const de=t.ownerSVGElement;if(!de)return;const pe=parseFloat(t.dataset.cropSourceWidth)||0,me=parseFloat(t.dataset.cropSourceHeight)||0,oe=parseFloat(t.dataset.cropSourceX)||0,ne=parseFloat(t.dataset.cropSourceY)||0;let J=pe,Q=me,Je=oe,$a=ne;if(!J||!Q){let je=null;try{je=t.getBBox()}catch{je=null}J=je&&Number.isFinite(je.width)&&je.width>0?je.width:parseFloat(t.getAttribute("width"))||0,Q=je&&Number.isFinite(je.height)&&je.height>0?je.height:parseFloat(t.getAttribute("height"))||0,Je=je&&Number.isFinite(je.x)?je.x:parseFloat(t.getAttribute("x"))||0,$a=je&&Number.isFinite(je.y)?je.y:parseFloat(t.getAttribute("y"))||0}if(!J||!Q)return;if(t instanceof HTMLImageElement){const je=a(T,0,1)*100,Zs=a(y,0,1)*100,yr=a(1-(T+B),0,1)*100,br=a(1-(y+V),0,1)*100,is=`inset(${je}% ${br}% ${yr}% ${Zs}%)`;t.style.clipPath=is,t.style.webkitClipPath=is,delete t.dataset.cropClipId,t.dataset.cropCssClip=is;return}const Qt=Bt(de);if(!Qt)return;const yt=t.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let Qe=Qt.querySelector(`#${yt}`);Qe||(Qe=document.createElementNS(q,"clipPath"),Qe.id=yt,Qe.setAttribute("clipPathUnits","userSpaceOnUse"),Qt.appendChild(Qe));let et=Qe.querySelector("rect");et||(et=document.createElementNS(q,"rect"),Qe.appendChild(et));const pr=J*V,gr=Q*B,mr=Je+J*y,hr=$a+Q*T;et.setAttribute("x",mr),et.setAttribute("y",hr),et.setAttribute("width",pr),et.setAttribute("height",gr),t.dataset.cropClipId=yt,t.setAttribute("clip-path",`url(#${yt})`),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip},ur=()=>{if(!j||!z)return;const y=t.dataset.cropRect||"",T=typeof t.getAttribute("clip-path")=="string"&&t.getAttribute("clip-path").length>0,V=t.ownerSVGElement,B=_.left/j,de=_.top/z,pe=_.width/j,me=_.height/z,oe=a(B,0,1),ne=a(de,0,1),J=a(pe,0,1-oe),Q=a(me,0,1-ne),Je=oe+J,$a=ne+Q;if(oe<=.001&&ne<=.001&&Je>=.999&&$a>=.999){const yt=t.dataset.cropClipId;if(yt){const Qe=Bt(V),et=Qe==null?void 0:Qe.querySelector(`#${yt}`);et==null||et.remove(),delete t.dataset.cropClipId}t.removeAttribute("clip-path"),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip,delete t.dataset.cropRect,(y||T)&&(E==null||E.schedule("image-crop"),le());return}const Qt=[oe,ne,J,Q].map(yt=>yt.toFixed(6)).join(",");t.dataset.cropRect=Qt,zs(oe,ne,J,Q),y!==Qt&&(E==null||E.schedule("image-crop"),le())},$s=()=>{var ne;const y=t.dataset.cropRect||"",T=t.getAttribute("clip-path")||"",V=t.dataset.cropClipId||"",B=t.ownerSVGElement,de=t.dataset.cropClipId;if(de&&de!==n.clipId){const J=Bt(B);(ne=J==null?void 0:J.querySelector(`#${de}`))==null||ne.remove()}if(n.rectString){t.dataset.cropRect=n.rectString,n.clipId?t.dataset.cropClipId=n.clipId:delete t.dataset.cropClipId;const J=n.rectString.split(",").map(Q=>Number(Q));J.length===4&&J.every(Q=>Number.isFinite(Q))&&zs(J[0],J[1],J[2],J[3]),n.clipPathAttr?t.setAttribute("clip-path",n.clipPathAttr):t.removeAttribute("clip-path"),n.clipPathStyle?(t.style.clipPath=n.clipPathStyle,t.dataset.cropCssClip=n.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),n.webkitClipPathStyle?t.style.webkitClipPath=n.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}else{if(delete t.dataset.cropRect,n.clipId){if(t.dataset.cropClipId=n.clipId,n.clipRect){const J=Bt(B);if(J){let Q=J.querySelector(`#${n.clipId}`);Q||(Q=document.createElementNS(q,"clipPath"),Q.id=n.clipId,Q.setAttribute("clipPathUnits","userSpaceOnUse"),J.appendChild(Q));let Je=Q.querySelector("rect");Je||(Je=document.createElementNS(q,"rect"),Q.appendChild(Je)),Je.setAttribute("x",n.clipRect.x),Je.setAttribute("y",n.clipRect.y),Je.setAttribute("width",n.clipRect.width),Je.setAttribute("height",n.clipRect.height)}}n.clipPathAttr&&t.setAttribute("clip-path",n.clipPathAttr)}else delete t.dataset.cropClipId,n.clipPathAttr?t.setAttribute("clip-path",n.clipPathAttr):t.removeAttribute("clip-path");n.clipPathStyle?(t.style.clipPath=n.clipPathStyle,t.dataset.cropCssClip=n.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),n.webkitClipPathStyle?t.style.webkitClipPath=n.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}const pe=t.dataset.cropRect||"",me=t.getAttribute("clip-path")||"",oe=t.dataset.cropClipId||"";(y!==pe||T!==me||V!==oe)&&(E==null||E.schedule("image-crop"),le())},ht=()=>{b.style.left=`${_.left}px`,b.style.top=`${_.top}px`,b.style.width=`${_.width}px`,b.style.height=`${_.height}px`,dr(),ur()};ht();let Ie=null,ue=null;const as=()=>{const y=j||(H==null?void 0:H.width)||(o==null?void 0:o.clientWidth)||0,T=z||(H==null?void 0:H.height)||(o==null?void 0:o.clientHeight)||0,V=Math.min(y,T);return Math.max(8,Math.round(V*.02))},Zt=(y,T)=>{const V=[],B=Math.round(y/Ut)*Ut;V.push(B),Number.isFinite(T)&&T>0&&V.push(T/2);let de=y,pe=Number.POSITIVE_INFINITY;return V.forEach(me=>{const oe=Math.abs(me-y);oe<pe&&oe<=ba&&(de=me,pe=oe)}),de},Ds=y=>{if(y.button!==0||y.target!==b)return;y.preventDefault(),H=e.getBoundingClientRect();const T=H.width||j,V=H.height||z;Ie={pointerId:y.pointerId,startX:y.clientX,startY:y.clientY,widthLimit:T,heightLimit:V,startLeft:_.left,startTop:_.top},b.setPointerCapture(y.pointerId)},qs=y=>{if(!Ie||y.pointerId!==Ie.pointerId)return;y.preventDefault();const T=y.clientX-Ie.startX,V=y.clientY-Ie.startY,B=as(),de=Math.max(0,Ie.widthLimit-_.width-B*2),pe=Math.max(0,Ie.heightLimit-_.height-B*2),me=Ie.startLeft+T,oe=Ie.startTop+V,ne=Zt(me,Ie.widthLimit),J=Zt(oe,Ie.heightLimit);_.left=a(ne,B,B+de),_.top=a(J,B,B+pe),ht()},Ra=y=>{if(!(!Ie||y.pointerId!==Ie.pointerId)){try{b.releasePointerCapture(y.pointerId)}catch{}Ie=null}};b.addEventListener("pointerdown",Ds),b.addEventListener("pointermove",qs),b.addEventListener("pointerup",Ra),b.addEventListener("pointercancel",Ra);const Ws=()=>{Ie=null};b.addEventListener("lostpointercapture",Ws);const Os=y=>{y.button===0&&(y.preventDefault(),y.stopPropagation(),H=e.getBoundingClientRect(),j=H.width||e.offsetWidth||j,z=H.height||e.offsetHeight||z,Jt(),ue={pointerId:y.pointerId,mode:"edge",edge:y.currentTarget.dataset.edge,anchor:{left:_.left,top:_.top,right:_.left+_.width,bottom:_.top+_.height},target:y.currentTarget},y.currentTarget.setPointerCapture(y.pointerId))},Us=y=>{if(!ue||y.pointerId!==ue.pointerId||ue.mode!=="edge")return;y.preventDefault(),H=e.getBoundingClientRect(),j=H.width||e.offsetWidth||j,z=H.height||e.offsetHeight||z,Jt();const T=y.clientX-H.left,V=y.clientY-H.top,B=ue.anchor,de=as();let pe=B.left,me=B.top,oe=a(B.right-B.left,we,j),ne=a(B.bottom-B.top,ye,z);if(ue.edge==="top"){const J=Math.min(B.bottom-ye,z-ye),Q=a(V,0,Math.max(0,J));me=Q,ne=Math.max(ye,B.bottom-Q)}else if(ue.edge==="bottom"){const J=B.top+ye,Q=a(V,J,z);me=B.top,ne=Math.max(ye,Q-B.top)}else if(ue.edge==="left"){const J=Math.min(B.right-we,j-we),Q=a(T,0,Math.max(0,J));pe=Q,oe=Math.max(we,B.right-Q)}else if(ue.edge==="right"){const J=B.left+we,Q=a(T,J,j);pe=B.left,oe=Math.max(we,Q-B.left)}oe=a(oe,we,j),ne=a(ne,ye,z),pe=Zt(a(pe,de,j-de-oe),j),me=Zt(a(me,de,z-de-ne),z),_.left=pe,_.top=me,_.width=oe,_.height=ne,ht()},Pa=y=>{var T;if(!(!ue||y.pointerId!==ue.pointerId)){try{(T=ue.target)==null||T.releasePointerCapture(y.pointerId)}catch{}ue=null,ht()}},Hs=()=>{ue=null},Vs=y=>{y.button===0&&(y.preventDefault(),y.stopPropagation(),H=e.getBoundingClientRect(),j=H.width||e.offsetWidth||j,z=H.height||e.offsetHeight||z,Jt(),ue={pointerId:y.pointerId,mode:"corner",corner:y.currentTarget.dataset.corner,anchor:{left:_.left,top:_.top,right:_.left+_.width,bottom:_.top+_.height},target:y.currentTarget},y.currentTarget.setPointerCapture(y.pointerId))},Gs=y=>{if(!ue||y.pointerId!==ue.pointerId||ue.mode!=="corner")return;y.preventDefault(),H=e.getBoundingClientRect(),j=H.width||e.offsetWidth||j,z=H.height||e.offsetHeight||z,Jt();const T=y.clientX-H.left,V=y.clientY-H.top,B=ue.anchor,de=as();let pe=B.left,me=B.top,oe=a(B.right-B.left,we,j),ne=a(B.bottom-B.top,ye,z);switch(ue.corner){case"top-left":{const J=a(T,0,B.right-we),Q=a(V,0,B.bottom-ye);pe=J,me=Q,oe=Math.max(we,B.right-J),ne=Math.max(ye,B.bottom-Q);break}case"top-right":{const J=a(T,B.left+we,j),Q=a(V,0,B.bottom-ye);pe=B.left,me=Q,oe=Math.max(we,J-B.left),ne=Math.max(ye,B.bottom-Q);break}case"bottom-left":{const J=a(T,0,B.right-we),Q=a(V,B.top+ye,z);pe=J,me=B.top,oe=Math.max(we,B.right-J),ne=Math.max(ye,Q-B.top);break}case"bottom-right":{const J=a(T,B.left+we,j),Q=a(V,B.top+ye,z);pe=B.left,me=B.top,oe=Math.max(we,J-B.left),ne=Math.max(ye,Q-B.top);break}default:return}oe=a(oe,we,j),ne=a(ne,ye,z),pe=Zt(a(pe,de,j-de-oe),j),me=Zt(a(me,de,z-de-ne),z),_.left=pe,_.top=me,_.width=oe,_.height=ne,ht()},za=y=>{var T;if(!(!ue||y.pointerId!==ue.pointerId)){try{(T=ue.target)==null||T.releasePointerCapture(y.pointerId)}catch{}ue=null,ht()}},Xs=()=>{ue=null};fe.forEach(y=>{y.addEventListener("pointerdown",Os),y.addEventListener("pointermove",Us),y.addEventListener("pointerup",Pa),y.addEventListener("pointercancel",Pa),y.addEventListener("lostpointercapture",Hs)}),P.forEach(y=>{y.addEventListener("pointerdown",Vs),y.addEventListener("pointermove",Gs),y.addEventListener("pointerup",za),y.addEventListener("pointercancel",za),y.addEventListener("lostpointercapture",Xs)});const Ys=y=>{y.preventDefault(),y.stopPropagation(),$s(),gt()},Ks=y=>{y.preventDefault(),y.stopPropagation(),ht()};m.addEventListener("click",Ys),x.addEventListener("click",Ks);const Js=y=>{y.key==="Escape"&&(y.preventDefault(),$s(),gt()),y.key==="Enter"&&(y.metaKey||y.ctrlKey)&&(y.preventDefault(),ht(),gt())};document.addEventListener("keydown",Js);const ss=()=>{if(H=e.getBoundingClientRect(),j=H.width||e.offsetWidth||j,z=H.height||e.offsetHeight||z,!j||!z)return;Jt();const y=t.dataset.cropRect||null;if(y){const T=y.split(",").map(V=>Number(V));if(T.length===4&&T.every(V=>Number.isFinite(V))){const V=a(T[2]*j,we,j),B=a(T[3]*z,ye,z),de=a(T[0]*j,0,j-V),pe=a(T[1]*z,0,z-B);_.left=de,_.top=pe,_.width=V,_.height=B}}else{const T=Ve?_.width/Ve:1,V=Et?_.height/Et:1,B=Ve?_.left/Ve:0,de=Et?_.top/Et:0;_.width=a(T*j,we,j),_.height=a(V*z,ye,z),_.left=a(B*j,0,j-_.width),_.top=a(de*z,0,z-_.height)}Ve=j,Et=z,ht()};return window.addEventListener("resize",ss),{overlay:e,refresh:ss,teardown:()=>{var y;if(Ie&&typeof Ie.pointerId<"u"){try{b.releasePointerCapture(Ie.pointerId)}catch{}Ie=null}if(ue&&typeof ue.pointerId<"u"){try{(y=ue.target)==null||y.releasePointerCapture(ue.pointerId)}catch{}ue=null}window.removeEventListener("resize",ss),b.removeEventListener("pointerdown",Ds),b.removeEventListener("pointermove",qs),b.removeEventListener("pointerup",Ra),b.removeEventListener("pointercancel",Ra),b.removeEventListener("lostpointercapture",Ws),fe.forEach(T=>{T.removeEventListener("pointerdown",Os),T.removeEventListener("pointermove",Us),T.removeEventListener("pointerup",Pa),T.removeEventListener("pointercancel",Pa),T.removeEventListener("lostpointercapture",Hs)}),P.forEach(T=>{T.removeEventListener("pointerdown",Vs),T.removeEventListener("pointermove",Gs),T.removeEventListener("pointerup",za),T.removeEventListener("pointercancel",za),T.removeEventListener("lostpointercapture",Xs)}),m.removeEventListener("click",Ys),x.removeEventListener("click",Ks),document.removeEventListener("keydown",Js),e.classList.remove("editor-overlay--crop-active"),delete e.dataset.cropSessionActive,u.forEach(T=>T.classList.remove("editor-overlay--hidden-for-crop")),u.length=0,le(),r.parentNode===e?e.removeChild(r):r.remove()}}},oa=()=>{be||he||We?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},la=()=>{Te.forEach(({overlay:e,type:t})=>{var n;if(!e)return;const a=((n=e.dataset)==null?void 0:n.previewNode)||"",s=!!be&&a===be&&t==="text",r=!!he&&a===he&&t==="image";e.classList.toggle("editor-overlay--selected",s||r)})},He=()=>We?"background":he?"image":be?"text":null,Ya=e=>{if(typeof e!="string")return null;const t=e.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!t)return null;const a=Number(t[1]),s=Number(t[2]),r=Number(t[3]);if([a,s,r].some(u=>Number.isNaN(u)||u<0||u>255))return null;const n=u=>u.toString(16).padStart(2,"0");return`#${n(a)}${n(s)}${n(r)}`.toUpperCase()};function hi(e){var t;try{if(e==="background"){if(!o)return null;const s=window.getComputedStyle(o).backgroundColor||o.style.backgroundColor||"";return jt(s)||Ya(s)||null}if(e==="text"){const a=Gt();if(!a.length)return null;const s=a[0],r=s.getAttribute("fill")||s.style.fill||s.dataset.color||"";return jt(r)||Ya(r)||null}if(e==="image"){const a=_t();if(!a.length)return null;const r=((t=a[0].dataset)==null?void 0:t.tintColor)||"";return jt(r)||null}}catch{return null}return null}const ca=()=>{if(typeof window>"u")return;const e=He(),t=e==="text"?be:e==="image"?he:null,a=hi(e);try{const s=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t,color:a}});window.dispatchEvent(s)}catch{if(typeof document<"u"&&document.createEvent){const r=document.createEvent("CustomEvent");r.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t,color:a}),window.dispatchEvent(r)}}},St=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;be===t&&!he||(gt(),be=t,t&&(he=null,We=!1),la(),oa(),ca())},kt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;he===t&&!be||(he!==t&&gt(),he=t,t&&(be=null,We=!1),la(),oa(),ca())},yi=()=>{We||(gt(),We=!0,be=null,he=null,la(),oa(),ca())},Gt=()=>{if(!be)return[];const e=M||l||document;if(!e)return[];const t=`[data-preview-node="${be}"]`,a=new Set;return e.querySelectorAll(t).forEach(s=>{if(!s||Z(s))return;const r=(s.tagName||"").toLowerCase();if(r==="tspan"||r==="g"){const n=s.closest("text");if(n){a.add(n);return}}a.add(s)}),Array.from(a)},_t=()=>{if(!he)return[];const e=M||l||document;if(!e)return[];const t=`[data-preview-node="${he}"]`;let a=new Set;return e.querySelectorAll(t).forEach(s=>{const r=xe(s);r&&a.add(r)}),a.size===0&&e!==document&&document.querySelectorAll(t).forEach(s=>{const r=xe(s);r&&a.add(r)}),Array.from(a)},Xt=()=>vs(be),Ft=(e,t,a)=>{const s=Number(e);return Number.isFinite(s)?Math.min(Math.max(s,t),a):t},jt=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},Ca=e=>{var n,u;if(!e||typeof e.getBBox!="function")return;const t=[],a=Number(((n=e.dataset)==null?void 0:n.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(a)&&a!==0)try{const f=e.getBBox(),p=f.x+f.width/2,v=f.y+f.height/2;t.push(`rotate(${a} ${p} ${v})`)}catch{t.push(`rotate(${a})`)}((u=e.dataset)==null?void 0:u.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const r=t.join(" ").trim();r?e.setAttribute("transform",r):e.removeAttribute("transform")},Pe=(e,t={})=>{const a=Gt();if(!a.length)return!1;if(a.forEach(s=>{try{e(s)}catch(r){console.warn("[InkWise Studio] Toolbar mutation failed.",r)}}),t.skipTransformUpdate||a.forEach(s=>{try{Ca(s)}catch{}}),t.skipOverlaySync||le(),t.autosaveReason!==!1){const s=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";E==null||E.schedule(s)}return!0},mt=(e,t={})=>{const a=_t();if(!a.length)return!1;if(a.forEach(s=>{try{e(s)}catch(r){console.warn("[InkWise Studio] Image mutation failed.",r)}}),t.skipTransformUpdate||a.forEach(s=>{try{Ca(s)}catch{}}),t.skipOverlaySync||le(),t.autosaveReason!==!1){const s=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";E==null||E.schedule(s)}return!0},Bt=(e=null)=>{var s;let t=M;if(!t&&e&&(t=e),!t)return null;if(typeof t.tagName=="string"&&t.tagName.toLowerCase()!=="svg"){const r=(s=t.closest)==null?void 0:s.call(t,"svg");r?t=r:e&&e!==t&&(t=e)}if(!t)return null;let a=t.querySelector('defs[data-inkwise-runtime="true"]');return a||(a=document.createElementNS(q,"defs"),a.setAttribute("data-inkwise-runtime","true"),t.insertBefore(a,t.firstChild||null)),a},Ia=e=>{const t=e.dataset.previewTarget;if(!t)return;const a=document.querySelector(`[data-preview-node="${t}"]`),s=a?a.dataset.defaultText||a.textContent:"",r=()=>{if(!a)return;const n=e.value.trim();a.textContent=n||s||"",le()};e.dataset.defaultValue||(e.dataset.defaultValue=s||""),e.addEventListener("focus",()=>{St(t)}),e.addEventListener("input",()=>{r(),ut("text-change")}),r()};i.forEach(Ia);const bi=(e,t="")=>{const a=normalizeSideKey(ke),s=vt(t),r=document.createElement("div");r.className="text-field-item";const n=document.createElement("span");n.className="text-field-label",n.textContent="Custom",r.appendChild(n);const u=document.createElement("input");u.type="text",u.className="text-field-input",u.placeholder="Add your text",u.dataset.previewTarget=e,u.dataset.templateSide=a,u.value=s,u.dataset.defaultValue=s||"",setStoredTextValue(a,e,s),captureDefaultTextValue(a,e,s),r.appendChild(u);const f=document.createElement("button");if(f.type="button",f.className="text-field-delete",f.setAttribute("aria-label","Delete field"),f.innerHTML='<i class="fa-regular fa-trash-can"></i>',r.appendChild(f),w.appendChild(r),N){const p=document.createElement("div");p.className="pill",p.dataset.previewNode=e,p.dataset.defaultText=t||"CUSTOM TEXT",p.textContent=t||"CUSTOM TEXT",N.appendChild(p)}return Ia(u),Ta(r),ut("add-text-field"),u},da=()=>{l&&(ra(),M=null,ea=null,l.innerHTML="",l.style.display="none")},xs=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},Ss=e=>{if(!e)return;const t=s=>{var n,u,f;let r=(s==null?void 0:s.parentNode)||null;for(;r;){const p=typeof r.getAttribute=="function"?r.getAttribute("fill"):null,v=(n=r.style)==null?void 0:n.fill,A=((u=r.dataset)==null?void 0:u.color)||((f=r.dataset)==null?void 0:f.defaultColor)||null,h=p||v||A;if(h&&h!=="none"&&h!=="transparent")return h;r=r.parentNode||null}return null};e.querySelectorAll("text, tspan").forEach(s=>{var b,k;s.removeAttribute("opacity"),s.style.opacity="1",s.style&&s.style.mixBlendMode&&(s.style.mixBlendMode="normal");const r=s.getAttribute("fill"),n=(b=s.style)==null?void 0:b.fill,u=(k=s.dataset)==null?void 0:k.color;let f=r&&r!=="none"?r:null;if((!f||f==="transparent")&&n&&n!=="none"&&(f=n),(!f||f==="transparent")&&u&&u!=="none"&&(f=u),(!f||f==="transparent")&&typeof window<"u"&&typeof window.getComputedStyle=="function")try{const m=window.getComputedStyle(s).fill;m&&m!=="none"&&m!=="transparent"&&(f=m)}catch{}if(!f||f==="transparent"||f==="none"){const m=t(s);m&&m!=="none"&&m!=="transparent"&&(f=m)}const p=jt(f||"")||Ya(f||"")||(f&&f!=="none"&&f!=="transparent"?f:null),A=p||"#111111";s.setAttribute("fill",A),s.style&&(s.style.fill=A,s.style.fillOpacity="1",s.style.strokeOpacity="1"),s.dataset&&(s.dataset.color=A,p&&(s.dataset.defaultColor=p)),s.removeAttribute("fill-opacity"),s.removeAttribute("stroke-opacity"),s.getAttribute("stroke")||s.setAttribute("stroke","none"),s.getAttribute("paint-order")||s.setAttribute("paint-order","stroke fill");const h=s.getAttribute("font-family")||s.style.fontFamily;if(h){const m=h.toLowerCase().replace(/[^a-z]/g,"");m.includes("greatvibes")?s.setAttribute("font-family","Great Vibes"):m.includes("poppins")&&s.setAttribute("font-family","Poppins")}})},vi=async e=>{var t,a;if(!l||!e)return da(),!1;try{let s="";if(e.startsWith("data:image/svg+xml")){const m=e.indexOf(","),x=m>=0?e.slice(0,m):e,C=m>=0?e.slice(m+1):"";if(/;base64/i.test(x))try{const re=C.replace(/\s+/g,"");s=typeof window<"u"&&typeof window.atob=="function"?window.atob(re):atob(re)}catch(re){try{s=decodeURIComponent(C)}catch(se){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",re,se),s=""}}else try{s=decodeURIComponent(C)}catch{s=C}}else{const m=await fetch(e,{cache:"no-store"});if(!m.ok)return console.warn("Failed to fetch SVG:",m.status),da(),!1;s=await m.text()}if(!s)return da(),!1;l.innerHTML=s,l.style.display="block";const r=document.getElementById("canvas-loading");r&&(r.style.display="none"),l.setAttribute("preserveAspectRatio","xMidYMid meet"),l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.style.width="100%",l.style.height="100%",l.style.maxWidth="100%",l.style.maxHeight="100%";const n=l.querySelector("svg");n?(n.setAttribute("preserveAspectRatio","xMidYMid meet"),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.style.width="100%",n.style.height="100%",n.style.maxWidth="100%",n.style.maxHeight="100%",M=n):M=l,M&&(tt(M),Ss(M)),M&&(M.setAttribute("data-svg-editor","true"),M.__inkwiseSvgTemplateEditor||(M.__inkwiseSvgTemplateEditor=new ga(M,{onTextChange:(m,x,C)=>{dt(),E&&E.schedule("text-change")},onImageChange:(m,x,C)=>{dt(),E&&E.schedule("image-change")}})),ea=M.__inkwiseSvgTemplateEditor,setTimeout(()=>dt(),100));const f=new DOMParser().parseFromString(s,"image/svg+xml").documentElement;let p=ka(f==null?void 0:f.getAttribute("width")),v=ka(f==null?void 0:f.getAttribute("height"));if(!Number.isFinite(p)||!Number.isFinite(v)){const m=f==null?void 0:f.getAttribute("viewBox");if(m){const x=m.split(/[\s,]+/).map(Number),C=x[2],P=x[3];!Number.isNaN(C)&&!Number.isNaN(P)&&C>0&&P>0&&(p=C,v=P)}}let A=Number.isFinite(p)?p:Number.NaN,h=Number.isFinite(v)?v:Number.NaN;if(Y&&Number.isFinite(Y.width)&&Number.isFinite(Y.height)){const m=Y.width/Y.height,x=Number.isFinite(A)&&Number.isFinite(h)?A/h:m,C=Math.abs(x-m)/m,P=Number.isFinite(A)?Math.abs(A-Y.width)/Y.width:Number.POSITIVE_INFINITY,re=Number.isFinite(h)?Math.abs(h-Y.height)/Y.height:Number.POSITIVE_INFINITY;(!Number.isFinite(A)||!Number.isFinite(h)||C>.02||P>.05&&re>.05)&&(A=Y.width,h=Y.height)}if(Number.isFinite(A)&&Number.isFinite(h)){const m=(Y==null?void 0:Y.unit)??"px";Ke(A,h,{unit:m,shape:Y==null?void 0:Y.shape}),Vt(Ge(A,m),Ge(h,m),"in",2)}const b=ri(l);if(ra(),w){w.innerHTML="";const m=(C,P="",re="")=>{const se=document.createElement("div");se.className="text-field-item";const fe=document.createElement("span");fe.className="text-field-label",fe.textContent=re||C,se.appendChild(fe);const H=document.createElement("input");H.type="text",H.className="text-field-input",H.dataset.previewTarget=C,H.value=P||"",H.dataset.defaultValue=P||"",se.appendChild(H);const j=document.createElement("button");return j.type="button",j.className="text-field-delete",j.setAttribute("aria-label","Delete field"),j.innerHTML='<i class="fa-regular fa-trash-can"></i>',se.appendChild(j),w.appendChild(se),Ia(H),Ta(se),H},x=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([P,re])=>m(P,"",re))};if(b.length>0){let C=!1;const P=new Set,re=new Set;b.forEach(se=>{var z,Ve;const fe=se.getAttribute("data-preview-node");if(!fe||P.has(fe))return;P.add(fe);const H=Z(se);if(ae(se)){C=!0;const Et=((z=se.dataset)==null?void 0:z.previewLabel)||fe,nt=((Ve=se.dataset)==null?void 0:Ve.defaultText)||ge(se)||"",Kt=(Et||"").toString().trim().toLowerCase(),Ma=(nt||"").toString().trim().toLowerCase(),ye=`${Kt}|${Ma}`;if(Kt&&re.has(ye))return;Kt&&re.add(ye),m(fe,nt,Et)}}),C||x()}else x()}const k=(a=(t=K==null?void 0:K.orderSummary)==null?void 0:t.metadata)==null?void 0:a.design;return k&&Pt(k),b.forEach(m=>{const x=m.getAttribute("data-preview-node");if(!x)return;const C=Z(m),P=ae(m);C&&m.setAttribute("data-changeable","image"),Fe(m)&&Re(m),P?(m.setAttribute("contenteditable","true"),m.style.cursor="text",m.style.userSelect="text",m.addEventListener("input",()=>{const fe=document.querySelector(`#textFieldList input[data-preview-target="${x}"]`);fe&&(fe.value=ge(m)),m.dataset.currentText=ge(m)||"",le(),E==null||E.schedule("text-edit")}),m.addEventListener("click",()=>{St(x),La(x)})):C&&(m.style.cursor="pointer",m.addEventListener("click",()=>{m.dataset.locked!=="true"&&(kt(x),Lt(m))}));const se=document.querySelector(`#textFieldList input[data-preview-target="${x}"]`);se&&P&&(se.addEventListener("input",()=>{Ce(m,se.value),E==null||E.schedule("text-change")}),se.value&&se.value.trim()!==""?Ce(m,se.value):se.value=ge(m)||"")}),requestAnimationFrame(()=>le()),Ht(10),!0}catch(s){return console.warn("Could not load SVG for binding:",s),da(),!1}},wi=async(e={})=>{var se,fe,H,j;const{scale:t=3,filename:a="inkwise-template.png",download:s=!0}=e,r=M||l;if(!r)throw new Error("No active canvas to export.");tt(r);const u=new XMLSerializer().serializeToString(r),f=z=>{const Ve=Number(z);return Number.isFinite(Ve)?Ve:null},p=(r.getAttribute("viewBox")||"").split(/[\s,]+/).map(f),v=p.length===4?p[2]:null,A=p.length===4?p[3]:null,h=f((se=o==null?void 0:o.dataset)==null?void 0:se.canvasWidth)||f((fe=X==null?void 0:X.dataset)==null?void 0:fe.canvasWidth)||v||1080,b=f((H=o==null?void 0:o.dataset)==null?void 0:H.canvasHeight)||f((j=X==null?void 0:X.dataset)==null?void 0:j.canvasHeight)||A||1527,k=Math.max(1,Math.round(h*Math.max(1,t))),m=Math.max(1,Math.round(b*Math.max(1,t))),x=new Image;x.crossOrigin="anonymous",x.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(u)}`,await new Promise((z,Ve)=>{x.onload=z,x.onerror=Ve});const C=document.createElement("canvas");C.width=k,C.height=m;const P=C.getContext("2d");P.fillStyle="#ffffff",P.fillRect(0,0,k,m),P.drawImage(x,0,0,k,m);const re=C.toDataURL("image/png",1);if(s){const z=document.createElement("a");z.href=re,z.download=a,z.click()}return{dataUrl:re,width:k,height:m}};typeof window<"u"&&(window.inkwiseExportCurrentSide=(e={})=>wi(e));const Ta=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),a=e.querySelector("input[data-preview-target]");if(!t||!a||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const r=a.dataset.previewTarget;if(e.remove(),N){const n=N.querySelector(`[data-preview-node="${r}"]`);n==null||n.remove()}if(M){const n=M.querySelector(`[data-preview-node="${r}"]`);n==null||n.remove()}deleteStoredTextValue(normalizeSideKey(ke),r),E==null||E.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>Ta(e));const La=e=>{if(!e)return;ls(),cs("text"),ie.forEach(a=>a.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const a=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(a){try{a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const n=document.getElementById("textFieldList");n&&(n.scrollTop=a.offsetTop-12)}a.focus({preventScroll:!1});return}const s=document.querySelector("[data-add-text-field]");s==null||s.focus({preventScroll:!1})},60)};Wt=La;const At=async e=>{if(!va(e))return;if(E&&ke!==e)try{await E.flush("side-switch")}catch(n){console.debug("[InkWise Studio] Autosave flush failed during side switch.",n)}if(ke=e,!o)return;let t=null;try{t=await ia(e)}catch{console.debug("[InkWise Studio] No autosave data for side:",e)}let a="",s="";t!=null&&t.png?(a=t.png,s=t.svg||""):e==="front"&&st?(a=st,s=st):e==="back"&&it?(a=it,s=it):(s=o.dataset[`${e}Svg`]||"",a=o.dataset[`${e}Image`]||"");let r=!1;if(s&&xs(s)&&await vi(s)&&(r=!0,o.style.backgroundImage="none",o.style.backgroundSize="",Ss(M)),!r){const n=a||o.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,n||"<empty>"),da(),o.style.backgroundImage=n?`url('${n}')`:"",o.style.backgroundSize=n?"cover":"",o.style.backgroundPosition=n?"center center":"",o.style.backgroundRepeat=n?"no-repeat":"",n&&qa(n),ra(),M=null}g.forEach(n=>{n.classList.toggle("active",n.dataset.cardView===e)}),c.forEach(n=>{const u=n.dataset.cardThumb===e;n.classList.toggle("active",u),n.setAttribute("aria-pressed",u?"true":"false")});try{Sr(e)}catch{}};g.forEach(e=>{e.addEventListener("click",()=>{At(e.dataset.cardView)})}),c.forEach(e=>{e.addEventListener("click",()=>{At(e.dataset.cardThumb)})});const Ka=At("front");Ka&&typeof Ka.then=="function"?Ka.catch(()=>{}).then(()=>{Ht(6),ut("initial-load")}):(Ht(6),ut("initial-load"));const ks=document.querySelector(".preview-overlay")||document.querySelector(".preview-canvas-wrapper");ks&&ks.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const a=t.dataset.previewNode;a&&(Z(t)?kt(a):(St(a),La(a)))}}),I&&w&&I.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${ce}`;ce+=1;const t=document.createElement("div");t.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",t.appendChild(a);const s=document.createElement("input");s.type="text",s.className="text-field-input",s.placeholder="Add your text",s.dataset.previewTarget=e,t.appendChild(s);const r=document.createElement("button");if(r.type="button",r.className="text-field-delete",r.setAttribute("aria-label","Delete field"),r.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(r),w.appendChild(t),N){const u=document.createElement("div");u.className="pill",u.dataset.previewNode=e,u.dataset.defaultText="CUSTOM TEXT",u.textContent="CUSTOM TEXT",N.appendChild(u)}let n=null;console.log("[InkWise Studio] currentSvgRoot:",M),M?(console.log("[InkWise Studio] Creating SVG text element"),n=document.createElementNS("http://www.w3.org/2000/svg","text"),n.setAttribute("id",e),n.setAttribute("data-preview-node",e),n.setAttribute("data-default-text","CUSTOM TEXT"),n.setAttribute("x","50%"),n.setAttribute("y","50%"),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.setAttribute("font-family","Arial, sans-serif"),n.setAttribute("font-size","24"),n.setAttribute("fill","#000000"),n.textContent="CUSTOM TEXT",n.setAttribute("contenteditable","true"),n.style.cursor="text",n.style.userSelect="text",n.addEventListener("input",()=>{s&&(s.value=n.textContent),n.dataset.currentText=n.textContent||"",le(),E==null||E.schedule("text-edit")}),n.addEventListener("click",()=>{St(e),La(e)}),M.appendChild(n),Fe(n)&&Re(n),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),Ia(s),s.addEventListener("input",()=>{n&&(n.textContent=s.value,n.dataset.currentText=s.value),E==null||E.schedule("text-change")}),St(e),n&&n.textContent&&n.textContent.trim()!==""?s.value=n.textContent:(s.value="CUSTOM TEXT",n&&(n.textContent="CUSTOM TEXT")),Ta(t),setTimeout(()=>{try{w.scrollHeight>w.clientHeight&&w.scrollTo({top:w.scrollHeight,behavior:"smooth"})}catch{w.scrollTop=w.scrollHeight}s.focus({preventScroll:!1})},60)}),st=null,it=null,ke="front";const ua=document.getElementById("image-upload"),As=document.getElementById("upload-button"),Ns=document.getElementById("quick-upload-button"),_a=document.getElementById("recentUploadsGrid"),Fa=document.getElementById("quickRecentUploads"),Ja="inkwise_recent_uploads",Es=12,Za=()=>{try{const e=localStorage.getItem(Ja);return e?JSON.parse(e):[]}catch{return[]}},xi=(e,t,a)=>{const s=Za(),r={id:Date.now(),dataUrl:e,filename:t,side:a,timestamp:new Date().toISOString()},n=s.filter(f=>f.filename!==t);n.unshift(r);const u=n.slice(0,Es);try{localStorage.setItem(Ja,JSON.stringify(u))}catch{const p=u.slice(0,Math.floor(Es/2));localStorage.setItem(Ja,JSON.stringify(p))}Is(),Ts()},Cs=(e,t,a="front")=>{var s,r;if(e&&(xi(e,t||`upload-${Date.now()}`,a),!(he&&mt(u=>{u.setAttribute("href",e),u.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},{autosaveReason:"image-upload"})))){if(M){const n=((s=M.tagName)==null?void 0:s.toLowerCase())==="svg"?M:M.closest("svg");if(n){const u=n.querySelectorAll('image[data-changeable="image"], image.changeable-image, image.svg-changeable-image, [data-editable-image]');if(u.length>0){const f=u[0];f.setAttribute("href",e),f.setAttributeNS("http://www.w3.org/1999/xlink","href",e),f.setAttribute("data-replaced-image","true");const p=document.querySelector(`[data-card-thumb="${a}"] .thumb-preview`);p&&(p.style.backgroundImage=`url('${e}')`),flushAutosave("image-upload-replace"),updatePreview(ke);return}}}if(M){const n=((r=M.tagName)==null?void 0:r.toLowerCase())==="svg"?M:M.closest("svg");if(n){const u=n.getAttribute("viewBox");let f=200,p=200,v=150;if(u){const k=u.split(/[\s,]+/).map(Number);k.length===4&&k.every(Number.isFinite)&&(f=k[0]+k[2]/2,p=k[1]+k[3]/2,v=Math.min(k[2],k[3])*.3)}const A=`uploaded_${Date.now()}`,h=document.createElementNS("http://www.w3.org/2000/svg","image");h.setAttribute("id",A),h.setAttribute("data-preview-node",A),h.setAttribute("href",e),h.setAttributeNS("http://www.w3.org/1999/xlink","href",e),h.setAttribute("x",String(f-v/2)),h.setAttribute("y",String(p-v/2)),h.setAttribute("width",String(v)),h.setAttribute("height",String(v)),h.setAttribute("preserveAspectRatio","xMidYMid meet"),n.appendChild(h),Fe(h)&&Re(h),kt(A),E==null||E.schedule("image-upload");return}}a==="front"?st=e:a==="back"&&(it=e);try{o&&typeof o.dataset=="object"&&(o.dataset[`${a}Image`]=e)}catch{}if(!he&&ke!==a&&xr(ke,a,!!he))try{At(a)}catch{}E==null||E.schedule("image-upload")}},Is=()=>{if(!_a)return;const e=Za();if(e.length===0){_a.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(s=>`
            <div class="recent-upload-item" data-upload-id="${s.id}" data-image-url="${s.dataUrl}" data-side="${s.side}">
                <img src="${s.dataUrl}" alt="${s.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${s.filename}</span>
                </div>
            </div>
        `).join("");_a.innerHTML=t;const a=_a.querySelectorAll(".recent-upload-item");a.forEach(s=>{s.addEventListener("click",async()=>{var u;const r=s.dataset.imageUrl,n=s.dataset.side||ke||"front";if(a.forEach(f=>f.classList.remove("selected")),s.classList.add("selected"),he&&mt(p=>{p.setAttribute("href",r),p.setAttributeNS("http://www.w3.org/1999/xlink","href",r)},{autosaveReason:"image-select"})){s.style.transform="scale(0.95)",setTimeout(()=>{s.style.transform=""},150);return}if(ke!==n)try{await At(n)}catch{}if(M){const f=((u=M.tagName)==null?void 0:u.toLowerCase())==="svg"?M:M.closest("svg");if(f){const p=f.getAttribute("viewBox");let v=200,A=200,h=150;if(p){const x=p.split(/[\s,]+/).map(Number);x.length===4&&x.every(Number.isFinite)&&(v=x[0]+x[2]/2,A=x[1]+x[3]/2,h=Math.min(x[2],x[3])*.3)}const b=`uploaded_${Date.now()}`,k=document.createElementNS("http://www.w3.org/2000/svg","image");k.setAttribute("id",b),k.setAttribute("data-preview-node",b),k.setAttribute("href",r),k.setAttributeNS("http://www.w3.org/1999/xlink","href",r),k.setAttribute("x",String(v-h/2)),k.setAttribute("y",String(A-h/2)),k.setAttribute("width",String(h)),k.setAttribute("height",String(h)),k.setAttribute("preserveAspectRatio","xMidYMid meet"),f.appendChild(k),Fe(k)&&Re(k),kt(b),E==null||E.schedule("image-select"),s.style.transform="scale(0.95)",setTimeout(()=>{s.style.transform=""},150);return}}n==="front"?st=r:it=r;try{o&&typeof o.dataset=="object"&&(o.dataset[`${n}Image`]=r)}catch{}At(n),s.style.transform="scale(0.95)",setTimeout(()=>{s.style.transform=""},150),E==null||E.schedule("image-select")})})},Ts=()=>{if(!Fa)return;const t=Za().slice(0,5);if(t.length===0){Fa.innerHTML="";return}const a=t.map(r=>`
            <div class="quick-recent-upload-item" data-upload-id="${r.id}" data-image-url="${r.dataUrl}" data-side="${r.side}" title="${r.filename}">
                <img src="${r.dataUrl}" alt="${r.filename}" loading="lazy">
            </div>
        `).join("");Fa.innerHTML=a;const s=Fa.querySelectorAll(".quick-recent-upload-item");s.forEach(r=>{r.addEventListener("click",async()=>{var f;const n=r.dataset.imageUrl,u=r.dataset.side||ke||"front";if(s.forEach(p=>p.classList.remove("selected")),r.classList.add("selected"),he&&mt(v=>{v.setAttribute("href",n),v.setAttributeNS("http://www.w3.org/1999/xlink","href",n)},{autosaveReason:"image-select"})){r.style.transform="scale(0.9)",setTimeout(()=>{r.style.transform=""},150);return}if(ke!==u)try{await At(u)}catch{}if(M){const p=((f=M.tagName)==null?void 0:f.toLowerCase())==="svg"?M:M.closest("svg");if(p){const v=p.getAttribute("viewBox");let A=200,h=200,b=150;if(v){const C=v.split(/[\s,]+/).map(Number);C.length===4&&C.every(Number.isFinite)&&(A=C[0]+C[2]/2,h=C[1]+C[3]/2,b=Math.min(C[2],C[3])*.3)}const k=`uploaded_${Date.now()}`,m=document.createElementNS("http://www.w3.org/2000/svg","image");m.setAttribute("id",k),m.setAttribute("data-preview-node",k),m.setAttribute("href",n),m.setAttributeNS("http://www.w3.org/1999/xlink","href",n),m.setAttribute("x",String(A-b/2)),m.setAttribute("y",String(h-b/2)),m.setAttribute("width",String(b)),m.setAttribute("height",String(b)),m.setAttribute("preserveAspectRatio","xMidYMid meet"),p.appendChild(m),Fe(m)&&Re(m),kt(k),E==null||E.schedule("image-select"),r.style.transform="scale(0.9)",setTimeout(()=>{r.style.transform=""},150);return}}u==="front"?st=n:it=n;try{o&&typeof o.dataset=="object"&&(o.dataset[`${u}Image`]=n)}catch{}At(u),r.style.transform="scale(0.9)",setTimeout(()=>{r.style.transform=""},150),E==null||E.schedule("image-select")})})},Si=e=>{const t=e.files[0];if(!t)return;const a=new FileReader;a.onload=s=>{const r=s.target.result;Cs(r,t.name,ke||"front")},a.readAsDataURL(t)};ua&&ua.addEventListener("change",()=>Si(ua)),As&&As.addEventListener("click",()=>{ua.click()}),Ns&&Ns.addEventListener("click",()=>{ua.click()});const ki=e=>{var a;const t=(a=e.clipboardData)==null?void 0:a.items;if(!(!t||t.length===0))for(const s of t){if(!s||typeof s.type!="string"||!s.type.startsWith("image/"))continue;const r=s.getAsFile();if(!r)continue;const n=new FileReader;n.onload=u=>{const f=u.target.result,p=r.name||`pasted-${Date.now()}.png`;Cs(f,p,ke||"front")},n.readAsDataURL(r),e.preventDefault();break}};Is(),Ts(),document.addEventListener("paste",ki);const Qa=document.querySelectorAll(".pill-with-tooltip"),es=document.querySelector(".preview-canvas-wrapper"),ts=document.querySelector(".preview-guides"),Ls=(e,t)=>{e==="safety-pill"&&(es==null||es.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(ts==null||ts.classList.toggle("highlight-bleed",t))},ja=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),a=e==null?void 0:e.querySelector(".tooltip");!t||!a||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),a.setAttribute("aria-hidden","true"),Ls(t.id,!1))};Qa.forEach(e=>{const t=e.querySelector(".canvas-pill"),a=e.querySelector(".tooltip");!t||!a||(t.addEventListener("click",s=>{s.preventDefault();const r=!e.classList.contains("is-active");Qa.forEach(n=>{n!==e&&ja(n)}),r?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),a.setAttribute("aria-hidden","false"),Ls(t.id,!0)):ja(e)}),t.addEventListener("mouseenter",()=>{a.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{a.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||a.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&a.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",s=>{s.key==="Escape"&&(ja(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||Qa.forEach(a=>ja(a))});const Ai=e=>{if(!e)return!1;const t=Pe(a=>{a.setAttribute("font-family",e),a.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const a=Xt();a&&(a.dataset.fontFamily=e)}return t},Ni=e=>{const t=Ft(e,6,400),a=Pe(s=>{s.setAttribute("font-size",t),s.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(a){const s=Xt();s&&(s.dataset.fontSize=String(t))}return a},Ei=e=>{const t=Ft(e,8,400),a=39;return mt(s=>{const r=typeof s.getBBox=="function"?s.getBBox():null,n=parseFloat(s.getAttribute("width")),u=parseFloat(s.getAttribute("height")),f=Number(s.dataset.baseWidth)||(Number.isFinite(n)?n:(r==null?void 0:r.width)||1),p=Number(s.dataset.baseHeight)||(Number.isFinite(u)?u:(r==null?void 0:r.height)||1);s.dataset.baseWidth||(s.dataset.baseWidth=f),s.dataset.baseHeight||(s.dataset.baseHeight=p);const v=t/a,A=Math.max(1,f*v),h=Math.max(1,p*v);s.setAttribute("width",A),s.setAttribute("height",h)},{autosaveReason:"image-scale"})},Ci=e=>{const t=jt(e);if(!t)return!1;const a=Pe(s=>{s.setAttribute("fill",t),s.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(a){const s=Xt();s&&(s.dataset.color=t)}return a},Ii=e=>{const t=jt(e);if(!t||!o)return!1;try{return o.style.backgroundColor=t,o.dataset.backgroundColor=t,E==null||E.schedule("background-color"),!0}catch(a){return console.warn("[InkWise Studio] Failed to apply background color",a),!1}},Ti=e=>{if(!e||!o)return!1;try{return o.style.backgroundImage=`url(${e})`,o.style.backgroundSize="cover",o.style.backgroundPosition="center",o.style.backgroundRepeat="no-repeat",o.dataset.backgroundImage=e,E==null||E.schedule("background-image"),!0}catch(t){return console.warn("[InkWise Studio] Failed to apply background image",t),!1}},Li=e=>new Promise((t,a)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=a,s.readAsDataURL(e)}),_i=e=>{const t=jt(e);return t?mt(a=>{if(t==="#FFFFFF"){const b=a.dataset.tintFilterId;if(b){const k=Bt(a.ownerSVGElement||null),m=k==null?void 0:k.querySelector(`#${b}`);m==null||m.remove(),delete a.dataset.tintFilterId}a.removeAttribute("filter");try{delete a.dataset.tintColor}catch{}return}const s=Bt(a.ownerSVGElement||null);if(!s)return;const r=a.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,n=parseInt(t.slice(1,3),16)/255,u=parseInt(t.slice(3,5),16)/255,f=parseInt(t.slice(5,7),16)/255;let p=s.querySelector(`#${r}`);if(!p){p=document.createElementNS(q,"filter"),p.id=r,p.setAttribute("color-interpolation-filters","sRGB");const b=document.createElementNS(q,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),p.appendChild(b);const k=document.createElementNS(q,"feComponentTransfer"),m=document.createElementNS(q,"feFuncR");m.setAttribute("type","linear"),k.appendChild(m);const x=document.createElementNS(q,"feFuncG");x.setAttribute("type","linear"),k.appendChild(x);const C=document.createElementNS(q,"feFuncB");C.setAttribute("type","linear"),k.appendChild(C);const P=document.createElementNS(q,"feFuncA");P.setAttribute("type","identity"),k.appendChild(P),p.appendChild(k),s.appendChild(p)}const v=p.querySelector("feFuncR"),A=p.querySelector("feFuncG"),h=p.querySelector("feFuncB");v&&v.setAttribute("slope",n.toString()),A&&A.setAttribute("slope",u.toString()),h&&h.setAttribute("slope",f.toString()),a.dataset.tintFilterId=r,a.setAttribute("filter",`url(#${r})`);try{a.dataset.tintColor=t}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},Fi=()=>Pe(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",a=Number(t);t==="bold"||a>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),ji=()=>Pe(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),_s=e=>Pe(t=>{const s=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),r=new Set(s);r.has(e)?r.delete(e):r.add(e);const n=Array.from(r).join(" ");n?(t.style.textDecoration=n,t.setAttribute("text-decoration",n)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),Bi=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},a={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},s=t[e]||"start",r=a[e]||"left",n=Pe(u=>{u.setAttribute("text-anchor",s);const f=u.getAttribute("x");f&&u.querySelectorAll("tspan").forEach(p=>p.setAttribute("x",f)),u.style.textAlign=r},{autosaveReason:"text-align",skipTransformUpdate:!0});if(n){const u=Xt();u&&(u.dataset.align=r)}return n},Mi=e=>{let t=null;const a=Pe(s=>{const r=s.textContent||"";let n=r;e==="uppercase"?n=r.toUpperCase():e==="lowercase"&&(n=r.toLowerCase()),s.textContent=n,s.dataset.currentText=n,t=n},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(a){const s=Xt();s&&t!==null&&(s.value=t)}return a},Ri=()=>{const e=Xt();return Pe(t=>{const s=(t.textContent||"").split(/\r?\n/),r=t.dataset.listType==="bullet"||s.every(u=>u.trim().startsWith("â€¢")),n=r?s.map(u=>u.replace(/^\s*â€¢\s*/u,"")).join(`
`):s.map(u=>{const f=u.trim();return f?`â€¢ ${f}`:"â€¢"}).join(`
`);r?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=n,t.dataset.currentText=n,e&&e.dataset.previewTarget===be&&(e.value=n)},{autosaveReason:"text-list",skipTransformUpdate:!0})},Pi=e=>{const t=Ft(e,.5,5);return Pe(a=>{a.dataset.lineHeight=t,a.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},zi=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?Pe(a=>{if(Math.abs(t)<1e-4)a.style.letterSpacing="",a.removeAttribute("letter-spacing"),delete a.dataset.letterSpacing;else{const s=`${t.toFixed(2)}em`;a.style.letterSpacing=s,a.setAttribute("letter-spacing",s),a.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},$i=e=>{const t=typeof e=="string"?e:"none";return Pe(a=>{switch(t){case"shadow":a.dataset.effectStyle="shadow",a.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"highlight":a.dataset.effectStyle="highlight",a.style.filter="none",a.style.paintOrder="stroke fill",a.style.stroke="rgba(253, 224, 71, 0.85)",a.style.strokeWidth=6;break;case"glitch":a.dataset.effectStyle="glitch",a.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"echo":a.dataset.effectStyle="echo",a.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;default:delete a.dataset.effectStyle,a.style.filter="",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},Di=e=>{const t=e==="curve"?"curve":"none";return Pe(a=>{t==="curve"?a.dataset.effectShape="curve":delete a.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},qi=e=>{const t=Ft(e,0,100)/100;return Pe(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},Wi=e=>{const t=Ft(e,0,100)/100;return mt(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},Oi=e=>{const t=Ft(e,-180,180);return Pe(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},Ui=e=>{const t=Ft(e,-180,180);return mt(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},Fs=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let a=`${t}_${Date.now()}`,s=1;for(;document.querySelector(`[data-preview-node="${a}"]`);)a=`${t}_${Date.now()}_${s}`,s+=1;return a},Hi=()=>{const e=Gt();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=Fs(be||"text"),s=t.cloneNode(!0);s.setAttribute("data-preview-node",a),s.dataset.previewNode=a,s.id=a,s.dataset.defaultText=s.dataset.defaultText||s.textContent||"",t.parentNode.appendChild(s),Ca(s),Fe(s)&&Re(s);const n=bi(a,s.textContent||"");return n&&(n.value=s.textContent||"",setTimeout(()=>{try{n.focus({preventScroll:!1})}catch{}},0)),St(a),le(),E==null||E.schedule("duplicate-text-node"),!0},Vi=()=>{const e=Gt();if(!e.length)return!1;const t=be;if(e.forEach(a=>{var r;const s=(r=Te.get(a))==null?void 0:r.overlay;s&&(s.remove(),at.delete(s)),Te.delete(a),a.remove()}),t){const a=vs(t),s=a==null?void 0:a.closest(".text-field-item");s&&s.remove();const r=mi(t);r==null||r.remove()}return St(null),le(),E==null||E.schedule("remove-text-node"),!0},Gi=()=>{const e=_t();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=Fs(he||"image"),s=t.cloneNode(!0);s.setAttribute("data-preview-node",a),s.dataset.previewNode=a,s.id=a;const r=parseFloat(t.getAttribute("x"))||0,n=parseFloat(t.getAttribute("y"))||0;return s.setAttribute("x",r+10),s.setAttribute("y",n+10),s.dataset.tintFilterId&&(delete s.dataset.tintFilterId,s.removeAttribute("filter")),t.parentNode.appendChild(s),Ca(s),Fe(s)&&Re(s),kt(a),le(),E==null||E.schedule("duplicate-image-node"),!0},Xi=()=>{const e=_t();return e.length?(e.forEach(t=>{var s;const a=(s=Te.get(t))==null?void 0:s.overlay;a&&(a.remove(),at.delete(a)),Te.delete(t),t.remove()}),kt(null),le(),E==null||E.schedule("remove-image-node"),!0):!1},Yi=()=>{const e=He();if(e==="text"){const t=Pe(a=>{var u;const r=!(a.dataset.locked==="true");r?a.dataset.locked="true":delete a.dataset.locked;const n=(u=Te.get(a))==null?void 0:u.overlay;n&&(n.classList.toggle("editor-overlay--locked",r),n.style.pointerEvents=r?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&le(),t}if(e==="image"){const t=mt(a=>{var u;const r=!(a.dataset.locked==="true");r?a.dataset.locked="true":delete a.dataset.locked;const n=(u=Te.get(a))==null?void 0:u.overlay;n&&(n.classList.toggle("editor-overlay--locked",r),n.style.pointerEvents=r?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&le(),t}return!1},Ki=()=>{var a;const e=Gt();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return navigator.clipboard.writeText(t).catch(s=>{console.warn("[InkWise Studio] Clipboard write failed.",s)}),!0;try{const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),s.remove(),!0}catch(s){return console.warn("[InkWise Studio] Clipboard fallback failed.",s),!1}},Ji=()=>{var s;const e=_t();if(!e.length)return!1;const t=e[0],a=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!a)return!1;if((s=navigator==null?void 0:navigator.clipboard)!=null&&s.writeText)return navigator.clipboard.writeText(a).catch(r=>{console.warn("[InkWise Studio] Clipboard write failed for image.",r)}),!0;try{const r=document.createElement("textarea");return r.value=a,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),r.remove(),!0}catch(r){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",r),!1}},Zi=()=>{const e=He();return e==="text"?Ki():e==="image"?Ji():!1},Qi=()=>{const e=He();return e==="text"?Hi():e==="image"?Gi():!1},er=()=>{const e=He();return e==="text"?Vi():e==="image"?Xi():!1},tr=e=>{const t=He();return t==="text"?nr(e):t==="image"?or(e):!1},ar=e=>{const t=He();return t==="text"?qi(e):t==="image"?Wi(e):!1},sr=e=>{const t=He();return t==="text"?Oi(e):t==="image"?Ui(e):!1},ir=e=>{const t=He();return t==="text"?Ci(e):t==="image"?_i(e):t==="background"?Ii(e):!1},rr=e=>{const t=He();return t==="text"?Ni(e):t==="image"?Ei(e):!1},nr=e=>{const t=Gt();if(!t.length)return!1;const a=t[0],s=a.parentNode;if(!s)return!1;const r=Array.from(s.children),n=r.indexOf(a);if(n===-1)return!1;if(e==="bring-to-front")s.appendChild(a);else if(e==="send-to-back")s.insertBefore(a,r[0]);else if(e==="bring-forward"){const u=Math.min(r.length-1,n+1);if(u!==n){const f=r[u+1]||null;s.insertBefore(a,f)}}else if(e==="send-backward"){const u=Math.max(0,n-1);if(u!==n){const f=r[u];s.insertBefore(a,f)}}else return!1;return le(),E==null||E.schedule("text-layer"),!0},or=e=>{const t=_t();if(!t.length)return!1;const a=t[0],s=a.parentNode;if(!s)return!1;const r=Array.from(s.children),n=r.indexOf(a);if(n===-1)return!1;if(e==="bring-to-front")s.appendChild(a);else if(e==="send-to-back")s.insertBefore(a,r[0]);else if(e==="bring-forward"){const u=Math.min(r.length-1,n+1);if(u!==n){const f=r[u+1]||null;s.insertBefore(a,f)}}else if(e==="send-backward"){const u=Math.max(0,n-1);if(u!==n){const f=r[u];s.insertBefore(a,f)}}else return!1;return le(),E==null||E.schedule("image-layer"),!0},lr={setFontFamily:e=>He()!=="text"?!1:Ai(e),setFontSize:e=>rr(e),setColor:e=>ir(e),getActiveKey:()=>be,getSelection:()=>{const e=He();return{type:e,key:e==="text"?be:e==="image"?he:null,textKey:be,imageKey:he}},dispatch(e,t){const a=He();switch(e){case"bold":a==="text"&&Fi();break;case"italic":a==="text"&&ji();break;case"underline":a==="text"&&_s("underline");break;case"strikethrough":a==="text"&&_s("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":a==="text"&&Bi(e);break;case"list-bullets":a==="text"&&Ri();break;case"line-spacing":a==="text"&&Pi(t);break;case"letter-spacing":a==="text"&&zi(t);break;case"uppercase":case"lowercase":a==="text"&&Mi(e);break;case"effect-style":a==="text"&&$i(t);break;case"effect-shape":a==="text"&&Di(t);break;case"opacity":ar(t);break;case"rotation":sr(t);break;case"layer":tr(t);break;case"more":t==="duplicate"?Qi():t==="delete"?er():t==="lock"?Yi():t==="copy"&&Zi();break;case"replace-image":const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=r=>{const n=r.target.files[0];if(n){const u=new FileReader;u.onload=f=>{const p=f.target.result;mt(v=>{v.setAttribute("href",p),v.setAttributeNS("http://www.w3.org/1999/xlink","href",p)}),E==null||E.schedule("image-replace")},u.readAsDataURL(n)}},s.click();break;case"crop":{const r=_t();if(!r.length)break;const n=Te.get(r[0]),u=n==null?void 0:n.overlay;if(!u)break;if(ws(),(Oe==null?void 0:Oe.overlay)===u)Oe.refresh();else{gt();const f=Xa(u,r[0]);f&&(Oe=f)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=lr);const Yt=document.getElementById("canvas-zoom-select"),js=document.getElementById("canvas-zoom-display"),cr=document.querySelectorAll("[data-zoom-step]"),Bs=document.querySelector(".preview-canvas-wrapper"),Ba=L,Nt=[.25,.5,.75,1,1.5,2,3];if(Yt&&Bs&&Ba){const e=a=>{Ba.style.setProperty("--canvas-scale",a.toString()),Bs.style.removeProperty("transform"),Yt.value=a.toString(),js&&(js.textContent=`${Math.round(a*100)}%`),le()},t=a=>{const s=parseFloat(Yt.value)||1,r=Nt.indexOf(s);if(r===-1)return;let n=r;a==="up"&&r<Nt.length-1&&(n=r+1),a==="down"&&r>0&&(n=r-1),n!==r&&e(Nt[n])};Yt.addEventListener("change",a=>{const s=parseFloat(a.target.value)||1;e(s)}),cr.forEach(a=>{a.addEventListener("click",()=>{const s=a.dataset.zoomStep;s&&t(s==="up"?"up":"down")})}),Ba&&Ba.addEventListener("wheel",a=>{a.preventDefault();const s=parseFloat(Yt.value)||1;let r=s;if(a.deltaY>0){const n=Nt.indexOf(s);n>0&&(r=Nt[n-1])}else{const n=Nt.indexOf(s);n<Nt.length-1&&(r=Nt[n+1])}r!==s&&e(r)},{passive:!1}),e(parseFloat(Yt.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement,a=t&&typeof t.matches=="function"&&t.matches("#textFieldList input"),s=t&&typeof t.closest=="function"&&t.closest(".studio-react-widgets");!a&&!s&&(be||he||We?oa():document.body.classList.remove("text-toolbar-visible"))},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W,{once:!0}):W()}const rs=[{name:"Lobster",family:"Lobster",weight:"400",style:"normal"},{name:"Fredoka One",family:"Fredoka One",weight:"400",style:"normal"},{name:"Pacifico",family:"Pacifico",weight:"400",style:"normal"},{name:"Baloo 2",family:"Baloo 2",weight:"400",style:"normal"},{name:"Poppins Bold",family:"Poppins",weight:"700",style:"normal"},{name:"Anton",family:"Anton",weight:"400",style:"normal"},{name:"Gochi Hand",family:"Gochi Hand",weight:"400",style:"normal"},{name:"Bangers",family:"Bangers",weight:"400",style:"normal"},{name:"Chewy",family:"Chewy",weight:"400",style:"normal"},{name:"Rubik ExtraBold",family:"Rubik",weight:"800",style:"normal"},{name:"Comic Neue Bold",family:"Comic Neue",weight:"700",style:"normal"},{name:"Amatic SC Bold",family:"Amatic SC",weight:"700",style:"normal"},{name:"Luckiest Guy",family:"Luckiest Guy",weight:"400",style:"normal"},{name:"Kalam Bold",family:"Kalam",weight:"700",style:"normal"},{name:"Bubblegum Sans",family:"Bubblegum Sans",weight:"400",style:"normal"},{name:"Shrikhand",family:"Shrikhand",weight:"400",style:"normal"},{name:"Jua",family:"Jua",weight:"400",style:"normal"},{name:"DynaPuff",family:"DynaPuff",weight:"400",style:"normal"},{name:"Cabin Sketch",family:"Cabin Sketch",weight:"400",style:"normal"},{name:"Titan One",family:"Titan One",weight:"400",style:"normal"},{name:"Montserrat SemiBold",family:"Montserrat",weight:"600",style:"normal"},{name:"Helvetica Neue",family:"Helvetica Neue",weight:"400",style:"normal"},{name:"Lato Bold",family:"Lato",weight:"700",style:"normal"},{name:"Source Sans Pro",family:"Source Sans Pro",weight:"400",style:"normal"},{name:"Poppins Medium",family:"Poppins",weight:"500",style:"normal"},{name:"Roboto Condensed",family:"Roboto Condensed",weight:"400",style:"normal"},{name:"Open Sans",family:"Open Sans",weight:"400",style:"normal"},{name:"Oswald",family:"Oswald",weight:"400",style:"normal"},{name:"Nunito Sans",family:"Nunito Sans",weight:"400",style:"normal"},{name:"Inter SemiBold",family:"Inter",weight:"600",style:"normal"},{name:"Futura PT",family:"Futura PT",weight:"400",style:"normal"},{name:"Avenir Next",family:"Avenir Next",weight:"400",style:"normal"},{name:"Work Sans Medium",family:"Work Sans",weight:"500",style:"normal"},{name:"Proxima Nova",family:"Proxima Nova",weight:"400",style:"normal"},{name:"IBM Plex Sans",family:"IBM Plex Sans",weight:"400",style:"normal"},{name:"Barlow SemiCondensed",family:"Barlow Semi Condensed",weight:"400",style:"normal"},{name:"Sora",family:"Sora",weight:"400",style:"normal"},{name:"Metropolis",family:"Metropolis",weight:"400",style:"normal"},{name:"Urbanist",family:"Urbanist",weight:"400",style:"normal"},{name:"Manrope",family:"Manrope",weight:"400",style:"normal"},{name:"Quicksand Light",family:"Quicksand",weight:"300",style:"normal"},{name:"Great Vibes",family:"Great Vibes",weight:"400",style:"normal"},{name:"Parisienne",family:"Parisienne",weight:"400",style:"normal"},{name:"Nunito Light",family:"Nunito",weight:"300",style:"normal"},{name:"Cormorant Garamond",family:"Cormorant Garamond",weight:"400",style:"normal"},{name:"Playfair Display",family:"Playfair Display",weight:"400",style:"normal"},{name:"Allura",family:"Allura",weight:"400",style:"normal"},{name:"DM Sans",family:"DM Sans",weight:"400",style:"normal"},{name:"Satisfy",family:"Satisfy",weight:"400",style:"normal"},{name:"Karla",family:"Karla",weight:"400",style:"normal"},{name:"Josefin Light",family:"Josefin Sans",weight:"300",style:"normal"},{name:"Merriweather Light",family:"Merriweather",weight:"300",style:"normal"},{name:"Sacramento",family:"Sacramento",weight:"400",style:"normal"},{name:"Dancing Script",family:"Dancing Script",weight:"400",style:"normal"},{name:"Marcellus",family:"Marcellus",weight:"400",style:"normal"},{name:"Crimson Pro",family:"Crimson Pro",weight:"400",style:"normal"},{name:"ABeeZee",family:"ABeeZee",weight:"400",style:"normal"},{name:"GFS Didot",family:"GFS Didot",weight:"400",style:"normal"},{name:"Overlock Light",family:"Overlock",weight:"300",style:"normal"},{name:"Hind Soft",family:"Hind",weight:"400",style:"normal"},{name:"Cinzel",family:"Cinzel",weight:"400",style:"normal"},{name:"Cormorant Infant",family:"Cormorant Infant",weight:"400",style:"normal"},{name:"Playfair Display Italic",family:"Playfair Display",weight:"400",style:"italic"},{name:"Alex Brush",family:"Alex Brush",weight:"400",style:"normal"},{name:"Montserrat Light",family:"Montserrat",weight:"300",style:"normal"},{name:"Bodoni Moda",family:"Bodoni Moda",weight:"400",style:"normal"},{name:"Cormorant Upright",family:"Cormorant Upright",weight:"400",style:"normal"},{name:"Libre Baskerville Italic",family:"Libre Baskerville",weight:"400",style:"italic"},{name:"Tangerine",family:"Tangerine",weight:"400",style:"normal"},{name:"Cinzel Decorative",family:"Cinzel Decorative",weight:"400",style:"normal"},{name:"Forum",family:"Forum",weight:"400",style:"normal"},{name:"Cardo Italic",family:"Cardo",weight:"400",style:"italic"},{name:"Unna Italic",family:"Unna",weight:"400",style:"italic"},{name:"Prata",family:"Prata",weight:"400",style:"normal"},{name:"Gilda Display",family:"Gilda Display",weight:"400",style:"normal"},{name:"Cormorant SC",family:"Cormorant SC",weight:"400",style:"normal"},{name:"Quattrocento",family:"Quattrocento",weight:"400",style:"normal"},{name:"Marcellus SC",family:"Marcellus SC",weight:"400",style:"normal"}],Ar=[12,14,16,18,24,32,36,39,42,48,60];function ns(W,i,o){return Math.min(Math.max(W,i),o)}function Nr({onFontChange:W=()=>{},onSizeChange:i=()=>{},onAction:o=()=>{},onColorChange:l=()=>{},activeElementType:c=null}){const g=$.useMemo(()=>rs[0],[]),[N,w]=$.useState(g),[I,ie]=$.useState(39),[L,q]=$.useState(!1),[O,G]=$.useState(!1),X=$.useRef(null),ce=$.useRef(null),[ee,U]=$.useState(!1),D=$.useRef(null),[Z,ae]=$.useState(!1),ge=$.useRef(null),[Ce,xe]=$.useState(!1),Ae=$.useRef(null),[tt,K]=$.useState("#FFFFFF"),[Be,$e]=$.useState([]),ma=$.useMemo(()=>[{label:"Grayscale",colors:["#FFFFFF","#E5E7EB","#9CA3AF","#4B5563","#111827"]},{label:"Blues",colors:["#DCEEFB","#A8D1FF","#4DA1FF","#2563EB","#0B3D91"]},{label:"Greens",colors:["#DEF7EC","#BFEBD3","#34D399","#059669","#064E3B"]},{label:"Yellows",colors:["#FFFBEB","#FEF3C7","#FBBF24","#F59E0B","#B45309"]},{label:"Oranges",colors:["#FFF1E6","#FFD8B5","#FB923C","#F97316","#7C2D12"]},{label:"Reds",colors:["#FFEFF2","#FFD6DD","#EF4444","#DC2626","#58151C"]}],[]),[Ct,ot]=$.useState(0),[Mt,Rt]=$.useState(0),[Pt,ha]=$.useState(100),[lt,zt]=$.useState("swatches"),Ge=$.useRef(null),ya=$.useRef(!1),De=c==="text",Y=c==="image",Ne=De||Y,[$t,Dt]=$.useState(0),[qe,Te]=$.useState(0),[at,qt]=$.useState(0),[Se,M]=$.useState(0);function ea(S,F,te,ve){const _e=S/100,Ee=F/100,Ze=te/100,Fe=ve/100,Ke=Math.round(255*(1-_e)*(1-Fe)),Vt=Math.round(255*(1-Ee)*(1-Fe)),ka=Math.round(255*(1-Ze)*(1-Fe)),na=qa=>qa.toString(16).padStart(2,"0").toUpperCase();return`#${na(Ke)}${na(Vt)}${na(ka)}`}$.useEffect(()=>{try{const S=typeof window<"u"?window.inkwiseToolbar:null;if(S&&typeof S.getSelection=="function"){const F=S.getSelection();if(F){if(F.fontFamily){const te=rs.find(ve=>ve.family===F.fontFamily||ve.name===F.fontFamily);te&&w(te)}Number.isFinite(Number(F.fontSize))&&ie(Number(F.fontSize)),F.color&&K(String(F.color))}}}catch{}if(lt==="cmyk")try{const S=ea($t,qe,at,Se);K(S),l(S)}catch{}},[$t,qe,at,Se,lt]);function Wt(S){const F=S.replace("#",""),te=parseInt(F,16),ve=te>>16&255,_e=te>>8&255,Ee=te&255;return{r:ve,g:_e,b:Ee}}function ke(S,F,te){S/=255,F/=255,te/=255;const ve=Math.max(S,F,te),_e=Math.min(S,F,te);let Ee=0,Ze=0,Fe=(ve+_e)/2;if(ve!==_e){const Ke=ve-_e;switch(Ze=Fe>.5?Ke/(2-ve-_e):Ke/(ve+_e),ve){case S:Ee=(F-te)/Ke+(F<te?6:0);break;case F:Ee=(te-S)/Ke+2;break;case te:Ee=(S-F)/Ke+4;break}Ee/=6}return{h:Math.round(Ee*360),s:Math.round(Ze*100),l:Math.round(Fe*100)}}function st(S,F,te){F/=100,te/=100;const ve=Ze=>(Ze+S/30)%12,_e=F*Math.min(te,1-te),Ee=Ze=>{const Fe=te-_e*Math.max(-1,Math.min(ve(Ze)-3,Math.min(9-ve(Ze),1)));return Math.round(255*Fe).toString(16).padStart(2,"0")};return`#${Ee(0)}${Ee(8)}${Ee(4)}`.toUpperCase()}$.useEffect(()=>{try{const S=Wt(tt.replace("#","")),{h:F,s:te,l:ve}=ke(S.r,S.g,S.b);ot(F),Rt(te),ha(ve)}catch{}},[tt]),$.useEffect(()=>{const S=st(Ct,Mt,Pt);K(S)},[Ct,Mt,Pt]);const it=S=>{ya.current=!0,E(S),window.addEventListener("mousemove",E),window.addEventListener("mouseup",It)},E=S=>{if(!Ge.current)return;const F=Ge.current.getBoundingClientRect(),te=Math.min(Math.max(0,(S.clientX-F.left)/F.width),1),ve=Math.min(Math.max(0,(S.clientY-F.top)/F.height),1),_e=Math.round(te*100),Ee=Math.round((1-ve)*100);Rt(_e),ha(Ee)},It=()=>{ya.current=!1,window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",It)};$.useEffect(()=>{const S=te=>{(L&&X.current&&!X.current.contains(te.target)||O&&ce.current&&!ce.current.contains(te.target)||ee&&D.current&&!D.current.contains(te.target)||Z&&ge.current&&!ge.current.contains(te.target)||ct&&bt.current&&!bt.current.contains(te.target)||dt&&ta.current&&!ta.current.contains(te.target)||Ot&&Ut.current&&!Ut.current.contains(te.target)||sa&&ia.current&&!ia.current.contains(te.target))&&(q(!1),G(!1),U(!1),ae(!1),Le(!1),ze(!1),Me(!1),Ue(!1))},F=te=>{(te.key==="Escape"||te.key==="Esc")&&(q(!1),G(!1),U(!1),ae(!1),Le(!1),ze(!1),Me(!1),Ue(!1),Tt(!1),rt(!1),Re(!1),xe(!1))};return(L||O||ee||Z||ct||dt||Ot||Ce||sa||ut||Lt||pt)&&(document.addEventListener("mousedown",S),document.addEventListener("keydown",F)),()=>{document.removeEventListener("mousedown",S),document.removeEventListener("keydown",F)}},[L,O]);const be=S=>{De&&(w(S),W(S.family),q(!1))},he=S=>{const F=(S||"#FFFFFF").toUpperCase();K(F),l(F),$e(te=>[F,...te.filter(_e=>_e!==F)].slice(0,8)),G(!1)},We=S=>{const F=ns(S,8,96);ie(F),i(F)},Oe=S=>{Ne&&We(I+S)},Xe=S=>{if(!Ne)return;const F=Number(S.target.value);Number.isFinite(F)&&We(F)},[ct,Le]=$.useState(!1),bt=$.useRef(null),[dt,ze]=$.useState(!1),ta=$.useRef(null),[Ot,Me]=$.useState(!1),Ut=$.useRef(null),[ba,vt]=$.useState(1.4),[va,aa]=$.useState(.12),[sa,Ue]=$.useState(!1),[wa,xa]=$.useState(100),ia=$.useRef(null),[ut,Tt]=$.useState(!1),[Sa,Ye]=$.useState(0),ft=$.useRef(null),[Lt,rt]=$.useState(!1),ra=$.useRef(null),[pt,Re]=$.useState(!1),Da=$.useRef(null);$.useEffect(()=>{De||(q(!1),U(!1),ae(!1),Le(!1),ze(!1),Me(!1),xe(!1))},[De]),$.useEffect(()=>{Ne||(G(!1),Ue(!1),Tt(!1),rt(!1),Re(!1))},[Ne]);const le=()=>{De&&(vt(1.4),o("line-spacing")(1.4))},Ht=()=>{De&&(aa(.12),o("letter-spacing")(.12))};return d.jsxs("div",{className:`text-mini-toolbar ${Ne?"floating":""}`,role:"toolbar","aria-label":Y?"Image editing toolbar":"Text editing toolbar",children:[d.jsxs("div",{className:"toolbar-group toolbar-group--font",children:[Y?d.jsxs(d.Fragment,{children:[d.jsx("button",{type:"button",className:"ghost-button",onClick:()=>o("replace-image"),children:"Replace Image"}),d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("button",{type:"button",className:"ghost-button",onClick:()=>o("crop"),children:[d.jsx("i",{className:"fa-solid fa-crop-simple"})," Crop"]})]}):d.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>{De&&q(S=>!S)},"aria-label":De?"Choose font family":"Font selection available for text elements","aria-haspopup":"listbox","aria-expanded":L,disabled:!De,children:[De?N.name:"Select element"," ",d.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),De&&L&&d.jsx("div",{className:"font-modal",ref:X,children:d.jsx("div",{className:"font-modal-content",children:rs.map(S=>d.jsx("button",{type:"button",className:"font-option",onClick:()=>be(S),style:{fontFamily:S.family,fontWeight:S.weight,fontStyle:S.style},children:S.name},S.name))})})]}),d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("div",{className:"toolbar-group toolbar-group--size",role:"group","aria-label":Y?"Image scale":"Font size",children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":Y?"Decrease image scale":"Decrease font size",onClick:()=>Oe(-2),disabled:!Ne,children:d.jsx("i",{className:"fa-solid fa-minus","aria-hidden":"true"})}),d.jsx("label",{className:"sr-only",htmlFor:"mini-toolbar-size",children:Y?"Image scale":"Font size"}),d.jsx("select",{id:"mini-toolbar-size",className:"size-select",value:I,onChange:Xe,disabled:!Ne,children:Ar.map(S=>d.jsx("option",{value:S,children:S},S))}),d.jsx("button",{type:"button",className:"ghost-button","aria-label":Y?"Increase image scale":"Increase font size",onClick:()=>Oe(2),disabled:!Ne,children:d.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"})})]}),d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{type:"button",className:"color-swatch","aria-label":Y?"Choose image tint":"Choose text color",onClick:()=>{Ne&&(q(!1),G(S=>!S))},disabled:!Ne,"aria-expanded":O,children:d.jsx("span",{className:"color-swatch__chip",style:{background:tt}})}),O&&d.jsx("div",{className:"color-modal",ref:ce,children:d.jsxs("div",{className:"color-modal-content",children:[d.jsxs("div",{className:"color-modal-header",children:[d.jsx("div",{className:"color-modal-title",children:Y?"Image tint":"Text color"}),d.jsx("button",{type:"button",className:"ghost-button",onClick:()=>G(!1),"aria-label":"Close color picker",children:d.jsx("i",{className:"fa-solid fa-x"})})]}),d.jsx("div",{className:"color-picker-area",children:d.jsx("div",{className:"inline-color-picker",children:d.jsxs("div",{className:"spectrum-picker",children:[d.jsx("div",{className:"spectrum-area",ref:Ge,onMouseDown:it,style:{background:`linear-gradient(to right, #fff, hsl(${Ct}, 100%, 50%)), linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,1))`},role:"application","aria-label":"Color spectrum",children:d.jsx("div",{className:"spectrum-handle",style:{left:`${Mt}%`,top:`${100-Pt}%`},"aria-hidden":"true"})}),d.jsx("div",{className:"hue-row",children:d.jsx("input",{className:"hue-range",type:"range",min:"0",max:"360",value:Ct,onChange:S=>ot(Number(S.target.value)),style:{background:`linear-gradient(to right, ${Array.from({length:13}).map((S,F)=>`hsl(${F*30},100%,50%)`).join(",")})`},"aria-label":"Hue"})}),d.jsxs("div",{className:"hex-row",children:[d.jsx("input",{type:"text",className:"hex-input",value:st(Ct,Mt,Pt),onChange:S=>K(S.target.value),"aria-label":"Hex color value"}),d.jsx("button",{type:"button",className:"eyedropper-button",title:"Eyedropper","aria-label":"Eyedropper",children:d.jsx("i",{className:"fa-solid fa-eye-dropper"})})]})]})})}),d.jsxs("div",{className:"swatch-sections",children:[d.jsxs("div",{className:"tabs",children:[d.jsx("div",{className:`tab ${lt==="swatches"?"active":""}`,onClick:()=>zt("swatches"),children:"Swatches"}),d.jsx("div",{className:`tab ${lt==="cmyk"?"active":""}`,onClick:()=>zt("cmyk"),children:"CMYK"})]}),d.jsx("div",{className:"section-divider","aria-hidden":"true"}),lt==="swatches"&&d.jsxs(d.Fragment,{children:[Be.length>0&&d.jsxs("div",{className:"swatch-section",children:[d.jsx("div",{className:"swatch-title",children:"Recent colors"}),d.jsx("div",{className:"swatches-grid",children:Be.map(S=>d.jsx("button",{type:"button",className:"swatch",style:{background:S},onClick:()=>he(S)},S))})]}),Be.length>0&&ma.length>0&&d.jsx("div",{className:"section-divider","aria-hidden":"true"}),d.jsx("div",{className:"swatch-section",children:d.jsx("div",{className:"preset-groups",children:ma.map((S,F)=>d.jsx("div",{className:"swatch-group",children:d.jsx("div",{className:"swatches-grid preset",children:S.colors.map(te=>d.jsx("button",{type:"button",className:"swatch",style:{background:te},onClick:()=>he(te)},te))})},F))})})]}),lt==="cmyk"&&d.jsxs("div",{className:"swatch-section cmyk-section",children:[d.jsx("div",{className:"swatch-title",children:"CMYK (preview)"}),d.jsxs("div",{className:"cmyk-row",children:[d.jsx("div",{className:"cmyk-label",children:"C"}),d.jsx("input",{type:"range",min:"0",max:"100",value:$t,onChange:S=>Dt(Number(S.target.value)),className:"cmyk-range c-range","aria-label":"Cyan"}),d.jsxs("div",{className:"cmyk-value",children:[$t,"%"]})]}),d.jsxs("div",{className:"cmyk-row",children:[d.jsx("div",{className:"cmyk-label",children:"M"}),d.jsx("input",{type:"range",min:"0",max:"100",value:qe,onChange:S=>Te(Number(S.target.value)),className:"cmyk-range m-range","aria-label":"Magenta"}),d.jsxs("div",{className:"cmyk-value",children:[qe,"%"]})]}),d.jsxs("div",{className:"cmyk-row",children:[d.jsx("div",{className:"cmyk-label",children:"Y"}),d.jsx("input",{type:"range",min:"0",max:"100",value:at,onChange:S=>qt(Number(S.target.value)),className:"cmyk-range y-range","aria-label":"Yellow"}),d.jsxs("div",{className:"cmyk-value",children:[at,"%"]})]}),d.jsxs("div",{className:"cmyk-row",children:[d.jsx("div",{className:"cmyk-label",children:"K"}),d.jsx("input",{type:"range",min:"0",max:"100",value:Se,onChange:S=>M(Number(S.target.value)),className:"cmyk-range k-range","aria-label":"Key Black"}),d.jsxs("div",{className:"cmyk-value",children:[Se,"%"]})]})]})]})]})})]}),De&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("div",{className:"toolbar-group toolbar-group--actions",role:"group","aria-label":"Text format actions",style:{position:"relative"},children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bold",onClick:()=>{U(S=>!S),G(!1),q(!1)},children:d.jsx("span",{className:"toolbar-label",children:"B"})}),ee&&d.jsx("div",{className:"format-modal",ref:D,role:"dialog","aria-label":"Text formatting options",children:d.jsxs("div",{className:"format-modal-content",children:[d.jsx("button",{type:"button",className:"format-option",title:"Bold",onClick:()=>{o("bold"),U(!1)},children:d.jsx("i",{className:"fi fi-ss-bold","aria-hidden":"true"})}),d.jsx("button",{type:"button",className:"format-option",title:"Italic",onClick:()=>{o("italic"),U(!1)},children:d.jsx("i",{className:"fi fi-br-italic","aria-hidden":"true"})}),d.jsx("button",{type:"button",className:"format-option",title:"Underline",onClick:()=>{o("underline"),U(!1)},children:d.jsx("i",{className:"fi fi-br-underline","aria-hidden":"true"})}),d.jsx("button",{type:"button",className:"format-option",title:"Strikethrough",onClick:()=>{o("strikethrough"),U(!1)},children:d.jsx("i",{className:"fi fi-br-strikethrough","aria-hidden":"true"})})]})}),d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Align center",onClick:()=>{Le(S=>!S),U(!1),G(!1),q(!1)},children:d.jsx("i",{className:"fa-solid fa-align-center","aria-hidden":"true"})}),ct&&d.jsx("div",{className:"align-modal",ref:bt,role:"dialog","aria-label":"Alignment options",children:d.jsxs("div",{className:"align-modal-content",children:[d.jsx("button",{type:"button",className:"align-option",title:"Align-justify",onClick:()=>{o("align-justify"),Le(!1)},children:d.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[d.jsx("rect",{x:"3",y:"4",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"14",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),d.jsx("button",{type:"button",className:"align-option",title:"Align-center",onClick:()=>{o("align-center"),Le(!1)},children:d.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[d.jsx("rect",{x:"5",y:"4",width:"14",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"5",y:"14",width:"14",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),d.jsx("button",{type:"button",className:"align-option",title:"Align-left",onClick:()=>{o("align-left"),Le(!1)},children:d.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[d.jsx("rect",{x:"3",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),d.jsx("button",{type:"button",className:"align-option",title:"Align-right",onClick:()=>{o("align-right"),Le(!1)},children:d.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[d.jsx("rect",{x:"9",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"9",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),d.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})})]})}),d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bulleted list",onClick:()=>{ze(S=>!S),Le(!1),U(!1),G(!1),q(!1)},children:d.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})}),dt&&d.jsx("div",{className:"list-modal",ref:ta,role:"dialog","aria-label":"List options",children:d.jsxs("div",{className:"list-modal-content",children:[d.jsx("button",{type:"button",className:"list-option",title:"Numbered list",onClick:()=>{ze(!1),Me(!0)},children:d.jsx("i",{className:"fa-solid fa-list-ol","aria-hidden":"true"})}),d.jsx("button",{type:"button",className:"list-option",title:"Bulleted list",onClick:()=>{o("list-bullets"),ze(!1)},children:d.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})})]})}),d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Numbered list",onClick:()=>{Me(S=>!S),ze(!1),Le(!1),U(!1),G(!1),q(!1)},children:d.jsx("i",{className:"fa-solid fa-text-height","aria-hidden":"true"})}),Ot&&d.jsx("div",{className:"number-modal",ref:Ut,role:"dialog","aria-label":"Text spacing options",children:d.jsxs("div",{className:"number-modal-content",children:[d.jsxs("div",{className:"slider-row number-row",children:[d.jsx("label",{className:"slider-label",children:"Line spacing"}),d.jsx("input",{type:"range",min:"0.8",max:"3",step:"0.01",value:ba,onChange:S=>{const F=Number(S.target.value);vt(F),o("line-spacing")(F)},className:"number-range line-range","aria-label":"Line spacing"}),d.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:le,"aria-label":"Reset line spacing",children:"âŸ²"}),d.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:ba,onChange:S=>{const F=Number(S.target.value);vt(F),o("line-spacing")(F)}})]}),d.jsxs("div",{className:"slider-row number-row",children:[d.jsx("label",{className:"slider-label",children:"Letter spacing"}),d.jsx("input",{type:"range",min:"-0.5",max:"1",step:"0.01",value:va,onChange:S=>{const F=Number(S.target.value);aa(F),o("letter-spacing")(F)},className:"number-range letter-range","aria-label":"Letter spacing"}),d.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:Ht,"aria-label":"Reset letter spacing",children:"âŸ²"}),d.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:va,onChange:S=>{const F=Number(S.target.value);aa(F),o("letter-spacing")(F)}})]})]})})]}),d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("div",{className:"toolbar-group toolbar-group--menu",role:"group","aria-label":"Text styles",style:{position:"relative"},children:[d.jsx("button",{type:"button",className:"text-button",onClick:()=>{ae(S=>!S),ze(!1),Le(!1),G(!1),q(!1),Me(!1),U(!1),xe(!1)},"aria-label":"Format",children:"Format"}),Z&&d.jsx("div",{className:"case-modal format-modal",ref:ge,role:"dialog","aria-label":"Case options",children:d.jsxs("div",{className:"format-modal-content",children:[d.jsx("button",{type:"button",className:"format-option ",title:"Lowercase",onClick:()=>{o("lowercase"),ae(!1)},children:d.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"a"})}),d.jsx("button",{type:"button",className:"format-option ",title:"Uppercase",onClick:()=>{o("uppercase"),ae(!1)},children:d.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"A"})})]})}),d.jsxs("button",{type:"button",className:"text-button",onClick:()=>{xe(S=>!S),ae(!1),ze(!1),Le(!1),U(!1),G(!1),q(!1),Me(!1)},children:["T",d.jsx("span",{className:"text-button__super",children:"+"})," Effects"]}),Ce&&d.jsxs("div",{className:"effects-modal",ref:Ae,role:"dialog","aria-label":"Text effects",children:[d.jsx("button",{type:"button",className:"modal-close-btn","aria-label":"Close effects",onClick:()=>xe(!1),children:d.jsx("i",{className:"fa-solid fa-x","aria-hidden":"true"})}),d.jsxs("div",{className:"effects-modal-content",children:[d.jsxs("div",{className:"effects-section",children:[d.jsx("div",{className:"effects-section-title",children:"Style"}),d.jsxs("div",{className:"effects-grid",children:[d.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{o("effect-style")("none")},children:d.jsx("div",{className:"effect-preview none",children:d.jsx("i",{className:"fa-solid fa-ban","aria-hidden":"true"})})}),d.jsx("button",{type:"button",className:"effect-option",title:"Shadow",onClick:()=>{o("effect-style")("shadow")},children:d.jsx("div",{className:"effect-preview shadow",children:d.jsx("i",{className:"fi fi-rr-text-shadow","aria-hidden":"true"})})}),d.jsx("button",{type:"button",className:"effect-option",title:"Highlight",onClick:()=>{o("effect-style")("highlight")},children:d.jsx("div",{className:"effect-preview highlight",children:d.jsx("i",{className:"fa-solid fa-highlighter","aria-hidden":"true"})})}),d.jsx("button",{type:"button",className:"effect-option",title:"Glitch",onClick:()=>{o("effect-style")("glitch")},children:d.jsx("div",{className:"effect-preview glitch",children:d.jsx("span",{className:"glitch-mark",children:"/A"})})}),d.jsx("button",{type:"button",className:"effect-option",title:"Echo",onClick:()=>{o("effect-style")("echo")},children:d.jsx("div",{className:"effect-preview echo",children:d.jsx("span",{className:"echo-mark",children:"//A"})})})]})]}),d.jsxs("div",{className:"effects-section",children:[d.jsx("div",{className:"effects-section-title",children:"Shape"}),d.jsxs("div",{className:"effects-grid two",children:[d.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{o("effect-shape")("none")},children:d.jsx("div",{className:"effect-preview none",children:"None"})}),d.jsx("button",{type:"button",className:"effect-option",title:"Curve",onClick:()=>{o("effect-shape")("curve")},children:d.jsx("div",{className:"effect-preview curve",children:"Curve"})})]})]})]})]})]})]}),d.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),d.jsxs("div",{className:"toolbar-group toolbar-group--utility",role:"group","aria-label":"Utility actions",style:{position:"relative"},children:[d.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Spacing",onClick:()=>{Ne&&(Ue(S=>!S),xe(!1),ae(!1),ze(!1),Le(!1),U(!1),G(!1),q(!1),Me(!1))},disabled:!Ne,children:d.jsx("i",{className:"fi fi-rr-chess-board","aria-hidden":"true"})}),sa&&d.jsx("div",{className:"opacity-modal",ref:ia,role:"dialog","aria-label":"Opacity",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:d.jsxs("div",{className:"opacity-modal-content",children:[d.jsxs("div",{className:"opacity-row",children:[d.jsx("label",{className:"opacity-label",children:"Opacity"}),d.jsx("input",{className:"opacity-input",type:"number",min:"0",max:"100",value:wa,onChange:S=>{const F=ns(Number(S.target.value)||0,0,100);xa(F),o("opacity")(F)},"aria-label":"Opacity percent"})]}),d.jsx("div",{className:"opacity-slider-row",children:d.jsx("input",{type:"range",min:"0",max:"100",value:wa,onChange:S=>{const F=Number(S.target.value);xa(F),o("opacity")(F)},className:"opacity-slider","aria-label":"Opacity slider",style:{background:"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1))"}})})]})})]}),d.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Layers",onClick:()=>{Ne&&(rt(S=>!S),Tt(!1),Ue(!1),xe(!1),ae(!1),ze(!1),Le(!1),U(!1),G(!1),q(!1),Me(!1))},disabled:!Ne,children:d.jsx("i",{className:"fa-solid fa-layer-group","aria-hidden":"true"})}),Lt&&d.jsx("div",{className:"layers-modal",ref:ra,role:"dialog","aria-label":"Layer management",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:d.jsxs("div",{className:"layers-modal-content",children:[d.jsxs("button",{type:"button",className:"layer-option",title:"Bring to front",onClick:()=>{o("layer")("bring-to-front"),rt(!1)},children:[d.jsx("i",{className:"fi fi-rr-chevron-double-up","aria-hidden":"true"}),d.jsx("span",{className:"layer-label",children:"Bring to front"})]}),d.jsxs("button",{type:"button",className:"layer-option",title:"Bring forward",onClick:()=>{o("layer")("bring-forward"),rt(!1)},children:[d.jsx("i",{className:"fi fi-rr-angle-up","aria-hidden":"true"}),d.jsx("span",{className:"layer-label",children:"Bring forward"})]}),d.jsxs("button",{type:"button",className:"layer-option",title:"Send backward",onClick:()=>{o("layer")("send-backward"),rt(!1)},children:[d.jsx("i",{className:"fi fi-rr-angle-down","aria-hidden":"true"}),d.jsx("span",{className:"layer-label",children:"Send backward"})]}),d.jsxs("button",{type:"button",className:"layer-option",title:"Send to back",onClick:()=>{o("layer")("send-to-back"),rt(!1)},children:[d.jsx("i",{className:"fi fi-rr-chevron-double-down","aria-hidden":"true"}),d.jsx("span",{className:"layer-label",children:"Send to back"})]})]})})]}),d.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":"Share / Rotation",onClick:()=>{Ne&&(Tt(S=>!S),Ue(!1),xe(!1),ae(!1),ze(!1),Le(!1),U(!1),G(!1),q(!1),Me(!1))},disabled:!Ne,children:d.jsx("i",{className:"fi fi-rr-refresh","aria-hidden":"true"})}),ut&&d.jsx("div",{className:"rotation-modal",ref:ft,role:"dialog","aria-label":"Rotation",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:d.jsxs("div",{className:"rotation-modal-content",children:[d.jsxs("div",{className:"rotation-row",children:[d.jsx("label",{className:"rotation-label",children:"Rotation"}),d.jsx("input",{className:"rotation-input",type:"number",min:"-180",max:"180",value:Sa,onChange:S=>{const F=ns(Number(S.target.value)||0,-180,180);Ye(F),o("rotation")(F)},"aria-label":"Rotation degrees"})]}),d.jsxs("div",{className:"rotation-slider-row",children:[d.jsx("input",{type:"range",min:"-180",max:"180",value:Sa,onChange:S=>{const F=Number(S.target.value);Ye(F),o("rotation")(F)},className:"rotation-slider","aria-label":"Rotation slider"}),d.jsx("i",{className:"fa-solid fa-rotate-right rotation-icon","aria-hidden":"true"})]})]})})]}),d.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[d.jsx("button",{type:"button",className:"ghost-button","aria-label":"More options",onClick:()=>{Ne&&(Re(S=>!S),rt(!1),Tt(!1),Ue(!1),xe(!1),ae(!1),ze(!1),Le(!1),U(!1),G(!1),q(!1),Me(!1))},disabled:!Ne,children:d.jsx("i",{className:"fa-solid fa-ellipsis","aria-hidden":"true"})}),pt&&d.jsx("div",{className:"more-modal",ref:Da,role:"dialog","aria-label":"More options",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:d.jsxs("div",{className:"more-modal-content",children:[d.jsxs("button",{type:"button",className:"more-option",title:"Duplicate",onClick:()=>{o("more")("duplicate"),Re(!1)},children:[d.jsx("i",{className:"fa-solid fa-clone","aria-hidden":"true"}),d.jsx("span",{className:"more-label",children:"Duplicate"})]}),d.jsxs("button",{type:"button",className:"more-option",title:"Delete",onClick:()=>{o("more")("delete"),Re(!1)},children:[d.jsx("i",{className:"fi fi-rr-trash","aria-hidden":"true"}),d.jsx("span",{className:"more-label",children:"Delete"})]}),d.jsxs("button",{type:"button",className:"more-option",title:"Lock",onClick:()=>{o("more")("lock"),Re(!1)},children:[d.jsx("i",{className:"fi fi-rr-unlock","aria-hidden":"true"}),d.jsx("span",{className:"more-label",children:"Lock"})]}),d.jsxs("button",{type:"button",className:"more-option",title:"Copy",onClick:()=>{o("more")("copy"),Re(!1)},children:[d.jsx("i",{className:"fa-solid fa-copy","aria-hidden":"true"}),d.jsx("span",{className:"more-label",children:"Copy"})]})]})})]})]})]})}function si(){const W=document.getElementById("inkwise-customer-studio-bootstrap");if(W)try{const i=JSON.parse(W.textContent||"{}");if(i&&typeof i=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=i),i}catch(i){console.error("[InkWise Studio] Failed to parse bootstrap payload.",i)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Er({template:W}){if(!W)return d.jsx("span",{className:"studio-status__message",children:"Template data unavailable"});const i=W.updated_at?new Date(W.updated_at):null,o=i&&!Number.isNaN(i.getTime())?i.toLocaleString():"Not yet saved";return d.jsxs("div",{className:"studio-status__summary",children:[d.jsx("span",{className:"studio-status__template-name",title:W.name||"Untitled Template",children:W.name||"Untitled Template"}),W.svg_path&&d.jsx("span",{className:"studio-status__badge studio-status__badge--svg",children:"SVG ready"}),W.preview&&d.jsx("span",{className:"studio-status__badge studio-status__badge--preview",children:"Preview loaded"}),d.jsxs("span",{className:"studio-status__meta",children:["Updated: ",o]})]})}function Cr({bootstrap:W,status:i}){const o=(W==null?void 0:W.template)??null,l=(W==null?void 0:W.product)??null,c=i==="ready"?"Design canvas ready":i==="initializing"?"Preparing editorâ€¦":i;return d.jsxs("div",{className:"studio-status",role:"status","aria-live":"polite",children:[d.jsxs("div",{className:"studio-status__header",children:[d.jsx("span",{className:"studio-status__dot","data-state":i}),d.jsx("span",{className:"studio-status__label",children:c})]}),d.jsx(Er,{template:o}),l&&d.jsxs("div",{className:"studio-status__product",children:["Editing: ",l.name||`Product #${l.id}`]})]})}function Ir(){const W=$.useMemo(()=>si(),[]),[i,o]=$.useState("initializing"),[l,c]=$.useState(null);return $.useEffect(()=>{if(typeof document>"u")return;const g=l==="text"||l==="image";return document.body.classList.toggle("text-toolbar-visible",!!g),()=>{document.body.classList.remove("text-toolbar-visible")}},[l]),$.useEffect(()=>{kr(),o("ready")},[]),$.useEffect(()=>{if(typeof window>"u")return;const g=w=>{const I=(w==null?void 0:w.detail)||{};c(I.type||null)};window.addEventListener("inkwise:active-element",g);const N=window.inkwiseToolbar;if(N&&typeof N.getSelection=="function")try{const w=N.getSelection();w&&w.type&&c(w.type)}catch(w){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",w)}return()=>{window.removeEventListener("inkwise:active-element",g)}},[]),!W||Object.keys(W).length===0?null:d.jsx("div",{className:"studio-status-wrapper",children:d.jsx(Cr,{bootstrap:W,status:i})})}function Tr(){$.useMemo(()=>si(),[]);const[W,i]=$.useState(null);$.useEffect(()=>{if(typeof window>"u")return;const N=I=>{const ie=(I==null?void 0:I.detail)||{};i(ie.type||null)};window.addEventListener("inkwise:active-element",N);const w=typeof window<"u"?window.inkwiseToolbar:null;if(w&&typeof w.getSelection=="function")try{const I=w.getSelection();I&&I.type&&i(I.type)}catch{}return()=>window.removeEventListener("inkwise:active-element",N)},[]),$.useEffect(()=>{if(typeof document>"u")return;const N=W==="text"||W==="image";return document.body.classList.toggle("text-toolbar-visible",!!N),()=>document.body.classList.remove("text-toolbar-visible")},[W]);const o=N=>{const w=typeof window<"u"?window.inkwiseToolbar:null;!w||typeof w.setFontFamily!="function"||w.setFontFamily(N)},l=N=>{const w=typeof window<"u"?window.inkwiseToolbar:null;!w||typeof w.setFontSize!="function"||w.setFontSize(N)},c=N=>{const w=typeof window<"u"?window.inkwiseToolbar:null;!w||typeof w.setColor!="function"||w.setColor(N)},g=N=>{const w=typeof window<"u"?window.inkwiseToolbar:null;return!w||typeof w.dispatch!="function"?()=>{}:new Set(["line-spacing","letter-spacing","effect-style","effect-shape","opacity","rotation","layer","more"]).has(N)?ie=>w.dispatch(N,ie):(w.dispatch(N),()=>{})};return d.jsx("div",{className:"studio-react-widgets","aria-hidden":!1,children:d.jsx(Nr,{onAction:g,onFontChange:o,onSizeChange:l,onColorChange:c,activeElementType:W})})}function Lr(){const W=()=>{const i=document.getElementById("inkwise-customer-studio-root");if(i){i.__inkwiseRoot||(i.__inkwiseRoot=Qs.createRoot(i)),i.__inkwiseRoot.render(d.jsx(ei.StrictMode,{children:d.jsx(Ir,{})}));try{const o=document.querySelector(".preview-canvas-wrapper");let c=document.getElementById("inkwise-mini-toolbar-root");!c&&o&&(c=document.createElement("div"),c.id="inkwise-mini-toolbar-root",c.className="studio-react-widgets",o.parentNode.insertBefore(c,o.nextSibling)),c&&(c.__inkwiseRoot||(c.__inkwiseRoot=Qs.createRoot(c)),c.__inkwiseRoot.render(d.jsx(ei.StrictMode,{children:d.jsx(Tr,{})})))}catch(o){console.debug("[InkWise Studio] Failed to mount toolbar in preview area",o)}}};if(document.readyState==="complete"||document.readyState==="interactive"){W();return}document.addEventListener("DOMContentLoaded",W,{once:!0})}Lr();const pa="http://www.w3.org/2000/svg",ai="http://www.w3.org/1999/xlink";class os{constructor(i,o={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",i),this.svg=i,this.options={onImageChange:o.onImageChange||null,onTextChange:o.onTextChange||null,...o};const l=document&&document.body&&document.body.dataset?document.body.dataset:{},c=(l.imageReplacementMode||"").toLowerCase();let g="full";c==="panel-only"||c==="disabled"?g=c:l.allowImageReplacement==="false"&&(g="disabled"),this.imageReplacementMode=g,this.allowCanvasImageTools=g!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const i=this.svg.dataset.svgData;if(i)try{const o=JSON.parse(i);this.changeableImages=o.changeable_images||[],this.textElements=o.text_elements||[]}catch(o){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",o)}}readDatasetTokens(i){return!i||!i.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(l=>i.dataset[l]).filter(l=>typeof l=="string"&&l.trim()!=="").map(l=>l.trim().toLowerCase())}findImageContentNode(i){return!i||typeof i.querySelector!="function"?null:i.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(i){if(!i)return!1;const o=typeof i.tagName=="string"?i.tagName.toLowerCase():"";if(o==="image"||o==="img"||this.readDatasetTokens(i).some(c=>c==="image"||c==="photo"||c==="graphic")||typeof i.hasAttribute=="function"&&(i.hasAttribute("data-editable-image")||i.hasAttribute("data-changeable-image")))return!0;if(i.classList){for(const c of this.imageClassTokens)if(i.classList.contains(c))return!0}return o==="foreignobject"?!!this.findImageContentNode(i):!1}resolveImageNode(i){if(!i)return null;if(this.nodeRepresentsImage(i))return i;if(typeof i.closest=="function"){const o=i.closest("[data-preview-node]");if(o&&o!==i&&this.nodeRepresentsImage(o))return o}return this.findImageContentNode(i)}resolveImageHandleNodes(i){const o=this.resolveImageNode(i);return o?{interactionNode:typeof o.closest=="function"&&o.closest("foreignObject")||o,contentNode:o}:null}applyImageSourceToNode(i,o){if(!i||!o)return null;const l=typeof i.tagName=="string"?i.tagName.toLowerCase():"";if(l==="image")return i.setAttributeNS(ai,"href",o),i.setAttribute("href",o),i.dataset&&(i.dataset.src=o),i;if(l==="img")return i.setAttribute("src",o),i.dataset&&(i.dataset.src=o),i;if(l==="foreignobject"){const c=this.findImageContentNode(i);return c&&c!==i?this.applyImageSourceToNode(c,o):null}return l==="rect"?this.convertRectToImage(i,o):(i.style&&typeof i.style.setProperty=="function"&&(i.style.backgroundImage=`url('${o}')`),i.dataset&&(i.dataset.src=o,i.dataset.replacedImage="true"),i)}convertRectToImage(i,o){if(!i||!i.parentNode)return null;const l=document.createElementNS(pa,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(g=>{i.hasAttribute&&i.hasAttribute(g)&&l.setAttribute(g,i.getAttribute(g))}),Array.from(i.attributes||[]).forEach(g=>{(g.name==="id"||g.name.startsWith("data-"))&&l.setAttribute(g.name,g.value)}),i.classList&&i.classList.length&&i.classList.forEach(g=>l.classList.add(g)),l.setAttribute("href",o),l.setAttributeNS(ai,"href",o),l.hasAttribute("preserveAspectRatio")||l.setAttribute("preserveAspectRatio","xMidYMid slice"),i.parentNode.replaceChild(l,i),l}escapeSelector(i){return typeof i!="string"||!i.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(i):i.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(i){if(!i||typeof i!="object")return null;const o=i.id||i.element_id||i.node_id;if(o){const c=`#${this.escapeSelector(o)}`,g=this.svg.querySelector(c);if(g)return g}const l=i.selector||i.css_selector;if(l)try{const c=this.svg.querySelector(l);if(c)return c}catch(c){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",l,c)}return null}collectImageCandidates(){const i=new Set;return this.changeableImages.forEach(l=>{const c=this.resolveNodeFromMetadata(l);c&&i.add(c)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(l=>{i.add(l)}),Array.from(i)}getBBoxSafe(i){if(!i||typeof i.getBBox!="function")return null;try{return i.getBBox()}catch(o){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",o,i),null}}toSvgPoint(i,o){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const l=this.svg.createSVGPoint();l.x=i,l.y=o;const c=this.svg.getScreenCTM();return c?l.matrixTransform(c.inverse()):null}setupImageHandlers(){const i=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",i.length,"changeable image elements"),!this.allowCanvasImageTools){i.forEach(o=>{const l=this.resolveImageHandleNodes(o);if(!l)return;const{interactionNode:c}=l;if(c.style.cursor="default",c.classList.remove("svg-changeable-image"),c.classList.remove("changeable-image-hover"),c._boundingBox){try{c._boundingBox.remove()}catch{}c._boundingBox=null}});return}setTimeout(()=>{i.forEach((o,l)=>{const c=this.resolveImageHandleNodes(o);if(!c)return;const{interactionNode:g,contentNode:N}=c;if(!g||g.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",l,g),g.__inkwiseSvgImageBound=!0,g.__inkwiseImageContent=N||g,g.style.cursor="pointer",g.classList.add("svg-changeable-image"),g.classList.add("changeable-image-hover"),g.addEventListener("mouseenter",()=>{g.classList.add("changeable-image-active")}),g.addEventListener("mouseleave",()=>{g.classList.remove("changeable-image-active")}),g.addEventListener("click",I=>{I.preventDefault(),this.showImageUploadDialog(g)});const w=this.createBoundingBox(g);w&&(g._boundingBox=w),this.makeDraggable(g)})},200)}createBoundingBox(i){const o=this.getBBoxSafe(i);if(!o)return null;const l=document.createElementNS(pa,"g");l.classList.add("svg-bounding-box");const c=document.createElementNS(pa,"rect");return c.classList.add("svg-bounding-box__rect"),c.setAttribute("fill","none"),c.setAttribute("stroke","#007cba"),c.setAttribute("stroke-width","2"),c.setAttribute("stroke-dasharray","5,5"),c.setAttribute("rx","3"),c.style.pointerEvents="none",l.appendChild(c),this.createResizeHandles().forEach(N=>l.appendChild(N)),this.svg.appendChild(l),this.positionBoundingElements(l,o),l}createResizeHandles(){const i=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(l=>{const c=document.createElementNS(pa,"circle");c.setAttribute("r","4"),c.setAttribute("fill","#007cba"),c.setAttribute("stroke","#ffffff"),c.setAttribute("stroke-width","1"),c.classList.add("resize-handle",`handle-${l.name}`),c.style.pointerEvents="all",c.style.cursor=`${l.name}-resize`,i.push(c)}),i}positionBoundingElements(i,o){if(!i||!o)return;const l=i.querySelector(".svg-bounding-box__rect");if(!l)return;const c=5,g=o.x-c,N=o.y-c,w=o.width+c*2,I=o.height+c*2;l.setAttribute("x",g),l.setAttribute("y",N),l.setAttribute("width",Math.max(w,0)),l.setAttribute("height",Math.max(I,0)),i.querySelectorAll(".resize-handle").forEach(L=>{L.classList.contains("handle-nw")?(L.setAttribute("cx",g),L.setAttribute("cy",N)):L.classList.contains("handle-ne")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N)):L.classList.contains("handle-sw")?(L.setAttribute("cx",g),L.setAttribute("cy",N+I)):L.classList.contains("handle-se")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N+I)):L.classList.contains("handle-n")?(L.setAttribute("cx",g+w/2),L.setAttribute("cy",N)):L.classList.contains("handle-s")?(L.setAttribute("cx",g+w/2),L.setAttribute("cy",N+I)):L.classList.contains("handle-e")?(L.setAttribute("cx",g+w),L.setAttribute("cy",N+I/2)):L.classList.contains("handle-w")&&(L.setAttribute("cx",g),L.setAttribute("cy",N+I/2))})}updateBoundingBox(i){if(!i||!i._boundingBox)return;const o=this.getBBoxSafe(i);this.positionBoundingElements(i._boundingBox,o)}focusElementById(i){if(!i||!this.svg)return!1;const o=`#${this.escapeSelector(i)}`;let l=null;try{l=this.svg.querySelector(o)}catch(w){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",i,w),!1}if(l||(l=this.svg.querySelector(`[data-element-id="${i}"]`)),!l)return!1;const g=(this.resolveImageHandleNodes(l)||{interactionNode:l}).interactionNode||l;return this.getBBoxSafe(g)?(this.updateBoundingBox(g),g._boundingBox&&(g._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{g._boundingBox&&g._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof g.scrollIntoView=="function"&&g.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),g.classList.add("changeable-image-active"),setTimeout(()=>g.classList.remove("changeable-image-active"),1200),!0):!1}makeDraggable(i){let o=!1,l=0,c=0,g=0,N=0,w=0,I=0;const ie=O=>{if(O.target.closest(".resize-handle"))return;const G=this.toSvgPoint(O.clientX,O.clientY);if(!G)return;const X=this.getBBoxSafe(i);if(!X)return;const ce=typeof i.getAttribute=="function",ee=typeof i.setAttribute=="function";l=ce?parseFloat(i.getAttribute("x")):X.x,c=ce?parseFloat(i.getAttribute("y")):X.y,Number.isNaN(l)&&(l=X.x,ee&&i.setAttribute("x",l)),Number.isNaN(c)&&(c=X.y,ee&&i.setAttribute("y",c)),g=G.x-l,N=G.y-c,w=l,I=c,o=!0,i.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",O.preventDefault()},L=O=>{if(!o)return;const G=this.toSvgPoint(O.clientX,O.clientY);G&&(w=G.x-g,I=G.y-N,typeof i.removeAttribute=="function"&&i.removeAttribute("transform"),typeof i.setAttribute=="function"&&(i.setAttribute("x",w),i.setAttribute("y",I)),this.updateBoundingBox(i),O.preventDefault())},q=O=>{if(!o)return;o=!1,i.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(i);const G=new CustomEvent("svgImageMoved",{detail:{element:i,x:w,y:I}});this.svg.dispatchEvent(G),O.preventDefault()};i.addEventListener("mousedown",ie),document.addEventListener("mousemove",L),document.addEventListener("mouseup",q),i._boundingBox&&i._boundingBox.querySelectorAll(".resize-handle").forEach(G=>{this.makeResizable(i,G)})}makeResizable(i,o){let l=!1,c=null,g=0,N=0,w=0,I=0,ie="",L=0;const q=X=>{const ce=this.toSvgPoint(X.clientX,X.clientY);if(!ce)return;const ee=this.getBBoxSafe(i);if(!ee)return;g=ee.width,N=ee.height;const U=typeof i.getAttribute=="function",D=typeof i.setAttribute=="function";w=U?parseFloat(i.getAttribute("x")):ee.x,I=U?parseFloat(i.getAttribute("y")):ee.y,Number.isNaN(w)&&(w=ee.x,D&&i.setAttribute("x",w)),Number.isNaN(I)&&(I=ee.y,D&&i.setAttribute("y",I)),L=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,c=ce,ie=Array.from(o.classList).find(Z=>Z.startsWith("handle-"))||"",l=!0,i.style.cursor=o.style.cursor,this.svg.style.cursor=o.style.cursor,document.body.style.userSelect="none",X.preventDefault(),X.stopPropagation()},O=X=>{if(!l)return;const ce=this.toSvgPoint(X.clientX,X.clientY);if(!ce)return;const ee=ce.x-c.x,U=ce.y-c.y;let D=g,Z=N,ae=w,ge=I;switch(ie){case"handle-se":D=g+ee,Z=N+U;break;case"handle-sw":D=g-ee,Z=N+U,ae=w+ee;break;case"handle-ne":D=g+ee,Z=N-U,ge=I+U;break;case"handle-nw":D=g-ee,Z=N-U,ae=w+ee,ge=I+U;break}D=Math.max(20,D),Z=Math.max(20,Z);const Ce=i.tagName.toLowerCase();if((Ce==="image"||Ce==="rect")&&typeof i.setAttribute=="function")i.setAttribute("width",D),i.setAttribute("height",Z),i.setAttribute("x",ae),i.setAttribute("y",ge);else{const xe=Math.max(1,g),Ae=Math.max(1,N),tt=D/xe,K=Z/Ae,Be=Math.max(tt,K),$e=Math.max(6,L*Be);typeof i.setAttribute=="function"&&i.setAttribute("font-size",$e)}this.updateBoundingBox(i),X.preventDefault(),X.stopPropagation()},G=X=>{if(!l)return;l=!1,i.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const ce={element:i,width:parseFloat(i.getAttribute?i.getAttribute("width"):"")||g,height:parseFloat(i.getAttribute?i.getAttribute("height"):"")||N,x:parseFloat(i.getAttribute?i.getAttribute("x"):"")||w,y:parseFloat(i.getAttribute?i.getAttribute("y"):"")||I},ee=new CustomEvent("svgImageResized",{detail:ce});this.svg.dispatchEvent(ee),X.preventDefault(),X.stopPropagation()};o.addEventListener("mousedown",q),document.addEventListener("mousemove",O),document.addEventListener("mouseup",G)}setupTextHandlers(){const i=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(l=>{l.style.cursor="pointer",l.classList.add("svg-editable-text"),l.addEventListener("click",function(c){c.preventDefault(),i.showTextEditDialog(l)}),l.addEventListener("mouseenter",function(){l.classList.add("editable-text-hover")}),l.addEventListener("mouseleave",function(){l.classList.remove("editable-text-hover")})})}showImageUploadDialog(i){const o=this,l=document.createElement("input");l.type="file",l.accept="image/*",l.style.display="none",l.addEventListener("change",function(c){const g=c.target.files[0];g&&o.handleImageUpload(g,i),l.parentNode&&l.parentNode.removeChild(l)}),document.body.appendChild(l),l.click()}async handleImageUpload(i,o){var L;const l=this,c=o&&o.__inkwiseImageContent?o.__inkwiseImageContent:o,g=((L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.getAttribute("content"))||null,N=new FormData;N.append("image",i),g&&N.append("_token",g);let w=null;try{const q=await fetch("/design/upload-image",{method:"POST",body:N,credentials:"same-origin"});if(!q.ok){const G=await q.text().catch(()=>"");throw new Error(`Upload failed (${q.status}): ${G}`)}const O=await q.json();w=O.url||O.path||null}catch(q){console.error("SvgTemplateEditor: Failed to upload image",q),alert("We could not upload your image. Please try again.");const O=new CustomEvent("svgImageUploadFailed",{detail:{error:q,file:i}});l.svg.dispatchEvent(O);return}if(!w){alert("Upload did not return a usable image URL.");return}const I=l.applyImageSourceToNode(c,w)||c;o&&I&&o.__inkwiseImageContent!==I&&(o.__inkwiseImageContent=I);const ie=new CustomEvent("svgImageChanged",{detail:{element:I,imageUrl:w,file:i}});l.svg.dispatchEvent(ie),l.options.onImageChange&&l.options.onImageChange(I,w,i),l.updateBoundingBox(o||I)}showTextEditDialog(i){const o=this,l=i.textContent||"",c=document.createElement("input");c.type="text",c.value=l,c.className="svg-text-editor";const g=i.getBoundingClientRect(),N=o.svg.getBoundingClientRect();c.style.position="absolute",c.style.left=g.left-N.left+"px",c.style.top=g.top-N.top+"px",c.style.width=Math.max(g.width,100)+"px",c.style.fontSize=window.getComputedStyle(i).fontSize,c.style.fontFamily=window.getComputedStyle(i).fontFamily,c.style.border="1px solid #007cba",c.style.padding="2px",c.style.background="white",c.style.zIndex="1000",i.style.visibility="hidden",o.svg.parentNode.appendChild(c),c.focus(),c.select();const w=function(){const I=c.value;for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(I)),i.style.visibility="visible",c.parentNode&&c.parentNode.removeChild(c);const ie=new CustomEvent("svgTextChanged",{detail:{element:i,oldText:l,newText:I}});o.svg.dispatchEvent(ie),o.options.onTextChange&&o.options.onTextChange(i,l,I)};c.addEventListener("blur",w),c.addEventListener("keydown",function(I){I.key==="Enter"?w():I.key==="Escape"&&(i.style.visibility="visible",c.parentNode&&c.parentNode.removeChild(c))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const i=document.createElement("style");i.id="svg-editor-styles",i.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(i)}getSvgString(){const i=this.svg.cloneNode(!0);i.querySelectorAll('.svg-bounding-box, .inkwise-editor-marker, [data-editor-only="true"]').forEach(c=>{var g;(g=c.parentNode)==null||g.removeChild(c)}),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.style.width="",i.style.height="",i.style.maxWidth="",i.style.maxHeight="",i.removeAttribute("preserveAspectRatio");const o=document.createElementNS(pa,"style");return o.id="inkwise-export-styles",o.textContent=`
            @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            text { white-space: pre; }
        `,i.insertBefore(o,i.firstChild),new XMLSerializer().serializeToString(i)}getSvgDataUrl(){const i=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))}async saveSvg(i,o="front"){const l=this.getSvgString();try{const c=await fetch(`/staff/templates/${i}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:l,side:o})});if(!c.ok){const N=await c.text().catch(()=>"");throw new Error(N||`Request failed with status ${c.status}`)}let g;try{g=await c.json()}catch(N){console.warn("SvgTemplateEditor: Failed to parse save response",N),g={success:!1,error:"Invalid response from server"}}return g}catch(c){return console.error("Failed to save SVG:",c),{success:!1,error:c.message}}}}function _r(){const W=()=>{const i=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",i.length,"SVGs with data-svg-editor attribute"),i.forEach((o,l)=>{o.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",l,"for SVG:",o),o.__inkwiseSvgTemplateEditor=new os(o))})};if(document.readyState==="complete"||document.readyState==="interactive"?W():document.addEventListener("DOMContentLoaded",W,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const i=new MutationObserver(o=>{o.forEach(l=>{l.addedNodes.forEach(c=>{c.nodeType===1&&c.matches&&c.matches("svg[data-svg-editor]")&&(c.__inkwiseSvgTemplateEditor||(c.__inkwiseSvgTemplateEditor=new os(c)))})})});i.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=i}}typeof window<"u"&&(window.SvgTemplateEditor=os,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,_r()));export{os as S};
