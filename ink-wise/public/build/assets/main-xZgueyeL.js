import{r as _,j as n,c as Ws,R as Vs}from"./client-Cv0X-2PX.js";const Ia="http://www.w3.org/2000/svg",Fr="http://www.w3.org/1999/xlink";class La{constructor(o,l={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",o),this.svg=o,this.options={onImageChange:l.onImageChange||null,onTextChange:l.onTextChange||null,...l};const u=document&&document.body&&document.body.dataset?document.body.dataset:{},p=(u.imageReplacementMode||"").toLowerCase();let y="full";p==="panel-only"||p==="disabled"?y=p:u.allowImageReplacement==="false"&&(y="disabled"),this.imageReplacementMode=y,this.allowCanvasImageTools=y!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const o=this.svg.dataset.svgData;if(o)try{const l=JSON.parse(o);this.changeableImages=l.changeable_images||[],this.textElements=l.text_elements||[]}catch(l){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",l)}}readDatasetTokens(o){return!o||!o.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(u=>o.dataset[u]).filter(u=>typeof u=="string"&&u.trim()!=="").map(u=>u.trim().toLowerCase())}findImageContentNode(o){return!o||typeof o.querySelector!="function"?null:o.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(o){if(!o)return!1;const l=typeof o.tagName=="string"?o.tagName.toLowerCase():"";if(l==="image"||l==="img"||this.readDatasetTokens(o).some(p=>p==="image"||p==="photo"||p==="graphic")||typeof o.hasAttribute=="function"&&(o.hasAttribute("data-editable-image")||o.hasAttribute("data-changeable-image")))return!0;if(o.classList){for(const p of this.imageClassTokens)if(o.classList.contains(p))return!0}return l==="foreignobject"?!!this.findImageContentNode(o):!1}resolveImageNode(o){if(!o)return null;if(this.nodeRepresentsImage(o))return o;if(typeof o.closest=="function"){const l=o.closest("[data-preview-node]");if(l&&l!==o&&this.nodeRepresentsImage(l))return l}return this.findImageContentNode(o)}resolveImageHandleNodes(o){const l=this.resolveImageNode(o);return l?{interactionNode:typeof l.closest=="function"&&l.closest("foreignObject")||l,contentNode:l}:null}applyImageSourceToNode(o,l){if(!o||!l)return null;const u=typeof o.tagName=="string"?o.tagName.toLowerCase():"";if(u==="image")return o.setAttributeNS(Fr,"href",l),o.setAttribute("href",l),o.dataset&&(o.dataset.src=l),o;if(u==="img")return o.setAttribute("src",l),o.dataset&&(o.dataset.src=l),o;if(u==="foreignobject"){const p=this.findImageContentNode(o);return p&&p!==o?this.applyImageSourceToNode(p,l):null}return u==="rect"?this.convertRectToImage(o,l):(o.style&&typeof o.style.setProperty=="function"&&(o.style.backgroundImage=`url('${l}')`),o.dataset&&(o.dataset.src=l,o.dataset.replacedImage="true"),o)}convertRectToImage(o,l){if(!o||!o.parentNode)return null;const u=document.createElementNS(Ia,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(y=>{o.hasAttribute&&o.hasAttribute(y)&&u.setAttribute(y,o.getAttribute(y))}),Array.from(o.attributes||[]).forEach(y=>{(y.name==="id"||y.name.startsWith("data-"))&&u.setAttribute(y.name,y.value)}),o.classList&&o.classList.length&&o.classList.forEach(y=>u.classList.add(y)),u.setAttribute("href",l),u.setAttributeNS(Fr,"href",l),u.hasAttribute("preserveAspectRatio")||u.setAttribute("preserveAspectRatio","xMidYMid slice"),o.parentNode.replaceChild(u,o),u}escapeSelector(o){return typeof o!="string"||!o.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(o):o.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(o){if(!o||typeof o!="object")return null;const l=o.id||o.element_id||o.node_id;if(l){const p=`#${this.escapeSelector(l)}`,y=this.svg.querySelector(p);if(y)return y}const u=o.selector||o.css_selector;if(u)try{const p=this.svg.querySelector(u);if(p)return p}catch(p){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",u,p)}return null}collectImageCandidates(){const o=new Set;return this.changeableImages.forEach(u=>{const p=this.resolveNodeFromMetadata(u);p&&o.add(p)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(u=>{o.add(u)}),Array.from(o)}getBBoxSafe(o){if(!o||typeof o.getBBox!="function")return null;try{return o.getBBox()}catch(l){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",l,o),null}}toSvgPoint(o,l){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const u=this.svg.createSVGPoint();u.x=o,u.y=l;const p=this.svg.getScreenCTM();return p?u.matrixTransform(p.inverse()):null}setupImageHandlers(){const o=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",o.length,"changeable image elements"),!this.allowCanvasImageTools){o.forEach(l=>{const u=this.resolveImageHandleNodes(l);if(!u)return;const{interactionNode:p}=u;if(p.style.cursor="default",p.classList.remove("svg-changeable-image"),p.classList.remove("changeable-image-hover"),p._boundingBox){try{p._boundingBox.remove()}catch{}p._boundingBox=null}});return}setTimeout(()=>{o.forEach((l,u)=>{const p=this.resolveImageHandleNodes(l);if(!p)return;const{interactionNode:y,contentNode:j}=p;if(!y||y.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",u,y),y.__inkwiseSvgImageBound=!0,y.__inkwiseImageContent=j||y,y.style.cursor="pointer",y.classList.add("svg-changeable-image"),y.classList.add("changeable-image-hover"),y.addEventListener("mouseenter",()=>{y.classList.add("changeable-image-active")}),y.addEventListener("mouseleave",()=>{y.classList.remove("changeable-image-active")}),y.addEventListener("click",F=>{F.preventDefault(),this.showImageUploadDialog(y)});const A=this.createBoundingBox(y);A&&(y._boundingBox=A),this.makeDraggable(y)})},200)}createBoundingBox(o){const l=this.getBBoxSafe(o);if(!l)return null;const u=document.createElementNS(Ia,"g");u.classList.add("svg-bounding-box");const p=document.createElementNS(Ia,"rect");return p.classList.add("svg-bounding-box__rect"),p.setAttribute("fill","none"),p.setAttribute("stroke","#007cba"),p.setAttribute("stroke-width","2"),p.setAttribute("stroke-dasharray","5,5"),p.setAttribute("rx","3"),p.style.pointerEvents="none",u.appendChild(p),this.createResizeHandles().forEach(j=>u.appendChild(j)),this.svg.appendChild(u),this.positionBoundingElements(u,l),u}createResizeHandles(){const o=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(u=>{const p=document.createElementNS(Ia,"circle");p.setAttribute("r","4"),p.setAttribute("fill","#007cba"),p.setAttribute("stroke","#ffffff"),p.setAttribute("stroke-width","1"),p.classList.add("resize-handle",`handle-${u.name}`),p.style.pointerEvents="all",p.style.cursor=`${u.name}-resize`,o.push(p)}),o}positionBoundingElements(o,l){if(!o||!l)return;const u=o.querySelector(".svg-bounding-box__rect");if(!u)return;const p=5,y=l.x-p,j=l.y-p,A=l.width+p*2,F=l.height+p*2;u.setAttribute("x",y),u.setAttribute("y",j),u.setAttribute("width",Math.max(A,0)),u.setAttribute("height",Math.max(F,0)),o.querySelectorAll(".resize-handle").forEach(E=>{E.classList.contains("handle-nw")?(E.setAttribute("cx",y),E.setAttribute("cy",j)):E.classList.contains("handle-ne")?(E.setAttribute("cx",y+A),E.setAttribute("cy",j)):E.classList.contains("handle-sw")?(E.setAttribute("cx",y),E.setAttribute("cy",j+F)):E.classList.contains("handle-se")?(E.setAttribute("cx",y+A),E.setAttribute("cy",j+F)):E.classList.contains("handle-n")?(E.setAttribute("cx",y+A/2),E.setAttribute("cy",j)):E.classList.contains("handle-s")?(E.setAttribute("cx",y+A/2),E.setAttribute("cy",j+F)):E.classList.contains("handle-e")?(E.setAttribute("cx",y+A),E.setAttribute("cy",j+F/2)):E.classList.contains("handle-w")&&(E.setAttribute("cx",y),E.setAttribute("cy",j+F/2))})}updateBoundingBox(o){if(!o||!o._boundingBox)return;const l=this.getBBoxSafe(o);this.positionBoundingElements(o._boundingBox,l)}focusElementById(o){if(!o||!this.svg)return!1;const l=`#${this.escapeSelector(o)}`;let u=null;try{u=this.svg.querySelector(l)}catch(A){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",o,A),!1}if(u||(u=this.svg.querySelector(`[data-element-id="${o}"]`)),!u)return!1;const y=(this.resolveImageHandleNodes(u)||{interactionNode:u}).interactionNode||u;return this.getBBoxSafe(y)?(this.updateBoundingBox(y),y._boundingBox&&(y._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{y._boundingBox&&y._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof y.scrollIntoView=="function"&&y.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),y.classList.add("changeable-image-active"),setTimeout(()=>y.classList.remove("changeable-image-active"),1200),!0):!1}makeDraggable(o){let l=!1,u=0,p=0,y=0,j=0,A=0,F=0;const U=W=>{if(W.target.closest(".resize-handle"))return;const V=this.toSvgPoint(W.clientX,W.clientY);if(!V)return;const G=this.getBBoxSafe(o);if(!G)return;const he=typeof o.getAttribute=="function",ie=typeof o.setAttribute=="function";u=he?parseFloat(o.getAttribute("x")):G.x,p=he?parseFloat(o.getAttribute("y")):G.y,Number.isNaN(u)&&(u=G.x,ie&&o.setAttribute("x",u)),Number.isNaN(p)&&(p=G.y,ie&&o.setAttribute("y",p)),y=V.x-u,j=V.y-p,A=u,F=p,l=!0,o.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",W.preventDefault()},E=W=>{if(!l)return;const V=this.toSvgPoint(W.clientX,W.clientY);V&&(A=V.x-y,F=V.y-j,typeof o.removeAttribute=="function"&&o.removeAttribute("transform"),typeof o.setAttribute=="function"&&(o.setAttribute("x",A),o.setAttribute("y",F)),this.updateBoundingBox(o),W.preventDefault())},P=W=>{if(!l)return;l=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(o);const V=new CustomEvent("svgImageMoved",{detail:{element:o,x:A,y:F}});this.svg.dispatchEvent(V),W.preventDefault()};o.addEventListener("mousedown",U),document.addEventListener("mousemove",E),document.addEventListener("mouseup",P),o._boundingBox&&o._boundingBox.querySelectorAll(".resize-handle").forEach(V=>{this.makeResizable(o,V)})}makeResizable(o,l){let u=!1,p=null,y=0,j=0,A=0,F=0,U="",E=0;const P=G=>{const he=this.toSvgPoint(G.clientX,G.clientY);if(!he)return;const ie=this.getBBoxSafe(o);if(!ie)return;y=ie.width,j=ie.height;const z=typeof o.getAttribute=="function",Q=typeof o.setAttribute=="function";A=z?parseFloat(o.getAttribute("x")):ie.x,F=z?parseFloat(o.getAttribute("y")):ie.y,Number.isNaN(A)&&(A=ie.x,Q&&o.setAttribute("x",A)),Number.isNaN(F)&&(F=ie.y,Q&&o.setAttribute("y",F)),E=parseFloat(o.getAttribute("font-size"))||parseFloat(window.getComputedStyle(o).fontSize)||16,p=he,U=Array.from(l.classList).find(O=>O.startsWith("handle-"))||"",u=!0,o.style.cursor=l.style.cursor,this.svg.style.cursor=l.style.cursor,document.body.style.userSelect="none",G.preventDefault(),G.stopPropagation()},W=G=>{if(!u)return;const he=this.toSvgPoint(G.clientX,G.clientY);if(!he)return;const ie=he.x-p.x,z=he.y-p.y;let Q=y,O=j,ne=A,je=F;switch(U){case"handle-se":Q=y+ie,O=j+z;break;case"handle-sw":Q=y-ie,O=j+z,ne=A+ie;break;case"handle-ne":Q=y+ie,O=j-z,je=F+z;break;case"handle-nw":Q=y-ie,O=j-z,ne=A+ie,je=F+z;break}Q=Math.max(20,Q),O=Math.max(20,O);const at=o.tagName.toLowerCase();if((at==="image"||at==="rect")&&typeof o.setAttribute=="function")o.setAttribute("width",Q),o.setAttribute("height",O),o.setAttribute("x",ne),o.setAttribute("y",je);else{const Ee=Math.max(1,y),kt=Math.max(1,j),rt=Q/Ee,Ae=O/kt,st=Math.max(rt,Ae),Dt=Math.max(6,E*st);typeof o.setAttribute=="function"&&o.setAttribute("font-size",Dt)}this.updateBoundingBox(o),G.preventDefault(),G.stopPropagation()},V=G=>{if(!u)return;u=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const he={element:o,width:parseFloat(o.getAttribute?o.getAttribute("width"):"")||y,height:parseFloat(o.getAttribute?o.getAttribute("height"):"")||j,x:parseFloat(o.getAttribute?o.getAttribute("x"):"")||A,y:parseFloat(o.getAttribute?o.getAttribute("y"):"")||F},ie=new CustomEvent("svgImageResized",{detail:he});this.svg.dispatchEvent(ie),G.preventDefault(),G.stopPropagation()};l.addEventListener("mousedown",P),document.addEventListener("mousemove",W),document.addEventListener("mouseup",V)}setupTextHandlers(){const o=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(u=>{u.style.cursor="pointer",u.classList.add("svg-editable-text"),u.addEventListener("click",function(p){p.preventDefault(),o.showTextEditDialog(u)}),u.addEventListener("mouseenter",function(){u.classList.add("editable-text-hover")}),u.addEventListener("mouseleave",function(){u.classList.remove("editable-text-hover")})})}showImageUploadDialog(o){const l=this,u=document.createElement("input");u.type="file",u.accept="image/*",u.style.display="none",u.addEventListener("change",function(p){const y=p.target.files[0];y&&l.handleImageUpload(y,o),u.parentNode&&u.parentNode.removeChild(u)}),document.body.appendChild(u),u.click()}handleImageUpload(o,l){const u=this,p=new FileReader,y=l&&l.__inkwiseImageContent?l.__inkwiseImageContent:l;p.onload=function(j){const A=j.target.result;if(!A)return;const F=u.applyImageSourceToNode(y,A)||y;l&&F&&l.__inkwiseImageContent!==F&&(l.__inkwiseImageContent=F);const U=new CustomEvent("svgImageChanged",{detail:{element:F,imageUrl:A,file:o}});u.svg.dispatchEvent(U),u.options.onImageChange&&u.options.onImageChange(F,A,o),u.updateBoundingBox(l||F)},p.onerror=function(j){console.error("SvgTemplateEditor: Failed to read selected image file",j);const A=new CustomEvent("svgImageUploadFailed",{detail:{error:j,file:o}});u.svg.dispatchEvent(A)},p.readAsDataURL(o)}showTextEditDialog(o){const l=this,u=o.textContent||"",p=document.createElement("input");p.type="text",p.value=u,p.className="svg-text-editor";const y=o.getBoundingClientRect(),j=l.svg.getBoundingClientRect();p.style.position="absolute",p.style.left=y.left-j.left+"px",p.style.top=y.top-j.top+"px",p.style.width=Math.max(y.width,100)+"px",p.style.fontSize=window.getComputedStyle(o).fontSize,p.style.fontFamily=window.getComputedStyle(o).fontFamily,p.style.border="1px solid #007cba",p.style.padding="2px",p.style.background="white",p.style.zIndex="1000",o.style.visibility="hidden",l.svg.parentNode.appendChild(p),p.focus(),p.select();const A=function(){const F=p.value;for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(document.createTextNode(F)),o.style.visibility="visible",p.parentNode&&p.parentNode.removeChild(p);const U=new CustomEvent("svgTextChanged",{detail:{element:o,oldText:u,newText:F}});l.svg.dispatchEvent(U),l.options.onTextChange&&l.options.onTextChange(o,u,F)};p.addEventListener("blur",A),p.addEventListener("keydown",function(F){F.key==="Enter"?A():F.key==="Escape"&&(o.style.visibility="visible",p.parentNode&&p.parentNode.removeChild(p))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const o=document.createElement("style");o.id="svg-editor-styles",o.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(o)}getSvgString(){var j;const o=(j=this.svg.closest(".preview-card-bg"))==null?void 0:j.querySelector(".canvas-overlay-layer"),l=(o==null?void 0:o.style.display)!=="none";o&&l&&(o.style.display="none");const u=this.svg.querySelectorAll(".svg-bounding-box"),p=[];u.forEach(A=>{A.parentNode&&(p.push({element:A,parent:A.parentNode}),A.parentNode.removeChild(A))});const y=new XMLSerializer().serializeToString(this.svg);return p.forEach(({element:A,parent:F})=>{F&&F.appendChild(A)}),o&&l&&(o.style.display=""),y}getSvgDataUrl(){const o=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o)))}async saveSvg(o,l="front"){const u=this.getSvgString();try{const p=await fetch(`/staff/templates/${o}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:u,side:l})});if(!p.ok){const j=await p.text().catch(()=>"");throw new Error(j||`Request failed with status ${p.status}`)}let y;try{y=await p.json()}catch(j){console.warn("SvgTemplateEditor: Failed to parse save response",j),y={success:!1,error:"Invalid response from server"}}return y}catch(p){return console.error("Failed to save SVG:",p),{success:!1,error:p.message}}}}function Gs(){const ue=()=>{const o=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",o.length,"SVGs with data-svg-editor attribute"),o.forEach((l,u)=>{l.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",u,"for SVG:",l),l.__inkwiseSvgTemplateEditor=new La(l))})};if(document.readyState==="complete"||document.readyState==="interactive"?ue():document.addEventListener("DOMContentLoaded",ue,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const o=new MutationObserver(l=>{l.forEach(u=>{u.addedNodes.forEach(p=>{p.nodeType===1&&p.matches&&p.matches("svg[data-svg-editor]")&&(p.__inkwiseSvgTemplateEditor||(p.__inkwiseSvgTemplateEditor=new La(p)))})})});o.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=o}}typeof window<"u"&&(window.SvgTemplateEditor=La,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,Gs()));function Ys(ue={}){const{collectSnapshot:o,routes:l={},statusLabel:u=null,statusDot:p=null,csrfToken:y=null,debounce:j=1200,onAfterSave:A=null}=ue;if(typeof o!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let F=null,U=null,E=null,P=null;const W=(z,Q={})=>{if(p instanceof HTMLElement&&p.setAttribute("data-state",z),u instanceof HTMLElement)switch(z){case"saving":u.textContent="Saving…";break;case"dirty":u.textContent="Unsaved changes";break;case"error":u.textContent="Save failed";break;case"saved":{const ne=(Q.timestamp instanceof Date?Q.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});u.textContent=`Saved ${ne}`;break}default:u.textContent="Saved";break}},V=async z=>{const Q=l.autosave;if(!Q)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const O=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...y?{"X-CSRF-TOKEN":y}:{}},credentials:"same-origin",body:JSON.stringify(z)});if(!O.ok){const ne=new Error(`Autosave responded with ${O.status}`);throw ne.status=O.status,ne.responseText=await O.text().catch(()=>null),ne}try{return await O.json()}catch{return{}}},G=async z=>{if(E)try{await E}catch{}U=null,W("saving");let Q;try{Q=await o(z)}catch(O){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",O),W("error"),O}if(!Q||typeof Q!="object")return W("saved",{timestamp:new Date}),null;E=V(Q);try{const O=await E;if(P=new Date,W("saved",{timestamp:P}),typeof A=="function")try{A(O,Q)}catch(ne){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",ne)}return O}catch(O){throw console.error("[InkWise Studio] Autosave request failed.",O),W("error"),O}finally{E=null}};return{schedule:(z="change")=>{U=z,F&&clearTimeout(F),W("dirty"),F=window.setTimeout(()=>{F=null,G(U).catch(()=>{})},Math.max(250,j))},flush:async(z="flush")=>(F&&(clearTimeout(F),F=null),E&&await E,U!==null?G(z):null),isSaving:()=>!!E,getLastSavedAt:()=>P,notifyError:()=>W("error"),markDirty:()=>W("dirty")}}function Xs(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const ue=()=>{var fr,pr,mr;const o=document.querySelectorAll("[data-preview-target]"),l=document.querySelector(".preview-card-bg"),u=document.getElementById("preview-svg"),p=document.querySelectorAll("[data-card-thumb]"),y=document.querySelectorAll("[data-card-view]"),j=document.getElementById("extraPreviewContainer"),A=document.getElementById("textFieldList"),F=document.querySelector("[data-add-text-field]"),U=document.querySelectorAll(".sidenav-btn"),E=document.querySelector(".canvas-stage"),P="http://www.w3.org/2000/svg",W=document.querySelector(".canvas-measure-horizontal .measure-value"),V=document.querySelector(".canvas-measure-vertical .measure-value"),G=document.querySelector(".preview-canvas-wrapper");let he=1;const ie=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),z=e=>!e||!e.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(a=>e.dataset[a]).filter(a=>typeof a=="string"&&a.trim()!=="").map(a=>a.trim().toLowerCase()),Q=e=>!e||typeof e.querySelector!="function"?null:e.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image'),O=e=>{if(!e)return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="image"||t==="img"||z(e).some(r=>r==="image"||r==="photo"||r==="graphic")||typeof e.hasAttribute=="function"&&(e.hasAttribute("data-editable-image")||e.hasAttribute("data-changeable-image")))return!0;if(e.classList){for(const r of ie)if(e.classList.contains(r))return!0}return!!(t==="foreignobject"&&Q(e))},ne=e=>{if(!e||O(e))return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="style"||t==="script"||t==="defs"||t==="title"||t==="metadata")return!1;if(t==="text"||t==="tspan"||z(e).some(i=>i.includes("text")||i==="names"||i==="heading"))return!0;const r=(e.textContent||"").trim();return!(!r||/\{[^}]*\}|;/.test(r)&&r.length>80)},je=e=>{if(!e)return"";const t=e.querySelectorAll("tspan");return t&&t.length>0?Ht(Array.from(t).map(a=>a.textContent||"").join(`
`)):Ht(e.textContent||"")},at=(e,t)=>{if(!e)return;const a=Ht(t),r=e.querySelectorAll("tspan");if(r&&r.length>0){const s=String(a??"").split(/\r?\n/);r.forEach((i,d)=>{i.textContent=s[d]??""})}else e.textContent=a??"";e.dataset&&(e.dataset.currentText=a??"")},Ee=e=>{if(!e)return null;if(O(e))return e;if(typeof e.closest=="function"){const a=e.closest("[data-preview-node]");if(a&&a!==e&&O(a))return a}const t=Q(e);return t||null},kt=(e,t)=>{if(!e||!t)return!1;const a=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(a==="image")return e.setAttributeNS("http://www.w3.org/1999/xlink","href",t),e.setAttribute("href",t),e.dataset.src=t,!0;if(a==="img")return e.setAttribute("src",t),e.dataset.src=t,!0;if(a==="foreignobject"){const r=Q(e);return r&&r!==e?kt(r,t):!1}return e.style&&(e.style.backgroundImage=`url('${t}')`),e.dataset&&(e.dataset.src=t,e.dataset.replacedImage="true"),!0},rt=e=>{if(!e||typeof e.insertBefore!="function"||e.querySelector('[data-inkwise-bg="true"]'))return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#ffffff"),a.setAttribute("data-inkwise-bg","true"),e.insertBefore(a,e.firstChild)},Ae=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{},st=(Ae==null?void 0:Ae.routes)??{},Dt=((fr=document.querySelector('meta[name="csrf-token"]'))==null?void 0:fr.getAttribute("content"))||((pr=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:pr.getAttribute("content"))||null,ca=document.querySelector(".topbar-status-label"),ut=document.querySelector(".topbar-status-dot"),qt=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},Ct=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},da=e=>{var i,d;if(!l)return null;const t=window.getComputedStyle(l),r=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(r&&r[2])return r[2];const s=`${e}Image`;return s&&((i=l.dataset)!=null&&i[s])?l.dataset[s]:((d=l.dataset)==null?void 0:d.frontImage)||null},Et=()=>A?Array.from(A.querySelectorAll("input[data-preview-target]")).map(e=>{var r,s;const t=e.closest(".text-field-item"),a=((s=(r=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:r.textContent)==null?void 0:s.trim())||e.dataset.previewTarget||"";return{key:e.dataset.previewTarget||"",label:a,value:e.value||"",defaultValue:e.dataset.defaultValue||""}}):[],zt=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const a=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return a?parseFloat(a[0]):Number.NaN}return Number.NaN},ze=e=>{if(!e)return null;if(typeof e=="string"){const m=e.trim();if(!m)return null;try{const N=JSON.parse(m);return ze(N)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((m,N)=>N&&typeof N=="object"?Object.assign(m,N):m,{}):Object.assign({},e),a=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,r=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,s=zt(a),i=zt(r);if(!Number.isFinite(s)||s<=0||!Number.isFinite(i)||i<=0)return null;const d=t.shape??t.Shape??t.canvasShape??null,h=t.unit??t.Unit??t.canvasUnit??null;return{width:s,height:i,shape:typeof d=="string"&&d.trim()!==""?d.trim():null,unit:typeof h=="string"&&h.trim()!==""?h.trim():"px"}},Me=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},Ot=ze(G==null?void 0:G.dataset);let L=ze(((mr=Ae==null?void 0:Ae.template)==null?void 0:mr.canvas)??null)||Ot||null;const _e=720,ge=920,Xe=new Map;let Oe=null;const fe=new Map,ft=new Map;let Ke=null,ye=null,K=null,ua=null,At=()=>{},Je="front",Ze=null,Be=null,x=null,oe=null,pe=null,Ue=!1,Re=null;const Ut=8,fa=4,Ht=e=>{const a=(e||"").toString().trim();return/::before|\{[^}]*\}|;/.test(a)&&a.length>120?"":a},Wt=e=>{if(!e||e==="front"||e!=="back")return!0;if(!l)return!1;if(Be)return!0;const t=l.dataset||{};return t.hasBack==="true"?!0:!!(t.backImage||t.backSvg)},we=()=>{if(!l)return null;const e=new Date,t=Je||"front",a=K;let r=null;if(a)try{r=new XMLSerializer().serializeToString(a),r&&!/xmlns=/i.test(r)&&(r=r.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(b){console.warn("[InkWise Studio] Unable to serialize current SVG.",b),r=null}const s=r?Ct(r):da(t),i=Et(),d=i.filter(b=>{const w=(b.value||"").trim(),v=(b.defaultValue||"").trim();return w===""||v!==""&&w===v}).map(b=>b.label||b.key).map(b=>(b||"").trim()).filter((b,w,v)=>b!==""&&v.indexOf(b)===w),h=[];if(a){const b=new Set;a.querySelectorAll('image,img,[data-changeable="image"]').forEach(w=>{const v=w.getAttribute("href")||w.getAttribute("xlink:href")||w.getAttributeNS("http://www.w3.org/1999/xlink","href")||w.getAttribute("data-src");if(!v)return;const B=w.getAttribute("data-preview-node")||w.id||`image-${h.length+1}`;b.has(B)||(b.add(B),h.push({key:B,href:v,x:w.getAttribute("x")||null,y:w.getAttribute("y")||null,width:w.getAttribute("width")||null,height:w.getAttribute("height")||null}))})}const m=l?{width:qt(l.dataset.canvasWidth),height:qt(l.dataset.canvasHeight),unit:l.dataset.canvasUnit||null,shape:l.dataset.canvasShape||null}:null,N=s?[s]:[];return{design:{updated_at:e.toISOString(),sides:{[t]:{svg:r,preview:s}},texts:i,images:h,canvas:m},preview:{image:s,images:N},placeholders:d}};try{x=Ys({collectSnapshot:we,routes:st,csrfToken:Dt,statusLabel:ca,statusDot:ut})}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),x=null}const Ie=document.querySelector('[data-action="proceed-review"]');if(Ie){const e=Ie.dataset.destination||st.review||Ie.getAttribute("href")||window.location.href;Ie.addEventListener("click",async t=>{if(t.preventDefault(),Ie.dataset.navigating==="1")return;Ie.dataset.navigating="1",Ie.disabled=!0;const a=()=>{window.location.href=e};if(!x){a();return}try{await x.flush("navigate"),a()}catch(r){console.error("[InkWise Studio] Unable to save before navigating.",r),x.notifyError(),Ie.disabled=!1,Ie.dataset.navigating="0"}})}const it=e=>{const t=Ee(e);if(!t)return;const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=r=>{const s=r.target.files&&r.target.files[0];if(!s)return;const i=new FileReader;i.onload=d=>{var N;const h=(N=d.target)==null?void 0:N.result;if(!h)return;kt(t,h)&&(Z(),x==null||x.schedule("image-replace"))},i.readAsDataURL(s)},a.click()},Ce=()=>l?((!Oe||!Oe.isConnected)&&(Oe=document.createElement("div"),Oe.className="canvas-overlay-layer",l.appendChild(Oe)),Oe):null,pt=()=>{fe.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),fe.clear(),ft.clear(),Oe&&(Oe.innerHTML=""),oe=null,pe=null,ra(),document.body.classList.remove("text-toolbar-visible"),sa()},He=(e,t)=>{if(e==null)return t;const a=e.toString().split(/[\s,]+/).filter(Boolean);if(a.length===0)return t;const r=parseFloat(a[0]);return Number.isFinite(r)?r:t},Se=e=>{if(!l)return;const t=fe.get(e);if(!t||!t.overlay)return;const a=t.overlay,r=l.getBoundingClientRect(),s=e.getBoundingClientRect();if(r.width===0||r.height===0)return;const i=t.type==="text"?18:12,d=Math.max(i,s.width),h=Math.max(i,s.height);a.style.left=`${s.left-r.left}px`,a.style.top=`${s.top-r.top}px`,a.style.width=`${d}px`,a.style.height=`${h}px`},Vt=()=>{fe.forEach((e,t)=>{Se(t)})},Z=()=>{fe.size!==0&&(Ke&&cancelAnimationFrame(Ke),Ke=window.requestAnimationFrame(()=>{Ke=null,Vt()}))},nt=(e=3)=>{e<=0||requestAnimationFrame(()=>{Z(),nt(e-1)})};window.addEventListener("resize",Z),document.addEventListener("scroll",Z,!0),window.addEventListener("load",Z);const Gt=(e,t)=>{const a=K||u;if(!a||typeof a.createSVGPoint!="function")return null;const r=a.createSVGPoint();r.x=e,r.y=t;const s=a.getScreenCTM();return s?r.matrixTransform(s.inverse()):null},Yt=(e,t,a)=>{const r=Gt(a.clientX,a.clientY);if(!r)return null;const{node:s}=e,i=s.getBBox?s.getBBox():{x:0,y:0,width:0,height:0},d={data:e,overlay:e.overlay,node:s,type:e.type,handle:t,mode:t?"resize":"move",pointerId:a.pointerId,startPoint:r,startClient:{x:a.clientX,y:a.clientY},initialBBox:i,moved:!1};if(e.type==="text"){d.fontSize=parseFloat(s.getAttribute("font-size"))||parseFloat(window.getComputedStyle(s).fontSize)||16,d.x=He(s.getAttribute("x"),i.x);const h=i.y+i.height;d.y=He(s.getAttribute("y"),h)}else d.x=He(s.getAttribute("x"),i.x),d.y=He(s.getAttribute("y"),i.y),d.width=He(s.getAttribute("width"),Math.max(1,i.width)),d.height=He(s.getAttribute("height"),Math.max(1,i.height));return d},Xt=(e,t,a)=>{if(e.type==="text"){const r=e.x+t,s=e.y+a;Number.isFinite(r)&&e.node.setAttribute("x",r),Number.isFinite(s)&&e.node.setAttribute("y",s)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+a)},ot=(e,t,a)=>{if(e.type==="image"){let r=e.x,s=e.y,i=e.width,d=e.height;e.handle.includes("e")&&(i=e.width+t),e.handle.includes("w")&&(i=e.width-t,r=e.x+t),e.handle.includes("s")&&(d=e.height+a),e.handle.includes("n")&&(d=e.height-a,s=e.y+a);const h=4;i<h&&(r+=i-h,i=h),d<h&&(s+=d-h,d=h),e.node.setAttribute("x",r),e.node.setAttribute("y",s),e.node.setAttribute("width",i),e.node.setAttribute("height",d)}else if(e.type==="text"){const r=Math.max(1,e.initialBBox.width),s=Math.max(1,e.initialBBox.height);let i=0,d=0;e.handle.includes("e")?i=t:e.handle.includes("w")&&(i=-t),e.handle.includes("s")?d=a:e.handle.includes("n")&&(d=-a);const h=Math.max(4,r+i),m=Math.max(4,s+d),N=h/r,b=m/s,w=Math.max(N,b),v=Math.max(6,e.fontSize*w);e.node.setAttribute("font-size",v)}},Kt=e=>{if(!ye||e.pointerId!==ye.pointerId)return;const t=Gt(e.clientX,e.clientY);if(!t)return;const a=t.x-ye.startPoint.x,r=t.y-ye.startPoint.y;!ye.moved&&(Math.abs(a)>.5||Math.abs(r)>.5)&&(ye.moved=!0),ye.mode==="move"?Xt(ye,a,r):ot(ye,a,r),Z()},mt=e=>{if(!ye||e.pointerId!==ye.pointerId)return;try{ye.overlay.releasePointerCapture(ye.pointerId)}catch{}ye.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",Kt),document.removeEventListener("pointerup",mt),document.removeEventListener("pointercancel",mt);const t=ye;ye=null,Z(),t.moved?x==null||x.schedule("element-transform"):t.type==="text"?At(t.data.previewKey):t.type==="image"&&it(t.node)},Jt=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t||t.dataset.cropSessionActive==="true")return;const a=ft.get(t);if(!a)return;a.type==="text"?lt(a.previewKey||null):a.type==="image"&&ia(a.previewKey||null);const r=Yt(a,e.target.dataset.handle||null,e);if(r){e.preventDefault(),ye=r,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",Kt),document.addEventListener("pointerup",mt),document.addEventListener("pointercancel",mt)}},ht=e=>{const t=Ce();if(!t)return null;let a=fe.get(e);if(a)return a;const r=O(e)?"image":"text",s=e.getAttribute("data-preview-node")||"",i=document.createElement("div");return i.className=`editor-overlay editor-overlay--${r}`,i.dataset.previewNode=s,i.tabIndex=0,i.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(h=>{const m=document.createElement("div");m.className=`editor-overlay__handle editor-overlay__handle--${h}`,m.dataset.handle=h,i.appendChild(m)}),i.addEventListener("pointerdown",Jt),i.addEventListener("dblclick",()=>{r==="text"?At(s):r==="image"&&it(e)}),i.addEventListener("keydown",h=>{h.key==="Enter"&&(h.preventDefault(),r==="text"?At(s):r==="image"&&it(e))}),t.appendChild(i),a={overlay:i,node:e,type:r,previewKey:s},fe.set(e,a),ft.set(i,a),e.dataset.locked==="true"&&(i.classList.add("editor-overlay--locked"),i.style.pointerEvents="none"),ra(),Z(),a},Qe=(e,t,a={})=>{if(!l)return;const r=l.closest(".preview-canvas-wrapper"),s=Number(e),i=Number(t),d=a.persist===void 0?!0:!!a.persist,h=typeof a.unit=="string"&&a.unit?a.unit:(L==null?void 0:L.unit)??"px",m=typeof a.shape=="string"&&a.shape?a.shape:(L==null?void 0:L.shape)??null;if(!r||!Number.isFinite(s)||!Number.isFinite(i)||s<=0||i<=0)return;const N=_e/s,b=ge/i,w=Math.min(1,N,b),v=Math.max(1,Math.round(s*w)),B=Math.max(1,Math.round(i*w));r.style.setProperty("--canvas-width",`${v}px`),r.style.setProperty("--canvas-height",`${B}px`),r.dataset.sourceWidth=s.toString(),r.dataset.sourceHeight=i.toString(),r.dataset.displayScale=w.toString(),r.dataset.canvasWidth=s.toString(),r.dataset.canvasHeight=i.toString(),r.dataset.canvasUnit=h,m&&(r.dataset.canvasShape=m),l.dataset.canvasWidth=s.toString(),l.dataset.canvasHeight=i.toString(),l.dataset.canvasUnit=h,m&&(l.dataset.canvasShape=m),u&&(u.setAttribute("viewBox",`0 0 ${s} ${i}`),u.setAttribute("preserveAspectRatio","xMidYMid meet")),K&&!K.getAttribute("viewBox")&&(K.setAttribute("viewBox",`0 0 ${s} ${i}`),K.setAttribute("preserveAspectRatio","xMidYMid meet")),E&&E.style.setProperty("--stage-width",`${v+112}px`),d&&(L={width:s,height:i,unit:h,shape:m}),Z()},gt=(e,t,a,r=0)=>{W&&(Number.isFinite(e)?W.textContent=`${e.toFixed(r)}${a}`:W.textContent="—"),V&&(Number.isFinite(t)?V.textContent=`${t.toFixed(r)}${a}`:V.textContent="—")};L&&(Qe(L.width,L.height,{unit:L.unit,shape:L.shape}),gt(Me(L.width,L.unit),Me(L.height,L.unit),"in",2));const Zt=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),a=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!a)return Number.NaN;const r=parseFloat(a[1]);if(!Number.isFinite(r))return Number.NaN;const s=t.match(/([a-z%]+)$/i);switch(s?s[1].toLowerCase():""){case"":case"px":return r;case"mm":return r*(96/25.4);case"cm":return r*(96/2.54);case"in":return r*96;case"pt":return r*(96/72);default:return r}},ja=()=>!!(L&&Number.isFinite(L.width)&&L.width>0&&Number.isFinite(L.height)&&L.height>0),pa=e=>{if(!e||ja())return;if(Xe.has(e)){const a=Xe.get(e);if(a){const r=a.unit||"px";Qe(a.width,a.height,{unit:r,shape:L==null?void 0:L.shape}),gt(Me(a.width,r),Me(a.height,r),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};Xe.set(e,a),Qe(a.width,a.height,{unit:a.unit,shape:L==null?void 0:L.shape}),gt(Me(a.width,a.unit),Me(a.height,a.unit),"in",2),Z()},t.onerror=()=>{Xe.set(e,null)},t.src=e},Pe={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},Fa=document.querySelectorAll("[data-modal-close]"),ma=e=>{if(!e)return[];const t=Array.from(e.querySelectorAll("[data-preview-node]"));if(t.length>0)return t;e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(d=>{const h=d.getAttribute("data-layer-id");if(!h)return;const m=(d.getAttribute("aria-label")||h).replace(/\s+layer$/i,"")||h,N=d.querySelector(".canvas-layer__text");if(N&&(N.hasAttribute("data-preview-node")||N.setAttribute("data-preview-node",h),N.dataset.previewLabel||(N.dataset.previewLabel=m),!N.dataset.defaultText)){const w=(N.textContent||"").trim();w&&(N.dataset.defaultText=w)}const b=d.querySelector("img, image");if(b){const w=`${h}-image`;b.hasAttribute("data-preview-node")||b.setAttribute("data-preview-node",w),b.dataset.previewLabel||(b.dataset.previewLabel=m)}if(!N&&!b&&(d.hasAttribute("data-preview-node")||d.setAttribute("data-preview-node",h),d.dataset.previewLabel||(d.dataset.previewLabel=m),!d.dataset.defaultText)){const w=(d.textContent||"").trim();w&&(d.dataset.defaultText=w)}}),e.querySelectorAll("image, img").forEach((d,h)=>{d.hasAttribute("data-preview-node")||d.setAttribute("data-preview-node",`auto-image-${h}`)}),e.querySelectorAll("text, tspan").forEach((d,h)=>{d.hasAttribute("data-preview-node")||d.setAttribute("data-preview-node",`auto-text-${h}`)});const i=Array.from(e.querySelectorAll("text[data-preview-node], tspan[data-preview-node]"));return i.length>0?i:Array.from(e.querySelectorAll("[data-preview-node]"))},$e=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const a=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);a==null||a.classList.remove("active"),t==="background"&&Ue&&(Ue=!1,ha(),sa())}},Qt=()=>{Object.values(Pe).forEach(e=>$e(e))},ea=e=>{const t=Pe[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const a=t.querySelector('input:not([type="hidden"])');if(a==null||a.focus({preventScroll:!0}),e==="background"&&Hr(),e==="graphics"){const r=document.querySelector('.graphics-category-button[data-category="image"]');r?Va(r):(aa(),yt())}};U.length&&U.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",a=Pe[t],r=a==null?void 0:a.classList.contains("is-open");Qt(),U.forEach(s=>s.classList.remove("active")),r||(ea(t),e.classList.add("active"))})}),Fa.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");$e(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&$e(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&$e(t)}});const It=document.querySelector(".graphics-categories-labels"),c=document.getElementById("graphics-browser-samples"),C=document.querySelectorAll(".graphics-category-button"),H=document.getElementById("graphics-search-form"),se=document.getElementById("graphics-search-input"),xe="53250708-d3f88461e75cb0c2c5366a181",Ve={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:xe,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:xe,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},Ge=new Map;let ta=0;function Lt(e,t){const a=(t||"").trim();return a||e.query||e.defaultQuery||""}function yt(){c&&(c.innerHTML="",c.dataset.category="",c.dataset.page="0",c.dataset.loading="0",c.dataset.hasMore="0",c.dataset.searchTerm="",c.dataset.requestToken="")}function aa(){if(!It||!c)return;It.querySelectorAll(".category-row").forEach(t=>{t.style.display="flex",t.dataset.expanded="0"}),C.forEach(t=>{t.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}),c.scrollTop=0,c.innerHTML="",c.dataset.category="",c.dataset.page="0",c.dataset.loading="0",c.dataset.hasMore="0",c.dataset.searchTerm="",c.dataset.requestToken="",H&&(H.classList.add("is-hidden"),H.dataset.category=""),se&&(se.value="",se.blur())}function Ma(e){return Ve[e]||null}async function Va(e){var w,v,B;const t=e.dataset.category;if(!t||!c||!It)return;if(e.getAttribute("aria-expanded")==="true"){aa(),yt();return}const r=Ma(t);if(!r){console.warn(`[InkWise Studio] No graphics configuration found for category "${t}".`);return}aa();const s=Ge.get(t)||"",i=r.label||"",d=(B=(v=(w=e.closest(".category-row"))==null?void 0:w.querySelector(".category-label"))==null?void 0:v.textContent)==null?void 0:B.trim(),h=i||d||t,m=r.searchPlaceholder||`Search ${h.toLowerCase()}`;H&&(H.classList.remove("is-hidden"),H.dataset.category=t),se&&(se.placeholder=m,se.value=s),e.setAttribute("aria-expanded","true"),e.classList.add("is-open"),It.querySelectorAll(".category-row").forEach(D=>{D.dataset.categoryRow===t?(D.style.display="flex",D.dataset.expanded="1"):D.style.display="none"}),c.innerHTML="",c.dataset.category=t,c.dataset.page="0",c.dataset.loading="0",c.dataset.hasMore="1",c.dataset.searchTerm=s,c.scrollTop=0;const b=String(++ta);c.dataset.requestToken=b,Ga(),await _a(t,1,s,b)}function Ga(){if(!c)return;const e=c.querySelector(".graphics-loading");if(e){e.style.display="flex";return}const t=document.createElement("div");t.className="graphics-loading",t.textContent="Loading assets…",c.appendChild(t)}function Ya(){if(!c)return;const e=c.querySelector(".graphics-loading");e&&e.remove()}function Xa(e){if(!c)return;c.innerHTML="";const t=document.createElement("div");t.className="graphics-error",t.textContent=e||"Unable to load assets at the moment.",c.appendChild(t)}function _r(e){if(!c||!Array.isArray(e))return;const t=document.createDocumentFragment();e.forEach(a=>{if(!a||!a.thumbUrl)return;const r=document.createElement("div");r.className="graphics-sample",r.title=a.alt||"Graphic sample";const s=document.createElement("img");if(s.src=a.thumbUrl,s.alt=a.alt||"Graphic sample",s.loading="lazy",r.appendChild(s),a.label){const i=document.createElement("span");i.className="sample-label",i.textContent=a.label,r.appendChild(i)}r.addEventListener("click",()=>{console.log("Selected asset",a)}),t.appendChild(r)}),Ya(),c.appendChild(t)}async function _a(e,t,a,r){if(!c)return;const s=Ma(e);if(!s)return;const i=c.dataset.requestToken||"",d=r||i||String(++ta);if(!(c.dataset.loading==="1"&&d===i)){c.dataset.loading="1",Ga();try{const h=typeof a=="string"?a:c.dataset.searchTerm||"",m=await Br(s,t,h);if(c.dataset.requestToken!==d)return;if(c.dataset.loading="0",Ya(),!m.length&&t===1){Xa("No assets found for this category right now. Try again in a moment."),c.dataset.hasMore="0";return}_r(m),c.dataset.page=String(t);const N=s.perPage||12;c.dataset.hasMore=m.length>=N?"1":"0"}catch(h){if(console.error("[InkWise Studio] Failed to load graphics assets:",h),c.dataset.requestToken!==d)return;c.dataset.loading="0",Xa("We ran into a problem loading assets. Please try again."),c.dataset.hasMore="0"}}}async function Br(e,t,a){switch(e.provider){case"unsplash":return Rr(e,t,a);case"pixabay":return Pr(e,t,a);case"flaticon":return $r(e,t,a);case"iconify":return Dr(e,t,a);default:return console.warn("[InkWise Studio] Unknown graphics provider:",e.provider),[]}}async function Rr(e,t,a){const r=e.perPage||12,s=Lt(e,a),i=s?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",d=new URLSearchParams({per_page:String(r),page:String(t),client_id:e.apiKey});s&&(d.set("query",s),d.set("orientation","portrait"));const h=`${i}?${d.toString()}`,m=await fetch(h);if(!m.ok)throw new Error(`Unsplash API error: ${m.status}`);const N=await m.json();return(Array.isArray(N)?N:Array.isArray(N.results)?N.results:[]).map(w=>{const v=w.urls||{};return{id:`unsplash-${w.id}`,thumbUrl:v.small||v.thumb||v.regular||"",fullUrl:v.full||v.regular||v.raw||"",alt:w.alt_description||w.description||w.slug||"Unsplash image"}}).filter(w=>!!w.thumbUrl)}async function Pr(e,t,a){const r=e.perPage||18,s=new URLSearchParams({key:e.apiKey,q:Lt(e,a),per_page:String(r),page:String(t),safesearch:"true",order:"popular"});e.imageType&&s.set("image_type",e.imageType),e.category&&s.set("category",e.category);const i=await fetch(`https://pixabay.com/api/?${s.toString()}`);if(!i.ok)throw new Error(`Pixabay API error: ${i.status}`);const d=await i.json();return(Array.isArray(d==null?void 0:d.hits)?d.hits:[]).map(m=>({id:`pixabay-${m.id}`,thumbUrl:m.previewURL||m.webformatURL||"",fullUrl:m.largeImageURL||m.webformatURL||"",alt:m.tags||"Pixabay asset",label:m.user?`@${m.user}`:null})).filter(m=>!!m.thumbUrl)}async function $r(e,t,a){const r=e.perPage||48,s=new URLSearchParams({q:Lt(e,a)||"icon",limit:String(r),page:String(t)});s.set("apikey",e.apiKey);const i=await fetch(`https://api.flaticon.com/v3/search/icons?${s.toString()}`,{headers:{Accept:"application/json",apikey:e.apiKey,Authorization:`Bearer ${e.apiKey}`}});if(!i.ok)throw new Error(`Flaticon API error: ${i.status}`);const d=await i.json();return(Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d==null?void 0:d.icons)?d.icons:Array.isArray(d==null?void 0:d.result)?d.result:[]).map(m=>{var D;const N=(m==null?void 0:m.images)||m,b=(N==null?void 0:N.png)||{},w=(N==null?void 0:N.svg)||(N==null?void 0:N.svg)||null,v=b[128]||b[256]||w||(N==null?void 0:N["64"])||null,B=b[512]||b[256]||w||v;return v?{id:`flaticon-${(m==null?void 0:m.id)||(m==null?void 0:m.icon_id)||(m==null?void 0:m.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:v,fullUrl:B,alt:(m==null?void 0:m.description)||(Array.isArray(m==null?void 0:m.tags)?m.tags.join(", "):"Icon asset"),label:((D=m==null?void 0:m.uploader)==null?void 0:D.name)||(m==null?void 0:m.category)||null}:null}).filter(Boolean)}async function Dr(e,t,a){const r=e.perPage||36,s=Math.max(0,(t-1)*r),i=new URLSearchParams({query:Lt(e,a)||"shape",limit:String(r),offset:String(s)});e.prefix&&i.set("prefix",e.prefix);const d=(e.baseUrl||"https://api.iconify.design").replace(/\/$/,""),h=await fetch(`${d}/search?${i.toString()}`,{headers:{Accept:"application/json"}});if(!h.ok)throw new Error(`Iconify API error: ${h.status}`);const m=await h.json(),N=Array.isArray(m==null?void 0:m.icons)?m.icons:[],b=Array.isArray(m==null?void 0:m.prefixes)&&m.prefixes.length===1?m.prefixes[0]:(m==null?void 0:m.prefix)||e.prefix||"";return N.map(w=>{if(typeof w=="string"){const v=w.includes(":")?w:b?`${b}:${w}`:w;if(!v)return null;const B=v.split(":").map(q=>encodeURIComponent(q)).join(":"),D=v.split(":").pop()||v;return{id:`iconify-${v.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${d}/${B}.svg?height=120&width=120`,fullUrl:`${d}/${B}.svg`,alt:D.replace(/[-_]/g," "),label:D.replace(/[-_]/g," ")}}if(w&&typeof w=="object"){const v=w.name||w.icon||w.id||"";if(!v)return null;const B=w.prefix||b,D=B?`${B}:${v}`:v,q=D.split(":").map(de=>encodeURIComponent(de)).join(":"),me=w.label||v;return{id:`iconify-${D.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${d}/${q}.svg?height=120&width=120`,fullUrl:`${d}/${q}.svg`,alt:me.replace(/[-_]/g," "),label:me.replace(/[-_]/g," ")}}return null}).filter(w=>!!(w!=null&&w.thumbUrl))}async function qr(){if(!c)return;const e=c.dataset.category;if(!e||c.dataset.loading==="1"||c.dataset.hasMore==="0")return;if(c.scrollTop+c.clientHeight>=c.scrollHeight-180){const a=Number(c.dataset.page||"1")+1,r=c.dataset.searchTerm||"";await _a(e,a,r)}}C.forEach(e=>{e.addEventListener("click",()=>Va(e))}),c&&(c.addEventListener("scroll",()=>{qr().catch(e=>{console.error("[InkWise Studio] graphics scroll handler error:",e)})}),yt()),H&&se&&H.addEventListener("submit",async e=>{if(e.preventDefault(),!c)return;const t=c.dataset.category;if(!t||!Ma(t))return;const a=se.value.trim();Ge.set(t,a),c.scrollTop=0,c.innerHTML="",c.dataset.page="0",c.dataset.hasMore="1",c.dataset.searchTerm=a,c.dataset.loading="0";const r=String(++ta);c.dataset.requestToken=r;try{await _a(t,1,a,r)}catch(s){console.error("[InkWise Studio] graphics search failed:",s)}}),Qt(),ea("text");const Ba=document.querySelector('.sidenav-btn[data-nav="text"]');Ba==null||Ba.classList.add("active");const Ka=e=>!e||!A?null:A.querySelector(`input[data-preview-target="${e}"]`),zr=e=>!e||!j?null:j.querySelector(`[data-preview-node="${e}"]`),Ja=(()=>{let e=!1;return()=>{if(e||typeof document>"u")return;const t=document.createElement("style");t.id="inkwise-crop-overlay-styles",t.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(t),e=!0}})(),bt=()=>{Re&&(Re.teardown(),Re=null)},Or=(e,t)=>{if(!e||!t)return null;Ja(),getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=(f,g,M)=>Math.min(Math.max(f,g),M);(()=>{if(t.dataset.cropSourceWidth&&t.dataset.cropSourceHeight)return;let f=null;try{f=t.getBBox()}catch{f=null}const g=f&&Number.isFinite(f.width)&&f.width>0?f.width:parseFloat(t.getAttribute("width"))||0,M=f&&Number.isFinite(f.height)&&f.height>0?f.height:parseFloat(t.getAttribute("height"))||0,k=f&&Number.isFinite(f.x)?f.x:parseFloat(t.getAttribute("x"))||0,ee=f&&Number.isFinite(f.y)?f.y:parseFloat(t.getAttribute("y"))||0;g>0&&M>0&&(t.dataset.cropSourceWidth=g,t.dataset.cropSourceHeight=M,t.dataset.cropSourceX=k,t.dataset.cropSourceY=ee)})();const s=document.createElement("div");s.className="crop-overlay";const i=(()=>{const f=typeof t.dataset.cropRect=="string"?t.dataset.cropRect:"",g=t.getAttribute("clip-path")||"",M=t.style&&typeof t.style.clipPath=="string"?t.style.clipPath:"",k=t.style&&typeof t.style.webkitClipPath=="string"?t.style.webkitClipPath:"",ee=t.dataset.cropClipId||"",ae=(()=>{const X=g.match(/^url\(#(.+)\)$/);return X?X[1]:""})(),re=ee||ae;let J=null;if(re){const X=wt(t.ownerSVGElement||null),R=X==null?void 0:X.querySelector(`#${re}`),$=R==null?void 0:R.querySelector("rect");$&&(J={x:$.getAttribute("x")||"",y:$.getAttribute("y")||"",width:$.getAttribute("width")||"",height:$.getAttribute("height")||""})}return{rectString:f,clipPathAttr:g,clipId:re,clipRect:J,clipPathStyle:M,webkitClipPathStyle:k}})(),d=[],h=document.createElement("div");h.className="crop-overlay__scrim crop-overlay__scrim--top";const m=document.createElement("div");m.className="crop-overlay__scrim crop-overlay__scrim--right";const N=document.createElement("div");N.className="crop-overlay__scrim crop-overlay__scrim--bottom";const b=document.createElement("div");b.className="crop-overlay__scrim crop-overlay__scrim--left",[h,m,N,b].forEach(f=>{f.style.pointerEvents="none",s.appendChild(f)});const v=document.createElement("div");v.className="crop-frame",s.appendChild(v);const B=document.createElement("div");B.className="crop-overlay__controls";const D=document.createElement("button");D.type="button",D.className="crop-overlay__button crop-overlay__button--cancel",D.textContent="Cancel";const q=document.createElement("button");q.type="button",q.className="crop-overlay__button crop-overlay__button--apply",q.textContent="Crop",B.appendChild(D),B.appendChild(q),s.appendChild(B);const me=["top-left","top-right","bottom-left","bottom-right"],de=[],Te={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};me.forEach(f=>{const g=document.createElement("div");g.className=`crop-frame__corner crop-frame__corner--${f}`,g.dataset.corner=f,g.style.pointerEvents="auto",g.style.cursor=Te[f]||"nwse-resize";const M=document.createElement("span");M.className="corner-arm corner-arm--horizontal",M.style.pointerEvents="none";const k=document.createElement("span");k.className="corner-arm corner-arm--vertical",k.style.pointerEvents="none",g.appendChild(M),g.appendChild(k),v.appendChild(g),de.push(g)});const St=["top","right","bottom","left"],dt=[];St.forEach(f=>{const g=document.createElement("div");g.className=`crop-frame__edge-handle crop-frame__edge-handle--${f}`,g.dataset.edge=f,g.style.pointerEvents="auto",g.style.cursor=f==="top"||f==="bottom"?"ns-resize":"ew-resize",v.appendChild(g),dt.push(g)}),e.appendChild(s);let Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth,I=Y.height||e.offsetHeight,Ye=T,la=I;if(!T||!I)return s.remove(),null;fe.forEach(f=>{!f||!f.overlay||f.overlay!==e&&(f.overlay.classList.contains("editor-overlay--hidden-for-crop")||(f.overlay.classList.add("editor-overlay--hidden-for-crop"),d.push(f.overlay)))}),e.classList.add("editor-overlay--crop-active"),e.dataset.cropSessionActive="true",Z(),s.style.pointerEvents="none",v.style.pointerEvents="auto";const Nt=(()=>{const f=t.dataset.cropRect;if(!f)return null;const g=f.split(",").map(M=>Number(M));return g.length!==4||g.some(M=>!Number.isFinite(M))?null:{left:a(g[0],0,1),top:a(g[1],0,1),width:a(g[2],0,1),height:a(g[3],0,1)}})(),hr=parseFloat(t.dataset.cropSourceWidth)||0,gr=parseFloat(t.dataset.cropSourceHeight)||0;let le,ce;const Rt=()=>{ce=Math.min(T,Math.max(48,T*.08)),le=Math.min(I,Math.max(48,I*.08))};Rt();const S={left:0,top:0,width:0,height:0};if(Nt&&Nt.width>0&&Nt.height>0){const f=Nt.width*T,g=Nt.height*I;S.width=a(f,ce,T),S.height=a(g,le,I),S.left=a(Nt.left*T,0,T-S.width),S.top=a(Nt.top*I,0,I-S.height)}else{const f=hr>0&&gr>0?hr/gr:T>0&&I>0?T/I:1;let g,M;f>=1?(g=T*.85,M=g/f):(M=I*.85,g=M*f),S.width=a(g,ce,T),S.height=a(M,le,I),S.left=Math.max(0,(T-S.width)/2),S.top=Math.max(0,(I-S.height)/2)}S.width=a(S.width,ce,T),S.height=a(S.height,le,I),S.left=a(S.left,0,T-S.width),S.top=a(S.top,0,I-S.height);const Rs=()=>{const f=S.left+S.width,g=S.top+S.height;h.style.top="0px",h.style.left="0px",h.style.width="100%",h.style.height=`${Math.max(0,S.top)}px`,h.style.display=S.top>0?"block":"none",N.style.top=`${g}px`,N.style.left="0px",N.style.width="100%",N.style.height=`${Math.max(0,I-g)}px`,N.style.display=g<I?"block":"none",b.style.top=`${S.top}px`,b.style.left="0px",b.style.width=`${Math.max(0,S.left)}px`,b.style.height=`${S.height}px`,b.style.display=S.left>0?"block":"none",m.style.top=`${S.top}px`,m.style.left=`${f}px`,m.style.width=`${Math.max(0,T-f)}px`,m.style.height=`${S.height}px`,m.style.display=f<T?"block":"none"},yr=(f,g,M,k)=>{const ee=t.ownerSVGElement;if(!ee)return;const ae=parseFloat(t.dataset.cropSourceWidth)||0,re=parseFloat(t.dataset.cropSourceHeight)||0,J=parseFloat(t.dataset.cropSourceX)||0,X=parseFloat(t.dataset.cropSourceY)||0;let R=ae,$=re,Fe=J,Aa=X;if(!R||!$){let ve=null;try{ve=t.getBBox()}catch{ve=null}R=ve&&Number.isFinite(ve.width)&&ve.width>0?ve.width:parseFloat(t.getAttribute("width"))||0,$=ve&&Number.isFinite(ve.height)&&ve.height>0?ve.height:parseFloat(t.getAttribute("height"))||0,Fe=ve&&Number.isFinite(ve.x)?ve.x:parseFloat(t.getAttribute("x"))||0,Aa=ve&&Number.isFinite(ve.y)?ve.y:parseFloat(t.getAttribute("y"))||0}if(!R||!$)return;if(t instanceof HTMLImageElement){const ve=a(g,0,1)*100,jr=a(f,0,1)*100,Us=a(1-(g+k),0,1)*100,Hs=a(1-(f+M),0,1)*100,Ha=`inset(${ve}% ${Hs}% ${Us}% ${jr}%)`;t.style.clipPath=Ha,t.style.webkitClipPath=Ha,delete t.dataset.cropClipId,t.dataset.cropCssClip=Ha;return}const $t=wt(ee);if(!$t)return;const tt=t.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let De=$t.querySelector(`#${tt}`);De||(De=document.createElementNS(P,"clipPath"),De.id=tt,De.setAttribute("clipPathUnits","userSpaceOnUse"),$t.appendChild(De));let qe=De.querySelector("rect");qe||(qe=document.createElementNS(P,"rect"),De.appendChild(qe));const Ds=R*M,qs=$*k,zs=Fe+R*f,Os=Aa+$*g;qe.setAttribute("x",zs),qe.setAttribute("y",Os),qe.setAttribute("width",Ds),qe.setAttribute("height",qs),t.dataset.cropClipId=tt,t.setAttribute("clip-path",`url(#${tt})`),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip},Ps=()=>{if(!T||!I)return;const f=t.dataset.cropRect||"",g=typeof t.getAttribute("clip-path")=="string"&&t.getAttribute("clip-path").length>0,M=t.ownerSVGElement,k=S.left/T,ee=S.top/I,ae=S.width/T,re=S.height/I,J=a(k,0,1),X=a(ee,0,1),R=a(ae,0,1-J),$=a(re,0,1-X),Fe=J+R,Aa=X+$;if(J<=.001&&X<=.001&&Fe>=.999&&Aa>=.999){const tt=t.dataset.cropClipId;if(tt){const De=wt(M),qe=De==null?void 0:De.querySelector(`#${tt}`);qe==null||qe.remove(),delete t.dataset.cropClipId}t.removeAttribute("clip-path"),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip,delete t.dataset.cropRect,(f||g)&&(x==null||x.schedule("image-crop"),Z());return}const $t=[J,X,R,$].map(tt=>tt.toFixed(6)).join(",");t.dataset.cropRect=$t,yr(J,X,R,$),f!==$t&&(x==null||x.schedule("image-crop"),Z())},br=()=>{var X;const f=t.dataset.cropRect||"",g=t.getAttribute("clip-path")||"",M=t.dataset.cropClipId||"",k=t.ownerSVGElement,ee=t.dataset.cropClipId;if(ee&&ee!==i.clipId){const R=wt(k);(X=R==null?void 0:R.querySelector(`#${ee}`))==null||X.remove()}if(i.rectString){t.dataset.cropRect=i.rectString,i.clipId?t.dataset.cropClipId=i.clipId:delete t.dataset.cropClipId;const R=i.rectString.split(",").map($=>Number($));R.length===4&&R.every($=>Number.isFinite($))&&yr(R[0],R[1],R[2],R[3]),i.clipPathAttr?t.setAttribute("clip-path",i.clipPathAttr):t.removeAttribute("clip-path"),i.clipPathStyle?(t.style.clipPath=i.clipPathStyle,t.dataset.cropCssClip=i.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),i.webkitClipPathStyle?t.style.webkitClipPath=i.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}else{if(delete t.dataset.cropRect,i.clipId){if(t.dataset.cropClipId=i.clipId,i.clipRect){const R=wt(k);if(R){let $=R.querySelector(`#${i.clipId}`);$||($=document.createElementNS(P,"clipPath"),$.id=i.clipId,$.setAttribute("clipPathUnits","userSpaceOnUse"),R.appendChild($));let Fe=$.querySelector("rect");Fe||(Fe=document.createElementNS(P,"rect"),$.appendChild(Fe)),Fe.setAttribute("x",i.clipRect.x),Fe.setAttribute("y",i.clipRect.y),Fe.setAttribute("width",i.clipRect.width),Fe.setAttribute("height",i.clipRect.height)}}i.clipPathAttr&&t.setAttribute("clip-path",i.clipPathAttr)}else delete t.dataset.cropClipId,i.clipPathAttr?t.setAttribute("clip-path",i.clipPathAttr):t.removeAttribute("clip-path");i.clipPathStyle?(t.style.clipPath=i.clipPathStyle,t.dataset.cropCssClip=i.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),i.webkitClipPathStyle?t.style.webkitClipPath=i.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}const ae=t.dataset.cropRect||"",re=t.getAttribute("clip-path")||"",J=t.dataset.cropClipId||"";(f!==ae||g!==re||M!==J)&&(x==null||x.schedule("image-crop"),Z())},et=()=>{v.style.left=`${S.left}px`,v.style.top=`${S.top}px`,v.style.width=`${S.width}px`,v.style.height=`${S.height}px`,Rs(),Ps()};et();let be=null,te=null;const Oa=()=>{const f=T||(Y==null?void 0:Y.width)||(l==null?void 0:l.clientWidth)||0,g=I||(Y==null?void 0:Y.height)||(l==null?void 0:l.clientHeight)||0,M=Math.min(f,g);return Math.max(8,Math.round(M*.02))},Pt=(f,g)=>{const M=[],k=Math.round(f/Ut)*Ut;M.push(k),Number.isFinite(g)&&g>0&&M.push(g/2);let ee=f,ae=Number.POSITIVE_INFINITY;return M.forEach(re=>{const J=Math.abs(re-f);J<ae&&J<=fa&&(ee=re,ae=J)}),ee},xr=f=>{if(f.button!==0||f.target!==v)return;f.preventDefault(),Y=e.getBoundingClientRect();const g=Y.width||T,M=Y.height||I;be={pointerId:f.pointerId,startX:f.clientX,startY:f.clientY,widthLimit:g,heightLimit:M,startLeft:S.left,startTop:S.top},v.setPointerCapture(f.pointerId)},vr=f=>{if(!be||f.pointerId!==be.pointerId)return;f.preventDefault();const g=f.clientX-be.startX,M=f.clientY-be.startY,k=Oa(),ee=Math.max(0,be.widthLimit-S.width-k*2),ae=Math.max(0,be.heightLimit-S.height-k*2),re=be.startLeft+g,J=be.startTop+M,X=Pt(re,be.widthLimit),R=Pt(J,be.heightLimit);S.left=a(X,k,k+ee),S.top=a(R,k,k+ae),et()},ka=f=>{if(!(!be||f.pointerId!==be.pointerId)){try{v.releasePointerCapture(f.pointerId)}catch{}be=null}};v.addEventListener("pointerdown",xr),v.addEventListener("pointermove",vr),v.addEventListener("pointerup",ka),v.addEventListener("pointercancel",ka);const wr=()=>{be=null};v.addEventListener("lostpointercapture",wr);const Sr=f=>{f.button===0&&(f.preventDefault(),f.stopPropagation(),Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth||T,I=Y.height||e.offsetHeight||I,Rt(),te={pointerId:f.pointerId,mode:"edge",edge:f.currentTarget.dataset.edge,anchor:{left:S.left,top:S.top,right:S.left+S.width,bottom:S.top+S.height},target:f.currentTarget},f.currentTarget.setPointerCapture(f.pointerId))},Nr=f=>{if(!te||f.pointerId!==te.pointerId||te.mode!=="edge")return;f.preventDefault(),Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth||T,I=Y.height||e.offsetHeight||I,Rt();const g=f.clientX-Y.left,M=f.clientY-Y.top,k=te.anchor,ee=Oa();let ae=k.left,re=k.top,J=a(k.right-k.left,ce,T),X=a(k.bottom-k.top,le,I);if(te.edge==="top"){const R=Math.min(k.bottom-le,I-le),$=a(M,0,Math.max(0,R));re=$,X=Math.max(le,k.bottom-$)}else if(te.edge==="bottom"){const R=k.top+le,$=a(M,R,I);re=k.top,X=Math.max(le,$-k.top)}else if(te.edge==="left"){const R=Math.min(k.right-ce,T-ce),$=a(g,0,Math.max(0,R));ae=$,J=Math.max(ce,k.right-$)}else if(te.edge==="right"){const R=k.left+ce,$=a(g,R,T);ae=k.left,J=Math.max(ce,$-k.left)}J=a(J,ce,T),X=a(X,le,I),ae=Pt(a(ae,ee,T-ee-J),T),re=Pt(a(re,ee,I-ee-X),I),S.left=ae,S.top=re,S.width=J,S.height=X,et()},Ca=f=>{var g;if(!(!te||f.pointerId!==te.pointerId)){try{(g=te.target)==null||g.releasePointerCapture(f.pointerId)}catch{}te=null,et()}},kr=()=>{te=null},Cr=f=>{f.button===0&&(f.preventDefault(),f.stopPropagation(),Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth||T,I=Y.height||e.offsetHeight||I,Rt(),te={pointerId:f.pointerId,mode:"corner",corner:f.currentTarget.dataset.corner,anchor:{left:S.left,top:S.top,right:S.left+S.width,bottom:S.top+S.height},target:f.currentTarget},f.currentTarget.setPointerCapture(f.pointerId))},Er=f=>{if(!te||f.pointerId!==te.pointerId||te.mode!=="corner")return;f.preventDefault(),Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth||T,I=Y.height||e.offsetHeight||I,Rt();const g=f.clientX-Y.left,M=f.clientY-Y.top,k=te.anchor,ee=Oa();let ae=k.left,re=k.top,J=a(k.right-k.left,ce,T),X=a(k.bottom-k.top,le,I);switch(te.corner){case"top-left":{const R=a(g,0,k.right-ce),$=a(M,0,k.bottom-le);ae=R,re=$,J=Math.max(ce,k.right-R),X=Math.max(le,k.bottom-$);break}case"top-right":{const R=a(g,k.left+ce,T),$=a(M,0,k.bottom-le);ae=k.left,re=$,J=Math.max(ce,R-k.left),X=Math.max(le,k.bottom-$);break}case"bottom-left":{const R=a(g,0,k.right-ce),$=a(M,k.top+le,I);ae=R,re=k.top,J=Math.max(ce,k.right-R),X=Math.max(le,$-k.top);break}case"bottom-right":{const R=a(g,k.left+ce,T),$=a(M,k.top+le,I);ae=k.left,re=k.top,J=Math.max(ce,R-k.left),X=Math.max(le,$-k.top);break}default:return}J=a(J,ce,T),X=a(X,le,I),ae=Pt(a(ae,ee,T-ee-J),T),re=Pt(a(re,ee,I-ee-X),I),S.left=ae,S.top=re,S.width=J,S.height=X,et()},Ea=f=>{var g;if(!(!te||f.pointerId!==te.pointerId)){try{(g=te.target)==null||g.releasePointerCapture(f.pointerId)}catch{}te=null,et()}},Ar=()=>{te=null};dt.forEach(f=>{f.addEventListener("pointerdown",Sr),f.addEventListener("pointermove",Nr),f.addEventListener("pointerup",Ca),f.addEventListener("pointercancel",Ca),f.addEventListener("lostpointercapture",kr)}),de.forEach(f=>{f.addEventListener("pointerdown",Cr),f.addEventListener("pointermove",Er),f.addEventListener("pointerup",Ea),f.addEventListener("pointercancel",Ea),f.addEventListener("lostpointercapture",Ar)});const Ir=f=>{f.preventDefault(),f.stopPropagation(),br(),bt()},Lr=f=>{f.preventDefault(),f.stopPropagation(),et()};D.addEventListener("click",Ir),q.addEventListener("click",Lr);const Tr=f=>{f.key==="Escape"&&(f.preventDefault(),br(),bt()),f.key==="Enter"&&(f.metaKey||f.ctrlKey)&&(f.preventDefault(),et(),bt())};document.addEventListener("keydown",Tr);const Ua=()=>{if(Y=e.getBoundingClientRect(),T=Y.width||e.offsetWidth||T,I=Y.height||e.offsetHeight||I,!T||!I)return;Rt();const f=t.dataset.cropRect||null;if(f){const g=f.split(",").map(M=>Number(M));if(g.length===4&&g.every(M=>Number.isFinite(M))){const M=a(g[2]*T,ce,T),k=a(g[3]*I,le,I),ee=a(g[0]*T,0,T-M),ae=a(g[1]*I,0,I-k);S.left=ee,S.top=ae,S.width=M,S.height=k}}else{const g=Ye?S.width/Ye:1,M=la?S.height/la:1,k=Ye?S.left/Ye:0,ee=la?S.top/la:0;S.width=a(g*T,ce,T),S.height=a(M*I,le,I),S.left=a(k*T,0,T-S.width),S.top=a(ee*I,0,I-S.height)}Ye=T,la=I,et()};return window.addEventListener("resize",Ua),{overlay:e,refresh:Ua,teardown:()=>{var f;if(be&&typeof be.pointerId<"u"){try{v.releasePointerCapture(be.pointerId)}catch{}be=null}if(te&&typeof te.pointerId<"u"){try{(f=te.target)==null||f.releasePointerCapture(te.pointerId)}catch{}te=null}window.removeEventListener("resize",Ua),v.removeEventListener("pointerdown",xr),v.removeEventListener("pointermove",vr),v.removeEventListener("pointerup",ka),v.removeEventListener("pointercancel",ka),v.removeEventListener("lostpointercapture",wr),dt.forEach(g=>{g.removeEventListener("pointerdown",Sr),g.removeEventListener("pointermove",Nr),g.removeEventListener("pointerup",Ca),g.removeEventListener("pointercancel",Ca),g.removeEventListener("lostpointercapture",kr)}),de.forEach(g=>{g.removeEventListener("pointerdown",Cr),g.removeEventListener("pointermove",Er),g.removeEventListener("pointerup",Ea),g.removeEventListener("pointercancel",Ea),g.removeEventListener("lostpointercapture",Ar)}),D.removeEventListener("click",Ir),q.removeEventListener("click",Lr),document.removeEventListener("keydown",Tr),e.classList.remove("editor-overlay--crop-active"),delete e.dataset.cropSessionActive,d.forEach(g=>g.classList.remove("editor-overlay--hidden-for-crop")),d.length=0,Z(),s.parentNode===e?e.removeChild(s):s.remove()}}},ha=()=>{oe||pe||Ue?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},ra=()=>{fe.forEach(({overlay:e,type:t})=>{var i;if(!e)return;const a=((i=e.dataset)==null?void 0:i.previewNode)||"",r=!!oe&&a===oe&&t==="text",s=!!pe&&a===pe&&t==="image";e.classList.toggle("editor-overlay--selected",r||s)})},Le=()=>Ue?"background":pe?"image":oe?"text":null,Za=e=>{if(typeof e!="string")return null;const t=e.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!t)return null;const a=Number(t[1]),r=Number(t[2]),s=Number(t[3]);if([a,r,s].some(d=>Number.isNaN(d)||d<0||d>255))return null;const i=d=>d.toString(16).padStart(2,"0");return`#${i(a)}${i(r)}${i(s)}`.toUpperCase()};function Ur(e){var t;try{if(e==="background"){if(!l)return null;const r=window.getComputedStyle(l).backgroundColor||l.style.backgroundColor||"";return Ft(r)||Za(r)||null}if(e==="text"){const a=Tt();if(!a.length)return null;const r=a[0],s=r.getAttribute("fill")||r.style.fill||r.dataset.color||"";return Ft(s)||Za(s)||null}if(e==="image"){const a=xt();if(!a.length)return null;const s=((t=a[0].dataset)==null?void 0:t.tintColor)||"";return Ft(s)||null}}catch{return null}return null}const sa=()=>{if(typeof window>"u")return;const e=Le(),t=e==="text"?oe:e==="image"?pe:null,a=Ur(e);try{const r=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t,color:a}});window.dispatchEvent(r)}catch{if(typeof document<"u"&&document.createEvent){const s=document.createEvent("CustomEvent");s.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t,color:a}),window.dispatchEvent(s)}}},lt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;oe===t&&!pe||(bt(),oe=t,t&&(pe=null,Ue=!1),ra(),ha(),sa())},ia=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;pe===t&&!oe||(pe!==t&&bt(),pe=t,t&&(oe=null,Ue=!1),ra(),ha(),sa())},Hr=()=>{Ue||(bt(),Ue=!0,oe=null,pe=null,ra(),ha(),sa())},Tt=()=>{if(!oe)return[];const e=K||u||document;if(!e)return[];const t=`[data-preview-node="${oe}"]`,a=new Set;return e.querySelectorAll(t).forEach(r=>{if(!r||O(r))return;const s=(r.tagName||"").toLowerCase();if(s==="tspan"||s==="g"){const i=r.closest("text");if(i){a.add(i);return}}a.add(r)}),Array.from(a)},xt=()=>{if(!pe)return[];const e=K||u||document;if(!e)return[];const t=`[data-preview-node="${pe}"]`,a=new Set;return e.querySelectorAll(t).forEach(r=>{const s=Ee(r);s&&a.add(s)}),Array.from(a)},jt=()=>Ka(oe),vt=(e,t,a)=>{const r=Number(e);return Number.isFinite(r)?Math.min(Math.max(r,t),a):t},Ft=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},ga=e=>{var i,d;if(!e||typeof e.getBBox!="function")return;const t=[],a=Number(((i=e.dataset)==null?void 0:i.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(a)&&a!==0)try{const h=e.getBBox(),m=h.x+h.width/2,N=h.y+h.height/2;t.push(`rotate(${a} ${m} ${N})`)}catch{t.push(`rotate(${a})`)}((d=e.dataset)==null?void 0:d.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const s=t.join(" ").trim();s?e.setAttribute("transform",s):e.removeAttribute("transform")},ke=(e,t={})=>{const a=Tt();if(!a.length)return!1;if(a.forEach(r=>{try{e(r)}catch(s){console.warn("[InkWise Studio] Toolbar mutation failed.",s)}}),t.skipTransformUpdate||a.forEach(r=>{try{ga(r)}catch{}}),t.skipOverlaySync||Z(),t.autosaveReason!==!1){const r=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";x==null||x.schedule(r)}return!0},Mt=(e,t={})=>{const a=xt();if(!a.length)return!1;if(a.forEach(r=>{try{e(r)}catch(s){console.warn("[InkWise Studio] Image mutation failed.",s)}}),t.skipTransformUpdate||a.forEach(r=>{try{ga(r)}catch{}}),t.skipOverlaySync||Z(),t.autosaveReason!==!1){const r=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";x==null||x.schedule(r)}return!0},wt=(e=null)=>{var r;let t=K;if(!t&&e&&(t=e),!t)return null;if(typeof t.tagName=="string"&&t.tagName.toLowerCase()!=="svg"){const s=(r=t.closest)==null?void 0:r.call(t,"svg");s?t=s:e&&e!==t&&(t=e)}if(!t)return null;let a=t.querySelector('defs[data-inkwise-runtime="true"]');return a||(a=document.createElementNS(P,"defs"),a.setAttribute("data-inkwise-runtime","true"),t.insertBefore(a,t.firstChild||null)),a},ya=e=>{const t=e.dataset.previewTarget;if(!t)return;const a=document.querySelector(`[data-preview-node="${t}"]`),r=a?a.dataset.defaultText||a.textContent:"",s=()=>{if(!a)return;const i=e.value.trim();a.textContent=i||r||"",Z()};e.dataset.defaultValue||(e.dataset.defaultValue=r||""),e.addEventListener("focus",()=>{lt(t)}),e.addEventListener("input",()=>{s(),x==null||x.schedule("text-change")}),s()};o.forEach(ya);const Wr=(e,t="")=>{const a=document.createElement("div");a.className="text-field-item";const r=document.createElement("span");r.className="text-field-label",r.textContent="Custom",a.appendChild(r);const s=document.createElement("input");s.type="text",s.className="text-field-input",s.placeholder="Add your text",s.dataset.previewTarget=e,s.value=t,s.dataset.defaultValue=t||"",a.appendChild(s);const i=document.createElement("button");i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',a.appendChild(i),A.appendChild(a);const d=document.createElement("div");return d.className="pill",d.dataset.previewNode=e,d.dataset.defaultText=t||"CUSTOM TEXT",d.textContent=t||"CUSTOM TEXT",j.appendChild(d),ya(s),ba(a),x==null||x.schedule("add-text-field"),s},na=()=>{u&&(pt(),K=null,ua=null,u.innerHTML="",u.style.display="none")},Vr=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},Qa=e=>{if(!e)return;e.querySelectorAll("text, tspan").forEach(a=>{a.removeAttribute("opacity"),a.style.opacity="1",a.style&&a.style.mixBlendMode&&(a.style.mixBlendMode="normal");const r=a.getAttribute("fill");(!r||r==="none")&&a.setAttribute("fill","#111"),a.removeAttribute("fill-opacity"),a.removeAttribute("stroke-opacity"),a.style.fillOpacity="1",a.style.strokeOpacity="1",a.getAttribute("stroke")||a.setAttribute("stroke","none"),a.getAttribute("paint-order")||a.setAttribute("paint-order","stroke fill")})},Gr=async e=>{if(!u||!e)return na(),!1;try{let t="";if(e.startsWith("data:image/svg+xml")){const[,b=""]=e.split(",",2);try{t=decodeURIComponent(b)}catch{t=b}}else{const b=await fetch(e,{cache:"no-store"});if(!b.ok)return console.warn("Failed to fetch SVG:",b.status),na(),!1;t=await b.text()}if(!t)return na(),!1;u.innerHTML=t,u.style.display="block",u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.style.width="100%",u.style.height="100%",u.style.maxWidth="100%",u.style.maxHeight="100%";const a=u.querySelector("svg");a?(a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",K=a):K=u,K&&(rt(K),Qa(K)),K&&(K.setAttribute("data-svg-editor","true"),K.__inkwiseSvgTemplateEditor||(K.__inkwiseSvgTemplateEditor=new La(K)),ua=K.__inkwiseSvgTemplateEditor);const s=new DOMParser().parseFromString(t,"image/svg+xml").documentElement;let i=Zt(s==null?void 0:s.getAttribute("width")),d=Zt(s==null?void 0:s.getAttribute("height"));if(!Number.isFinite(i)||!Number.isFinite(d)){const b=s==null?void 0:s.getAttribute("viewBox");if(b){const w=b.split(/[\s,]+/).map(Number),v=w[2],B=w[3];!Number.isNaN(v)&&!Number.isNaN(B)&&v>0&&B>0&&(i=v,d=B)}}let h=Number.isFinite(i)?i:Number.NaN,m=Number.isFinite(d)?d:Number.NaN;if(L&&Number.isFinite(L.width)&&Number.isFinite(L.height)){const b=L.width/L.height,w=Number.isFinite(h)&&Number.isFinite(m)?h/m:b,v=Math.abs(w-b)/b,B=Number.isFinite(h)?Math.abs(h-L.width)/L.width:Number.POSITIVE_INFINITY,D=Number.isFinite(m)?Math.abs(m-L.height)/L.height:Number.POSITIVE_INFINITY;(!Number.isFinite(h)||!Number.isFinite(m)||v>.02||B>.05&&D>.05)&&(h=L.width,m=L.height)}if(Number.isFinite(h)&&Number.isFinite(m)){const b=(L==null?void 0:L.unit)??"px";Qe(h,m,{unit:b,shape:L==null?void 0:L.shape}),gt(Me(h,b),Me(m,b),"in",2)}const N=ma(u);if(pt(),A){A.innerHTML="";const b=(v,B="",D="")=>{const q=document.createElement("div");q.className="text-field-item";const me=document.createElement("span");me.className="text-field-label",me.textContent=D||v,q.appendChild(me);const de=document.createElement("input");de.type="text",de.className="text-field-input",de.dataset.previewTarget=v,de.value=B||"",de.dataset.defaultValue=B||"",q.appendChild(de);const Te=document.createElement("button");return Te.type="button",Te.className="text-field-delete",Te.setAttribute("aria-label","Delete field"),Te.innerHTML='<i class="fa-regular fa-trash-can"></i>',q.appendChild(Te),A.appendChild(q),ya(de),ba(q),de},w=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([B,D])=>b(B,"",D))};if(N.length>0){let v=!1;const B=new Set;N.forEach(D=>{var Te,St;const q=D.getAttribute("data-preview-node");if(!q||B.has(q))return;B.add(q);const me=O(D);if(ne(D)){v=!0;const dt=((Te=D.dataset)==null?void 0:Te.previewLabel)||q,Y=((St=D.dataset)==null?void 0:St.defaultText)||je(D)||"";b(q,Y,dt)}}),v||w()}else w()}return N.forEach(b=>{const w=b.getAttribute("data-preview-node");if(!w)return;const v=O(b),B=ne(b);v&&b.setAttribute("data-changeable","image"),ht(b)&&Se(b),B?(b.setAttribute("contenteditable","true"),b.style.cursor="text",b.style.userSelect="text",b.addEventListener("input",()=>{const me=document.querySelector(`#textFieldList input[data-preview-target="${w}"]`);me&&(me.value=je(b)),b.dataset.currentText=je(b)||"",Z(),x==null||x.schedule("text-edit")}),b.addEventListener("click",()=>{lt(w),xa(w)})):v&&(b.style.cursor="pointer",b.addEventListener("click",()=>{b.dataset.locked!=="true"&&(ia(w),it(b))}));const q=document.querySelector(`#textFieldList input[data-preview-target="${w}"]`);q&&B&&(q.addEventListener("input",()=>{at(b,q.value),x==null||x.schedule("text-change")}),q.value&&q.value.trim()!==""?at(b,q.value):q.value=je(b)||"")}),requestAnimationFrame(()=>Z()),nt(10),!0}catch(t){return console.warn("Could not load SVG for binding:",t),na(),!1}},Yr=async(e={})=>{var St,dt,Y,T;const{scale:t=3,filename:a="inkwise-template.png",download:r=!0}=e,s=K||u;if(!s)throw new Error("No active canvas to export.");rt(s);const d=new XMLSerializer().serializeToString(s),h=I=>{const Ye=Number(I);return Number.isFinite(Ye)?Ye:null},m=(s.getAttribute("viewBox")||"").split(/[\s,]+/).map(h),N=m.length===4?m[2]:null,b=m.length===4?m[3]:null,w=h((St=l==null?void 0:l.dataset)==null?void 0:St.canvasWidth)||h((dt=G==null?void 0:G.dataset)==null?void 0:dt.canvasWidth)||N||1080,v=h((Y=l==null?void 0:l.dataset)==null?void 0:Y.canvasHeight)||h((T=G==null?void 0:G.dataset)==null?void 0:T.canvasHeight)||b||1527,B=Math.max(1,Math.round(w*Math.max(1,t))),D=Math.max(1,Math.round(v*Math.max(1,t))),q=new Image;q.crossOrigin="anonymous",q.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(d)}`,await new Promise((I,Ye)=>{q.onload=I,q.onerror=Ye});const me=document.createElement("canvas");me.width=B,me.height=D;const de=me.getContext("2d");de.fillStyle="#ffffff",de.fillRect(0,0,B,D),de.drawImage(q,0,0,B,D);const Te=me.toDataURL("image/png",1);if(r){const I=document.createElement("a");I.href=Te,I.download=a,I.click()}return{dataUrl:Te,width:B,height:D}};typeof window<"u"&&(window.inkwiseExportCurrentSide=(e={})=>Yr(e));const ba=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),a=e.querySelector("input[data-preview-target]");if(!t||!a||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const s=a.dataset.previewTarget;if(e.remove(),j){const i=j.querySelector(`[data-preview-node="${s}"]`);i==null||i.remove()}if(K){const i=K.querySelector(`[data-preview-node="${s}"]`);i==null||i.remove()}x==null||x.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>ba(e));const xa=e=>{if(!e)return;Qt(),ea("text"),U.forEach(a=>a.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const a=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(a){try{a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const i=document.getElementById("textFieldList");i&&(i.scrollTop=a.offsetTop-12)}a.focus({preventScroll:!1});return}const r=document.querySelector("[data-add-text-field]");r==null||r.focus({preventScroll:!1})},60)};At=xa;const _t=async e=>{if(!Wt(e)||(Je=e,!l))return;let t="",a="";e==="front"&&Ze?(t=Ze,a=Ze):e==="back"&&Be?(t=Be,a=Be):(a=l.dataset[`${e}Svg`]||"",t=l.dataset[`${e}Image`]||"");let r=!1;if(a&&Vr(a)&&await Gr(a)&&(r=!0,l.style.backgroundImage="none",l.style.backgroundSize="",Qa(K)),!r){const s=t||l.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,s||"<empty>"),na(),l.style.backgroundImage=s?`url('${s}')`:"",l.style.backgroundSize=s?"cover":"",l.style.backgroundPosition=s?"center center":"",l.style.backgroundRepeat=s?"no-repeat":"",s&&pa(s),pt(),K=null}y.forEach(s=>{s.classList.toggle("active",s.dataset.cardView===e)}),p.forEach(s=>{const i=s.dataset.cardThumb===e;s.classList.toggle("active",i),s.setAttribute("aria-pressed",i?"true":"false")})};y.forEach(e=>{e.addEventListener("click",()=>{_t(e.dataset.cardView)})}),p.forEach(e=>{e.addEventListener("click",()=>{_t(e.dataset.cardThumb)})});const Ra=_t("front");Ra&&typeof Ra.then=="function"?Ra.catch(()=>{}).then(()=>{nt(6),x==null||x.schedule("initial-load")}):(nt(6),x==null||x.schedule("initial-load"));const er=document.querySelector(".preview-overlay");er&&er.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const a=t.dataset.previewNode;a&&(O(t)?ia(a):(lt(a),xa(a)))}}),F&&A&&F.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${he}`;he+=1;const t=document.createElement("div");t.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",t.appendChild(a);const r=document.createElement("input");r.type="text",r.className="text-field-input",r.placeholder="Add your text",r.dataset.previewTarget=e,t.appendChild(r);const s=document.createElement("button");if(s.type="button",s.className="text-field-delete",s.setAttribute("aria-label","Delete field"),s.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(s),A.appendChild(t),j){const d=document.createElement("div");d.className="pill",d.dataset.previewNode=e,d.dataset.defaultText="CUSTOM TEXT",d.textContent="CUSTOM TEXT",j.appendChild(d)}let i=null;console.log("[InkWise Studio] currentSvgRoot:",K),K?(console.log("[InkWise Studio] Creating SVG text element"),i=document.createElementNS("http://www.w3.org/2000/svg","text"),i.setAttribute("id",e),i.setAttribute("data-preview-node",e),i.setAttribute("data-default-text","CUSTOM TEXT"),i.setAttribute("x","50%"),i.setAttribute("y","50%"),i.setAttribute("text-anchor","middle"),i.setAttribute("dominant-baseline","middle"),i.setAttribute("font-family","Arial, sans-serif"),i.setAttribute("font-size","24"),i.setAttribute("fill","#000000"),i.textContent="CUSTOM TEXT",i.setAttribute("contenteditable","true"),i.style.cursor="text",i.style.userSelect="text",i.addEventListener("input",()=>{r&&(r.value=i.textContent),i.dataset.currentText=i.textContent||"",Z(),x==null||x.schedule("text-edit")}),i.addEventListener("click",()=>{lt(e),xa(e)}),K.appendChild(i),ht(i)&&Se(i),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),ya(r),r.addEventListener("input",()=>{i&&(i.textContent=r.value,i.dataset.currentText=r.value),x==null||x.schedule("text-change")}),lt(e),i&&i.textContent&&i.textContent.trim()!==""?r.value=i.textContent:(r.value="CUSTOM TEXT",i&&(i.textContent="CUSTOM TEXT")),ba(t),setTimeout(()=>{try{A.scrollHeight>A.clientHeight&&A.scrollTo({top:A.scrollHeight,behavior:"smooth"})}catch{A.scrollTop=A.scrollHeight}r.focus({preventScroll:!1})},60)}),Ze=null,Be=null,Je="front";const oa=document.getElementById("image-upload"),tr=document.getElementById("upload-button"),ar=document.getElementById("quick-upload-button"),va=document.getElementById("recentUploadsGrid"),wa=document.getElementById("quickRecentUploads"),Pa="inkwise_recent_uploads",rr=12,$a=()=>{try{const e=localStorage.getItem(Pa);return e?JSON.parse(e):[]}catch{return[]}},Xr=(e,t,a)=>{const r=$a(),s={id:Date.now(),dataUrl:e,filename:t,side:a,timestamp:new Date().toISOString()},i=r.filter(h=>h.filename!==t);i.unshift(s);const d=i.slice(0,rr);try{localStorage.setItem(Pa,JSON.stringify(d))}catch{const m=d.slice(0,Math.floor(rr/2));localStorage.setItem(Pa,JSON.stringify(m))}ir(),nr()},sr=(e,t,a="front")=>{e&&(Xr(e,t||`upload-${Date.now()}`,a),a==="front"?Ze=e:a==="back"&&(Be=e),Je===a&&_t(a),x==null||x.schedule("image-upload"))},ir=()=>{if(!va)return;const e=$a();if(e.length===0){va.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(r=>`
            <div class="recent-upload-item" data-upload-id="${r.id}" data-image-url="${r.dataUrl}" data-side="${r.side}">
                <img src="${r.dataUrl}" alt="${r.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${r.filename}</span>
                </div>
            </div>
        `).join("");va.innerHTML=t;const a=va.querySelectorAll(".recent-upload-item");a.forEach(r=>{r.addEventListener("click",()=>{const s=r.dataset.imageUrl,i=r.dataset.side;a.forEach(d=>d.classList.remove("selected")),r.classList.add("selected"),i==="front"?Ze=s:Be=s,Je===i&&_t(i),r.style.transform="scale(0.95)",setTimeout(()=>{r.style.transform=""},150),x==null||x.schedule("image-select")})})},nr=()=>{if(!wa)return;const t=$a().slice(0,5);if(t.length===0){wa.innerHTML="";return}const a=t.map(s=>`
            <div class="quick-recent-upload-item" data-upload-id="${s.id}" data-image-url="${s.dataUrl}" data-side="${s.side}" title="${s.filename}">
                <img src="${s.dataUrl}" alt="${s.filename}" loading="lazy">
            </div>
        `).join("");wa.innerHTML=a;const r=wa.querySelectorAll(".quick-recent-upload-item");r.forEach(s=>{s.addEventListener("click",()=>{const i=s.dataset.imageUrl,d=s.dataset.side;r.forEach(h=>h.classList.remove("selected")),s.classList.add("selected"),d==="front"?Ze=i:Be=i,Je===d&&_t(d),s.style.transform="scale(0.9)",setTimeout(()=>{s.style.transform=""},150),x==null||x.schedule("image-select")})})},Kr=e=>{const t=e.files[0];if(!t)return;const a=new FileReader;a.onload=r=>{const s=r.target.result;sr(s,t.name,"front")},a.readAsDataURL(t)};oa&&oa.addEventListener("change",()=>Kr(oa)),tr&&tr.addEventListener("click",()=>{oa.click()}),ar&&ar.addEventListener("click",()=>{oa.click()});const Jr=e=>{var a;const t=(a=e.clipboardData)==null?void 0:a.items;if(!(!t||t.length===0))for(const r of t){if(!r||typeof r.type!="string"||!r.type.startsWith("image/"))continue;const s=r.getAsFile();if(!s)continue;const i=new FileReader;i.onload=d=>{const h=d.target.result,m=s.name||`pasted-${Date.now()}.png`;sr(h,m,Je||"front")},i.readAsDataURL(s),e.preventDefault();break}};ir(),nr(),document.addEventListener("paste",Jr);const Da=document.querySelectorAll(".pill-with-tooltip"),qa=document.querySelector(".preview-canvas-wrapper"),za=document.querySelector(".preview-guides"),or=(e,t)=>{e==="safety-pill"&&(qa==null||qa.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(za==null||za.classList.toggle("highlight-bleed",t))},Sa=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),a=e==null?void 0:e.querySelector(".tooltip");!t||!a||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),a.setAttribute("aria-hidden","true"),or(t.id,!1))};Da.forEach(e=>{const t=e.querySelector(".canvas-pill"),a=e.querySelector(".tooltip");!t||!a||(t.addEventListener("click",r=>{r.preventDefault();const s=!e.classList.contains("is-active");Da.forEach(i=>{i!==e&&Sa(i)}),s?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),a.setAttribute("aria-hidden","false"),or(t.id,!0)):Sa(e)}),t.addEventListener("mouseenter",()=>{a.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{a.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||a.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&a.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",r=>{r.key==="Escape"&&(Sa(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||Da.forEach(a=>Sa(a))});const Zr=e=>{if(!e)return!1;const t=ke(a=>{a.setAttribute("font-family",e),a.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const a=jt();a&&(a.dataset.fontFamily=e)}return t},Qr=e=>{const t=vt(e,6,400),a=ke(r=>{r.setAttribute("font-size",t),r.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(a){const r=jt();r&&(r.dataset.fontSize=String(t))}return a},es=e=>{const t=vt(e,8,400),a=39;return Mt(r=>{const s=typeof r.getBBox=="function"?r.getBBox():null,i=parseFloat(r.getAttribute("width")),d=parseFloat(r.getAttribute("height")),h=Number(r.dataset.baseWidth)||(Number.isFinite(i)?i:(s==null?void 0:s.width)||1),m=Number(r.dataset.baseHeight)||(Number.isFinite(d)?d:(s==null?void 0:s.height)||1);r.dataset.baseWidth||(r.dataset.baseWidth=h),r.dataset.baseHeight||(r.dataset.baseHeight=m);const N=t/a,b=Math.max(1,h*N),w=Math.max(1,m*N);r.setAttribute("width",b),r.setAttribute("height",w)},{autosaveReason:"image-scale"})},ts=e=>{const t=Ft(e);if(!t)return!1;const a=ke(r=>{r.setAttribute("fill",t),r.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(a){const r=jt();r&&(r.dataset.color=t)}return a},as=e=>{const t=Ft(e);if(!t||!l)return!1;try{return l.style.backgroundColor=t,l.dataset.backgroundColor=t,x==null||x.schedule("background-color"),!0}catch(a){return console.warn("[InkWise Studio] Failed to apply background color",a),!1}},rs=e=>{const t=Ft(e);return t?Mt(a=>{if(t==="#FFFFFF"){const v=a.dataset.tintFilterId;if(v){const B=wt(a.ownerSVGElement||null),D=B==null?void 0:B.querySelector(`#${v}`);D==null||D.remove(),delete a.dataset.tintFilterId}a.removeAttribute("filter");try{delete a.dataset.tintColor}catch{}return}const r=wt(a.ownerSVGElement||null);if(!r)return;const s=a.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,i=parseInt(t.slice(1,3),16)/255,d=parseInt(t.slice(3,5),16)/255,h=parseInt(t.slice(5,7),16)/255;let m=r.querySelector(`#${s}`);if(!m){m=document.createElementNS(P,"filter"),m.id=s,m.setAttribute("color-interpolation-filters","sRGB");const v=document.createElementNS(P,"feColorMatrix");v.setAttribute("type","matrix"),v.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),m.appendChild(v);const B=document.createElementNS(P,"feComponentTransfer"),D=document.createElementNS(P,"feFuncR");D.setAttribute("type","linear"),B.appendChild(D);const q=document.createElementNS(P,"feFuncG");q.setAttribute("type","linear"),B.appendChild(q);const me=document.createElementNS(P,"feFuncB");me.setAttribute("type","linear"),B.appendChild(me);const de=document.createElementNS(P,"feFuncA");de.setAttribute("type","identity"),B.appendChild(de),m.appendChild(B),r.appendChild(m)}const N=m.querySelector("feFuncR"),b=m.querySelector("feFuncG"),w=m.querySelector("feFuncB");N&&N.setAttribute("slope",i.toString()),b&&b.setAttribute("slope",d.toString()),w&&w.setAttribute("slope",h.toString()),a.dataset.tintFilterId=s,a.setAttribute("filter",`url(#${s})`);try{a.dataset.tintColor=t}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},ss=()=>ke(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",a=Number(t);t==="bold"||a>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),is=()=>ke(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),lr=e=>ke(t=>{const r=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),s=new Set(r);s.has(e)?s.delete(e):s.add(e);const i=Array.from(s).join(" ");i?(t.style.textDecoration=i,t.setAttribute("text-decoration",i)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),ns=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},a={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},r=t[e]||"start",s=a[e]||"left",i=ke(d=>{d.setAttribute("text-anchor",r);const h=d.getAttribute("x");h&&d.querySelectorAll("tspan").forEach(m=>m.setAttribute("x",h)),d.style.textAlign=s},{autosaveReason:"text-align",skipTransformUpdate:!0});if(i){const d=jt();d&&(d.dataset.align=s)}return i},os=e=>{let t=null;const a=ke(r=>{const s=r.textContent||"";let i=s;e==="uppercase"?i=s.toUpperCase():e==="lowercase"&&(i=s.toLowerCase()),r.textContent=i,r.dataset.currentText=i,t=i},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(a){const r=jt();r&&t!==null&&(r.value=t)}return a},ls=()=>{const e=jt();return ke(t=>{const r=(t.textContent||"").split(/\r?\n/),s=t.dataset.listType==="bullet"||r.every(d=>d.trim().startsWith("•")),i=s?r.map(d=>d.replace(/^\s*•\s*/u,"")).join(`
`):r.map(d=>{const h=d.trim();return h?`• ${h}`:"•"}).join(`
`);s?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=i,t.dataset.currentText=i,e&&e.dataset.previewTarget===oe&&(e.value=i)},{autosaveReason:"text-list",skipTransformUpdate:!0})},cs=e=>{const t=vt(e,.5,5);return ke(a=>{a.dataset.lineHeight=t,a.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},ds=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?ke(a=>{if(Math.abs(t)<1e-4)a.style.letterSpacing="",a.removeAttribute("letter-spacing"),delete a.dataset.letterSpacing;else{const r=`${t.toFixed(2)}em`;a.style.letterSpacing=r,a.setAttribute("letter-spacing",r),a.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},us=e=>{const t=typeof e=="string"?e:"none";return ke(a=>{switch(t){case"shadow":a.dataset.effectStyle="shadow",a.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"highlight":a.dataset.effectStyle="highlight",a.style.filter="none",a.style.paintOrder="stroke fill",a.style.stroke="rgba(253, 224, 71, 0.85)",a.style.strokeWidth=6;break;case"glitch":a.dataset.effectStyle="glitch",a.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"echo":a.dataset.effectStyle="echo",a.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;default:delete a.dataset.effectStyle,a.style.filter="",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},fs=e=>{const t=e==="curve"?"curve":"none";return ke(a=>{t==="curve"?a.dataset.effectShape="curve":delete a.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},ps=e=>{const t=vt(e,0,100)/100;return ke(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},ms=e=>{const t=vt(e,0,100)/100;return Mt(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},hs=e=>{const t=vt(e,-180,180);return ke(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},gs=e=>{const t=vt(e,-180,180);return Mt(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},cr=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let a=`${t}_${Date.now()}`,r=1;for(;document.querySelector(`[data-preview-node="${a}"]`);)a=`${t}_${Date.now()}_${r}`,r+=1;return a},ys=()=>{const e=Tt();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=cr(oe||"text"),r=t.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a,r.dataset.defaultText=r.dataset.defaultText||r.textContent||"",t.parentNode.appendChild(r),ga(r),ht(r)&&Se(r);const i=Wr(a,r.textContent||"");return i&&(i.value=r.textContent||"",setTimeout(()=>{try{i.focus({preventScroll:!1})}catch{}},0)),lt(a),Z(),x==null||x.schedule("duplicate-text-node"),!0},bs=()=>{const e=Tt();if(!e.length)return!1;const t=oe;if(e.forEach(a=>{var s;const r=(s=fe.get(a))==null?void 0:s.overlay;r&&(r.remove(),ft.delete(r)),fe.delete(a),a.remove()}),t){const a=Ka(t),r=a==null?void 0:a.closest(".text-field-item");r&&r.remove();const s=zr(t);s==null||s.remove()}return lt(null),Z(),x==null||x.schedule("remove-text-node"),!0},xs=()=>{const e=xt();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=cr(pe||"image"),r=t.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a;const s=parseFloat(t.getAttribute("x"))||0,i=parseFloat(t.getAttribute("y"))||0;return r.setAttribute("x",s+10),r.setAttribute("y",i+10),r.dataset.tintFilterId&&(delete r.dataset.tintFilterId,r.removeAttribute("filter")),t.parentNode.appendChild(r),ga(r),ht(r)&&Se(r),ia(a),Z(),x==null||x.schedule("duplicate-image-node"),!0},vs=()=>{const e=xt();return e.length?(e.forEach(t=>{var r;const a=(r=fe.get(t))==null?void 0:r.overlay;a&&(a.remove(),ft.delete(a)),fe.delete(t),t.remove()}),ia(null),Z(),x==null||x.schedule("remove-image-node"),!0):!1},ws=()=>{const e=Le();if(e==="text"){const t=ke(a=>{var d;const s=!(a.dataset.locked==="true");s?a.dataset.locked="true":delete a.dataset.locked;const i=(d=fe.get(a))==null?void 0:d.overlay;i&&(i.classList.toggle("editor-overlay--locked",s),i.style.pointerEvents=s?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&Z(),t}if(e==="image"){const t=Mt(a=>{var d;const s=!(a.dataset.locked==="true");s?a.dataset.locked="true":delete a.dataset.locked;const i=(d=fe.get(a))==null?void 0:d.overlay;i&&(i.classList.toggle("editor-overlay--locked",s),i.style.pointerEvents=s?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&Z(),t}return!1},Ss=()=>{var a;const e=Tt();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return navigator.clipboard.writeText(t).catch(r=>{console.warn("[InkWise Studio] Clipboard write failed.",r)}),!0;try{const r=document.createElement("textarea");return r.value=t,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),r.remove(),!0}catch(r){return console.warn("[InkWise Studio] Clipboard fallback failed.",r),!1}},Ns=()=>{var r;const e=xt();if(!e.length)return!1;const t=e[0],a=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!a)return!1;if((r=navigator==null?void 0:navigator.clipboard)!=null&&r.writeText)return navigator.clipboard.writeText(a).catch(s=>{console.warn("[InkWise Studio] Clipboard write failed for image.",s)}),!0;try{const s=document.createElement("textarea");return s.value=a,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),s.remove(),!0}catch(s){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",s),!1}},ks=()=>{const e=Le();return e==="text"?Ss():e==="image"?Ns():!1},Cs=()=>{const e=Le();return e==="text"?ys():e==="image"?xs():!1},Es=()=>{const e=Le();return e==="text"?bs():e==="image"?vs():!1},As=e=>{const t=Le();return t==="text"?Fs(e):t==="image"?Ms(e):!1},Is=e=>{const t=Le();return t==="text"?ps(e):t==="image"?ms(e):!1},Ls=e=>{const t=Le();return t==="text"?hs(e):t==="image"?gs(e):!1},Ts=e=>{const t=Le();return t==="text"?ts(e):t==="image"?rs(e):t==="background"?as(e):!1},js=e=>{const t=Le();return t==="text"?Qr(e):t==="image"?es(e):!1},Fs=e=>{const t=Tt();if(!t.length)return!1;const a=t[0],r=a.parentNode;if(!r)return!1;const s=Array.from(r.children),i=s.indexOf(a);if(i===-1)return!1;if(e==="bring-to-front")r.appendChild(a);else if(e==="send-to-back")r.insertBefore(a,s[0]);else if(e==="bring-forward"){const d=Math.min(s.length-1,i+1);if(d!==i){const h=s[d+1]||null;r.insertBefore(a,h)}}else if(e==="send-backward"){const d=Math.max(0,i-1);if(d!==i){const h=s[d];r.insertBefore(a,h)}}else return!1;return Z(),x==null||x.schedule("text-layer"),!0},Ms=e=>{const t=xt();if(!t.length)return!1;const a=t[0],r=a.parentNode;if(!r)return!1;const s=Array.from(r.children),i=s.indexOf(a);if(i===-1)return!1;if(e==="bring-to-front")r.appendChild(a);else if(e==="send-to-back")r.insertBefore(a,s[0]);else if(e==="bring-forward"){const d=Math.min(s.length-1,i+1);if(d!==i){const h=s[d+1]||null;r.insertBefore(a,h)}}else if(e==="send-backward"){const d=Math.max(0,i-1);if(d!==i){const h=s[d];r.insertBefore(a,h)}}else return!1;return Z(),x==null||x.schedule("image-layer"),!0},_s={setFontFamily:e=>Le()!=="text"?!1:Zr(e),setFontSize:e=>js(e),setColor:e=>Ts(e),getActiveKey:()=>oe,getSelection:()=>{const e=Le();return{type:e,key:e==="text"?oe:e==="image"?pe:null,textKey:oe,imageKey:pe}},dispatch(e,t){const a=Le();switch(e){case"bold":a==="text"&&ss();break;case"italic":a==="text"&&is();break;case"underline":a==="text"&&lr("underline");break;case"strikethrough":a==="text"&&lr("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":a==="text"&&ns(e);break;case"list-bullets":a==="text"&&ls();break;case"line-spacing":a==="text"&&cs(t);break;case"letter-spacing":a==="text"&&ds(t);break;case"uppercase":case"lowercase":a==="text"&&os(e);break;case"effect-style":a==="text"&&us(t);break;case"effect-shape":a==="text"&&fs(t);break;case"opacity":Is(t);break;case"rotation":Ls(t);break;case"layer":As(t);break;case"more":t==="duplicate"?Cs():t==="delete"?Es():t==="lock"?ws():t==="copy"&&ks();break;case"replace-image":const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=s=>{const i=s.target.files[0];if(i){const d=new FileReader;d.onload=h=>{const m=h.target.result;Mt(N=>{N.setAttribute("href",m),N.setAttributeNS("http://www.w3.org/1999/xlink","href",m)}),x==null||x.schedule("image-replace")},d.readAsDataURL(i)}},r.click();break;case"crop":{const s=xt();if(!s.length)break;const i=fe.get(s[0]),d=i==null?void 0:i.overlay;if(!d)break;if(Ja(),(Re==null?void 0:Re.overlay)===d)Re.refresh();else{bt();const h=Or(d,s[0]);h&&(Re=h)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=_s);const Bt=document.getElementById("canvas-zoom-select"),dr=document.getElementById("canvas-zoom-display"),Bs=document.querySelectorAll("[data-zoom-step]"),ur=document.querySelector(".preview-canvas-wrapper"),Na=E,ct=[.25,.5,.75,1,1.5,2,3];if(Bt&&ur&&Na){const e=a=>{Na.style.setProperty("--canvas-scale",a.toString()),ur.style.removeProperty("transform"),Bt.value=a.toString(),dr&&(dr.textContent=`${Math.round(a*100)}%`),Z()},t=a=>{const r=parseFloat(Bt.value)||1,s=ct.indexOf(r);if(s===-1)return;let i=s;a==="up"&&s<ct.length-1&&(i=s+1),a==="down"&&s>0&&(i=s-1),i!==s&&e(ct[i])};Bt.addEventListener("change",a=>{const r=parseFloat(a.target.value)||1;e(r)}),Bs.forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.zoomStep;r&&t(r==="up"?"up":"down")})}),Na&&Na.addEventListener("wheel",a=>{a.preventDefault();const r=parseFloat(Bt.value)||1;let s=r;if(a.deltaY>0){const i=ct.indexOf(r);i>0&&(s=ct[i-1])}else{const i=ct.indexOf(r);i<ct.length-1&&(s=ct[i+1])}s!==r&&e(s)},{passive:!1}),e(parseFloat(Bt.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement;(!t||!t.matches("#textFieldList input")&&!t.closest(".studio-react-widgets"))&&document.body.classList.remove("text-toolbar-visible")},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ue,{once:!0}):ue()}const Mr=[{name:"Lobster",family:"Lobster",weight:"400",style:"normal"},{name:"Fredoka One",family:"Fredoka One",weight:"400",style:"normal"},{name:"Pacifico",family:"Pacifico",weight:"400",style:"normal"},{name:"Baloo 2",family:"Baloo 2",weight:"400",style:"normal"},{name:"Poppins Bold",family:"Poppins",weight:"700",style:"normal"},{name:"Anton",family:"Anton",weight:"400",style:"normal"},{name:"Gochi Hand",family:"Gochi Hand",weight:"400",style:"normal"},{name:"Bangers",family:"Bangers",weight:"400",style:"normal"},{name:"Chewy",family:"Chewy",weight:"400",style:"normal"},{name:"Rubik ExtraBold",family:"Rubik",weight:"800",style:"normal"},{name:"Comic Neue Bold",family:"Comic Neue",weight:"700",style:"normal"},{name:"Amatic SC Bold",family:"Amatic SC",weight:"700",style:"normal"},{name:"Luckiest Guy",family:"Luckiest Guy",weight:"400",style:"normal"},{name:"Kalam Bold",family:"Kalam",weight:"700",style:"normal"},{name:"Bubblegum Sans",family:"Bubblegum Sans",weight:"400",style:"normal"},{name:"Shrikhand",family:"Shrikhand",weight:"400",style:"normal"},{name:"Jua",family:"Jua",weight:"400",style:"normal"},{name:"DynaPuff",family:"DynaPuff",weight:"400",style:"normal"},{name:"Cabin Sketch",family:"Cabin Sketch",weight:"400",style:"normal"},{name:"Titan One",family:"Titan One",weight:"400",style:"normal"},{name:"Montserrat SemiBold",family:"Montserrat",weight:"600",style:"normal"},{name:"Helvetica Neue",family:"Helvetica Neue",weight:"400",style:"normal"},{name:"Lato Bold",family:"Lato",weight:"700",style:"normal"},{name:"Source Sans Pro",family:"Source Sans Pro",weight:"400",style:"normal"},{name:"Poppins Medium",family:"Poppins",weight:"500",style:"normal"},{name:"Roboto Condensed",family:"Roboto Condensed",weight:"400",style:"normal"},{name:"Open Sans",family:"Open Sans",weight:"400",style:"normal"},{name:"Oswald",family:"Oswald",weight:"400",style:"normal"},{name:"Nunito Sans",family:"Nunito Sans",weight:"400",style:"normal"},{name:"Inter SemiBold",family:"Inter",weight:"600",style:"normal"},{name:"Futura PT",family:"Futura PT",weight:"400",style:"normal"},{name:"Avenir Next",family:"Avenir Next",weight:"400",style:"normal"},{name:"Work Sans Medium",family:"Work Sans",weight:"500",style:"normal"},{name:"Proxima Nova",family:"Proxima Nova",weight:"400",style:"normal"},{name:"IBM Plex Sans",family:"IBM Plex Sans",weight:"400",style:"normal"},{name:"Barlow SemiCondensed",family:"Barlow Semi Condensed",weight:"400",style:"normal"},{name:"Sora",family:"Sora",weight:"400",style:"normal"},{name:"Metropolis",family:"Metropolis",weight:"400",style:"normal"},{name:"Urbanist",family:"Urbanist",weight:"400",style:"normal"},{name:"Manrope",family:"Manrope",weight:"400",style:"normal"},{name:"Quicksand Light",family:"Quicksand",weight:"300",style:"normal"},{name:"Great Vibes",family:"Great Vibes",weight:"400",style:"normal"},{name:"Parisienne",family:"Parisienne",weight:"400",style:"normal"},{name:"Nunito Light",family:"Nunito",weight:"300",style:"normal"},{name:"Cormorant Garamond",family:"Cormorant Garamond",weight:"400",style:"normal"},{name:"Playfair Display",family:"Playfair Display",weight:"400",style:"normal"},{name:"Allura",family:"Allura",weight:"400",style:"normal"},{name:"DM Sans",family:"DM Sans",weight:"400",style:"normal"},{name:"Satisfy",family:"Satisfy",weight:"400",style:"normal"},{name:"Karla",family:"Karla",weight:"400",style:"normal"},{name:"Josefin Light",family:"Josefin Sans",weight:"300",style:"normal"},{name:"Merriweather Light",family:"Merriweather",weight:"300",style:"normal"},{name:"Sacramento",family:"Sacramento",weight:"400",style:"normal"},{name:"Dancing Script",family:"Dancing Script",weight:"400",style:"normal"},{name:"Marcellus",family:"Marcellus",weight:"400",style:"normal"},{name:"Crimson Pro",family:"Crimson Pro",weight:"400",style:"normal"},{name:"ABeeZee",family:"ABeeZee",weight:"400",style:"normal"},{name:"GFS Didot",family:"GFS Didot",weight:"400",style:"normal"},{name:"Overlock Light",family:"Overlock",weight:"300",style:"normal"},{name:"Hind Soft",family:"Hind",weight:"400",style:"normal"},{name:"Cinzel",family:"Cinzel",weight:"400",style:"normal"},{name:"Cormorant Infant",family:"Cormorant Infant",weight:"400",style:"normal"},{name:"Playfair Display Italic",family:"Playfair Display",weight:"400",style:"italic"},{name:"Alex Brush",family:"Alex Brush",weight:"400",style:"normal"},{name:"Montserrat Light",family:"Montserrat",weight:"300",style:"normal"},{name:"Bodoni Moda",family:"Bodoni Moda",weight:"400",style:"normal"},{name:"Cormorant Upright",family:"Cormorant Upright",weight:"400",style:"normal"},{name:"Libre Baskerville Italic",family:"Libre Baskerville",weight:"400",style:"italic"},{name:"Tangerine",family:"Tangerine",weight:"400",style:"normal"},{name:"Cinzel Decorative",family:"Cinzel Decorative",weight:"400",style:"normal"},{name:"Forum",family:"Forum",weight:"400",style:"normal"},{name:"Cardo Italic",family:"Cardo",weight:"400",style:"italic"},{name:"Unna Italic",family:"Unna",weight:"400",style:"italic"},{name:"Prata",family:"Prata",weight:"400",style:"normal"},{name:"Gilda Display",family:"Gilda Display",weight:"400",style:"normal"},{name:"Cormorant SC",family:"Cormorant SC",weight:"400",style:"normal"},{name:"Quattrocento",family:"Quattrocento",weight:"400",style:"normal"},{name:"Marcellus SC",family:"Marcellus SC",weight:"400",style:"normal"}],Ks=[12,14,16,18,24,32,36,39,42,48,60];function Wa(ue,o,l){return Math.min(Math.max(ue,o),l)}function Js({onFontChange:ue=()=>{},onSizeChange:o=()=>{},onAction:l=()=>{},onColorChange:u=()=>{},activeElementType:p=null}){const y=_.useMemo(()=>Mr[0],[]),[j,A]=_.useState(y),[F,U]=_.useState(39),[E,P]=_.useState(!1),[W,V]=_.useState(!1),G=_.useRef(null),he=_.useRef(null),[ie,z]=_.useState(!1),Q=_.useRef(null),[O,ne]=_.useState(!1),je=_.useRef(null),[at,Ee]=_.useState(!1),kt=_.useRef(null),[rt,Ae]=_.useState("#FFFFFF"),[st,Dt]=_.useState([]),ca=_.useMemo(()=>[{label:"Grayscale",colors:["#FFFFFF","#E5E7EB","#9CA3AF","#4B5563","#111827"]},{label:"Blues",colors:["#DCEEFB","#A8D1FF","#4DA1FF","#2563EB","#0B3D91"]},{label:"Greens",colors:["#DEF7EC","#BFEBD3","#34D399","#059669","#064E3B"]},{label:"Yellows",colors:["#FFFBEB","#FEF3C7","#FBBF24","#F59E0B","#B45309"]},{label:"Oranges",colors:["#FFF1E6","#FFD8B5","#FB923C","#F97316","#7C2D12"]},{label:"Reds",colors:["#FFEFF2","#FFD6DD","#EF4444","#DC2626","#58151C"]}],[]),[ut,qt]=_.useState(0),[Ct,da]=_.useState(0),[Et,zt]=_.useState(100),[ze,Me]=_.useState("swatches"),Ot=_.useRef(null),Ta=_.useRef(!1),L=p==="text",_e=p==="image",ge=L||_e,[Xe,Oe]=_.useState(0),[fe,ft]=_.useState(0),[Ke,ye]=_.useState(0),[K,ua]=_.useState(0);function At(c,C,H,se){const xe=c/100,Ne=C/100,We=H/100,Ve=se/100,Ge=Math.round(255*(1-xe)*(1-Ve)),ta=Math.round(255*(1-Ne)*(1-Ve)),Lt=Math.round(255*(1-We)*(1-Ve)),yt=aa=>aa.toString(16).padStart(2,"0").toUpperCase();return`#${yt(Ge)}${yt(ta)}${yt(Lt)}`}_.useEffect(()=>{if(ze==="cmyk")try{const c=At(Xe,fe,Ke,K);Ae(c),u(c)}catch{}},[Xe,fe,Ke,K,ze]);function Je(c){const C=c.replace("#",""),H=parseInt(C,16),se=H>>16&255,xe=H>>8&255,Ne=H&255;return{r:se,g:xe,b:Ne}}function Ze(c,C,H){c/=255,C/=255,H/=255;const se=Math.max(c,C,H),xe=Math.min(c,C,H);let Ne=0,We=0,Ve=(se+xe)/2;if(se!==xe){const Ge=se-xe;switch(We=Ve>.5?Ge/(2-se-xe):Ge/(se+xe),se){case c:Ne=(C-H)/Ge+(C<H?6:0);break;case C:Ne=(H-c)/Ge+2;break;case H:Ne=(c-C)/Ge+4;break}Ne/=6}return{h:Math.round(Ne*360),s:Math.round(We*100),l:Math.round(Ve*100)}}function Be(c,C,H){C/=100,H/=100;const se=We=>(We+c/30)%12,xe=C*Math.min(H,1-H),Ne=We=>{const Ve=H-xe*Math.max(-1,Math.min(se(We)-3,Math.min(9-se(We),1)));return Math.round(255*Ve).toString(16).padStart(2,"0")};return`#${Ne(0)}${Ne(8)}${Ne(4)}`.toUpperCase()}_.useEffect(()=>{try{const c=Je(rt.replace("#","")),{h:C,s:H,l:se}=Ze(c.r,c.g,c.b);qt(C),da(H),zt(se)}catch{}},[rt]),_.useEffect(()=>{const c=Be(ut,Ct,Et);Ae(c)},[ut,Ct,Et]);const x=c=>{Ta.current=!0,oe(c),window.addEventListener("mousemove",oe),window.addEventListener("mouseup",pe)},oe=c=>{if(!Ot.current)return;const C=Ot.current.getBoundingClientRect(),H=Math.min(Math.max(0,(c.clientX-C.left)/C.width),1),se=Math.min(Math.max(0,(c.clientY-C.top)/C.height),1),xe=Math.round(H*100),Ne=Math.round((1-se)*100);da(xe),zt(Ne)},pe=()=>{Ta.current=!1,window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",pe)};_.useEffect(()=>{const c=C=>{(E&&G.current&&!G.current.contains(C.target)||W&&he.current&&!he.current.contains(C.target)||ie&&Q.current&&!Q.current.contains(C.target)||O&&je.current&&!je.current.contains(C.target)||Wt&&Ie.current&&!Ie.current.contains(C.target)||it&&pt.current&&!pt.current.contains(C.target)||He&&Vt.current&&!Vt.current.contains(C.target)||Xt&&Jt.current&&!Jt.current.contains(C.target))&&(P(!1),V(!1),z(!1),ne(!1),we(!1),Ce(!1),Se(!1),ot(!1))};return(E||W||ie||O||Wt||it||He||at||Xt||ht||pa||ma)&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[E,W]);const Ue=c=>{L&&(A(c),ue(c.family),P(!1))},Re=c=>{const C=(c||"#FFFFFF").toUpperCase();Ae(C),u(C),Dt(H=>[C,...H.filter(xe=>xe!==C)].slice(0,8)),V(!1)},Ut=c=>{const C=Wa(c,8,96);U(C),o(C)},fa=c=>{ge&&Ut(F+c)},Ht=c=>{if(!ge)return;const C=Number(c.target.value);Number.isFinite(C)&&Ut(C)},[Wt,we]=_.useState(!1),Ie=_.useRef(null),[it,Ce]=_.useState(!1),pt=_.useRef(null),[He,Se]=_.useState(!1),Vt=_.useRef(null),[Z,nt]=_.useState(1.4),[Gt,Yt]=_.useState(.12),[Xt,ot]=_.useState(!1),[Kt,mt]=_.useState(100),Jt=_.useRef(null),[ht,Qe]=_.useState(!1),[gt,Zt]=_.useState(0),ja=_.useRef(null),[pa,Pe]=_.useState(!1),Fa=_.useRef(null),[ma,$e]=_.useState(!1),Qt=_.useRef(null);_.useEffect(()=>{L||(P(!1),z(!1),ne(!1),we(!1),Ce(!1),Se(!1),Ee(!1))},[L]),_.useEffect(()=>{ge||(V(!1),ot(!1),Qe(!1),Pe(!1),$e(!1))},[ge]);const ea=()=>{L&&(nt(1.4),l("line-spacing")(1.4))},It=()=>{L&&(Yt(.12),l("letter-spacing")(.12))};return n.jsxs("div",{className:"text-mini-toolbar",role:"toolbar","aria-label":_e?"Image editing toolbar":"Text editing toolbar",children:[n.jsxs("div",{className:"toolbar-group toolbar-group--font",children:[_e?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>l("replace-image"),children:"Replace Image"}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("button",{type:"button",className:"ghost-button",onClick:()=>l("crop"),children:[n.jsx("i",{className:"fa-solid fa-crop-simple"})," Crop"]})]}):n.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>{L&&P(c=>!c)},"aria-label":L?"Choose font family":"Font selection available for text elements",disabled:!L,children:[L?j.name:"Select element"," ",n.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),L&&E&&n.jsx("div",{className:"font-modal",ref:G,children:n.jsx("div",{className:"font-modal-content",children:Mr.map(c=>n.jsx("button",{type:"button",className:"font-option",onClick:()=>Ue(c),style:{fontFamily:c.family,fontWeight:c.weight,fontStyle:c.style},children:c.name},c.name))})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--size",role:"group","aria-label":_e?"Image scale":"Font size",children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":_e?"Decrease image scale":"Decrease font size",onClick:()=>fa(-2),disabled:!ge,children:n.jsx("i",{className:"fa-solid fa-minus","aria-hidden":"true"})}),n.jsx("label",{className:"sr-only",htmlFor:"mini-toolbar-size",children:_e?"Image scale":"Font size"}),n.jsx("select",{id:"mini-toolbar-size",className:"size-select",value:F,onChange:Ht,disabled:!ge,children:Ks.map(c=>n.jsx("option",{value:c,children:c},c))}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":_e?"Increase image scale":"Increase font size",onClick:()=>fa(2),disabled:!ge,children:n.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"color-swatch","aria-label":_e?"Choose image tint":"Choose text color",onClick:()=>{ge&&(P(!1),V(c=>!c))},disabled:!ge,children:n.jsx("span",{className:"color-swatch__chip",style:{background:rt}})}),W&&n.jsx("div",{className:"color-modal",ref:he,children:n.jsxs("div",{className:"color-modal-content",children:[n.jsxs("div",{className:"color-modal-header",children:[n.jsx("div",{className:"color-modal-title",children:_e?"Image tint":"Text color"}),n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>V(!1),"aria-label":"Close color picker",children:n.jsx("i",{className:"fa-solid fa-x"})})]}),n.jsx("div",{className:"color-picker-area",children:n.jsx("div",{className:"inline-color-picker",children:n.jsxs("div",{className:"spectrum-picker",children:[n.jsx("div",{className:"spectrum-area",ref:Ot,onMouseDown:x,style:{background:`linear-gradient(to right, #fff, hsl(${ut}, 100%, 50%)), linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,1))`},role:"application","aria-label":"Color spectrum",children:n.jsx("div",{className:"spectrum-handle",style:{left:`${Ct}%`,top:`${100-Et}%`},"aria-hidden":"true"})}),n.jsx("div",{className:"hue-row",children:n.jsx("input",{className:"hue-range",type:"range",min:"0",max:"360",value:ut,onChange:c=>qt(Number(c.target.value)),style:{background:`linear-gradient(to right, ${Array.from({length:13}).map((c,C)=>`hsl(${C*30},100%,50%)`).join(",")})`},"aria-label":"Hue"})}),n.jsxs("div",{className:"hex-row",children:[n.jsx("input",{type:"text",className:"hex-input",value:Be(ut,Ct,Et),onChange:c=>Ae(c.target.value),"aria-label":"Hex color value"}),n.jsx("button",{type:"button",className:"eyedropper-button",title:"Eyedropper","aria-label":"Eyedropper",children:n.jsx("i",{className:"fa-solid fa-eye-dropper"})})]})]})})}),n.jsxs("div",{className:"swatch-sections",children:[n.jsxs("div",{className:"tabs",children:[n.jsx("div",{className:`tab ${ze==="swatches"?"active":""}`,onClick:()=>Me("swatches"),children:"Swatches"}),n.jsx("div",{className:`tab ${ze==="cmyk"?"active":""}`,onClick:()=>Me("cmyk"),children:"CMYK"})]}),n.jsx("div",{className:"section-divider","aria-hidden":"true"}),ze==="swatches"&&n.jsxs(n.Fragment,{children:[st.length>0&&n.jsxs("div",{className:"swatch-section",children:[n.jsx("div",{className:"swatch-title",children:"Recent colors"}),n.jsx("div",{className:"swatches-grid",children:st.map(c=>n.jsx("button",{type:"button",className:"swatch",style:{background:c},onClick:()=>Re(c)},c))})]}),st.length>0&&ca.length>0&&n.jsx("div",{className:"section-divider","aria-hidden":"true"}),n.jsx("div",{className:"swatch-section",children:n.jsx("div",{className:"preset-groups",children:ca.map((c,C)=>n.jsx("div",{className:"swatch-group",children:n.jsx("div",{className:"swatches-grid preset",children:c.colors.map(H=>n.jsx("button",{type:"button",className:"swatch",style:{background:H},onClick:()=>Re(H)},H))})},C))})})]}),ze==="cmyk"&&n.jsxs("div",{className:"swatch-section cmyk-section",children:[n.jsx("div",{className:"swatch-title",children:"CMYK (preview)"}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"C"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Xe,onChange:c=>Oe(Number(c.target.value)),className:"cmyk-range c-range","aria-label":"Cyan"}),n.jsxs("div",{className:"cmyk-value",children:[Xe,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"M"}),n.jsx("input",{type:"range",min:"0",max:"100",value:fe,onChange:c=>ft(Number(c.target.value)),className:"cmyk-range m-range","aria-label":"Magenta"}),n.jsxs("div",{className:"cmyk-value",children:[fe,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"Y"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Ke,onChange:c=>ye(Number(c.target.value)),className:"cmyk-range y-range","aria-label":"Yellow"}),n.jsxs("div",{className:"cmyk-value",children:[Ke,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"K"}),n.jsx("input",{type:"range",min:"0",max:"100",value:K,onChange:c=>ua(Number(c.target.value)),className:"cmyk-range k-range","aria-label":"Key Black"}),n.jsxs("div",{className:"cmyk-value",children:[K,"%"]})]})]})]})]})})]}),L&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--actions",role:"group","aria-label":"Text format actions",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bold",onClick:()=>{z(c=>!c),V(!1),P(!1)},children:n.jsx("span",{className:"toolbar-label",children:"B"})}),ie&&n.jsx("div",{className:"format-modal",ref:Q,role:"dialog","aria-label":"Text formatting options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option",title:"Bold",onClick:()=>{l("bold"),z(!1)},children:n.jsx("i",{className:"fi fi-ss-bold","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Italic",onClick:()=>{l("italic"),z(!1)},children:n.jsx("i",{className:"fi fi-br-italic","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Underline",onClick:()=>{l("underline"),z(!1)},children:n.jsx("i",{className:"fi fi-br-underline","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Strikethrough",onClick:()=>{l("strikethrough"),z(!1)},children:n.jsx("i",{className:"fi fi-br-strikethrough","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Align center",onClick:()=>{we(c=>!c),z(!1),V(!1),P(!1)},children:n.jsx("i",{className:"fa-solid fa-align-center","aria-hidden":"true"})}),Wt&&n.jsx("div",{className:"align-modal",ref:Ie,role:"dialog","aria-label":"Alignment options",children:n.jsxs("div",{className:"align-modal-content",children:[n.jsx("button",{type:"button",className:"align-option",title:"Align-justify",onClick:()=>{l("align-justify"),we(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-center",onClick:()=>{l("align-center"),we(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"5",y:"4",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"5",y:"14",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-left",onClick:()=>{l("align-left"),we(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-right",onClick:()=>{l("align-right"),we(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"9",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"9",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bulleted list",onClick:()=>{Ce(c=>!c),we(!1),z(!1),V(!1),P(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})}),it&&n.jsx("div",{className:"list-modal",ref:pt,role:"dialog","aria-label":"List options",children:n.jsxs("div",{className:"list-modal-content",children:[n.jsx("button",{type:"button",className:"list-option",title:"Numbered list",onClick:()=>{Ce(!1),Se(!0)},children:n.jsx("i",{className:"fa-solid fa-list-ol","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"list-option",title:"Bulleted list",onClick:()=>{l("list-bullets"),Ce(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Numbered list",onClick:()=>{Se(c=>!c),Ce(!1),we(!1),z(!1),V(!1),P(!1)},children:n.jsx("i",{className:"fa-solid fa-text-height","aria-hidden":"true"})}),He&&n.jsx("div",{className:"number-modal",ref:Vt,role:"dialog","aria-label":"Text spacing options",children:n.jsxs("div",{className:"number-modal-content",children:[n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Line spacing"}),n.jsx("input",{type:"range",min:"0.8",max:"3",step:"0.01",value:Z,onChange:c=>{const C=Number(c.target.value);nt(C),l("line-spacing")(C)},className:"number-range line-range","aria-label":"Line spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:ea,"aria-label":"Reset line spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:Z,onChange:c=>{const C=Number(c.target.value);nt(C),l("line-spacing")(C)}})]}),n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Letter spacing"}),n.jsx("input",{type:"range",min:"-0.5",max:"1",step:"0.01",value:Gt,onChange:c=>{const C=Number(c.target.value);Yt(C),l("letter-spacing")(C)},className:"number-range letter-range","aria-label":"Letter spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:It,"aria-label":"Reset letter spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:Gt,onChange:c=>{const C=Number(c.target.value);Yt(C),l("letter-spacing")(C)}})]})]})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--menu",role:"group","aria-label":"Text styles",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"text-button",onClick:()=>{ne(c=>!c),Ce(!1),we(!1),V(!1),P(!1),Se(!1),z(!1),Ee(!1)},"aria-label":"Format",children:"Format"}),O&&n.jsx("div",{className:"case-modal format-modal",ref:je,role:"dialog","aria-label":"Case options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option ",title:"Lowercase",onClick:()=>{l("lowercase"),ne(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"a"})}),n.jsx("button",{type:"button",className:"format-option ",title:"Uppercase",onClick:()=>{l("uppercase"),ne(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"A"})})]})}),n.jsxs("button",{type:"button",className:"text-button",onClick:()=>{Ee(c=>!c),ne(!1),Ce(!1),we(!1),z(!1),V(!1),P(!1),Se(!1)},children:["T",n.jsx("span",{className:"text-button__super",children:"+"})," Effects"]}),at&&n.jsxs("div",{className:"effects-modal",ref:kt,role:"dialog","aria-label":"Text effects",children:[n.jsx("button",{type:"button",className:"modal-close-btn","aria-label":"Close effects",onClick:()=>Ee(!1),children:n.jsx("i",{className:"fa-solid fa-x","aria-hidden":"true"})}),n.jsxs("div",{className:"effects-modal-content",children:[n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Style"}),n.jsxs("div",{className:"effects-grid",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-style")("none")},children:n.jsx("div",{className:"effect-preview none",children:n.jsx("i",{className:"fa-solid fa-ban","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Shadow",onClick:()=>{l("effect-style")("shadow")},children:n.jsx("div",{className:"effect-preview shadow",children:n.jsx("i",{className:"fi fi-rr-text-shadow","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Highlight",onClick:()=>{l("effect-style")("highlight")},children:n.jsx("div",{className:"effect-preview highlight",children:n.jsx("i",{className:"fa-solid fa-highlighter","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Glitch",onClick:()=>{l("effect-style")("glitch")},children:n.jsx("div",{className:"effect-preview glitch",children:n.jsx("span",{className:"glitch-mark",children:"/A"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Echo",onClick:()=>{l("effect-style")("echo")},children:n.jsx("div",{className:"effect-preview echo",children:n.jsx("span",{className:"echo-mark",children:"//A"})})})]})]}),n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Shape"}),n.jsxs("div",{className:"effects-grid two",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-shape")("none")},children:n.jsx("div",{className:"effect-preview none",children:"None"})}),n.jsx("button",{type:"button",className:"effect-option",title:"Curve",onClick:()=>{l("effect-shape")("curve")},children:n.jsx("div",{className:"effect-preview curve",children:"Curve"})})]})]})]})]})]})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--utility",role:"group","aria-label":"Utility actions",style:{position:"relative"},children:[n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Spacing",onClick:()=>{ge&&(ot(c=>!c),Ee(!1),ne(!1),Ce(!1),we(!1),z(!1),V(!1),P(!1),Se(!1))},disabled:!ge,children:n.jsx("i",{className:"fi fi-rr-chess-board","aria-hidden":"true"})}),Xt&&n.jsx("div",{className:"opacity-modal",ref:Jt,role:"dialog","aria-label":"Opacity",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"opacity-modal-content",children:[n.jsxs("div",{className:"opacity-row",children:[n.jsx("label",{className:"opacity-label",children:"Opacity"}),n.jsx("input",{className:"opacity-input",type:"number",min:"0",max:"100",value:Kt,onChange:c=>{const C=Wa(Number(c.target.value)||0,0,100);mt(C),l("opacity")(C)},"aria-label":"Opacity percent"})]}),n.jsx("div",{className:"opacity-slider-row",children:n.jsx("input",{type:"range",min:"0",max:"100",value:Kt,onChange:c=>{const C=Number(c.target.value);mt(C),l("opacity")(C)},className:"opacity-slider","aria-label":"Opacity slider",style:{background:"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1))"}})})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Layers",onClick:()=>{ge&&(Pe(c=>!c),Qe(!1),ot(!1),Ee(!1),ne(!1),Ce(!1),we(!1),z(!1),V(!1),P(!1),Se(!1))},disabled:!ge,children:n.jsx("i",{className:"fa-solid fa-layer-group","aria-hidden":"true"})}),pa&&n.jsx("div",{className:"layers-modal",ref:Fa,role:"dialog","aria-label":"Layer management",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"layers-modal-content",children:[n.jsxs("button",{type:"button",className:"layer-option",title:"Bring to front",onClick:()=>{l("layer")("bring-to-front"),Pe(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring to front"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Bring forward",onClick:()=>{l("layer")("bring-forward"),Pe(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring forward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send backward",onClick:()=>{l("layer")("send-backward"),Pe(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send backward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send to back",onClick:()=>{l("layer")("send-to-back"),Pe(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send to back"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Share / Rotation",onClick:()=>{ge&&(Qe(c=>!c),ot(!1),Ee(!1),ne(!1),Ce(!1),we(!1),z(!1),V(!1),P(!1),Se(!1))},disabled:!ge,children:n.jsx("i",{className:"fi fi-rr-refresh","aria-hidden":"true"})}),ht&&n.jsx("div",{className:"rotation-modal",ref:ja,role:"dialog","aria-label":"Rotation",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"rotation-modal-content",children:[n.jsxs("div",{className:"rotation-row",children:[n.jsx("label",{className:"rotation-label",children:"Rotation"}),n.jsx("input",{className:"rotation-input",type:"number",min:"-180",max:"180",value:gt,onChange:c=>{const C=Wa(Number(c.target.value)||0,-180,180);Zt(C),l("rotation")(C)},"aria-label":"Rotation degrees"})]}),n.jsxs("div",{className:"rotation-slider-row",children:[n.jsx("input",{type:"range",min:"-180",max:"180",value:gt,onChange:c=>{const C=Number(c.target.value);Zt(C),l("rotation")(C)},className:"rotation-slider","aria-label":"Rotation slider"}),n.jsx("i",{className:"fa-solid fa-rotate-right rotation-icon","aria-hidden":"true"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"More options",onClick:()=>{ge&&($e(c=>!c),Pe(!1),Qe(!1),ot(!1),Ee(!1),ne(!1),Ce(!1),we(!1),z(!1),V(!1),P(!1),Se(!1))},disabled:!ge,children:n.jsx("i",{className:"fa-solid fa-ellipsis","aria-hidden":"true"})}),ma&&n.jsx("div",{className:"more-modal",ref:Qt,role:"dialog","aria-label":"More options",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"more-modal-content",children:[n.jsxs("button",{type:"button",className:"more-option",title:"Duplicate",onClick:()=>{l("more")("duplicate"),$e(!1)},children:[n.jsx("i",{className:"fa-solid fa-clone","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Duplicate"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Delete",onClick:()=>{l("more")("delete"),$e(!1)},children:[n.jsx("i",{className:"fi fi-rr-trash","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Delete"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Lock",onClick:()=>{l("more")("lock"),$e(!1)},children:[n.jsx("i",{className:"fi fi-rr-unlock","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Lock"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Copy",onClick:()=>{l("more")("copy"),$e(!1)},children:[n.jsx("i",{className:"fa-solid fa-copy","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Copy"})]})]})})]})]})]})}function Zs(){const ue=document.getElementById("inkwise-customer-studio-bootstrap");if(ue)try{const o=JSON.parse(ue.textContent||"{}");if(o&&typeof o=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=o),o}catch(o){console.error("[InkWise Studio] Failed to parse bootstrap payload.",o)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Qs(){const ue=_.useMemo(()=>Zs(),[]),[o,l]=_.useState("initializing"),[u,p]=_.useState(null);if(_.useEffect(()=>{Xs(),l("ready")},[]),_.useEffect(()=>{if(typeof window>"u")return;const U=P=>{const W=(P==null?void 0:P.detail)||{};p(W.type||null)};window.addEventListener("inkwise:active-element",U);const E=window.inkwiseToolbar;if(E&&typeof E.getSelection=="function")try{const P=E.getSelection();P&&P.type&&p(P.type)}catch(P){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",P)}return()=>{window.removeEventListener("inkwise:active-element",U)}},[]),!ue||Object.keys(ue).length===0)return null;const y=U=>{const E=typeof window<"u"?window.inkwiseToolbar:null;if(!E||typeof E.setFontFamily!="function"){console.debug("[InkWise Studio] Font change ignored (bridge unavailable).",U);return}E.setFontFamily(U)},j=U=>{const E=typeof window<"u"?window.inkwiseToolbar:null;if(!E||typeof E.setFontSize!="function"){console.debug("[InkWise Studio] Size change ignored (bridge unavailable).",U);return}E.setFontSize(U)},A=U=>{const E=typeof window<"u"?window.inkwiseToolbar:null;if(!E||typeof E.setColor!="function"){console.debug("[InkWise Studio] Color change ignored (bridge unavailable).",U);return}E.setColor(U)},F=U=>{const E=typeof window<"u"?window.inkwiseToolbar:null;return!E||typeof E.dispatch!="function"?(console.debug("[InkWise Studio] Toolbar action ignored (bridge unavailable).",U),()=>{}):new Set(["line-spacing","letter-spacing","effect-style","effect-shape","opacity","rotation","layer","more"]).has(U)?W=>{E.dispatch(U,W)}:(E.dispatch(U),()=>{})};return n.jsx("div",{className:"studio-react-widgets",children:n.jsx(Js,{onAction:F,onFontChange:y,onSizeChange:j,onColorChange:A,activeElementType:u})})}function ei(){const ue=()=>{const o=document.getElementById("inkwise-customer-studio-root");if(!o)return;Ws.createRoot(o).render(n.jsx(Vs.StrictMode,{children:n.jsx(Qs,{})}))};if(document.readyState==="complete"||document.readyState==="interactive"){ue();return}document.addEventListener("DOMContentLoaded",ue,{once:!0})}ei();
