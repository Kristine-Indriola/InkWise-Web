import{r as Ea,g as cn,a as ln}from"./vendor-CRB3T2We.js";document.addEventListener("DOMContentLoaded",()=>{var la,ua,da,fa,pa,ga,ya,ha,ma,ba;document.addEventListener("focusin",t=>{t.target&&t.target.matches("input[data-text-node]")&&Pt(t.target)}),document.addEventListener("click",t=>{t.target&&t.target.matches("input[data-text-node]")&&Pt(t.target);const e=t.target&&t.target.closest&&t.target.closest("svg [data-text-node]"),r=t.target&&t.target.closest&&(t.target.closest("svg image")||t.target.closest("svg [data-uploaded]"));if(e){const a=t.target.closest("[data-text-node]"),n=a.closest("svg"),i=n.closest(".card"),o=i&&i.dataset&&i.dataset.card?i.dataset.card:n.id==="cardFront"?"front":"back";b=a,at=o,Pt(t.target),D(a,o);try{ue(a,o)}catch{}}else if(r){const a=t.target.closest("image")||t.target.closest("[data-uploaded]");if(a){const n=a.closest("svg"),i=n.closest(".card"),o=i&&i.dataset&&i.dataset.card?i.dataset.card:n.id==="cardFront"?"front":"back";if(!Fe){_e();return}b=a,at=o,_e(),D(a,o)}}});const z=document.getElementById("showFront"),V=document.getElementById("showBack"),Ct=document.querySelectorAll(".view-toggle button"),j=document.getElementById("cardFront"),U=document.getElementById("cardBack"),gt=document.getElementById("zoomIn"),xt=document.getElementById("zoomOut"),jt=document.getElementById("zoomLevel"),et=document.querySelector(".canvas"),K=document.getElementById("textFields"),ct=document.getElementById("addTextField"),It=document.querySelectorAll(".side-btn"),Vt=document.querySelectorAll(".editor-panel"),yt=document.querySelectorAll("[data-image-input]"),cr=document.querySelectorAll("[data-reset-image]"),At={front:document.querySelector('[data-image-preview="front"]'),back:document.querySelector('[data-image-preview="back"]')},Ce=((la=document.body)==null?void 0:la.dataset)||{},Ie=(Ce.imageReplacementMode||"").toLowerCase();let Ht="full";Ie==="panel-only"||Ie==="disabled"?Ht=Ie:Ce.allowImageReplacement==="false"&&(Ht="disabled");const he=Ht!=="disabled",Fe=Ht==="full",Q=Ht==="disabled",lt=yt.length>0,it=document.getElementById("textToolbar"),Ft=document.querySelector(".canvas-area"),_t=document.querySelector(".canvas"),Oe=document.getElementById("changeImageBtn"),me=window.inkwiseTemplateParser||{},Ue=me.front||{},Ke=me.back||{},We=Array.isArray(me.warnings)?me.warnings:[],be=(t,e,r)=>{if(!t||typeof t!="object")return 0;const a=t[e];if(typeof a=="number"&&Number.isFinite(a))return Number(a);const n=t[r];return Array.isArray(n)?n.length:0},Xe={front:be(Ue,"text_count","text_elements"),back:be(Ke,"text_count","text_elements")},Bt={front:be(Ue,"changeable_count","changeable_images"),back:be(Ke,"changeable_count","changeable_images")},E=Bt.front+Bt.back;function W(){const t=document.getElementById("parserFrontSummary");t&&(t.textContent=`Front: text ${Xe.front} • replaceable images ${Bt.front}`);const e=document.getElementById("parserBackSummary");e&&(e.textContent=`Back: text ${Xe.back} • replaceable images ${Bt.back}`);const r=document.getElementById("parserWarningsContainer"),a=document.getElementById("parserWarningsList");r&&a&&(We.length?(r.hidden=!1,a.innerHTML="",We.forEach(o=>{const s=document.createElement("li");s.textContent=o,a.appendChild(s)})):(r.hidden=!0,a.innerHTML=""));const n=[`front ${Bt.front}`];Bt.back&&n.push(`back ${Bt.back}`);const i=document.getElementById("imageParserStatus");i&&(E>0?Fe?i.textContent=`Replaceable image areas detected: ${n.join(" • ")}`:i.textContent="Use the Images panel to swap the template background.":i.textContent="No replaceable image areas detected in this template."),Oe&&(Oe.title=E>0?`Swap detected image areas (${n.join(" • ")})`:"Template import did not include replaceable image frames.")}if(W(),Ft){const t=window.getComputedStyle(Ft).position;(!t||t==="static")&&(Ft.style.position="relative")}else if(_t){const t=window.getComputedStyle(_t).position;(!t||t==="static")&&(_t.style.position="relative")}function Ot(t){var n;if(!t)return;const e={left:"start",center:"middle",right:"end",justify:"start"},r=t==="justify"?"justify":t||"center",a=document.activeElement;if(a&&a.matches&&a.matches("input[data-text-node]")){const i=$(a),o=(n=P[i])==null?void 0:n.get(J(a));o&&F(o,i);try{a.dataset.align=r}catch{}if(o){try{o.setAttribute("text-anchor",e[r]||"middle")}catch{}const s=o.getAttribute("x")||o.dataset.originalX||null;s&&o.querySelectorAll("tspan").forEach(l=>l.setAttribute("x",s));try{B(o,i)}catch{}try{I(i)}catch{}D(o,i)}return}if(L){const i=L,o=tt;F(i,o);try{i.setAttribute("text-anchor",e[r]||"middle")}catch{}const s=i.getAttribute("x")||i.dataset.originalX||null;s&&i.querySelectorAll("tspan").forEach(l=>l.setAttribute("x",s));try{B(i,o)}catch{}try{I(o)}catch{}D(i,o);return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const i=b,o=at||C||"front";F(i,o);try{i.setAttribute("text-anchor",e[r]||"middle")}catch{}const s=i.getAttribute("x")||i.dataset.originalX||null;s&&i.querySelectorAll("tspan").forEach(l=>l.setAttribute("x",s));try{B(i,o)}catch{}try{I(o)}catch{}D(i,o);try{i&&i.tagName&&i.tagName.toLowerCase()==="text"&&ue(i,o)}catch{}return}}let Gt=null,lr=!1,ur=!1;function Pt(t){it&&(clearTimeout(Gt),it.classList.add("is-visible"),it.setAttribute("aria-hidden","false"))}function _e(){it&&(clearTimeout(Gt),it.classList.remove("is-visible"),it.setAttribute("aria-hidden","true"))}function Ye(){it&&(clearTimeout(Gt),Gt=setTimeout(()=>{var e;if(lr||ur||_.active)return;const t=document.activeElement;if(!t){_e();return}it.contains(t)||(e=t.closest)!=null&&e.call(t,".text-field")||Dt&&t===Dt||t!=null&&t.hasAttribute&&t.hasAttribute("data-text-node")||_e()},150))}it&&(it.addEventListener("focusin",()=>clearTimeout(Gt)),it.addEventListener("focusout",Ye));const qt=document.getElementById("fontModal"),Jt=document.getElementById("fontList"),Ve=document.getElementById("fontSearch"),Ir=document.getElementById("fontClose"),Fr=(ua=qt==null?void 0:qt.dataset)==null?void 0:ua.googleFontsKey;function La(){if(qt){qt.setAttribute("aria-hidden","false"),lr=!0,Pt(),Ia();try{Ve.focus()}catch{}}}function dr(){qt&&(qt.setAttribute("aria-hidden","true"),lr=!1)}Ir&&Ir.addEventListener("click",dr),qt&&qt.addEventListener("pointerdown",t=>{t.target===qt&&dr()});const ce=document.getElementById("colorModal"),_r=document.getElementById("colorClose"),H=document.getElementById("colorNative"),G=document.getElementById("colorHexInput"),rt=document.getElementById("colorSample"),Br=document.getElementById("recentColors");function ka(){var t;if(ce){ce.setAttribute("aria-hidden","false"),ur=!0,Pt();try{const e=document.querySelector(".toolbar-color-swatch"),r=((t=e==null?void 0:e.dataset)==null?void 0:t.color)||e&&e.style&&e.style.background||"#1f2933";H&&(H.value=r),G&&(G.value=r),rt&&(rt.style.background=r)}catch{}}}function Pr(){ce&&(ce.setAttribute("aria-hidden","true"),ur=!1)}_r&&_r.addEventListener("click",Pr),ce&&ce.addEventListener("pointerdown",t=>{t.target===ce&&Pr()}),document.querySelectorAll(".toolbar-color").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),ka()})}),H&&H.addEventListener("input",t=>{const e=H.value;G&&(G.value=e),rt&&(rt.style.background=e),le(e)}),G&&G.addEventListener("change",()=>{const t=G.value.trim();/^#([0-9A-F]{3}){1,2}$/i.test(t)&&(H&&(H.value=t),rt&&(rt.style.background=t),le(t),$r(t))}),document.addEventListener("click",t=>{const e=t.target.closest(".swatch");if(!e)return;const r=e.dataset.color;r&&(H&&(H.value=r),G&&(G.value=r),rt&&(rt.style.background=r),le(r),$r(r))});function le(t){var i,o;if(!t)return;const e=document.activeElement;let r=null,a=null;if(e&&e.matches&&e.matches("input[data-text-node]")){r=(i=P[$(e)])==null?void 0:i.get(J(e)),a=$(e),r&&F(r,a),e.style.color=t;const s=$(e),l=J(e),u=(o=P[s])==null?void 0:o.get(l);u&&u.setAttribute("fill",t)}else if(L)F(L,tt),L.setAttribute("fill",t);else if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){F(b,at),b.setAttribute("fill",t);try{B(b,at)}catch{}}const n=document.querySelector(".toolbar-color-swatch");n&&(n.style.background=t,n.dataset.color=t);try{r&&a?B(r,a):L&&B(L,tt)}catch{}}const Tt=document.getElementById("colorGradient"),ve=document.getElementById("colorGradientPointer"),Zt=document.getElementById("hueSlider"),Be=document.getElementById("huePointer"),qr=document.getElementById("presetSwatches"),Tr=document.getElementById("eyedropperBtn"),Ge=(t,e,r)=>Math.max(e,Math.min(r,t));function Pe(t,e,r){let a,n,i,o=Math.floor(t*6),s=t*6-o,l=r*(1-e),u=r*(1-s*e),d=r*(1-(1-s)*e);switch(o%6){case 0:a=r,n=d,i=l;break;case 1:a=u,n=r,i=l;break;case 2:a=l,n=r,i=d;break;case 3:a=l,n=u,i=r;break;case 4:a=d,n=l,i=r;break;case 5:a=r,n=l,i=u;break}const f=c=>Math.round(c*255).toString(16).padStart(2,"0");return`#${f(a)}${f(n)}${f(i)}`.toUpperCase()}function Na(t){if(!t)return{h:0,s:0,v:0};t=t.replace("#",""),t.length===3&&(t=t.split("").map(f=>f+f).join(""));const e=parseInt(t,16),r=(e>>16&255)/255,a=(e>>8&255)/255,n=(e&255)/255,i=Math.max(r,a,n),o=Math.min(r,a,n);let s=0,l=0,u=i;const d=i-o;if(l=i===0?0:d/i,i===o)s=0;else{switch(i){case r:s=(a-n)/d+(a<n?6:0);break;case a:s=(n-r)/d+2;break;case n:s=(r-a)/d+4;break}s/=6}return{h:s,s:l,v:u}}function fr(t){if(!Tt)return;const e=Pe(t,1,1);Tt.style.background=`linear-gradient(to right, #fff, ${e})`}function Rr(t,e,r,a){if(!t||!e)return;const n=t.getBoundingClientRect(),i=Ge(r-n.left,0,n.width),o=Ge(a-n.top,0,n.height);return e.style.left=i+"px",e.style.top=o+"px",{px:i,py:o,w:n.width,h:n.height}}let wt=0,Qt=1,te=1;if(Tt&&ve){let t=!1;Tt.addEventListener("pointerdown",e=>{t=!0,Tt.setPointerCapture(e.pointerId);const r=Rr(Tt,ve,e.clientX,e.clientY);Qt=r.px/r.w,te=1-r.py/r.h;const a=Pe(wt,Qt,te);rt&&(rt.style.background=a),G&&(G.value=a),H&&(H.value=a),le(a)}),window.addEventListener("pointermove",e=>{if(t)try{const r=Rr(Tt,ve,e.clientX,e.clientY);Qt=r.px/r.w,te=1-r.py/r.h;const a=Pe(wt,Qt,te);rt&&(rt.style.background=a),G&&(G.value=a),H&&(H.value=a),le(a)}catch{}}),window.addEventListener("pointerup",e=>{if(t){t=!1;try{Tt.releasePointerCapture(e.pointerId)}catch{}}})}if(Zt&&Be){let t=!1;Zt.addEventListener("pointerdown",e=>{t=!0,Zt.setPointerCapture(e.pointerId);const r=Zt.getBoundingClientRect(),a=Ge(e.clientX-r.left,0,r.width);wt=a/r.width,Be.style.left=a+"px",fr(wt);const i=Pe(wt,Qt,te);rt&&(rt.style.background=i),G&&(G.value=i),H&&(H.value=i),le(i)}),window.addEventListener("pointermove",e=>{if(t)try{const r=Zt.getBoundingClientRect(),a=Ge(e.clientX-r.left,0,r.width);wt=a/r.width,Be.style.left=a+"px",fr(wt);const i=Pe(wt,Qt,te);rt&&(rt.style.background=i),G&&(G.value=i),H&&(H.value=i),le(i)}catch{}}),window.addEventListener("pointerup",e=>{if(t){t=!1;try{Zt.releasePointerCapture(e.pointerId)}catch{}}})}document.querySelectorAll(".color-tabs .tab").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".color-tabs .tab").forEach(r=>r.classList.remove("active")),t.classList.add("active");const e=t.dataset.tab;document.querySelectorAll(".tab-panel").forEach(r=>{r.style.display=r.dataset.panel===e?"":"none"})})}),qr&&[["#0ea5e9","#38bdf8","#7dd3fc","#bae6fd","#e0f2fe"],["#16a34a","#4ade80","#86efac","#bbf7d0","#ecfdf5"],["#f59e0b","#facc15","#fde68a","#fff7cc","#fffaf0"],["#ef4444","#fb7185","#fda4af","#ffdde1","#fff5f5"],["#2563eb","#3b82f6","#60a5fa","#93c5fd","#dbeafe"]].forEach(e=>e.forEach(r=>{const a=document.createElement("button");a.type="button",a.className="swatch",a.dataset.color=r,a.style.background=r,qr.appendChild(a)})),Tr&&H&&Tr.addEventListener("click",()=>{try{H.click()}catch{}});function Ca(t){if(!t)return;const e=Na(t);if(wt=e.h,Qt=e.s,te=e.v,Zt&&Be){const r=Zt.getBoundingClientRect();Be.style.left=wt*r.width+"px"}if(Tt&&ve){const r=Tt.getBoundingClientRect();ve.style.left=Qt*r.width+"px",ve.style.top=(1-te)*r.height+"px"}fr(wt)}try{const t=document.querySelector(".toolbar-color-swatch");t&&Ca(t.dataset.color||t.style.background)}catch{}function $r(t){if(!Br)return;const e=Br.querySelector(".recent-list");if(!e)return;const r=Array.from(e.querySelectorAll(".swatch")).map(o=>o.dataset.color.toLowerCase()),a=t.toLowerCase();if(r.includes(a))return;const n=document.createElement("button");n.type="button",n.className="swatch",n.dataset.color=t,n.style.background=t,e.insertBefore(n,e.firstChild);const i=e.querySelectorAll(".swatch");i.length>8&&i[i.length-1].remove()}async function Ia(){if(!Jt)return;Jt.innerHTML='<div class="font-list-loading">Loading fonts…</div>';const t=["Roboto","Open Sans","Lato","Montserrat","Merriweather","Playfair Display","Source Sans Pro"];if(!Fr){Jt.innerHTML="",t.forEach(e=>pr(e));return}try{const e=await fetch(`https://www.googleapis.com/webfonts/v1/webfonts?key=${encodeURIComponent(Fr)}&sort=popularity`);if(!e.ok)throw new Error("Failed to fetch");const a=(await e.json()).items||[];Jt.innerHTML="",a.slice(0,200).forEach(n=>pr(n.family)),Dr()}catch(e){console.error("Fonts API failed",e),Jt.innerHTML="",t.forEach(r=>pr(r)),Dr()}}function Fa(){const t=new Set;return document.querySelectorAll("input[data-text-node]").forEach(e=>{const r=e.style.fontFamily||e.dataset.fontFamily||null;r&&t.add(r.replace(/['\"]+/g,"").split(",")[0].trim())}),["front","back"].forEach(e=>{var r;(r=P[e])==null||r.forEach(a=>{if(!a)return;const i=(a.getAttribute("style")||"").match(/font-family:\s*['"]?([^;',]+)['"]?/i);i&&i[1]&&t.add(i[1].trim())})}),Array.from(t).slice(0,8)}function Dr(){const t=document.getElementById("recentFonts"),e=t==null?void 0:t.querySelector(".recent-list");if(!t||!e)return;const r=Fa();if(e.innerHTML="",r.length===0){t.setAttribute("aria-hidden","true"),e.textContent="No recent fonts";return}t.setAttribute("aria-hidden","false"),r.forEach(a=>{const n=document.createElement("button");n.type="button",n.className="recent-item",n.textContent=a,n.addEventListener("click",()=>jr(a)),e.appendChild(n)})}function pr(t){if(!Jt)return;const e=document.createElement("div");e.className="font-item",e.dataset.family=t;const r=document.createElement("div");r.className="font-sample",r.textContent=t,r.style.fontFamily="system-ui, sans-serif",e.appendChild(r),e.addEventListener("click",()=>jr(t)),Jt.appendChild(e);try{qe&&qe.observe(e)}catch{}}let zr=new Set;function Mr(t){if(zr.has(t))return Promise.resolve();const e=document.createElement("link");return e.rel="stylesheet",e.href=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(t)}:wght@400;700&display=swap`,document.head.appendChild(e),zr.add(t),new Promise(r=>{e.onload=()=>r(),e.onerror=()=>r()})}let qe=null;try{qe=new IntersectionObserver(t=>{t.forEach(async e=>{if(!e.isIntersecting)return;const r=e.target,a=r.dataset.family;if(!a)return;await Mr(a);const n=r.querySelector(".font-sample");n&&(n.style.fontFamily=`'${a}', system-ui, sans-serif`),qe.unobserve(r)})},{root:Jt,rootMargin:"200px",threshold:.01})}catch{qe=null}async function jr(t){var r;await Mr(t);const e=document.activeElement;if(e&&e.matches&&e.matches("input[data-text-node]")){e.style.fontFamily=`'${t}', system-ui, sans-serif`;try{e.dataset.fontFamily=t}catch{}const a=$(e),n=J(e),i=(r=P[a])==null?void 0:r.get(n);if(i){i.setAttribute("style",`font-family: '${t}', system-ui, sans-serif;`);try{i.dataset.fontFamily=t}catch{}}}else if(L){L.setAttribute("style",`font-family: '${t}', system-ui, sans-serif;`);try{L.dataset.fontFamily=t}catch{}}else if(b&&b.tagName&&b.tagName.toLowerCase()==="text")try{b.setAttribute("style",`font-family: '${t}', system-ui, sans-serif;`);try{b.dataset.fontFamily=t}catch{}try{I(at||C||"front")}catch{}try{D(b,at||C||"front")}catch{}}catch(a){console.error("selectFont apply to selectedElementNode failed",a)}dr()}document.querySelectorAll('[data-tool="font"]').forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),La()})});const Hr=document.querySelector(".font-size-control"),bt=document.getElementById("toolbarFontSizeInput"),ot=document.querySelector(".font-size-dropdown");function Or(t){var n,i;if(!t)return;const e=document.activeElement;let r=null,a=null;if(e&&e.matches&&e.matches("input[data-text-node]")){r=(n=P[$(e)])==null?void 0:n.get(J(e)),a=$(e),r&&F(r,a),e.style.fontSize=t+"px";try{e.dataset.fontSize=String(t)}catch{}const o=$(e),s=J(e),l=(i=P[o])==null?void 0:i.get(s);if(l){const u=vt(l),d=parseFloat(l.getAttribute("font-size")||window.getComputedStyle(l).fontSize||String(t))||t,f=Number(t)/d;pe(u,f,Number(u.dataset.iwRotate||0)||0,l);try{l.dataset.fontSize=String(t)}catch{}}}else if(L){const o=L;F(o,tt);const s=vt(o),l=parseFloat(o.getAttribute("font-size")||window.getComputedStyle(o).fontSize||String(t))||t,u=Number(t)/l;pe(s,u,Number(s.dataset.iwRotate||0)||0,o);try{o.dataset.fontSize=String(t)}catch{}try{B(o,tt)}catch{}}else if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const o=b,s=at||C||"front";F(o,s);const l=vt(o),u=parseFloat(o.getAttribute("font-size")||window.getComputedStyle(o).fontSize||String(t))||t,d=Number(t)/u;pe(l,d,Number(l.dataset.iwRotate||0)||0,o);try{o.dataset.fontSize=String(t)}catch{}try{B(o,s)}catch{}}try{r&&a&&B(r,a)}catch{}}ot&&(bt&&(bt.addEventListener("click",t=>{t.stopPropagation();const e=ot.getAttribute("aria-hidden")==="false";ot.setAttribute("aria-hidden",e?"true":"false")}),bt.addEventListener("keydown",t=>{if(t.key==="Enter"||t.key===" "){t.preventDefault();const e=ot.getAttribute("aria-hidden")==="false";ot.setAttribute("aria-hidden",e?"true":"false")}else if(t.key==="ArrowDown"){t.preventDefault(),ot.setAttribute("aria-hidden","false");try{const e=ot.querySelector(".font-size-option");e&&e.focus()}catch{}}else t.key==="Escape"&&ot.setAttribute("aria-hidden","true")})),ot.addEventListener("click",t=>{const e=t.target.closest(".font-size-option");if(!e)return;const r=Number(e.textContent.trim());bt&&(bt.value=String(r)),Or(r),ot.setAttribute("aria-hidden","true")}),document.addEventListener("click",t=>{Hr&&(Hr.contains(t.target)||ot.setAttribute("aria-hidden","true"))})),bt&&(bt.addEventListener("change",()=>{const t=Number(bt.value);Number.isFinite(t)&&Or(t)}),bt.addEventListener("click",t=>{t.stopPropagation(),ot&&ot.setAttribute("aria-hidden","false")}),bt.addEventListener("keydown",t=>{t.key==="ArrowDown"&&(t.preventDefault(),ot&&ot.setAttribute("aria-hidden","false"))}));function ue(t,e){if(!t)return;const r=vt(t),a=parseFloat(t.getAttribute("font-size")||window.getComputedStyle(t).fontSize||"16")||16,n=Number(r&&r.dataset&&r.dataset.iwScale||1)||1,i=Math.round(a*n);bt&&(bt.value=String(i));const o=t.getAttribute("fill")||t.dataset.color||"#1f2933",s=document.querySelector(".toolbar-color-swatch");s&&(s.style.background=o,s.dataset.color=o),H&&(H.value=o),G&&(G.value=o),Qe(t)||t.dataset.fontFamily;try{const l=document.querySelector('[data-tool="bold"]'),u=(t.getAttribute("font-weight")||t.style.fontWeight||t.dataset.fontWeight||"").toString(),d=u==="700"||u.toLowerCase()==="bold";l&&(l.classList.toggle("is-active",!!d),l.setAttribute("aria-pressed",d?"true":"false"))}catch{}try{const l=document.querySelector('[data-tool="list"]'),d=(nt(t)||"").split(/\r?\n/).map(c=>c.trim()).filter(Boolean),f=d.length>0&&d.every(c=>c.startsWith("•")||c.startsWith("-"));l&&(l.classList.toggle("is-active",!!f),l.setAttribute("aria-pressed",f?"true":"false"))}catch{}try{const l=document.querySelector('[data-tool="align"]'),u=t.getAttribute("text-anchor")||"middle",d=tr(u);l&&(l.dataset.align=d,l.setAttribute("data-current-align",d),l.title="Align: "+(d.charAt(0).toUpperCase()+d.slice(1)))}catch{}try{const l=document.querySelector(".toolbar-select");l&&(l.value="")}catch{}}function _a(){var e;const t=document.activeElement;if(t&&t.matches&&t.matches("input[data-text-node]")){const r=$(t),a=(e=P[r])==null?void 0:e.get(J(t));a&&F(a,r);const n=t.style.fontWeight||t.dataset.fontWeight||"",i=n==="700"||n==="bold"?"":"700";t.style.fontWeight=i;try{t.dataset.fontWeight=i}catch{}if(a){try{a.setAttribute("font-weight",i)}catch{}try{B(a,r)}catch{}try{I(r)}catch{}D(a,r)}return}if(L){F(L,tt);const r=L.getAttribute("font-weight")||L.style.fontWeight||"",a=r==="700"||r==="bold"?"":"700";try{L.setAttribute("font-weight",a)}catch{}try{L.style.fontWeight=a}catch{}try{B(L,tt)}catch{}try{I(tt)}catch{}D(L,tt);try{ue(L,tt)}catch{}return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const r=b,a=at||C||"front";F(r,a);const n=r.getAttribute("font-weight")||r.style.fontWeight||"",i=n==="700"||n==="bold"?"":"700";try{r.setAttribute("font-weight",i)}catch{}try{r.style.fontWeight=i}catch{}try{B(r,a)}catch{}try{I(a)}catch{}D(r,a);return}}function Ba(){var r;const t={left:"start",center:"middle",right:"end"},e=document.activeElement;if(e&&e.matches&&e.matches("input[data-text-node]")){const a=$(e),n=(r=P[a])==null?void 0:r.get(J(e));n&&F(n,a);const i=(e.dataset.align||"center").toLowerCase(),o=["left","center","right"],s=o.indexOf(i)>=0?o.indexOf(i):1,l=o[(s+1)%o.length];try{e.dataset.align=l}catch{}if(n){try{n.setAttribute("text-anchor",t[l])}catch{}const u=n.getAttribute("x")||n.dataset.originalX||null;u&&n.querySelectorAll("tspan").forEach(d=>d.setAttribute("x",u));try{B(n,a)}catch{}try{I(a)}catch{}D(n,a);try{n&&n.tagName&&n.tagName.toLowerCase()==="text"&&ue(n,a)}catch{}}return}if(L){const a=L,n=tt;F(a,n);const i=tr(a.getAttribute("text-anchor"))||"center",o=["left","center","right"],s=o.indexOf(i)>=0?o.indexOf(i):1,l=o[(s+1)%o.length];try{a.setAttribute("text-anchor",t[l])}catch{}const u=a.getAttribute("x")||a.dataset.originalX||null;u&&a.querySelectorAll("tspan").forEach(d=>d.setAttribute("x",u));try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const a=b,n=at||C||"front";F(a,n);const i=tr(a.getAttribute("text-anchor"))||"center",o=["left","center","right"],s=o.indexOf(i)>=0?o.indexOf(i):1,l=o[(s+1)%o.length];try{a.setAttribute("text-anchor",t[l])}catch{}const u=a.getAttribute("x")||a.dataset.originalX||null;u&&a.querySelectorAll("tspan").forEach(d=>d.setAttribute("x",u));try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}}function Pa(){var r;const e=document.activeElement;if(e&&e.matches&&e.matches("input[data-text-node]")){const a=$(e),n=(r=P[a])==null?void 0:r.get(J(e));n&&F(n,a);const o=(e.value||"").split(/\r?\n/).map(u=>u.trim()),l=o.length>0&&o.every(u=>u.startsWith("• "))?o.map(u=>u.replace(new RegExp("^•\\s?"),"")):o.map(u=>u&&"• "+u);e.value=l.join(`
`);try{ar(e,e.value)}catch{}if(n){try{B(n,a)}catch{}try{I(a)}catch{}D(n,a)}return}if(L){const a=L,n=tt;F(a,n);const o=(nt(a)||"").split(/\r?\n/).map(u=>u.trim()),l=o.length>0&&o.every(u=>u.startsWith("• "))?o.map(u=>u.replace(new RegExp("^•\\s?"),"")):o.map(u=>u&&"• "+u);Z(a,l.join(`
`));try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const a=b,n=at||C||"front";F(a,n);const o=(nt(a)||"").split(/\r?\n/).map(u=>u.trim()),l=o.length>0&&o.every(u=>u.startsWith("• "))?o.map(u=>u.replace(new RegExp("^•\\s?"),"")):o.map(u=>u&&"• "+u);Z(a,l.join(`
`));try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}}function gr(t){var r;if(!t)return;const e=document.activeElement;if(e&&e.matches&&e.matches("input[data-text-node]")){const a=$(e),n=(r=P[a])==null?void 0:r.get(J(e));n&&F(n,a);const i=e.value||"",o=t==="uppercase"?i.toUpperCase():t==="lowercase"?i.toLowerCase():i;e.value=o;try{ar(e,o)}catch{}if(n){try{B(n,a)}catch{}try{I(a)}catch{}D(n,a)}return}if(L){const a=L,n=tt;F(a,n);const i=nt(a)||"",o=t==="uppercase"?i.toUpperCase():t==="lowercase"?i.toLowerCase():i;Z(a,o);try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const a=b,n=at||C||"front";F(a,n);const i=nt(a)||"",o=t==="uppercase"?i.toUpperCase():t==="lowercase"?i.toLowerCase():i;Z(a,o);try{B(a,n)}catch{}try{I(n)}catch{}D(a,n);return}}document.querySelectorAll('[data-tool="bold"]').forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),_a()})}),document.querySelectorAll('[data-tool="align"]').forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),Ba()})}),document.querySelectorAll('[data-tool="list"]').forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),Pa()})});const Je=document.querySelector(".toolbar-select");if(Je&&Je.addEventListener("change",t=>{const e=Je.value;e&&(gr(e),Je.value="")}),Ve){let t=null;Ve.addEventListener("input",()=>{clearTimeout(t),t=setTimeout(()=>{const e=Ve.value.trim().toLowerCase();Array.from(document.querySelectorAll(".font-item")).forEach(r=>{const a=r.textContent.toLowerCase();r.style.display=e&&!a.includes(e)?"none":""})},160)})}const ut=document.getElementById("toolbarListBtn"),dt=document.querySelector(".list-dropdown-menu");let yr=!1;function qa(){if(!(!ut||!dt)){ut.setAttribute("aria-expanded","true"),dt.setAttribute("aria-hidden","false"),yr=!0;try{const t=dt.querySelector(".list-option");t&&typeof t.focus=="function"&&t.focus()}catch{}}}function ee(){!ut||!dt||(ut.setAttribute("aria-expanded","false"),dt.setAttribute("aria-hidden","true"),yr=!1)}function Ur(){yr?ee():qa()}ut&&(ut.addEventListener("click",t=>{t.stopPropagation();const e=t.target,r=e.classList&&(e.classList.contains("fa-list-ul")||e.classList.contains("fa-list-ol")||e.classList.contains("fa-ban"));!r&&e!==ut&&!e.closest||!r&&!e.closest(".fa-list-ul, .fa-list-ol, .fa-ban")||Ur()}),ut.addEventListener("keydown",t=>{t.key==="Enter"||t.key===" "?(t.preventDefault(),Ur()):t.key==="Escape"&&ee()})),document.addEventListener("click",t=>{!ut||!dt||ut.contains(t.target)||dt.contains(t.target)||ee()}),dt&&dt.querySelectorAll(".list-option").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();const r=t.dataset.list;Xr(r),ee()}),t.setAttribute("tabindex","0"),t.addEventListener("keydown",e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();const r=t.dataset.list;Xr(r),ee()}else if(e.key==="ArrowRight"||e.key==="ArrowDown"){e.preventDefault();const r=t.nextElementSibling||dt.querySelector(".list-option");r&&r.focus()}else if(e.key==="ArrowLeft"||e.key==="ArrowUp"){e.preventDefault();const r=t.previousElementSibling||dt.querySelector(".list-option:last-child");r&&r.focus()}else if(e.key==="Escape"){ee();try{ut.focus()}catch{}}})});const Rt=document.getElementById("toolbarFormatBtn"),Ut=document.querySelector(".format-dropdown-menu");let hr=!1;function Ta(){if(!(!Rt||!Ut)){Rt.setAttribute("aria-expanded","true"),Ut.setAttribute("aria-hidden","false"),hr=!0;try{const t=Ut.querySelector(".format-option");t&&t.focus()}catch{}}}function xe(){!Rt||!Ut||(Rt.setAttribute("aria-expanded","false"),Ut.setAttribute("aria-hidden","true"),hr=!1)}function Kr(){hr?xe():Ta()}if(Rt&&(Rt.addEventListener("click",t=>{t.stopPropagation(),Kr()}),Rt.addEventListener("keydown",t=>{t.key==="Enter"||t.key===" "?(t.preventDefault(),Kr()):t.key==="Escape"&&xe()})),Ut){const t=Ut.querySelectorAll(".format-option");t.forEach(e=>{e.setAttribute("tabindex","0"),e.addEventListener("click",r=>{r.stopPropagation();const a=e.dataset.format;gr(a),xe()}),e.addEventListener("keydown",r=>{if(r.key==="Enter"||r.key===" ")r.preventDefault(),gr(e.dataset.format),xe();else if(r.key==="ArrowRight"||r.key==="ArrowDown")r.preventDefault(),(e.nextElementSibling||t[0]).focus();else if(r.key==="ArrowLeft"||r.key==="ArrowUp")r.preventDefault(),(e.previousElementSibling||t[t.length-1]).focus();else if(r.key==="Escape"){xe();try{Rt.focus()}catch{}}})})}document.addEventListener("click",t=>{!Rt||!Ut||Rt.contains(t.target)||Ut.contains(t.target)||xe()});const $t=document.getElementById("toolbarAlignBtn"),Kt=document.querySelector(".align-dropdown-menu");let mr=!1;function Ra(){if(!(!$t||!Kt)){$t.setAttribute("aria-expanded","true"),Kt.setAttribute("aria-hidden","false"),mr=!0;try{const t=Kt.querySelector(".align-option");t&&t.focus()}catch{}}}function Ae(){!$t||!Kt||($t.setAttribute("aria-expanded","false"),Kt.setAttribute("aria-hidden","true"),mr=!1)}function Wr(){mr?Ae():Ra()}if($t&&($t.addEventListener("click",t=>{t.stopPropagation(),Wr()}),$t.addEventListener("keydown",t=>{t.key==="Enter"||t.key===" "?(t.preventDefault(),Wr()):t.key==="Escape"&&Ae()})),Kt){const t=Kt.querySelectorAll(".align-option");t.forEach(e=>{e.setAttribute("tabindex","0"),e.addEventListener("click",r=>{r.stopPropagation();const a=(e.dataset.align||"").toLowerCase();Ot(a),Ae()}),e.addEventListener("keydown",r=>{if(r.key==="Enter"||r.key===" ")r.preventDefault(),Ot(e.dataset.align),Ae();else if(r.key==="ArrowRight"||r.key==="ArrowDown")r.preventDefault(),(e.nextElementSibling||t[0]).focus();else if(r.key==="ArrowLeft"||r.key==="ArrowUp")r.preventDefault(),(e.previousElementSibling||t[t.length-1]).focus();else if(r.key==="Escape"){Ae();try{$t.focus()}catch{}}})})}document.addEventListener("click",t=>{!$t||!Kt||$t.contains(t.target)||Kt.contains(t.target)||Ae()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&ee()});try{ee()}catch{}dt&&(dt.addEventListener("pointerenter",t=>{t.stopPropagation()}),dt.addEventListener("mouseover",t=>{t.stopPropagation()})),ut&&(ut.addEventListener("focus",t=>{}),ut.addEventListener("mouseover",t=>{}));function Xr(t){var i;const e=document.activeElement,r="•",a=/^\s*\d+\.\s*/,n=/^\s*[\u2022\-*]\s*/;if(e&&e.matches&&e.matches("input[data-text-node]")){const o=$(e),s=(i=P[o])==null?void 0:i.get(J(e)),u=(e.value||"").split(/\r?\n/).map(f=>f.trim());let d=[];t==="ul"?d=u.map(f=>f&&r+" "+f):t==="ol"?d=u.map((f,c)=>f&&c+1+". "+f):t==="none"&&(d=u.map(f=>f.replace(a,"").replace(n,""))),e.value=d.join(`
`);try{ar(e,e.value)}catch{}if(s)try{I(o)}catch{}return}if(L){const o=L,s=tt,u=(nt(o)||"").split(/\r?\n/).map(f=>f.trim());let d="";t==="ul"?d=u.map(f=>f&&r+" "+f).join(`
`):t==="ol"?d=u.map((f,c)=>f&&c+1+". "+f).join(`
`):t==="none"&&(d=u.map(f=>f.replace(a,"").replace(n,"")).join(`
`)),F(o,s),Z(o,d);try{B(o,s)}catch{}try{I(s)}catch{}D(o,s);return}if(b&&b.tagName&&b.tagName.toLowerCase()==="text"){const o=b,s=at||C||"front",u=(nt(o)||"").split(/\r?\n/).map(f=>f.trim());let d="";t==="ul"?d=u.map(f=>f&&r+" "+f).join(`
`):t==="ol"?d=u.map((f,c)=>f&&c+1+". "+f).join(`
`):t==="none"&&(d=u.map(f=>f.replace(a,"").replace(n,"")).join(`
`)),F(o,s),Z(o,d);try{B(o,s)}catch{}try{I(s)}catch{}D(o,s);return}}document.addEventListener("pointerdown",t=>{var r,a,n,i;if(!it||it.contains(t.target))return;const e=t.target.closest(".bounding-box-handle");if(e){t.preventDefault(),t.stopPropagation();const o=e.getAttribute("data-handle-type"),s=e.closest("svg"),l=s.id==="cardFront"?"front":"back";let u=b;try{const d=e.dataset&&e.dataset.targetNodeKey;if(!u&&d){const f=$e(d);u=s.querySelector(`[data-text-node="${f}"]`)||s.querySelector(`[data-text-node="${d}"]`)}}catch{}if(u||(u=s.querySelector("[data-text-node]")||s.querySelector("image")),!u)return;if(o==="resize"){v.active=!0,v.node=u,v.side=l,v.startY=t.clientY;try{u.tagName&&u.tagName.toLowerCase()==="text"?v.startScale=Number(vt(u).dataset.iwScale||1):v.startScale=Number(u.dataset.iwScale||1)}catch{v.startScale=1}v.pointerId=t.pointerId,e.setPointerCapture(t.pointerId),F(u,l)}else if(o==="rotate"){const d=vt(u);m.active=!0,m.node=u,m.side=l,m.startAngle=Number(d&&d.dataset&&d.dataset.iwRotate||0)||0;const f=De(s,t.clientX,t.clientY),c=Er(d,u);m.startPointerAngle=Math.atan2(f.y-c.cy,f.x-c.cx)*(180/Math.PI),m.pointerId=t.pointerId,e.setPointerCapture(t.pointerId),F(u,l);try{d&&d.classList&&d.classList.add("is-rotating")}catch{}}else if(o==="move"){_.active=!0,_.node=u,_.side=l,_.pointerId=t.pointerId;const d=getSvgPoint(s,t.clientX,t.clientY),f=Number(u.getAttribute("x")||u.getAttribute("data-x")||0),c=Number(u.getAttribute("y")||u.getAttribute("data-y")||0);_.offsetX=d.x-f,_.offsetY=d.y-c,e.setPointerCapture(t.pointerId),F(u,l)}return}if((a=(r=t.target).closest)!=null&&a.call(r,".text-field")||(i=(n=t.target).closest)!=null&&i.call(n,".canvas [data-text-node]")){Pt(t.target);return}_e(),ir("front"),ir("back")}),document.addEventListener("pointerdown",t=>{const e=t.target&&t.target.closest&&t.target.closest(".bounding-box-hit");if(!e)return;const r=e.closest&&e.closest(".bounding-box-handle");if(r)try{const a=new PointerEvent("pointerdown",Object.assign({},t));r.dispatchEvent(a),t.preventDefault(),t.stopPropagation()}catch{}});const st="http://www.w3.org/2000/svg",we="http://www.w3.org/1999/xlink",br=.5,vr=2,Yr=.1,Ze=24,$a=12,Vr=5*1024*1024,Wt={front:{defaultSrc:((fa=(da=At.front)==null?void 0:da.dataset)==null?void 0:fa.defaultSrc)||((pa=j==null?void 0:j.dataset)==null?void 0:pa.defaultImage)||"",currentSrc:""},back:{defaultSrc:((ya=(ga=At.back)==null?void 0:ga.dataset)==null?void 0:ya.defaultSrc)||((ha=U==null?void 0:U.dataset)==null?void 0:ha.defaultImage)||"",currentSrc:""}};(function(){if(!he)return;const e=document.getElementById("imageUploadInput");e&&e.addEventListener("change",async r=>{const a=e.files&&e.files[0];if(a)try{if(a.size>Vr){alert("Image is too large. Max 5MB allowed."),e.value="";return}const n=URL.createObjectURL(a),i=C||"front";try{ie(i,n)}catch(o){console.error("applyImage failed",o)}try{const o=R(i),s=document.getElementById("recentImagesList");if(s){const l=document.createElement("button");l.type="button",l.className="recent-image-item",l.dataset.src=n,l.style.backgroundImage=`url('${n}')`,l.title=a.name,l.addEventListener("click",()=>{ie(i,l.dataset.src)}),s.firstChild&&s.firstChild.classList&&s.firstChild.classList.contains("recent-placeholder")&&(s.innerHTML=""),s.insertBefore(l,s.firstChild||null);const u=s.querySelectorAll(".recent-image-item");u.length>12&&u[u.length-1].remove()}}catch{}try{Xt[i]&&URL.revokeObjectURL(Xt[i])}catch{}Xt[i]=n;try{e.value=""}catch{}}catch(n){console.error("image upload insert failed",n);try{e.value=""}catch{}alert("Failed to insert image.")}})})();const xr={front:null,back:null},re={front:null,back:null},Xt={front:null,back:null};let St=1,C="front";const P={front:new Map,back:new Map};let Gr=0;function Jr(t){return String(t||"").trim().replace(/[\s#/]+/g,"-").replace(/[^a-zA-Z0-9_-]+/g,"-").replace(/^-+|-+$/g,"")}function Te(t,e){if(!t)return"";let r=(t.getAttribute("data-text-node")||"").trim();if(r)return r;const a=t.getAttribute("id")||t.getAttribute("name")||"";let n=Jr(a)||Jr((t.textContent||"").split(/\s+/).slice(0,3).join("-"));for(n?n=n.toLowerCase():n=`text-${++Gr}`,r=`${e}-${n}`;P[e]&&P[e].has(r);)r=`${e}-${n}-${++Gr}`;return t.setAttribute("data-text-node",r),r}function Qe(t){if(!t)return"";const e=t.getAttribute("font-family");if(e)return e.replace(/["']/g,"").trim();const a=(t.getAttribute("style")||"").match(/font-family:\s*['"]?([^;'"\n]+)/i);return a&&a[1]?a[1].trim():""}function tr(t){switch((t||"").toLowerCase()){case"start":return"left";case"end":return"right";case"middle":case"center":return"center";default:return"center"}}function Zr(t,e){var l,u;const r=R(e),a=Me(r),n=Number.parseFloat((t==null?void 0:t.getAttribute("x"))||((l=t==null?void 0:t.dataset)==null?void 0:l.originalX)||`${a.x+a.width/2}`),i=Number.parseFloat((t==null?void 0:t.getAttribute("y"))||((u=t==null?void 0:t.dataset)==null?void 0:u.originalY)||`${a.y+a.height/2}`),o=Number.isFinite(n)&&a.width?(n-a.x)/a.width*100:50,s=Number.isFinite(i)&&a.height?(i-a.y)/a.height*100:Ze;return{left:Number.isFinite(o)?o.toFixed(2):"50.00",top:Number.isFinite(s)?s.toFixed(2):Number(Ze).toFixed(2)}}let Dt=null,L=null,tt=null,er="",Yt=null,v={active:!1,startY:0,startScale:1,pointerId:null,node:null,side:null},ae=null,m={active:!1,startAngle:0,startPointerAngle:0,pointerId:null,node:null,side:null},_={active:!1,node:null,side:null,pointerId:null,svg:null,offsetX:0,offsetY:0},b=null,at=null;const ne=[];let Et=-1,Re=null;function Qr(t,e){if(!t)return null;const r=nt(t),a=Number.parseFloat(t.getAttribute("x")||t.dataset.originalX||"0"),n=Number.parseFloat(t.getAttribute("y")||t.dataset.originalY||"0"),i=t.getAttribute("font-size")||t.dataset.fontSize||"",o=t.getAttribute("letter-spacing")||t.dataset.letterSpacing||"",s=t.getAttribute("fill")||t.dataset.color||"",l=Qe(t)||t.dataset.fontFamily||"",u=t.parentNode&&t.parentNode.dataset&&t.parentNode.dataset.iwWrapper==="true"?t.parentNode:null,d=u?Number(u.dataset.iwScale||1):1,f=u?Number(u.dataset.iwRotate||0):0;return{text:r,x:a,y:n,fontSize:i,letterSpacing:o,fill:s,fontFamily:l,wrapperScale:d,wrapperRotate:f}}function ta(t,e,r){var o;if(!r||!t)return;let a=(o=P[e])==null?void 0:o.get(t);if(!a){const s=Ar(t,e);if(s)a=Le(s);else{const l=R(e);if(!l)return;a=document.createElementNS(st,"text"),a.setAttribute("data-text-node",t),l.appendChild(a),je(a,e)}}typeof r.text=="string"&&Z(a,r.text),Number.isFinite(Number(r.x))&&Number.isFinite(Number(r.y))&&ze(a,e,Number(r.x),Number(r.y));try{r.fontSize&&a.setAttribute("font-size",r.fontSize)}catch{}try{r.letterSpacing!==void 0&&a.setAttribute("letter-spacing",r.letterSpacing)}catch{}try{r.fill&&a.setAttribute("fill",r.fill)}catch{}try{r.fontFamily&&a.setAttribute("style",`font-family: '${r.fontFamily}', system-ui, sans-serif;`)}catch{}const n=vt(a);if(n){const s=Number(r.wrapperScale||1),l=Number(r.wrapperRotate||0);pe(n,s,l,a)}const i=a.getAttribute("data-text-node")||t;Se(i,e,nt(a));try{I(e)}catch{}}function Da(t){Et<ne.length-1&&ne.splice(Et+1),ne.push(t),Et=ne.length-1,de()}function za(t,e){try{if(!t)return!1;const r=t.getAttribute&&t.getAttribute("data-text-node");if(!r)return!1;if(typeof window.__iw_history_capture=="object"&&window.__iw_history_capture)return!!window.__iw_history_capture[`${r}::${e}`]}catch{}try{if(L===t)return!0}catch{}return!1}function de(){const t=document.querySelector(".undo-btn"),e=document.querySelector(".redo-btn");t&&(t.disabled=Et<0),e&&(e.disabled=Et>=ne.length-1)}function Ma(){if(Et<0)return;const t=ne[Et];t&&(ta(t.nodeKey,t.side,t.before),Et-=1,de())}function ja(){if(Et>=ne.length-1)return;Et+=1;const t=ne[Et];t&&(ta(t.nodeKey,t.side,t.after),de())}function F(t,e){if(!t)return;Re={nodeKey:t.getAttribute("data-text-node")||Te(t,e),side:e,before:Qr(t)}}function B(t,e){var o;if(!Re)return;const r=Re.nodeKey,a=(o=P[e])==null?void 0:o.get(r),n=a?Qr(a):null,i=Re.before;n&&JSON.stringify(i)!==JSON.stringify(n)&&Da({nodeKey:r,side:e,before:i,after:n}),Re=null}const ea=lt;let fe=null;function Ha(){if(!lt||!ea)return null;if(fe)return fe;try{fe=document.createElement("div"),fe.className="editor-debug-panel",fe.innerHTML='<h4>Image debug</h4><pre id="__iw_debug_pre">(no diagnostics yet)</pre>';const t=document.querySelector(".canvas-area");return t&&t.appendChild(fe),fe}catch{return null}}function ht(t){if(!(!lt||!ea))try{const e=Ha();if(!e)return;const r=e.querySelector("#__iw_debug_pre");if(!r)return;const a=Object.assign({},t||{});a.bbox&&typeof a.bbox=="object"&&(a.bbox={x:a.bbox.x,y:a.bbox.y,width:a.bbox.width,height:a.bbox.height}),r.textContent=JSON.stringify(a,null,2)}catch{}}function $e(t){return typeof CSS<"u"&&CSS.escape?CSS.escape(t):String(t).replace(/"/g,'"').replace(/\]/g,"\\]")}function De(t,e,r){if(!t)return{x:0,y:0};const a=t.createSVGPoint();a.x=e,a.y=r;try{const n=t.getScreenCTM();if(!n)return{x:0,y:0};const i=a.matrixTransform(n.inverse());return{x:i.x,y:i.y}}catch{return{x:0,y:0}}}function Ar(t,e){if(!K||!t)return null;const r=$e(t);return K.querySelector(`input[data-text-node="${r}"][data-card-side="${e}"]`)}function Oa(){const t=document.querySelector(".text-editor-panel");if(!t)return;const e=t.querySelector(".new-text-btn");e&&e.addEventListener("click",()=>{Ua()}),t.querySelectorAll(".text-input").forEach(a=>{wr(a)})}function Ua(){const t=document.querySelector(".text-fields-container");if(!t)return;const e=document.createElement("div");e.className="text-input-wrapper";const r=document.createElement("input");r.type="text",r.className="text-input",r.value="New Text",r.placeholder="Enter text here...",r.dataset.textNode=`custom-${Date.now()}-${Math.random().toString(36).slice(2,5)}`,r.dataset.cardSide=C||"front",e.appendChild(r),t.appendChild(e),wr(r);const a=document.createElement("button");a.type="button",a.className="delete-text",a.setAttribute("aria-label","Delete text field"),a.innerHTML='<span class="sr-only">Delete text field</span><i class="fa-solid fa-trash-can" aria-hidden="true"></i>',a.addEventListener("click",o=>{o.preventDefault();const s=r.dataset.textNode,l=r.dataset.cardSide||C||"front";s&&Lr(s,l),e.remove()}),e.appendChild(a);const n=C||"front",i=Le(r);if(i){Z(i,r.value);const o=R(n);if(o){const s=Me(o),l=s.x+(s.width||500)*.5,u=s.y+(s.height||700)*.5;ze(i,n,l,u)}je(i,n);try{I(n)}catch{}}setTimeout(()=>{r.focus(),r.select()},10)}function wr(t){var a;if(!t)return;t.addEventListener("input",()=>{var s;const n=t.dataset.cardSide||C||"front",i=t.dataset.textNode;if(!i)return;const o=(s=P[n])==null?void 0:s.get(i);if(o){Z(o,t.value);try{I(n)}catch{}nr(o,n)}});const e=t.dataset.cardSide||C||"front",r=t.dataset.textNode;if(r&&((a=P[e])!=null&&a.has(r))){const n=P[e].get(r);if(n){const i=nt(n);i!==t.value&&(t.value=i)}}}function Se(t,e,r){if(t){try{const a=`.text-editor-panel .text-input[data-text-node="${CSS&&CSS.escape?CSS.escape(t):t}"][data-card-side="${e}"]`,n=document.querySelector(a);n&&n.value!==r&&(n.value=r,n.dispatchEvent(new Event("input",{bubbles:!0})))}catch{}try{Array.from(document.querySelectorAll(`input[data-text-node="${t}"]`)).forEach(n=>{try{const i=n.dataset.cardSide||n.dataset.cardSide||n.getAttribute("data-card-side")||n.getAttribute("data-card-side")||"";(n.value||"")!==(r||"")&&(n.value=r||"",n.dispatchEvent(new Event("input",{bubbles:!0})))}catch{}})}catch{}}}function Ka(){const t=document.querySelector(".text-fields-container");t&&["front","back"].forEach(e=>{const r=R(e);if(!r)return;Array.from(r.querySelectorAll("text")).forEach(n=>{try{const i=Te(n,e);if(t.querySelector(`.text-input-wrapper[data-text-node="${i}"][data-card-side="${e}"]`))return;const s=nt(n)||"",l=Zr(n,e),u=document.createElement("div");u.className="text-input-wrapper",u.setAttribute("data-text-node",i),u.setAttribute("data-card-side",e);const d=document.createElement("input");d.type="text",d.className="text-input",d.value=s,d.placeholder="",d.setAttribute("data-text-node",i),d.setAttribute("data-card-side",e),d.setAttribute("data-top-percent",l.top),d.setAttribute("data-left-percent",l.left);try{const c=n.getAttribute("font-size")||n.dataset.fontSize;c&&(d.dataset.fontSize=c)}catch{}try{const c=n.getAttribute("letter-spacing")||n.dataset.letterSpacing;c&&(d.dataset.letterSpacing=c)}catch{}try{const c=Qe(n)||n.dataset.fontFamily;c&&(d.dataset.fontFamily=c,d.style.fontFamily=c)}catch{}u.appendChild(d);const f=document.createElement("button");f.type="button",f.className="delete-text",f.setAttribute("aria-label","Delete text field"),f.innerHTML='<span class="sr-only">Delete text field</span><i class="fa-solid fa-trash-can" aria-hidden="true"></i>',u.appendChild(f),t.appendChild(u),wr(d),f.addEventListener("click",c=>{c.preventDefault(),Lr(i,e),u.remove()})}catch{}})})}function ra(t,e,r,a){if(!t)return;const n=t.getAttribute("data-text-node")||"";if(!n)return;const i=Ar(n,e);if(!i)return;const o=R(e);if(!o)return;const s=Me(o),l=s.width?(r-s.x)/s.width*100:0,u=s.height?(a-s.y)/s.height*100:0;i.dataset.leftPercent=l.toFixed(2),i.dataset.topPercent=u.toFixed(2)}function ze(t,e,r,a){if(!t)return;t.setAttribute("x",r),t.dataset.originalX=r,t.setAttribute("y",a),t.dataset.originalY=a,t.querySelectorAll("tspan").forEach((i,o)=>{i.setAttribute("x",r),o===0?(i.setAttribute("y",a),i.removeAttribute("dy")):i.hasAttribute("dy")||i.setAttribute("dy","1.2em")}),ra(t,e,r,a)}function $(t){var e;return(((e=t==null?void 0:t.dataset)==null?void 0:e.cardSide)||"front").toLowerCase()}function J(t){var e;return(((e=t==null?void 0:t.dataset)==null?void 0:e.textNode)||"").trim()}function R(t){const e=t==="front"?j:U;return e?e.querySelector("svg"):null}function Wa(t){if(!lt)return null;if(xr[t])return xr[t];const e=t==="front"?j:U;if(!e)return null;try{e.classList.remove("background-fallback"),e.style.removeProperty("background-image"),e.style.backgroundColor||(e.style.backgroundColor="#ffffff")}catch{}const r=R(t);if(!r)return null;function a(s){if(!s)return"";try{return s.getAttribute("href")||s.href&&s.href.baseVal||s.getAttributeNS(we,"href")||""}catch{return""}}function n(){const s=Array.from(r.querySelectorAll("image")).filter(c=>!(!c||!c.tagName||c.tagName.toLowerCase()!=="image"||c.closest&&c.closest("defs, symbol, clipPath, mask, pattern")));if(!s.length)return null;const l=s.find(c=>(c.dataset&&c.dataset.editableImage||"")===t);if(l)return l;const u=s.find(c=>{if(!c.dataset)return!1;const p=(c.dataset.changeable||"").toLowerCase(),g=c.hasAttribute("data-uploaded");return p==="image"||g});if(u)return u;let d=s[0],f=0;return s.forEach(c=>{let p=0;try{const g=c.getBBox();p=g&&Number.isFinite(g.width)&&Number.isFinite(g.height)?g.width*g.height:0}catch{const x=Number(c.getAttribute("width"))||0,S=Number(c.getAttribute("height"))||0;p=x*S}p>f&&(d=c,f=p)}),d||null}const i=Array.from(r.querySelectorAll("image")).filter(s=>!(!s||!s.tagName||s.tagName.toLowerCase()!=="image"||s.closest&&s.closest("defs, symbol, clipPath, mask, pattern")));let o=r.querySelector(`image[data-editable-image="${t}"]`)||n();o?o.getAttribute("data-editable-image")||o.setAttribute("data-editable-image",t):(o=document.createElementNS(st,"image"),o.setAttribute("data-editable-image",t),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o.style.display="none",r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o));try{const s=a(o);s&&i.forEach(l=>{if(l===o)return;const u=a(l);if(u&&u===s)try{l.remove()}catch{}})}catch{}try{Array.from(r.querySelectorAll(`image[data-editable-image="${t}"]`)).filter(l=>l!==o).forEach(l=>{try{l.remove()}catch{}})}catch{}xr[t]=o;try{const s=o.getAttribute&&(o.getAttribute("href")||o.getAttributeNS(we,"href")||o.href&&o.href.baseVal);console.debug("[ensureImageLayer] side:",t,"layer:",o,"href:",s),ht({event:"ensureImageLayer",side:t,href:s})}catch{}return o}function zt(t){if(!lt)return null;if(!Q){try{const a=re[t];a&&a.parentNode&&a.parentNode.removeChild(a)}catch{}return re[t]=null,null}if(re[t])return re[t];const e=t==="front"?j:U;if(!e)return null;let r=e.querySelector(`img[data-image-layer="${t}"]`);if(!r){r=document.createElement("img"),r.setAttribute("data-image-layer",t),r.setAttribute("alt",""),r.setAttribute("aria-hidden","true"),r.decoding="async",r.loading="lazy",r.style.display="none",r.style.visibility="hidden";const a=R(t);a&&a.parentNode===e?e.insertBefore(r,a):e.appendChild(r)}return re[t]=r,r}function X(t,e){if(lt&&t)try{const r=t.tagName&&t.tagName.toLowerCase()==="img";if(console.debug("[setImageElementSource] element:",t,"src:",e,"isImg:",r),r){const a=t.hasAttribute&&t.hasAttribute("data-image-layer");if(t.dataset.loaded="pending",t.onload=function(){t.dataset.loaded="true",console.debug("[setImageElementSource] <img> load",t.currentSrc,t.naturalWidth,t.naturalHeight),ht({type:"img",src:t.currentSrc,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight});const n=t.closest&&t.closest(".card");n&&(n.classList.remove("background-fallback"),n.style.removeProperty("background-image"))},t.onerror=function(n){t.dataset.loaded="error",console.warn("[setImageElementSource] <img> load error",e,n),ht({type:"img",src:e,error:"load failed"});const i=t.closest&&t.closest(".card");if(i&&e)try{i.classList.add("background-fallback"),i.style.backgroundImage=`url("${e}")`}catch{}},e){if(t.src=e,a&&!Q)t.style.display="none",t.style.visibility="hidden";else{try{t.style.removeProperty("display")}catch{}t.style.visibility="visible"}try{t.style.removeProperty("filter")}catch{}try{t.style.removeProperty("image-rendering")}catch{}}else{try{t.removeAttribute("src")}catch{}t.style.display="none",t.style.visibility="hidden";try{t.style.removeProperty("filter")}catch{}try{t.style.removeProperty("image-rendering")}catch{}}ht({type:"img",src:e});return}try{t.removeEventListener&&t.removeEventListener("load",t.__iw_onload)}catch{}try{t.removeEventListener&&t.removeEventListener("error",t.__iw_onerror)}catch{}if(e){try{t.setAttribute("href",e)}catch{}try{t.setAttributeNS(null,"href",e)}catch{}try{t.setAttributeNS(we,"xlink:href",e)}catch{}try{t.setAttribute("xlink:href",e)}catch{}const a=t.closest&&t.closest(".card");a&&(a.classList.remove("background-fallback"),a.style.removeProperty("background-image"));const n=t.getAttribute&&t.getAttribute("data-editable-image");if(n){const i=re[n];i&&!Q&&(i.style.display="none",i.style.visibility="hidden")}t.__iw_onload=function(){console.debug("[setImageElementSource] svg image load",e);try{t.style.removeProperty("display"),t.style.visibility="visible"}catch{}try{t.style.removeProperty("filter")}catch{}try{t.style.removeProperty("image-rendering")}catch{}const i=t.closest&&t.closest(".card");i&&(i.classList.remove("background-fallback"),i.style.removeProperty("background-image"));const o=t.getAttribute&&t.getAttribute("data-editable-image");if(o){const s=re[o];s&&!Q&&(s.style.display="none",s.style.visibility="hidden")}ht({type:"svg-image",href:e,status:"loaded"})},t.__iw_onerror=function(i){console.warn("[setImageElementSource] svg image load error",e,i);const o=t.closest&&t.closest(".card");if(o&&e)try{o.classList.add("background-fallback"),o.style.backgroundImage=`url("${e}")`;try{o.style.removeProperty("filter")}catch{}try{o.style.removeProperty("image-rendering")}catch{}}catch{}const s=t.getAttribute&&t.getAttribute("data-editable-image");if(s){const l=re[s];if(l){try{l.style.removeProperty("display")}catch{}l.style.visibility="visible"}}ht({type:"svg-image",href:e,error:"load failed"})};try{t.addEventListener&&t.addEventListener("load",t.__iw_onload)}catch{}try{t.addEventListener&&t.addEventListener("error",t.__iw_onerror)}catch{}try{t.style.removeProperty("display")}catch{}t.style.visibility="visible"}else{try{t.removeAttribute("href")}catch{}try{t.removeAttributeNS(we,"xlink:href")}catch{}try{t.setAttribute("xlink:href","")}catch{}t.style.display="none",t.style.visibility="hidden"}try{const a=t.getAttribute("href")||t.href&&t.href.baseVal||t.getAttributeNS(we,"href");let n=null;try{n=t.getBBox&&t.getBBox()}catch{}ht({type:"svg-image",href:a,bbox:n})}catch{}}catch(r){console.error("setImageElementSource error",r)}}function aa(t,e){var n;if(!lt)return;const r=At[t];if(!r)return;const a=((n=Wt[t])==null?void 0:n.defaultSrc)||r.dataset.defaultSrc||r.src;e?(r.src=e,r.style.filter="none"):(r.src=a||"",r.style.filter="none")}function ie(t,e,{skipPreview:r=!1}={}){if(!lt||!Wt[t])return;const a=Wa(t);if(!a)return;Wt[t].currentSrc=e||"";const n=Wt[t].currentSrc||Wt[t].defaultSrc||"";console.debug("[applyImage] side:",t,"displaySrc:",n),ht({event:"applyImage",side:t,displaySrc:n});function i(c){if(!c||typeof c!="string")return c;if(c=c.replace(/\\/g,"/"),/^https?:\/\//i.test(c))try{const S=new URL(c,window.location.origin),A=(S.pathname||"")+(S.search||"")+(S.hash||"");if(A.startsWith("/templates/"))return"/storage/templates/"+A.substring(11);const N=A.indexOf("/storage/templates/");return N!==-1?A.substring(N):S.origin===window.location.origin?A:c}catch{return c}if(c.startsWith("/templates/"))return"/storage/templates/"+c.substring(11);if(c.startsWith("/"))return c;const p=c.match(/.*\/public\/(.*)/i);if(p&&p[1])return"/"+p[1];const g=c.match(/.*(storage\/templates\/.*)/i);if(g&&g[1])return"/"+g[1];const x=c.match(/.*templates\/(.+)$/i);return x&&x[1]?"/storage/templates/"+x[1]:c}const o=i(n);try{Xt[t]&&(URL.revokeObjectURL(Xt[t]),Xt[t]=null)}catch{}function s(c){const p=c.split(",");if(!p||p.length<2)return null;const g=p[0],x=p.slice(1).join(","),S=/;base64/i.test(g);let A;try{A=S?atob(x):decodeURIComponent(x)}catch{try{A=atob(x)}catch{A=null}}if(A==null)return null;const N=new Uint8Array(A.length);for(let w=0;w<A.length;w++)N[w]=A.charCodeAt(w);const q=g.match(/data:([^;]+)[;]?/i),y=q?q[1]:"application/octet-stream";return new Blob([N],{type:y})}const l=typeof n=="string"&&n.trim().startsWith("<svg"),u=typeof o=="string"&&o.trim().startsWith("data:"),d=typeof o=="string"&&/\.svg(\?|$)/i.test(o);if(l)try{const c=new Blob([n],{type:"image/svg+xml"}),p=URL.createObjectURL(c);Xt[t]=p,X(a,p);const g=Q?zt(t):null;g&&X(g,p),ht({event:"applyImage",side:t,inlined:!0})}catch(c){console.warn("[applyImage] failed to inline raw svg, falling back to direct src",c),X(a,n);const p=Q?zt(t):null;p&&X(p,n)}else if(u)try{const c=s(o);if(c){const p=c.type||"";if(/svg/i.test(p)){const g=URL.createObjectURL(c);Xt[t]=g,X(a,g);const x=Q?zt(t):null;x&&X(x,g),ht({event:"applyImage",side:t,dataUrl:!0})}else{X(a,o);const g=Q?zt(t):null;g&&X(g,o)}}else{X(a,o);const p=Q?zt(t):null;p&&X(p,o)}}catch(c){console.warn("[applyImage] data url handling failed",c),X(a,o);const p=Q?zt(t):null;p&&X(p,o)}else if(d)o&&fetch(o,{credentials:"same-origin"}).then(c=>{if(!c.ok)throw new Error("fetch failed "+c.status+" for "+o);return c.text()}).then(c=>{try{const p=new Blob([c],{type:"image/svg+xml"}),g=URL.createObjectURL(p);Xt[t]=g,X(a,g);const x=Q?zt(t):null;x&&X(x,g),ht({event:"applyImage",side:t,fetched:!0,blobUrl:g})}catch(p){console.warn("[applyImage] failed to inline svg, falling back to direct href",p),X(a,o);const g=Q?zt(t):null;g&&X(g,o)}}).catch(c=>{console.warn("[applyImage] fetch svg failed, using direct src",c),X(a,o||n);const p=Q?zt(t):null;p&&X(p,o||n)});else{X(a,o||n);const c=Q?zt(t):null;c&&X(c,o||n)}const f=t==="front"?j:U;f&&(f.dataset.currentImage=n,n||(f.classList.remove("background-fallback"),f.style.removeProperty("background-image"))),r?At[t]&&!At[t].getAttribute("src")&&aa(t,n):aa(t,n)}if(lt)try{["front","back"].forEach(t=>{const e=R(t);if(!e)return;const r=e.querySelector('image[data-editable-image="'+t+'"]');if(!r)return;const a=r.getAttribute("href")||r.getAttributeNS(we,"href")||r.href&&r.href.baseVal||null;console.debug("[init-scan] side:",t,"svg-image-href:",a,"element:",r),ht({event:"init-scan",side:t,href:a})})}catch{}function Xa(t){if(!lt||!Wt[t])return;Wt[t].currentSrc="",ie(t,"");const e=document.querySelector(`[data-image-input="${t}"]`);e&&(e.value="")}function Ya(){document.querySelectorAll(".next-form").forEach(t=>{t.dataset.textMetaBound!=="true"&&(t.dataset.textMetaBound="true",t.addEventListener("submit",()=>{t.querySelectorAll('input[name^="text_fields_meta["]').forEach(e=>e.remove()),document.querySelectorAll("input[data-text-node]").forEach(e=>{const a=e.dataset.textNode||e.getAttribute("data-text-node")||"",n={font_size:e.dataset.fontSize||e.getAttribute("data-font-size")||"",font_family:e.dataset.fontFamily||"",color:e.dataset.color||""};Object.keys(n).forEach(i=>{const o=`text_fields_meta[${a}][${i}]`,s=document.createElement("input");s.type="hidden",s.name=o,s.value=n[i],t.appendChild(s)});try{const i=a,o=document.querySelector(`input[data-text-node="${$e(i)}"]`),s=document.querySelector(`[data-text-node="${$e(i)}"]`);if(s){const l=s.parentNode&&s.parentNode.dataset&&s.parentNode.dataset.iwWrapper==="true"?s.parentNode:null;if(l){const u=l.dataset.iwScale||"",d=l.dataset.iwRotate||"",f=document.createElement("input");f.type="hidden",f.name=`text_fields_meta[${a}][wrapper_scale]`,f.value=u,t.appendChild(f);const c=document.createElement("input");c.type="hidden",c.name=`text_fields_meta[${a}][wrapper_rotate]`,c.value=d,t.appendChild(c)}}}catch{}})}))})}function na(t){Vt.forEach(e=>{e.classList.toggle("active",e.dataset.panel===t)})}function Me(t){const e=t==null?void 0:t.getAttribute("viewBox");if(!e){const a=(t==null?void 0:t.clientWidth)||0,n=(t==null?void 0:t.clientHeight)||0;return{x:0,y:0,width:a,height:n}}const r=e.trim().split(/\s+/).map(Number);return r.length===4&&r.every(a=>Number.isFinite(a))?{x:r[0],y:r[1],width:r[2],height:r[3]}:{x:0,y:0,width:t.clientWidth||0,height:t.clientHeight||0}}function ia(t,e,r){if(!t||!e)return;const a=R(r);if(!a)return;const n=Me(a),i=Number.parseFloat(e.dataset.topPercent??""),o=Number.parseFloat(e.dataset.leftPercent??""),s=(e.dataset.align||"center").toLowerCase();if(Number.isFinite(o)){const u=n.x+n.width*o/100;t.setAttribute("x",u),t.dataset.originalX=u}if(Number.isFinite(i)){const u=n.y+n.height*i/100;t.setAttribute("y",u),t.dataset.originalY=u}const l={left:"start",center:"middle",right:"end"};t.setAttribute("text-anchor",l[s]||"middle"),t.setAttribute("dominant-baseline","middle"),e.dataset.fontSize&&t.setAttribute("font-size",e.dataset.fontSize),e.dataset.letterSpacing&&t.setAttribute("letter-spacing",e.dataset.letterSpacing)}function Z(t,e){if(!t)return;const r=String(e??"").split(/\r?\n/);for(;t.firstChild;)t.removeChild(t.firstChild);const a=t.dataset.originalX||t.getAttribute("x")||null,n=t.dataset.originalY||t.getAttribute("y")||null;r.forEach((i,o)=>{const s=document.createElementNS(st,"tspan");a&&s.setAttribute("x",a),o===0&&n?s.setAttribute("y",n):o>0&&s.setAttribute("dy","1.2em"),s.textContent=i||" ",t.appendChild(s)});try{if(t.ownerSVGElement){const i=t.ownerSVGElement,o=i.closest&&i.closest(".card"),s=o&&o.dataset&&o.dataset.card?o.dataset.card:i.id==="cardFront"?"front":"back";try{nr(t,s)}catch{}}}catch{}}function nt(t){if(!t)return"";const e=t.querySelectorAll("tspan");return e.length===0?(t.textContent??"").replace(/\u00A0/g,""):Array.from(e).map(r=>(r.textContent??"").replace(/\u00A0/g,"")).join(`
`)}function Va(t,e){if(!K||!t)return null;const r=Te(t,e);if(!r)return null;const a=nt(t),{left:n,top:i}=Zr(t,e),o=tr(t.getAttribute("text-anchor")),s=t.getAttribute("font-size")||"",l=t.getAttribute("letter-spacing")||"",u=t.getAttribute("fill")||"",d=Qe(t),f=Ar(r,e);if(f){f.value||(f.value=a),!f.placeholder&&a&&(f.placeholder=a),f.dataset.cardSide||(f.dataset.cardSide=e),f.dataset.leftPercent||(f.dataset.leftPercent=n),f.dataset.topPercent||(f.dataset.topPercent=i),f.dataset.align||(f.dataset.align=o),s&&!f.dataset.fontSize&&(f.dataset.fontSize=s),l&&!f.dataset.letterSpacing&&(f.dataset.letterSpacing=l),u&&!f.dataset.color&&(f.dataset.color=u),u&&!f.style.color&&(f.style.color=u),d&&!f.dataset.fontFamily&&(f.dataset.fontFamily=d,f.style.fontFamily="'"+d+"', system-ui, sans-serif"),f.name||(f.name=`text_fields[${r}]`),f.dataset.defaultValue=f.dataset.defaultValue||a;const x=f.closest(".text-field");return x&&(x.dataset.cardSide=e,x.dataset.textNode=r),f}const c=document.createElement("div");c.className="text-field",c.dataset.cardSide=e,c.dataset.textNode=r;const p=document.createElement("input");p.type="text",p.name=`text_fields[${r}]`,p.value=a,a&&(p.placeholder=a),p.dataset.cardSide=e,p.dataset.textNode=r,p.dataset.leftPercent=n,p.dataset.topPercent=i,p.dataset.align=o,p.dataset.defaultValue=a,s&&(p.dataset.fontSize=s),l&&(p.dataset.letterSpacing=l),u&&(p.dataset.color=u,p.style.color=u),d&&(p.dataset.fontFamily=d,p.style.fontFamily="'"+d+"', system-ui, sans-serif");const g=document.createElement("button");return g.type="button",g.className="delete-text",g.setAttribute("aria-label","Remove text field"),g.innerHTML='<i class="fa-solid fa-trash-can"></i>',c.appendChild(p),c.appendChild(g),K.appendChild(c),p}function vt(t){if(!t||!t.parentNode)return null;const e=t.parentNode;if(e&&e.tagName&&e.tagName.toLowerCase()==="g"&&e.dataset&&e.dataset.iwWrapper==="true")return e;if(!(t.ownerSVGElement||R("front")||R("back")))return null;const a=document.createElementNS(st,"g");return a.dataset.iwWrapper="true",t.parentNode.insertBefore(a,t),a.appendChild(t),a.dataset.iwScale=a.dataset.iwScale||"1",a.dataset.iwRotate=a.dataset.iwRotate||"0",pe(a,Number(a.dataset.iwScale),Number(a.dataset.iwRotate),t),a}function pe(t,e,r,a){try{e=Number(e)||1,r=Number(r)||0;const n=a||t&&t.querySelector&&t.querySelector("text");let i=0,o=0;try{const l=n.getBBox();i=l.x+l.width/2,o=l.y+l.height/2}catch{}const s=`translate(${i} ${o}) rotate(${r}) scale(${e}) translate(${-i} ${-o})`;t.setAttribute("transform",s),t.dataset.iwScale=String(e),t.dataset.iwRotate=String(r)}catch{}}function oe(t=!0){if(!Dt)return;const e=Dt,r=L,a=tt,n=(r==null?void 0:r.getAttribute("data-text-node"))||"";r&&r.classList.remove("svg-text-focus"),n&&a&&ge(n,a,!1),e.remove(),Dt=null,L=null,tt=null;const i=t?e.value:er;if(r&&n&&typeof i=="string"){Z(r,i),Se(n,a,i);try{I(a)}catch{}}er="",Ye();try{B(r,a)}catch{}}function Ee(t,e){if(!t)return;const r=t.getAttribute("data-text-node")||"";if(!r)return;C!==e&&ke(e),oe(!0),er=nt(t),F(t,e);const a=R(e),n=Ft||_t;if(!a||!n)return;const i=t.getBoundingClientRect(),o=n.getBoundingClientRect(),s=St||1,l=(i.left-o.left)/s,u=(i.top-o.top)/s,d=document.createElement("textarea");d.className="inline-text-editor",d.setAttribute("aria-label","Edit canvas text"),d.value=er,d.style.position="absolute",d.style.left=`${l}px`,d.style.top=`${u}px`;const f=Math.max(i.width/s,120),c=Math.max(i.height/s,28);d.style.width=`${f}px`,d.style.height=`${c}px`,d.style.padding="6px 8px",d.style.border="2px solid #3B82F6",d.style.borderRadius="6px",d.style.background="rgba(255,255,255,0.98)",d.style.boxShadow="0 4px 12px rgba(15, 23, 42, 0.15)",d.style.zIndex="35",d.style.transform=`scale(${s})`,d.style.transformOrigin="top left",d.style.left=`${l}px`,d.style.top=`${u}px`;const p=t.getAttribute("font-size")||window.getComputedStyle(t).fontSize||"18px",g=/px$/i.test(p)?p:`${p}px`;d.style.fontSize=g,d.style.lineHeight="1.2",d.style.fontFamily=t.dataset.fontFamily?`'${t.dataset.fontFamily}', system-ui, sans-serif`:window.getComputedStyle(t).fontFamily;const x=t.getAttribute("fill")||t.style.fill||"#1f2933";d.style.color=x,d.style.caretColor=x,d.style.resize="none";function S(){try{d.style.height="1px";const y=Math.max(d.scrollHeight,c);d.style.height=y/s+"px"}catch{}}setTimeout(S,0),n.appendChild(d),Dt=d,L=t,tt=e,t.classList.add("svg-text-focus"),ge(r,e,!0),Pt(),ue(t);try{const y=t.getAttribute("letter-spacing")||t.dataset.letterSpacing||"";y&&(d.style.letterSpacing=typeof y=="string"&&y.endsWith("px")?y:`${y}px`)}catch{}try{const y=(t.getAttribute("text-anchor")||"middle").toLowerCase();d.style.textAlign=y==="start"?"left":y==="end"?"right":"center"}catch{}try{const y=t.getAttribute("font-size")||window.getComputedStyle(t).fontSize||"";y&&(d.style.fontSize=/px$/i.test(y)?y:`${y}px`)}catch{}let A=!1,N=null;const q=600;d.addEventListener("compositionstart",()=>{A=!0}),d.addEventListener("compositionend",y=>{A=!1,Z(t,d.value),Se(r,e,d.value);try{I(e)}catch{}S()}),d.addEventListener("input",()=>{Z(t,d.value),Se(r,e,d.value);try{I(e)}catch{}S();try{za(t,e)||F(t,e)}catch{}N&&clearTimeout(N),N=setTimeout(()=>{try{B(t,e)}catch{}N=null},q)}),d.addEventListener("keydown",y=>{if(y.key==="Escape")y.preventDefault(),oe(!1);else if(y.key==="Enter"&&!y.shiftKey&&!y.ctrlKey){if(A)return;y.preventDefault(),oe(!0)}}),d.addEventListener("blur",()=>{A||oe(!0)}),requestAnimationFrame(()=>{var y;try{d.focus({preventScroll:!0})}catch{d.focus()}(y=d.select)==null||y.call(d)})}function je(t,e){if(!t||!e)return;const r=Te(t,e);if(!r)return;if(t._iwEventListeners?(t._iwEventListeners.forEach(({event:c,handler:p})=>{try{t.removeEventListener(c,p)}catch{}}),t._iwEventListeners=[]):t._iwEventListeners=[],P[e].set(r,t),!t.dataset.originalX&&t.hasAttribute("x")&&(t.dataset.originalX=t.getAttribute("x")),!t.dataset.originalY&&t.hasAttribute("y")&&(t.dataset.originalY=t.getAttribute("y")),t.setAttribute("contenteditable","true"),t.setAttribute("role","textbox"),t.setAttribute("spellcheck","false"),t.setAttribute("tabindex","0"),t.style.cursor="pointer",t.style.userSelect="none",!t.hasAttribute("aria-label"))try{const c=t.getAttribute("data-text-node")||t.getAttribute("id")||"",p=c?`Edit text: ${c}`:t.textContent&&t.textContent.trim()||"Edit canvas text";t.setAttribute("aria-label",p)}catch{t.setAttribute("aria-label","Edit canvas text")}const a=()=>{C!==e&&ke(e),t.classList.add("svg-text-focus"),ge(r,e,!0),Pt(),ue(t),b=t,at=e,D(t,e)},n=()=>{t.classList.remove("svg-text-focus"),ge(r,e,!1)};t.addEventListener("focus",a),t.addEventListener("blur",n),t._iwEventListeners.push({event:"focus",handler:a}),t._iwEventListeners.push({event:"blur",handler:n});const i=c=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(c.key)){c.preventDefault();const g=c.shiftKey?5:1;let x=Number.parseFloat(t.getAttribute("x")||t.dataset.originalX||"0"),S=Number.parseFloat(t.getAttribute("y")||t.dataset.originalY||"0");c.key==="ArrowUp"&&(S-=g),c.key==="ArrowDown"&&(S+=g),c.key==="ArrowLeft"&&(x-=g),c.key==="ArrowRight"&&(x+=g),ze(t,e,x,S);try{I(e)}catch{}return}if(c.key==="Enter"&&!c.shiftKey){c.preventDefault(),Ee(t,e);return}else if(c.key==="Backspace"||c.key==="Delete"){c.preventDefault(),Ee(t,e);return}else if(!c.ctrlKey&&!c.metaKey&&!c.altKey&&c.key.length===1){c.preventDefault(),Ee(t,e);return}};t.addEventListener("keydown",i),t._iwEventListeners.push({event:"keydown",handler:i});const o=()=>Ga(t,e);t.addEventListener("input",o),t._iwEventListeners.push({event:"input",handler:o});const s=c=>Ja(c,t,e);t.addEventListener("pointerdown",s),t._iwEventListeners.push({event:"pointerdown",handler:s}),t.addEventListener("pointermove",Za),t.addEventListener("pointerup",c=>Sr(c,!1)),t.addEventListener("pointercancel",c=>Sr(c,!0)),t.addEventListener("lostpointercapture",()=>{_.active&&_.node===t&&Sr({pointerId:_.pointerId},!0)});const l=c=>{c.preventDefault(),c.stopPropagation(),Ee(t,e)};t.addEventListener("dblclick",l),t._iwEventListeners.push({event:"dblclick",handler:l});const u=c=>{c.detail===1&&setTimeout(()=>{(!Dt||L!==t)&&Ee(t,e)},200)};t.addEventListener("click",u),t._iwEventListeners.push({event:"click",handler:u});const d=()=>oa(t,e),f=()=>en();t.addEventListener("focus",d),t.addEventListener("blur",f),t._iwEventListeners.push({event:"focus",handler:d}),t._iwEventListeners.push({event:"blur",handler:f});try{vt(t)}catch{}t.dataset.prepared=e}function rr(t,e){if(!t)return;t.querySelectorAll("text").forEach(a=>{a.closest&&a.closest("defs, symbol, clipPath, mask, pattern")||a.hasAttribute&&(a.hasAttribute("data-non-editable")||a.getAttribute("aria-hidden")==="true")||!Te(a,e)||(Va(a,e),je(a,e))})}function ge(t,e,r){if(!K)return;const a=$e(t),n=K.querySelector(`input[data-text-node="${a}"][data-card-side="${e}"]`);if(!n)return;const i=n.closest(".text-field");i&&i.classList.toggle("is-active",r)}function Ga(t,e){const r=t.getAttribute("data-text-node")||"",a=nt(t);Se(r,e,a),R(e);const n=Number.parseFloat(t.getAttribute("x")||t.dataset.originalX||"0"),i=Number.parseFloat(t.getAttribute("y")||t.dataset.originalY||"0");ra(t,e,n,i);try{I(e)}catch(o){console.debug("preview-from-svg failed",o)}try{nr(t,e)}catch{}}function Le(t){const e=$(t),r=J(t);if(!r)return null;const a=P[e].get(r);if(a)return a;const n=R(e);if(!n)return null;const i=document.createElementNS(st,"text");i.setAttribute("data-text-node",r),ia(i,t,e);try{const o=t.dataset.fontSize||t.getAttribute("data-font-size")||"16",s=t.dataset.letterSpacing||t.getAttribute("data-letter-spacing")||"",l=t.dataset.color||t.style.color||"#1f2933",u=t.dataset.fontFamily||t.style.fontFamily||"",d=(t.dataset.align||"center").toLowerCase(),f=d==="left"?"start":d==="right"?"end":"middle";try{i.setAttribute("font-size",String(o))}catch{}if(s)try{i.setAttribute("letter-spacing",String(s))}catch{}try{i.setAttribute("fill",l)}catch{}if(u)try{i.setAttribute("style",`font-family: '${u}', system-ui, sans-serif;`)}catch{}try{i.setAttribute("text-anchor",f)}catch{}try{i.setAttribute("dominant-baseline","middle")}catch{}}catch{}return Z(i,t.value||""),n.appendChild(i),je(i,e),i}function ar(t,e){const r=$(t);if(!J(t))return;const n=Le(t);if(n){Z(n,e),L===n&&Dt&&(Dt.value=e,Dt.dispatchEvent(new Event("input")));try{I(r)}catch(i){console.debug("preview-from-svg failed",i)}}}function Ja(t,e,r){if(!e||t.button!==0||t.detail>1)return;const a=R(r);if(!a)return;oe(!0),t.preventDefault(),t.stopPropagation();const n=De(a,t.clientX,t.clientY),i=Number.parseFloat(e.getAttribute("x")||e.dataset.originalX||"0"),o=Number.parseFloat(e.getAttribute("y")||e.dataset.originalY||"0");_.active=!0,_.node=e,_.side=r,_.svg=a,_.pointerId=t.pointerId,_.offsetX=i-n.x,_.offsetY=o-n.y;try{e.setPointerCapture(t.pointerId)}catch{}e.classList.add("svg-text-dragging"),F(e,r);const s=e.getAttribute("data-text-node");s&&ge(s,r,!0),Pt();try{e.focus({preventScroll:!0})}catch{try{e.focus()}catch{}}}function Za(t){if(!_.active||t.pointerId!==_.pointerId)return;const{svg:e,node:r,side:a,offsetX:n,offsetY:i}=_;if(!e||!r)return;t.preventDefault();const o=De(e,t.clientX,t.clientY),s=o.x+n,l=o.y+i;ze(r,a,s,l),Yt&&v.node===r&&oa(r,a)}function Qa(){_.active=!1,_.node=null,_.side=null,_.pointerId=null,_.svg=null,_.offsetX=0,_.offsetY=0}function Sr(t,e=!1){if(!_.active||t&&_.pointerId!==t.pointerId)return;const r=_.node,a=_.side;if(t&&r)try{r.releasePointerCapture(t.pointerId)}catch{}if(r&&r.classList.remove("svg-text-dragging"),Qa(),!e&&a){try{I(a)}catch{}try{B(r,a)}catch{}de()}}function tn(){if(Yt)return Yt;const t=Ft||_t;if(!t)return null;const e=document.createElement("div");return e.className="svg-resize-handle",e.setAttribute("aria-hidden","true"),t.appendChild(e),e.addEventListener("pointerdown",r=>{if(r.preventDefault(),r.stopPropagation(),r.button!==0)return;const a=v.node;if(!a)return;const n=vt(a);v.active=!0,v.pointerId=r.pointerId,v.startY=r.clientY;const i=Number(n&&n.dataset&&n.dataset.iwScale||1)||1;v.startScale=i;const o=parseFloat(a.getAttribute("letter-spacing")||a.dataset.letterSpacing||"0")||0;v.startLetterSpacing=o;try{e.setPointerCapture(r.pointerId)}catch{}F(v.node,v.side)}),e.addEventListener("pointermove",r=>{if(!v.active||r.pointerId!==v.pointerId)return;r.preventDefault();const n=1+(v.startY-r.clientY)/200,i=Math.max(.2,v.startScale*n);if(v.node){const o=vt(v.node);if(o){const l=Number(o.dataset.iwRotate||0)||0;pe(o,i,l,v.node);try{const d=(v.startLetterSpacing||0)/i;if(Number.isFinite(d)){v.node.setAttribute("letter-spacing",String(d));try{v.node.dataset.letterSpacing=String(d)}catch{}}}catch{}}const s=v.node.getAttribute("data-text-node")||"";s&&v.side&&Se(s,v.side,nt(v.node));try{I(v.side)}catch{}}}),e.addEventListener("pointerup",r=>{if(!(!v.active||r.pointerId!==v.pointerId)){v.active=!1;try{e.releasePointerCapture(r.pointerId)}catch{}v.pointerId=null;try{B(v.node,v.side)}catch{}de()}}),e.addEventListener("pointercancel",r=>{v.active=!1;try{e.releasePointerCapture(r.pointerId)}catch{}v.pointerId=null}),Yt=e,e}function oa(t,e){const r=Ft||_t,a=tn();if(!t||!a||!r||!R(e))return;const i=t.getBoundingClientRect(),o=r.getBoundingClientRect(),s=i.right-o.left-6,l=i.bottom-o.top-6;a.style.left=`${s}px`,a.style.top=`${l}px`,a.classList.add("is-visible"),v.node=t,v.side=e,an(t,e,o)}function en(){Yt&&(Yt.classList.remove("is-visible"),v.node=null,v.side=null,nn())}function rn(){if(ae)return ae;const t=Ft||_t;if(!t)return null;const e=document.createElement("div");return e.className="svg-rotate-handle",e.setAttribute("aria-hidden","true"),t.appendChild(e),e.addEventListener("pointerdown",r=>{if(r.preventDefault(),r.stopPropagation(),r.button!==0)return;const a=m.node;if(!a)return;const n=vt(a);m.active=!0,m.pointerId=r.pointerId,m.startAngle=Number(n&&n.dataset&&n.dataset.iwRotate||0)||0;const i=R(m.side),o=De(i,r.clientX,r.clientY),s=Er(n,a);m.startPointerAngle=Math.atan2(o.y-s.cy,o.x-s.cx)*(180/Math.PI);try{e.setPointerCapture(r.pointerId)}catch{}F(m.node,m.side)}),e.addEventListener("pointermove",r=>{if(!m.active||r.pointerId!==m.pointerId)return;r.preventDefault();const a=R(m.side),n=De(a,r.clientX,r.clientY),i=vt(m.node),o=Er(i,m.node),l=Math.atan2(n.y-o.cy,n.x-o.cx)*(180/Math.PI)-m.startPointerAngle,u=m.startAngle+l;pe(i,Number(i.dataset.iwScale||1)||1,u,m.node);try{I(m.side)}catch{}}),e.addEventListener("pointerup",r=>{if(!(!m.active||r.pointerId!==m.pointerId)){m.active=!1;try{e.releasePointerCapture(r.pointerId)}catch{}m.pointerId=null;try{B(m.node,m.side)}catch{}de();try{const a=m.node&&m.node.parentNode&&m.node.parentNode.dataset&&m.node.parentNode.dataset.iwWrapper==="true"?m.node.parentNode:null;a&&a.classList&&a.classList.remove("is-rotating")}catch{}}}),e.addEventListener("pointercancel",r=>{m.active=!1;try{e.releasePointerCapture(r.pointerId)}catch{}m.pointerId=null;try{const a=m.node&&m.node.parentNode&&m.node.parentNode.dataset&&m.node.parentNode.dataset.iwWrapper==="true"?m.node.parentNode:null;a&&a.classList&&a.classList.remove("is-rotating")}catch{}}),ae=e,e}function Er(t,e){let r=0,a=0;try{const n=e.getBBox();r=n.x+n.width/2,a=n.y+n.height/2}catch{}return{cx:r,cy:a,getScreen:function(n){try{const i=n.createSVGPoint();i.x=r,i.y=a;const o=e.ownerSVGElement.getScreenCTM(),s=i.matrixTransform(o);return{x:s.x,y:s.y}}catch{return{x:0,y:0}}},cy:a}}function an(t,e,r){const a=Ft||_t,n=rn();if(!t||!n||!a||!R(e))return;const o=t.getBoundingClientRect();r=r||a.getBoundingClientRect();const s=o.left-r.left+o.width/2-8,l=o.top-r.top-18;n.style.left=`${s}px`,n.style.top=`${l}px`,n.classList.add("is-visible"),m.node=t,m.side=e}function nn(){ae&&(ae.classList.remove("is-visible"),m.node=null,m.side=null)}function D(t,e){const r=R(e);if(!r||!t||(t.tagName?t.tagName.toLowerCase():"")==="image"||t.hasAttribute&&t.hasAttribute("data-uploaded"))return;try{const k=t.getAttribute&&t.getAttribute("data-text-node")||"";k?Array.from(r.querySelectorAll(`[data-iw-target-node="${k}"]`)).forEach(O=>{try{O.remove()}catch{}}):ir(e)}catch{try{ir(e)}catch{}}let n={x:0,y:0,width:0,height:0};try{n=t.getBBox()}catch{}const i=8,o=n.x-i,s=n.y-i,l=Math.max(0,n.width+i*2),u=Math.max(0,n.height+i*2),d=document.createElementNS(st,"rect");d.classList.add("text-bounding-box");try{const k=t.getAttribute&&t.getAttribute("data-text-node")||"";k&&d.setAttribute("data-iw-target-node",k)}catch{}d.setAttribute("x",o),d.setAttribute("y",s),d.setAttribute("width",l),d.setAttribute("height",u),d.setAttribute("fill","none"),d.setAttribute("stroke","#3B82F6"),d.setAttribute("stroke-width","2"),d.setAttribute("pointer-events","none");let f=r;try{const k=t.parentNode&&t.parentNode.dataset&&t.parentNode.dataset.iwWrapper==="true"?t.parentNode:null;k&&(f=k)}catch{f=r}f.appendChild(d);let c=null;try{c=r.querySelector("g[data-iw-handles-layer]"),c||(c=document.createElementNS(st,"g"),c.setAttribute("data-iw-handles-layer","true"),r.appendChild(c))}catch{c=r}function p(k,Mt,O={}){const{type:mt="resize",shape:M="circle",w:Y=10,h:ft=10,cursor:kt="pointer",rx:ye=0,ry:Ne=0}=O,pt=document.createElementNS(st,"g");pt.classList.add("bounding-box-handle"),pt.setAttribute("data-handle-type",mt);try{if(t&&t.getAttribute){const T=t.getAttribute("data-text-node")||"";T&&pt.setAttribute("data-iw-target-node",T)}}catch{}try{pt.dataset.targetNodeKey=t.getAttribute&&t.getAttribute("data-text-node")||""}catch{}try{pt.style.cursor=kt}catch{}if(M==="circle"){const T=document.createElementNS(st,"circle");T.setAttribute("cx",k),T.setAttribute("cy",Mt),T.setAttribute("r",String(Y/2)),T.setAttribute("fill","#fff"),T.setAttribute("stroke","#3B82F6"),T.setAttribute("stroke-width","2"),T.setAttribute("pointer-events","none"),pt.appendChild(T)}else{const T=document.createElementNS(st,"rect");T.setAttribute("x",String(k-Y/2)),T.setAttribute("y",String(Mt-ft/2)),T.setAttribute("width",String(Y)),T.setAttribute("height",String(ft)),ye&&T.setAttribute("rx",String(ye)),Ne&&T.setAttribute("ry",String(Ne)),T.setAttribute("fill","#fff"),T.setAttribute("stroke","#3B82F6"),T.setAttribute("stroke-width","2"),T.setAttribute("pointer-events","none"),pt.appendChild(T)}const Nt=document.createElementNS(st,"circle");return Nt.setAttribute("cx",k),Nt.setAttribute("cy",Mt),Nt.setAttribute("r",String(Math.max(12,Y))),Nt.setAttribute("fill","transparent"),Nt.setAttribute("pointer-events","visible"),Nt.setAttribute("class","bounding-box-hit"),Nt.setAttribute("role","button"),Nt.setAttribute("aria-label",mt.charAt(0).toUpperCase()+mt.slice(1)),Nt.setAttribute("tabindex","-1"),pt.appendChild(Nt),c.appendChild(pt),pt}const g=[{x:o,y:s,cursor:"nw-resize"},{x:o+l,y:s,cursor:"ne-resize"},{x:o+l,y:s+u,cursor:"se-resize"},{x:o,y:s+u,cursor:"sw-resize"}],x=[{x:o+l/2,y:s,cursor:"n-resize",w:16,h:10},{x:o+l,y:s+u/2,cursor:"e-resize",w:10,h:16},{x:o+l/2,y:s+u,cursor:"s-resize",w:16,h:10},{x:o,y:s+u/2,cursor:"w-resize",w:10,h:16}];g.forEach(k=>p(k.x,k.y,{type:"resize",shape:"circle",w:12,cursor:k.cursor})),x.forEach(k=>p(k.x,k.y,{type:"resize-side",shape:"rect",w:k.w,h:k.h,rx:2,ry:2,cursor:k.cursor}));const S=18,A=o+l+S,N=s-S,q=document.createElementNS(st,"g");q.classList.add("bounding-box-handle"),q.setAttribute("data-handle-type","rotate");try{const k=t.getAttribute&&t.getAttribute("data-text-node")||"";k&&q.setAttribute("data-iw-target-node",k)}catch{}try{q.dataset.targetNodeKey=t.getAttribute&&t.getAttribute("data-text-node")||""}catch{}try{q.style.cursor="grab"}catch{}const y=document.createElementNS(st,"circle");y.setAttribute("cx",String(A)),y.setAttribute("cy",String(N)),y.setAttribute("r","10"),y.setAttribute("fill","#fff"),y.setAttribute("stroke","#3B82F6"),y.setAttribute("stroke-width","2"),y.setAttribute("pointer-events","none"),q.appendChild(y);const w=document.createElementNS(st,"circle");w.setAttribute("cx",String(A)),w.setAttribute("cy",String(N)),w.setAttribute("r","16"),w.setAttribute("fill","transparent"),w.setAttribute("pointer-events","visible"),w.setAttribute("class","bounding-box-hit"),w.setAttribute("role","button"),w.setAttribute("aria-label","Rotate"),w.setAttribute("tabindex","-1"),q.appendChild(w);const Lt=document.createElementNS(st,"path");Lt.setAttribute("d","M12 6 A6 6 0 1 0 8 4"),Lt.setAttribute("stroke","#3B82F6"),Lt.setAttribute("stroke-width","1.6"),Lt.setAttribute("fill","none"),Lt.setAttribute("transform",`translate(${A-6} ${N-6})`),q.appendChild(Lt),c.appendChild(q)}function on(t,e){let r=null;return function(...n){r&&clearTimeout(r),r=setTimeout(()=>{r=null;try{t.apply(this,n)}catch{}},e)}}const nr=on(function(t,e){try{D(t,e)}catch{}},80);function ir(t){const e=R(t);if(!e)return;let r="";try{b&&at===t&&(r=b.getAttribute&&(b.getAttribute("data-text-node")||"")||"")}catch{r=""}try{Array.from(e.querySelectorAll(".text-bounding-box")).forEach(n=>{try{const i=n.getAttribute("data-iw-target-node")||"";if(r&&i===r)return}catch{}try{n.remove()}catch{}})}catch{}try{Array.from(e.querySelectorAll(".bounding-box-handle")).forEach(n=>{try{const i=n.getAttribute("data-iw-target-node")||"";if(r&&i===r)return}catch{}try{n.remove()}catch{}})}catch{}try{const a=e.querySelector("g[data-iw-handles-layer]");a&&Array.from(a.querySelectorAll(".bounding-box-handle")).forEach(n=>{try{const i=n.getAttribute("data-iw-target-node")||"";if(r&&i===r)return}catch{}try{n.remove()}catch{}})}catch{}try{Array.from(e.querySelectorAll("g[data-iw-wrapper]")).forEach(a=>{Array.from(a.querySelectorAll(".text-bounding-box, .bounding-box-handle")).forEach(n=>{try{const i=n.getAttribute&&n.getAttribute("data-iw-target-node")||"";if(r&&i===r)return}catch{}try{n.remove()}catch{}})})}catch{}try{if(Yt)try{const a=v.node&&v.node.getAttribute&&v.node.getAttribute("data-text-node")||"";(!r||a!==r)&&Yt.classList.remove("is-visible")}catch{Yt.classList.remove("is-visible")}}catch{}try{if(ae)try{const a=m.node&&m.node.getAttribute&&m.node.getAttribute("data-text-node")||"";(!r||a!==r)&&ae.classList.remove("is-visible")}catch{ae.classList.remove("is-visible")}}catch{}}function I(t){const e=R(t),r=At[t];if(!e||!r)return;const a=e.cloneNode(!0);try{if(!a.getAttribute("viewBox")){const l=e.getAttribute("width")||e.clientWidth||0,u=e.getAttribute("height")||e.clientHeight||0;l&&u&&a.setAttribute("viewBox",`0 0 ${l} ${u}`)}}catch{}const i=new XMLSerializer().serializeToString(a),o=new Blob([i],{type:"image/svg+xml"}),s=URL.createObjectURL(o);try{const l=r.dataset.__svg_blob_url;l&&URL.revokeObjectURL(l)}catch{}r.dataset.__svg_blob_url=s,r.src=s;try{r.style.removeProperty("filter")}catch{}}function Lr(t,e){var a,n;const r=(a=P[e])==null?void 0:a.get(t);r&&r.parentNode&&(L===r&&oe(!1),r.parentNode.removeChild(r)),(n=P[e])==null||n.delete(t)}function sa(){K&&K.querySelectorAll(".text-field").forEach(t=>{const e=t.querySelector("input"),r=$(e);t.classList.toggle("is-inactive",r!==C)})}function or(){if(!K)return;const t=new Map;Array.from(K.querySelectorAll(".text-field")).forEach(e=>{const r=e.querySelector("input");if(!r)return;const a=$(r);t.has(a)||t.set(a,[]),t.get(a).push({wrapper:e,input:r})}),t.forEach((e,r)=>{e.forEach(({input:a},n)=>{const i=Ze+n*$a;a.dataset.topPercent||(a.dataset.topPercent=i),Le(a),ia(P[r].get(J(a)),a,r)})}),sa()}function ca(t){var d;if(!t||t.dataset.textPrepared==="true")return;const e=t.querySelector("input"),r=t.querySelector(".delete-text");if(!e)return;e.dataset.cardSide||(e.dataset.cardSide=C),e.dataset.textNode||(e.dataset.textNode=`field-${Date.now()}-${Math.random().toString(36).slice(2,5)}`);const a=$(e),n=J(e),i=e.dataset.defaultValue??"",o=e.getAttribute("placeholder")||"",s=(d=P[a])==null?void 0:d.get(n),l=nt(s);e.value||(l?e.value=l:i&&(e.value=i)),!e.placeholder&&o?e.placeholder=o:!e.placeholder&&i&&(e.placeholder=i);const u=Le(e);!s&&u?Z(u,e.value||i||""):s&&e.value&&e.value!==l?Z(s,e.value):s&&!l&&(i||e.value)&&Z(s,e.value||i||""),e.addEventListener("input",()=>{var f;try{ar(e,e.value);const c=(f=P[$(e)])==null?void 0:f.get(J(e));if(c){nr(c,$(e));try{I($(e))}catch{}}}catch(c){console.debug("input update failed",c)}}),e.addEventListener("focus",()=>{const f=$(e);C!==f&&ke(f),ge(J(e),f,!0),Pt()}),e.addEventListener("blur",()=>{ge(J(e),$(e),!1),Ye()}),r&&!r.dataset.bound&&(r.dataset.bound="true",r.addEventListener("click",()=>{const f=$(e),c=J(e);Lr(c,f),t.remove(),or(),Ye()})),t.dataset.textPrepared="true"}function sn(){K&&(Array.from(K.querySelectorAll(".text-field")).forEach(ca),or())}function ke(t){oe(!0),C=t;const e=t==="front";j&&j.classList.toggle("active",e),U&&U.classList.toggle("active",!e),Ct.forEach(r=>{const n=(r===z?"front":r===V?"back":r.dataset.view)===t;r.classList.toggle("active",n),r.setAttribute("aria-pressed",n?"true":"false")}),sa()}function kr(){et&&(oe(!0),et.style.transform=`scale(${St})`,et.style.transformOrigin="center center",jt&&(jt.textContent=`${Math.round(St*100)}%`),gt&&(gt.disabled=St>=vr),xt&&(xt.disabled=St<=br))}if(z&&z.addEventListener("click",()=>ke("front")),V&&V.addEventListener("click",()=>ke("back")),gt&&gt.addEventListener("click",()=>{St<vr&&(St=Math.min(vr,+(St+Yr).toFixed(2)),kr())}),xt&&xt.addEventListener("click",()=>{St>br&&(St=Math.max(br,+(St-Yr).toFixed(2)),kr())}),kr(),rr(j,"front"),rr(U,"back"),(function(){function e(n,i){if(!i||!n)return;const o=parseFloat(i.getAttribute("width"))||500,s=parseFloat(i.getAttribute("height"))||700;n.style.width=o+"px",n.style.height=s+"px",n.parentNode.style.width=o+"px",n.parentNode.style.height=s+"px"}function r(n){const i=n.getAttribute("viewBox");let o=0,s=0,l=500,u=700;if(i){const f=i.trim().split(/\s+/).map(Number);f.length===4&&(o=f[0],s=f[1],l=f[2],u=f[3])}n.querySelectorAll("text").forEach(f=>{if(f.hasAttribute("data-text-node"))return;let c=parseFloat(f.getAttribute("x")),p=parseFloat(f.getAttribute("y"));(!isFinite(c)||c<o||c>o+l)&&(c=o+l/2),(!isFinite(p)||p<s||p>s+u)&&(p=s+u/2),f.setAttribute("x",String(c)),f.setAttribute("y",String(p)),f.dataset.originalX=String(c),f.dataset.originalY=String(p);const g=f.getAttribute("text-anchor")||"middle";f.setAttribute("text-anchor",g);const x=f.getAttribute("dominant-baseline")||"middle";f.setAttribute("dominant-baseline",x);const S=f.getAttribute("font-size")||window.getComputedStyle(f).fontSize||"16";f.setAttribute("font-size",S);const A=f.getAttribute("letter-spacing")||window.getComputedStyle(f).letterSpacing||"";A&&f.setAttribute("letter-spacing",A);const N=f.getAttribute("font-family")||f.style&&f.style.fontFamily||window.getComputedStyle(f).fontFamily||"";N&&f.setAttribute("style",`font-family: ${N};`);const q=f.querySelectorAll("tspan");q.length>0&&q.forEach((w,Lt)=>{w.setAttribute("x",String(c)),Lt===0&&w.setAttribute("y",String(p)),w.setAttribute("font-size",S),A&&w.setAttribute("letter-spacing",A),N&&w.setAttribute("style",`font-family: ${N};`)});const y=f.getAttribute("id")||f.getAttribute("name")||"";if(y){const w=document.querySelector(`input[data-text-node="${y}"]`);w&&(w.dataset.leftPercent=((c-o)/l*100).toFixed(2),w.dataset.topPercent=((p-s)/u*100).toFixed(2),w.dataset.fontSize=S,w.dataset.letterSpacing=A,w.dataset.fontFamily=N,w.style.fontFamily=N,w.style.fontSize=S+"px",A&&(w.style.letterSpacing=A))}})}function a(){["front","back"].forEach(n=>{const i=n==="front"?j:U,o=R(n);!o||!i||(e(i,o),r(o))}),rr(j,"front"),rr(U,"back"),or();try{Ka()}catch{}try{I("front"),I("back")}catch{}}window.document.fonts&&window.document.fonts.ready?window.document.fonts.ready.then(a):setTimeout(a,200)})(),lt&&(ie("front",Wt.front.currentSrc,{skipPreview:!1}),ie("back",Wt.back.currentSrc,{skipPreview:!1}),Q))try{["front","back"].forEach(t=>{const e=t==="front"?j:U;if(!e)return;const r=e.dataset.defaultImage||"",a=e.dataset.currentImage||"";if(r&&!a)try{e.classList.add("background-fallback"),e.style.backgroundImage=`url("${r}")`;const n=document.querySelector(`[data-image-preview="${t}"]`);n&&!n.getAttribute("src")&&(n.src=r),ht({event:"immediate-background-fallback",side:t,defaultSrc:r})}catch(n){console.warn("background fallback apply failed",n)}})}catch{}sn(),Ya();try{const t=document.querySelector(".undo-btn"),e=document.querySelector(".redo-btn");t&&t.addEventListener("click",r=>{r.preventDefault(),Ma()}),e&&e.addEventListener("click",r=>{r.preventDefault(),ja()}),de()}catch{}ct&&K&&ct.addEventListener("click",()=>{const t=document.createElement("div");t.classList.add("text-field"),t.dataset.cardSide=C;const e=document.createElement("input");e.type="text",e.value="New Text",e.dataset.cardSide=C,e.dataset.textNode=`custom-${Date.now()}`,e.dataset.topPercent=Ze,e.dataset.leftPercent=50,e.dataset.align="center",e.dataset.defaultValue="New Text",e.placeholder="New Text";const r=document.createElement("button");r.classList.add("delete-text"),r.type="button",r.setAttribute("aria-label","Delete text field"),r.innerHTML='<i class="fa-solid fa-trash-can" aria-hidden="true"></i>',t.appendChild(e),t.appendChild(r),K.appendChild(t),ca(t);const a=Le(e);if(a){Z(a,e.value||e.dataset.defaultValue||"New Text");const n=R(C);if(n){const i=Me(n),o=i.x+(i.width||500)*.5,s=i.y+(i.height||700)*.5;ze(a,C,o,s)}je(a,C),b=a,at=C,D(a,C);try{ue(a,C)}catch{}F(a,C),B(a,C);try{Ee(a,C)}catch{}}or();try{e.focus({preventScroll:!0})}catch{e.focus()}}),It.forEach(t=>{const e=t.dataset.panel||"text";t.addEventListener("click",()=>{It.forEach(r=>r.classList.remove("active")),t.classList.add("active"),na(e)})}),lt&&he&&(yt.forEach(t=>{const e=t.dataset.imageInput;t.addEventListener("change",()=>{const r=t.files&&t.files[0];if(!r)return;if(!r.type.startsWith("image/")){t.value="",alert("Please choose an image file.");return}if(r.size>Vr){t.value="",alert("Image is too large. Please upload a file smaller than 5MB.");return}const a=new FileReader;a.onload=n=>{var o;const i=(o=n.target)==null?void 0:o.result;typeof i=="string"&&ie(e,i)},a.onerror=()=>{console.error("Unable to read selected image file."),alert("Unable to read the selected image file. Please try another image.")},a.readAsDataURL(r)})}),cr.forEach(t=>{const e=t.dataset.resetImage;t.addEventListener("click",()=>Xa(e))})),ke("front"),na(((ba=(ma=It[0])==null?void 0:ma.dataset)==null?void 0:ba.panel)||"text"),document.addEventListener("pointerup",()=>{try{document.querySelectorAll("g[data-iw-wrapper].is-rotating").forEach(t=>{try{t.classList.remove("is-rotating")}catch{}})}catch{}}),document.addEventListener("pointercancel",()=>{try{document.querySelectorAll("g[data-iw-wrapper].is-rotating").forEach(t=>{try{t.classList.remove("is-rotating")}catch{}})}catch{}}),(function(){const e=document.getElementById("imagesPanel");if(!e)return;if(!he){const c=document.createElement("div");c.className="images-locked-message",c.textContent="Image replacement is disabled for this template.",c.style.padding="16px",c.style.textAlign="center",c.style.color="#4b5563";const p=e.querySelector(".images-body");p&&(p.innerHTML="",p.appendChild(c)),e.querySelectorAll("button, input").forEach(g=>{g.disabled=!0,g.setAttribute("aria-disabled","true")});return}const r=e.querySelectorAll(".images-tab"),a=document.getElementById("imagesFileInput"),n=document.getElementById("btnUploadFiles"),i=document.getElementById("recentUploads"),o="__iw_recent_images_v1";function s(c){r.forEach(p=>{const g=p.dataset.tab,x=e.querySelector(`.images-panel[data-panel="${g}"]`),S=p===c;p.classList.toggle("active",S),x&&(x.style.display=S?"":"none"),p.setAttribute("aria-selected",S?"true":"false")})}r.forEach(c=>c.addEventListener("click",p=>{p.stopPropagation(),s(c)}));function l(){try{const c=localStorage.getItem(o);if(!c)return[];const p=JSON.parse(c);return Array.isArray(p)?p:[]}catch{return[]}}function u(c){try{localStorage.setItem(o,JSON.stringify(c.slice(0,40)))}catch{}}function d(c){i&&(i.innerHTML="",(c||[]).forEach(p=>{const g=document.createElement("div");g.className="thumb-wrapper";const x=document.createElement("button");x.type="button",x.className="thumb",x.setAttribute("aria-label",p.name||"Uploaded image");const S=document.createElement("img");S.alt=p.name||"Uploaded image",S.src=p.data,x.appendChild(S),x.addEventListener("click",()=>{try{ie(C||"front",p.data)}catch(N){console.debug("applyImage failed",N)}});const A=document.createElement("button");A.type="button",A.className="thumb-delete",A.setAttribute("aria-label","Delete uploaded image"),A.innerHTML='<i class="fa-solid fa-trash-can" aria-hidden="true"></i>',A.addEventListener("click",N=>{N.stopPropagation();try{const y=(l()||[]).filter(w=>w.data!==p.data);u(y),d(y)}catch(q){console.error("Failed to delete recent image",q)}}),g.appendChild(x),g.appendChild(A),i.appendChild(g)}))}try{d(l())}catch{}function f(c){if(!c||c.length===0)return;const p=l();Array.from(c).forEach(g=>{const x=new FileReader;x.onload=S=>{const A=S.target&&S.target.result;if(!A)return;p.unshift({name:g.name||"",type:g.type||"",data:A});const N=[],q=new Set;for(const y of p)q.has(y.data)||(N.push(y),q.add(y.data));u(N),d(N)};try{x.readAsDataURL(g)}catch(S){console.error("readFile failed",S)}})}n&&a&&n.addEventListener("click",c=>{c.preventDefault(),a.click()}),a&&a.addEventListener("change",c=>{const p=a.files;f(p);try{a.value=""}catch{}});try{let y=function(O,mt=!1){if(g){if(mt||(g.innerHTML=""),!O||O.length===0){const M=document.createElement("div");M.className="discover-empty",M.textContent="No results",g.appendChild(M);return}O.forEach(M=>{const Y=document.createElement("button");Y.type="button",Y.className="thumb",Y.style.padding="0",Y.style.border="none",Y.style.background="transparent";const ft=document.createElement("img");ft.alt=M.alt_description||M.description||"Result image",ft.src=M.urls&&(M.urls.small||M.urls.thumb)||"",ft.style.width="100%",ft.style.height="auto",ft.loading="lazy",Y.appendChild(ft),Y.addEventListener("click",()=>{try{ie(C||"front",M.urls&&M.urls.full||M.urls&&M.urls.regular||M.urls&&M.urls.small)}catch(kt){console.debug("applyImage failed",kt)}}),g.appendChild(Y)})}},Lt=function(){try{w&&(w.style.display="",w.setAttribute("aria-hidden","false"))}catch{}},k=function(){try{w&&(w.style.display="none",w.setAttribute("aria-hidden","true"))}catch{}};const c=e.querySelector("#discoverSearchInput"),p=e.querySelector("#discoverSearchBtn"),g=e.querySelector("#discoverResults"),x="iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs";let S=null,A="",N=1,q=1;const w=e.querySelector("#discoverSpinner");async function Mt(O,mt=1,M=!1){if(!O||!O.trim()){y([]);return}A=O,N=Number(mt)||1;try{Lt();const Y=18,ft=`https://api.unsplash.com/search/photos?query=${encodeURIComponent(O)}&per_page=${Y}&page=${N}`,kt=await fetch(ft,{headers:{Authorization:`Client-ID ${x}`}});if(!kt.ok)throw new Error("Unsplash fetch failed "+kt.status);const ye=await kt.json(),Ne=ye.results||[],pt=Number(ye.total||0);q=Math.ceil(pt/Y)||1,y(Ne,M),k()}catch(Y){console.warn("Discover search failed",Y),k(),y([])}}p&&c&&(p.addEventListener("click",O=>{O.preventDefault(),Mt(c.value,1,!1)}),c.addEventListener("keydown",O=>{O.key==="Enter"&&(O.preventDefault(),Mt(c.value,1,!1))}),c.addEventListener("input",O=>{clearTimeout(S),S=setTimeout(()=>{Mt(c.value,1,!1)},450)}),(function(){if(!g)return;let mt=!1,M=0;g.addEventListener("scroll",Y=>{const ft=Date.now();if(ft-M<200||(M=ft,mt))return;const kt=Y.target,ye=kt.scrollTop,Ne=kt.clientHeight,pt=kt.scrollHeight;if((ye+Ne)/Math.max(1,pt)>=.6){if(!A||N>=q)return;mt=!0,N+=1,Mt(A,N,!0).then(()=>{mt=!1}).catch(()=>{mt=!1})}})})())}catch{}})(),Oa()});var Nr={exports:{}},He={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var va;function un(){if(va)return He;va=1;var z=Ea(),V=Symbol.for("react.element"),Ct=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,U=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gt={key:!0,ref:!0,__self:!0,__source:!0};function xt(jt,et,K){var ct,It={},Vt=null,yt=null;K!==void 0&&(Vt=""+K),et.key!==void 0&&(Vt=""+et.key),et.ref!==void 0&&(yt=et.ref);for(ct in et)j.call(et,ct)&&!gt.hasOwnProperty(ct)&&(It[ct]=et[ct]);if(jt&&jt.defaultProps)for(ct in et=jt.defaultProps,et)It[ct]===void 0&&(It[ct]=et[ct]);return{$$typeof:V,type:jt,key:Vt,ref:yt,props:It,_owner:U.current}}return He.Fragment=Ct,He.jsx=xt,He.jsxs=xt,He}var xa;function dn(){return xa||(xa=1,Nr.exports=un()),Nr.exports}var h=dn(),se=Ea();const xn=cn(se);var sr={},Aa;function fn(){if(Aa)return sr;Aa=1;var z=ln();return sr.createRoot=z.createRoot,sr.hydrateRoot=z.hydrateRoot,sr}var pn=fn();const gn=()=>{},yn=[{label:"Showcase",href:"#dashboard"},{label:"Collections",href:"#categories"},{label:"Templates",href:"#templates"},{label:"About",href:"#about"},{label:"Contact",href:"#contact"}],hn=(z=[])=>Array.isArray(z)?z.filter(Boolean).slice(0,7):[],Cr=({label:z,badge:V,onClick:Ct,iconClass:j,href:U,disabled:gt})=>{const xt=h.jsxs("button",{type:"button",className:"customer-icon-button","aria-label":z,onClick:gt?gn:Ct,disabled:gt,children:[h.jsx("i",{className:j,"aria-hidden":"true"}),V?h.jsx("span",{className:"notification-badge",children:V}):null]});return U&&!Ct?h.jsxs("a",{className:"customer-icon-button","aria-label":z,href:U,children:[h.jsx("i",{className:j,"aria-hidden":"true"}),V?h.jsx("span",{className:"notification-badge",children:V}):null]}):xt},mn=(z,V)=>`${z}-${V}`,wa={isAuthenticated:!1,name:"Guest",initials:"IN",profileUrl:"/customer/profile",purchaseUrl:"/customer/my-purchase",favoritesUrl:"/customer/favorites"},bn=(z={})=>{var Bt;const{navLinks:V=[],searchEndpoint:Ct="#",notificationsUrl:j="#",favoritesUrl:U="#",cartUrl:gt="/order/addtocart",orderSummaryEndpoint:xt="/order/summary.json",cartItemsEndpoint:jt="/order/cart/items",storageKey:et="inkwise-finalstep",csrfToken:K=((Bt=document.querySelector('meta[name="csrf-token"]'))==null?void 0:Bt.getAttribute("content"))??"",loginUrl:ct="/customer/login",auth:It=wa,unreadCount:Vt=0}=z,yt={...wa,...It||{}},cr=hn(V.length?V:yn),[At,Ce]=se.useState(!1),[Ie,Ht]=se.useState(!1),[he,Fe]=se.useState(!1),[Q,lt]=se.useState(()=>Math.floor(Math.random()*360));se.useEffect(()=>{const E=window.setInterval(()=>{lt(W=>(W+17)%360)},4e3);return()=>window.clearInterval(E)},[]),se.useEffect(()=>(document.body.classList.toggle("customer-nav-open",At),()=>document.body.classList.remove("customer-nav-open")),[At]),se.useEffect(()=>{const E=W=>{W.target.closest(".customer-topbar")||(Fe(!1),Ht(!1))};return document.addEventListener("click",E),()=>document.removeEventListener("click",E)},[]);const it=async()=>{try{return(await fetch(xt,{method:"GET",headers:{Accept:"application/json"},credentials:"same-origin"})).ok}catch(E){return console.warn("[InkWise] Unable to reach order summary",E),!1}},Ft=async E=>{if(!E)return!1;const W=E.productId??E.product_id,Ot=Number(E.quantity??10);if(!W)return!1;try{return(await fetch(jt,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...K?{"X-CSRF-TOKEN":K}:{}},credentials:"same-origin",body:JSON.stringify({product_id:Number(W),quantity:Ot})})).ok}catch(Gt){return console.warn("[InkWise] Unable to create order from summary",Gt),!1}},_t=()=>{window.requestAnimationFrame(()=>{const E=document.querySelector('.customer-topbar__search-panel input[type="text"]');E==null||E.focus()})},Oe=async E=>{E.preventDefault();try{if(await it()){window.location.href=gt;return}let W=null;try{const Ot=window.sessionStorage.getItem(et);W=Ot?JSON.parse(Ot):null}catch{W=null}if(W&&(W.productId||W.product_id)&&await Ft(W)){window.location.href=gt;return}window.location.href=gt}catch(W){console.warn("[InkWise] Cart shortcut failed",W),window.location.href="/order/summary"}},me=E=>{E.preventDefault(),window.location.href=U},Ue=E=>{E.preventDefault(),window.location.href=j},Ke=()=>{const E=document.getElementById("customerLogoutForm");E&&E.submit()},We=yt.isAuthenticated?h.jsxs("button",{className:"customer-pill",onClick:()=>Fe(E=>!E),"aria-expanded":he,children:[h.jsx("span",{className:"customer-avatar","aria-hidden":"true",children:h.jsx("span",{children:yt.initials})}),h.jsx("span",{className:"customer-pill__label",children:yt.name}),h.jsx("i",{className:"fi fi-br-angle-small-down","aria-hidden":"true"})]}):h.jsxs("a",{className:"customer-pill",href:ct,children:[h.jsx("span",{className:"customer-pill__label",children:"Sign in"}),h.jsx("i",{className:"fi fi-br-enter","aria-hidden":"true"})]}),be=yt.isAuthenticated?h.jsxs("div",{className:`customer-dropdown ${he?"is-open":""}`,role:"menu",children:[h.jsx("a",{href:yt.profileUrl,role:"menuitem",children:"My Account"}),h.jsx("a",{href:yt.purchaseUrl,role:"menuitem",children:"My Purchase"}),h.jsx("a",{href:yt.favoritesUrl,role:"menuitem",children:"My Favorites"}),h.jsx("button",{type:"button",role:"menuitem",onClick:Ke,children:"Logout"})]}):null,Xe={"--customer-accent-hue":Q};return h.jsxs("header",{className:`customer-topbar ${At?"is-open":""}`,style:Xe,children:[h.jsx("div",{className:"customer-topbar__glow","aria-hidden":"true"}),h.jsx("div",{className:"customer-topbar__trail","aria-hidden":"true"}),h.jsxs("div",{className:"customer-topbar__inner",children:[h.jsxs("div",{className:"customer-topbar__brand",children:[h.jsx("span",{className:"brandmark__initial",children:"I"}),h.jsxs("div",{className:"brandmark__wordmark",children:[h.jsx("span",{className:"brandmark__word",children:"nkwise"}),h.jsx("span",{className:"brandmark__tagline",children:"Elegant invites & thoughtful giveaways"})]})]}),h.jsx("nav",{className:"customer-topbar__nav","aria-label":"Primary",children:cr.map(({label:E,href:W})=>h.jsx("a",{href:W,onClick:()=>Ce(!1),children:h.jsx("span",{children:E})},mn(E,W)))}),h.jsxs("div",{className:"customer-topbar__actions",children:[h.jsx("button",{className:"customer-icon-button customer-icon-button--ghost","aria-label":"Search",onClick:()=>{Ht(E=>!E),setTimeout(_t,150)},children:h.jsx("i",{className:"fi fi-br-search","aria-hidden":"true"})}),h.jsx(Cr,{label:"Notifications",badge:Vt>0?Vt:null,iconClass:"fi fi-br-bell",onClick:Ue}),h.jsx(Cr,{label:"Favorites",iconClass:"fi fi-br-comment-heart",onClick:me}),h.jsx(Cr,{label:"Cart",iconClass:"bi bi-bag-heart-fill",onClick:Oe}),We,h.jsxs("button",{className:"customer-topbar__toggle","aria-label":"Toggle navigation","aria-expanded":At,onClick:()=>Ce(E=>!E),children:[h.jsx("span",{}),h.jsx("span",{}),h.jsx("span",{})]})]}),be]}),h.jsx("div",{className:`customer-topbar__search-panel ${Ie?"is-open":""}`,children:h.jsxs("form",{action:Ct,method:"GET",children:[h.jsx("label",{htmlFor:"customerTopbarSearch",className:"sr-only",children:"Search templates"}),h.jsx("input",{id:"customerTopbarSearch",type:"text",name:"query",placeholder:"Search dreamy templates, giveaways, names..."}),h.jsx("button",{type:"submit",children:"Search"}),h.jsx("button",{type:"button",className:"customer-topbar__close",onClick:()=>Ht(!1),children:h.jsx("i",{className:"fi fi-br-cross-small","aria-hidden":"true"})})]})})]})},Sa=()=>{const z=document.getElementById("customer-topbar-root");if(z)try{const V=z.getAttribute("data-props")??"{}",Ct=JSON.parse(V);pn.createRoot(z).render(h.jsx(bn,{...Ct}))}catch(V){console.error("[InkWise] Failed to mount customer topbar",V)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Sa,{once:!0}):Sa();export{xn as R,pn as c,h as j,se as r};
