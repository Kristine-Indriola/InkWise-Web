import{r as $,j as n,c as Ji,R as Zi}from"./client-Cv0X-2PX.js";const Fa="http://www.w3.org/2000/svg",Pr="http://www.w3.org/1999/xlink";class ja{constructor(o,l={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",o),this.svg=o,this.options={onImageChange:l.onImageChange||null,onTextChange:l.onTextChange||null,...l};const f=document&&document.body&&document.body.dataset?document.body.dataset:{},m=(f.imageReplacementMode||"").toLowerCase();let x="full";m==="panel-only"||m==="disabled"?x=m:f.allowImageReplacement==="false"&&(x="disabled"),this.imageReplacementMode=x,this.allowCanvasImageTools=x!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const o=this.svg.dataset.svgData;if(o)try{const l=JSON.parse(o);this.changeableImages=l.changeable_images||[],this.textElements=l.text_elements||[]}catch(l){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",l)}}readDatasetTokens(o){return!o||!o.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(f=>o.dataset[f]).filter(f=>typeof f=="string"&&f.trim()!=="").map(f=>f.trim().toLowerCase())}findImageContentNode(o){return!o||typeof o.querySelector!="function"?null:o.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(o){if(!o)return!1;const l=typeof o.tagName=="string"?o.tagName.toLowerCase():"";if(l==="image"||l==="img"||this.readDatasetTokens(o).some(m=>m==="image"||m==="photo"||m==="graphic")||typeof o.hasAttribute=="function"&&(o.hasAttribute("data-editable-image")||o.hasAttribute("data-changeable-image")))return!0;if(o.classList){for(const m of this.imageClassTokens)if(o.classList.contains(m))return!0}return l==="foreignobject"?!!this.findImageContentNode(o):!1}resolveImageNode(o){if(!o)return null;if(this.nodeRepresentsImage(o))return o;if(typeof o.closest=="function"){const l=o.closest("[data-preview-node]");if(l&&l!==o&&this.nodeRepresentsImage(l))return l}return this.findImageContentNode(o)}resolveImageHandleNodes(o){const l=this.resolveImageNode(o);return l?{interactionNode:typeof l.closest=="function"&&l.closest("foreignObject")||l,contentNode:l}:null}applyImageSourceToNode(o,l){if(!o||!l)return null;const f=typeof o.tagName=="string"?o.tagName.toLowerCase():"";if(f==="image")return o.setAttributeNS(Pr,"href",l),o.setAttribute("href",l),o.dataset&&(o.dataset.src=l),o;if(f==="img")return o.setAttribute("src",l),o.dataset&&(o.dataset.src=l),o;if(f==="foreignobject"){const m=this.findImageContentNode(o);return m&&m!==o?this.applyImageSourceToNode(m,l):null}return f==="rect"?this.convertRectToImage(o,l):(o.style&&typeof o.style.setProperty=="function"&&(o.style.backgroundImage=`url('${l}')`),o.dataset&&(o.dataset.src=l,o.dataset.replacedImage="true"),o)}convertRectToImage(o,l){if(!o||!o.parentNode)return null;const f=document.createElementNS(Fa,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(x=>{o.hasAttribute&&o.hasAttribute(x)&&f.setAttribute(x,o.getAttribute(x))}),Array.from(o.attributes||[]).forEach(x=>{(x.name==="id"||x.name.startsWith("data-"))&&f.setAttribute(x.name,x.value)}),o.classList&&o.classList.length&&o.classList.forEach(x=>f.classList.add(x)),f.setAttribute("href",l),f.setAttributeNS(Pr,"href",l),f.hasAttribute("preserveAspectRatio")||f.setAttribute("preserveAspectRatio","xMidYMid slice"),o.parentNode.replaceChild(f,o),f}escapeSelector(o){return typeof o!="string"||!o.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(o):o.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(o){if(!o||typeof o!="object")return null;const l=o.id||o.element_id||o.node_id;if(l){const m=`#${this.escapeSelector(l)}`,x=this.svg.querySelector(m);if(x)return x}const f=o.selector||o.css_selector;if(f)try{const m=this.svg.querySelector(f);if(m)return m}catch(m){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",f,m)}return null}collectImageCandidates(){const o=new Set;return this.changeableImages.forEach(f=>{const m=this.resolveNodeFromMetadata(f);m&&o.add(m)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(f=>{o.add(f)}),Array.from(o)}getBBoxSafe(o){if(!o||typeof o.getBBox!="function")return null;try{return o.getBBox()}catch(l){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",l,o),null}}toSvgPoint(o,l){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const f=this.svg.createSVGPoint();f.x=o,f.y=l;const m=this.svg.getScreenCTM();return m?f.matrixTransform(m.inverse()):null}setupImageHandlers(){const o=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",o.length,"changeable image elements"),!this.allowCanvasImageTools){o.forEach(l=>{const f=this.resolveImageHandleNodes(l);if(!f)return;const{interactionNode:m}=f;if(m.style.cursor="default",m.classList.remove("svg-changeable-image"),m.classList.remove("changeable-image-hover"),m._boundingBox){try{m._boundingBox.remove()}catch{}m._boundingBox=null}});return}setTimeout(()=>{o.forEach((l,f)=>{const m=this.resolveImageHandleNodes(l);if(!m)return;const{interactionNode:x,contentNode:M}=m;if(!x||x.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",f,x),x.__inkwiseSvgImageBound=!0,x.__inkwiseImageContent=M||x,x.style.cursor="pointer",x.classList.add("svg-changeable-image"),x.classList.add("changeable-image-hover"),x.addEventListener("mouseenter",()=>{x.classList.add("changeable-image-active")}),x.addEventListener("mouseleave",()=>{x.classList.remove("changeable-image-active")}),x.addEventListener("click",B=>{B.preventDefault(),this.showImageUploadDialog(x)});const L=this.createBoundingBox(x);L&&(x._boundingBox=L),this.makeDraggable(x)})},200)}createBoundingBox(o){const l=this.getBBoxSafe(o);if(!l)return null;const f=document.createElementNS(Fa,"g");f.classList.add("svg-bounding-box");const m=document.createElementNS(Fa,"rect");return m.classList.add("svg-bounding-box__rect"),m.setAttribute("fill","none"),m.setAttribute("stroke","#007cba"),m.setAttribute("stroke-width","2"),m.setAttribute("stroke-dasharray","5,5"),m.setAttribute("rx","3"),m.style.pointerEvents="none",f.appendChild(m),this.createResizeHandles().forEach(M=>f.appendChild(M)),this.svg.appendChild(f),this.positionBoundingElements(f,l),f}createResizeHandles(){const o=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(f=>{const m=document.createElementNS(Fa,"circle");m.setAttribute("r","4"),m.setAttribute("fill","#007cba"),m.setAttribute("stroke","#ffffff"),m.setAttribute("stroke-width","1"),m.classList.add("resize-handle",`handle-${f.name}`),m.style.pointerEvents="all",m.style.cursor=`${f.name}-resize`,o.push(m)}),o}positionBoundingElements(o,l){if(!o||!l)return;const f=o.querySelector(".svg-bounding-box__rect");if(!f)return;const m=5,x=l.x-m,M=l.y-m,L=l.width+m*2,B=l.height+m*2;f.setAttribute("x",x),f.setAttribute("y",M),f.setAttribute("width",Math.max(L,0)),f.setAttribute("height",Math.max(B,0)),o.querySelectorAll(".resize-handle").forEach(I=>{I.classList.contains("handle-nw")?(I.setAttribute("cx",x),I.setAttribute("cy",M)):I.classList.contains("handle-ne")?(I.setAttribute("cx",x+L),I.setAttribute("cy",M)):I.classList.contains("handle-sw")?(I.setAttribute("cx",x),I.setAttribute("cy",M+B)):I.classList.contains("handle-se")?(I.setAttribute("cx",x+L),I.setAttribute("cy",M+B)):I.classList.contains("handle-n")?(I.setAttribute("cx",x+L/2),I.setAttribute("cy",M)):I.classList.contains("handle-s")?(I.setAttribute("cx",x+L/2),I.setAttribute("cy",M+B)):I.classList.contains("handle-e")?(I.setAttribute("cx",x+L),I.setAttribute("cy",M+B/2)):I.classList.contains("handle-w")&&(I.setAttribute("cx",x),I.setAttribute("cy",M+B/2))})}updateBoundingBox(o){if(!o||!o._boundingBox)return;const l=this.getBBoxSafe(o);this.positionBoundingElements(o._boundingBox,l)}focusElementById(o){if(!o||!this.svg)return!1;const l=`#${this.escapeSelector(o)}`;let f=null;try{f=this.svg.querySelector(l)}catch(L){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",o,L),!1}if(f||(f=this.svg.querySelector(`[data-element-id="${o}"]`)),!f)return!1;const x=(this.resolveImageHandleNodes(f)||{interactionNode:f}).interactionNode||f;return this.getBBoxSafe(x)?(this.updateBoundingBox(x),x._boundingBox&&(x._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{x._boundingBox&&x._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof x.scrollIntoView=="function"&&x.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),x.classList.add("changeable-image-active"),setTimeout(()=>x.classList.remove("changeable-image-active"),1200),!0):!1}makeDraggable(o){let l=!1,f=0,m=0,x=0,M=0,L=0,B=0;const X=K=>{if(K.target.closest(".resize-handle"))return;const J=this.toSvgPoint(K.clientX,K.clientY);if(!J)return;const Z=this.getBBoxSafe(o);if(!Z)return;const ke=typeof o.getAttribute=="function",ue=typeof o.setAttribute=="function";f=ke?parseFloat(o.getAttribute("x")):Z.x,m=ke?parseFloat(o.getAttribute("y")):Z.y,Number.isNaN(f)&&(f=Z.x,ue&&o.setAttribute("x",f)),Number.isNaN(m)&&(m=Z.y,ue&&o.setAttribute("y",m)),x=J.x-f,M=J.y-m,L=f,B=m,l=!0,o.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",K.preventDefault()},I=K=>{if(!l)return;const J=this.toSvgPoint(K.clientX,K.clientY);J&&(L=J.x-x,B=J.y-M,typeof o.removeAttribute=="function"&&o.removeAttribute("transform"),typeof o.setAttribute=="function"&&(o.setAttribute("x",L),o.setAttribute("y",B)),this.updateBoundingBox(o),K.preventDefault())},q=K=>{if(!l)return;l=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(o);const J=new CustomEvent("svgImageMoved",{detail:{element:o,x:L,y:B}});this.svg.dispatchEvent(J),K.preventDefault()};o.addEventListener("mousedown",X),document.addEventListener("mousemove",I),document.addEventListener("mouseup",q),o._boundingBox&&o._boundingBox.querySelectorAll(".resize-handle").forEach(J=>{this.makeResizable(o,J)})}makeResizable(o,l){let f=!1,m=null,x=0,M=0,L=0,B=0,X="",I=0;const q=Z=>{const ke=this.toSvgPoint(Z.clientX,Z.clientY);if(!ke)return;const ue=this.getBBoxSafe(o);if(!ue)return;x=ue.width,M=ue.height;const H=typeof o.getAttribute=="function",ie=typeof o.setAttribute=="function";L=H?parseFloat(o.getAttribute("x")):ue.x,B=H?parseFloat(o.getAttribute("y")):ue.y,Number.isNaN(L)&&(L=ue.x,ie&&o.setAttribute("x",L)),Number.isNaN(B)&&(B=ue.y,ie&&o.setAttribute("y",B)),I=parseFloat(o.getAttribute("font-size"))||parseFloat(window.getComputedStyle(o).fontSize)||16,m=ke,X=Array.from(l.classList).find(G=>G.startsWith("handle-"))||"",f=!0,o.style.cursor=l.style.cursor,this.svg.style.cursor=l.style.cursor,document.body.style.userSelect="none",Z.preventDefault(),Z.stopPropagation()},K=Z=>{if(!f)return;const ke=this.toSvgPoint(Z.clientX,Z.clientY);if(!ke)return;const ue=ke.x-m.x,H=ke.y-m.y;let ie=x,G=M,de=L,ze=B;switch(X){case"handle-se":ie=x+ue,G=M+H;break;case"handle-sw":ie=x-ue,G=M+H,de=L+ue;break;case"handle-ne":ie=x+ue,G=M-H,ze=B+H;break;case"handle-nw":ie=x-ue,G=M-H,de=L+ue,ze=B+H;break}ie=Math.max(20,ie),G=Math.max(20,G);const at=o.tagName.toLowerCase();if((at==="image"||at==="rect")&&typeof o.setAttribute=="function")o.setAttribute("width",ie),o.setAttribute("height",G),o.setAttribute("x",de),o.setAttribute("y",ze);else{const je=Math.max(1,x),At=Math.max(1,M),ct=ie/je,V=G/At,_e=Math.max(ct,V),rt=Math.max(6,I*_e);typeof o.setAttribute=="function"&&o.setAttribute("font-size",rt)}this.updateBoundingBox(o),Z.preventDefault(),Z.stopPropagation()},J=Z=>{if(!f)return;f=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const ke={element:o,width:parseFloat(o.getAttribute?o.getAttribute("width"):"")||x,height:parseFloat(o.getAttribute?o.getAttribute("height"):"")||M,x:parseFloat(o.getAttribute?o.getAttribute("x"):"")||L,y:parseFloat(o.getAttribute?o.getAttribute("y"):"")||B},ue=new CustomEvent("svgImageResized",{detail:ke});this.svg.dispatchEvent(ue),Z.preventDefault(),Z.stopPropagation()};l.addEventListener("mousedown",q),document.addEventListener("mousemove",K),document.addEventListener("mouseup",J)}setupTextHandlers(){const o=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(f=>{f.style.cursor="pointer",f.classList.add("svg-editable-text"),f.addEventListener("click",function(m){m.preventDefault(),o.showTextEditDialog(f)}),f.addEventListener("mouseenter",function(){f.classList.add("editable-text-hover")}),f.addEventListener("mouseleave",function(){f.classList.remove("editable-text-hover")})})}showImageUploadDialog(o){const l=this,f=document.createElement("input");f.type="file",f.accept="image/*",f.style.display="none",f.addEventListener("change",function(m){const x=m.target.files[0];x&&l.handleImageUpload(x,o),f.parentNode&&f.parentNode.removeChild(f)}),document.body.appendChild(f),f.click()}handleImageUpload(o,l){const f=this,m=new FileReader,x=l&&l.__inkwiseImageContent?l.__inkwiseImageContent:l;m.onload=function(M){const L=M.target.result;if(!L)return;const B=f.applyImageSourceToNode(x,L)||x;l&&B&&l.__inkwiseImageContent!==B&&(l.__inkwiseImageContent=B);const X=new CustomEvent("svgImageChanged",{detail:{element:B,imageUrl:L,file:o}});f.svg.dispatchEvent(X),f.options.onImageChange&&f.options.onImageChange(B,L,o),f.updateBoundingBox(l||B)},m.onerror=function(M){console.error("SvgTemplateEditor: Failed to read selected image file",M);const L=new CustomEvent("svgImageUploadFailed",{detail:{error:M,file:o}});f.svg.dispatchEvent(L)},m.readAsDataURL(o)}showTextEditDialog(o){const l=this,f=o.textContent||"",m=document.createElement("input");m.type="text",m.value=f,m.className="svg-text-editor";const x=o.getBoundingClientRect(),M=l.svg.getBoundingClientRect();m.style.position="absolute",m.style.left=x.left-M.left+"px",m.style.top=x.top-M.top+"px",m.style.width=Math.max(x.width,100)+"px",m.style.fontSize=window.getComputedStyle(o).fontSize,m.style.fontFamily=window.getComputedStyle(o).fontFamily,m.style.border="1px solid #007cba",m.style.padding="2px",m.style.background="white",m.style.zIndex="1000",o.style.visibility="hidden",l.svg.parentNode.appendChild(m),m.focus(),m.select();const L=function(){const B=m.value;for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(document.createTextNode(B)),o.style.visibility="visible",m.parentNode&&m.parentNode.removeChild(m);const X=new CustomEvent("svgTextChanged",{detail:{element:o,oldText:f,newText:B}});l.svg.dispatchEvent(X),l.options.onTextChange&&l.options.onTextChange(o,f,B)};m.addEventListener("blur",L),m.addEventListener("keydown",function(B){B.key==="Enter"?L():B.key==="Escape"&&(o.style.visibility="visible",m.parentNode&&m.parentNode.removeChild(m))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const o=document.createElement("style");o.id="svg-editor-styles",o.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(o)}getSvgString(){var M;const o=(M=this.svg.closest(".preview-card-bg"))==null?void 0:M.querySelector(".canvas-overlay-layer"),l=(o==null?void 0:o.style.display)!=="none";o&&l&&(o.style.display="none");const f=this.svg.querySelectorAll(".svg-bounding-box"),m=[];f.forEach(L=>{L.parentNode&&(m.push({element:L,parent:L.parentNode}),L.parentNode.removeChild(L))});const x=new XMLSerializer().serializeToString(this.svg);return m.forEach(({element:L,parent:B})=>{B&&B.appendChild(L)}),o&&l&&(o.style.display=""),x}getSvgDataUrl(){const o=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o)))}async saveSvg(o,l="front"){const f=this.getSvgString();try{const m=await fetch(`/staff/templates/${o}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:f,side:l})});if(!m.ok){const M=await m.text().catch(()=>"");throw new Error(M||`Request failed with status ${m.status}`)}let x;try{x=await m.json()}catch(M){console.warn("SvgTemplateEditor: Failed to parse save response",M),x={success:!1,error:"Invalid response from server"}}return x}catch(m){return console.error("Failed to save SVG:",m),{success:!1,error:m.message}}}}function Qi(){const be=()=>{const o=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",o.length,"SVGs with data-svg-editor attribute"),o.forEach((l,f)=>{l.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",f,"for SVG:",l),l.__inkwiseSvgTemplateEditor=new ja(l))})};if(document.readyState==="complete"||document.readyState==="interactive"?be():document.addEventListener("DOMContentLoaded",be,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const o=new MutationObserver(l=>{l.forEach(f=>{f.addedNodes.forEach(m=>{m.nodeType===1&&m.matches&&m.matches("svg[data-svg-editor]")&&(m.__inkwiseSvgTemplateEditor||(m.__inkwiseSvgTemplateEditor=new ja(m)))})})});o.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=o}}typeof window<"u"&&(window.SvgTemplateEditor=ja,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,Qi()));function es(be={}){const{collectSnapshot:o,routes:l={},statusLabel:f=null,statusDot:m=null,csrfToken:x=null,debounce:M=1200,onAfterSave:L=null}=be;if(typeof o!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let B=null,X=null,I=null,q=null;const K=(H,ie={})=>{if(m instanceof HTMLElement&&m.setAttribute("data-state",H),f instanceof HTMLElement)switch(H){case"saving":f.textContent="Saving…";break;case"dirty":f.textContent="Unsaved changes";break;case"error":f.textContent="Save failed";break;case"saved":{const de=(ie.timestamp instanceof Date?ie.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});f.textContent=`Saved ${de}`;break}default:f.textContent="Saved";break}},J=async H=>{const ie=l.autosave;if(!ie)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const G=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...x?{"X-CSRF-TOKEN":x}:{}},credentials:"same-origin",body:JSON.stringify(H)});if(!G.ok){const de=new Error(`Autosave responded with ${G.status}`);throw de.status=G.status,de.responseText=await G.text().catch(()=>null),de}try{return await G.json()}catch{return{}}},Z=async H=>{if(console.log("[Autosave] Saving",H),I)try{await I}catch{}X=null,K("saving");let ie;try{ie=await o(H)}catch(G){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",G),K("error"),G}if(!ie||typeof ie!="object")return K("saved",{timestamp:new Date}),null;I=J(ie);try{const G=await I;if(q=new Date,K("saved",{timestamp:q}),typeof L=="function")try{L(G,ie)}catch(de){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",de)}return G}catch(G){throw console.error("[InkWise Studio] Autosave request failed.",G),K("error"),G}finally{I=null}};return{schedule:(H="change")=>{console.log("[Autosave] Scheduling",H),X=H,B&&clearTimeout(B),K("dirty"),B=window.setTimeout(()=>{B=null,Z(X).catch(()=>{})},Math.max(250,M))},flush:async(H="flush")=>(B&&(clearTimeout(B),B=null),I&&await I,X!==null?Z(H):null),isSaving:()=>!!I,getLastSavedAt:()=>q,notifyError:()=>K("error"),markDirty:()=>K("dirty")}}function ts(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const be=()=>{var xr,wr,Sr;const o=document.querySelectorAll("[data-preview-target]"),l=document.querySelector(".preview-card-bg"),f=document.getElementById("preview-svg"),m=document.querySelectorAll("[data-card-thumb]"),x=document.querySelectorAll("[data-card-view]"),M=document.getElementById("extraPreviewContainer"),L=document.getElementById("textFieldList"),B=document.querySelector("[data-add-text-field]"),X=document.querySelectorAll(".sidenav-btn"),I=document.querySelector(".canvas-stage"),q="http://www.w3.org/2000/svg",K=document.querySelector(".canvas-measure-horizontal .measure-value"),J=document.querySelector(".canvas-measure-vertical .measure-value"),Z=document.querySelector(".preview-canvas-wrapper");let ke=1;const ue=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),H=e=>!e||!e.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(a=>e.dataset[a]).filter(a=>typeof a=="string"&&a.trim()!=="").map(a=>a.trim().toLowerCase()),ie=e=>!e||typeof e.querySelector!="function"?null:e.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image'),G=e=>{if(!e)return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="image"||t==="img"||H(e).some(r=>r==="image"||r==="photo"||r==="graphic")||typeof e.hasAttribute=="function"&&(e.hasAttribute("data-editable-image")||e.hasAttribute("data-changeable-image")))return!0;if(e.classList){for(const r of ue)if(e.classList.contains(r))return!0}return!!(t==="foreignobject"&&ie(e))},de=e=>{if(!e||G(e))return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="style"||t==="script"||t==="defs"||t==="title"||t==="metadata")return!1;if(t==="text"||t==="tspan"||H(e).some(s=>s.includes("text")||s==="names"||s==="heading"))return!0;const r=(e.textContent||"").trim();return!(!r||/\{[^}]*\}|;/.test(r)&&r.length>80)},ze=e=>{if(!e)return"";const t=e.querySelectorAll("tspan");return t&&t.length>0?xe(Array.from(t).map(a=>a.textContent||"").join(`
`)):xe(e.textContent||"")},at=(e,t)=>{if(!e)return;const a=xe(t),r=e.querySelectorAll("tspan");if(r&&r.length>0){const i=String(a??"").split(/\r?\n/);r.forEach((s,c)=>{s.textContent=i[c]??""})}else e.textContent=a??"";e.dataset&&(e.dataset.currentText=a??"")},je=e=>{if(!e)return null;if(G(e))return e;if(typeof e.closest=="function"){const a=e.closest("[data-preview-node]");if(a&&a!==e&&G(a))return a}const t=ie(e);return t||null},At=(e,t)=>{if(!e||!t)return!1;const a=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(a==="image")return e.setAttributeNS("http://www.w3.org/1999/xlink","href",t),e.setAttribute("href",t),e.dataset.src=t,!0;if(a==="img")return e.setAttribute("src",t),e.dataset.src=t,!0;if(a==="foreignobject"){const r=ie(e);return r&&r!==e?At(r,t):!1}return e.style&&(e.style.backgroundImage=`url('${t}')`),e.dataset&&(e.dataset.src=t,e.dataset.replacedImage="true"),!0},ct=e=>{if(!e||typeof e.insertBefore!="function"||e.querySelector('[data-inkwise-bg="true"]'))return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("fill","#ffffff"),a.setAttribute("data-inkwise-bg","true"),e.insertBefore(a,e.firstChild)},V=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{};console.log("[InkWise Studio] Bootstrap payload:",V);const _e=(V==null?void 0:V.routes)??{};console.log("[InkWise Studio] Routes:",_e);const rt=((xr=document.querySelector('meta[name="csrf-token"]'))==null?void 0:xr.getAttribute("content"))||((wr=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:wr.getAttribute("content"))||null,oa=document.querySelector(".topbar-status-label"),pt=document.querySelector(".topbar-status-dot"),mt=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},Et=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},Gt=e=>{var s,c;if(!l)return null;const t=window.getComputedStyle(l),r=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(r&&r[2])return r[2];const i=e?`${e}Image`:null;return i&&((s=l.dataset)!=null&&s[i])?l.dataset[i]:((c=l.dataset)==null?void 0:c.frontImage)||null},It=e=>{!e||!Y||(e.texts&&Array.isArray(e.texts)&&e.texts.forEach(t=>{const{key:a,value:r,fontFamily:i,fontSize:s,color:c}=t,d=Y.querySelector(`[data-preview-node="${a}"]`);if(d){if(r!==void 0){at(d,r);const u=document.querySelector(`input[data-preview-target="${a}"]`);u&&(u.value=r)}if(i){d.setAttribute("font-family",i),d.style.fontFamily=i;try{d.dataset.fontFamily=i}catch{}}if(s){d.setAttribute("font-size",s),d.style.fontSize=s;try{d.dataset.fontSize=s}catch{}}if(c){d.setAttribute("fill",c),d.style.fill=c;try{d.dataset.color=c}catch{}}}}),e.images&&Array.isArray(e.images)&&e.images.forEach(t=>{const{key:a,href:r,x:i,y:s,width:c,height:d}=t,u=Y.querySelector(`[data-preview-node="${a}"]`);u&&(r&&(u.setAttribute("href",r),u.setAttribute("xlink:href",r)),i!==void 0&&u.setAttribute("x",i),s!==void 0&&u.setAttribute("y",s),c!==void 0&&u.setAttribute("width",c),d!==void 0&&u.setAttribute("height",d))}))},la=()=>L?Array.from(L.querySelectorAll("input[data-preview-target]")).map(e=>{var u,S;const t=e.closest(".text-field-item"),a=((S=(u=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:u.textContent)==null?void 0:S.trim())||e.dataset.previewTarget||"",r=e.dataset.previewTarget||"",i=Y==null?void 0:Y.querySelector(`[data-preview-node="${r}"]`);let s=null,c=null,d=null;return i&&(s=i.getAttribute("font-family")||i.style.fontFamily||i.dataset.fontFamily,c=i.getAttribute("font-size")||i.style.fontSize||i.dataset.fontSize,d=i.getAttribute("fill")||i.style.fill||i.dataset.color),{key:r,label:a,value:e.value||"",defaultValue:e.dataset.defaultValue||"",fontFamily:s,fontSize:c,color:d}}):[],it=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const a=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return a?parseFloat(a[0]):Number.NaN}return Number.NaN},Lt=e=>{if(!e)return null;if(typeof e=="string"){const u=e.trim();if(!u)return null;try{const S=JSON.parse(u);return Lt(S)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((u,S)=>S&&typeof S=="object"?Object.assign(u,S):u,{}):Object.assign({},e),a=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,r=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,i=it(a),s=it(r);if(!Number.isFinite(i)||i<=0||!Number.isFinite(s)||s<=0)return null;const c=t.shape??t.Shape??t.canvasShape??null,d=t.unit??t.Unit??t.canvasUnit??null;return{width:i,height:s,shape:typeof c=="string"&&c.trim()!==""?c.trim():null,unit:typeof d=="string"&&d.trim()!==""?d.trim():"px"}},qe=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},ca=Lt(Z==null?void 0:Z.dataset);let P=Lt(((Sr=V==null?void 0:V.template)==null?void 0:Sr.canvas)??null)||ca||null;const Se=720,Tt=920,Ft=new Map;let Be=null;const Ee=new Map,Ye=new Map;let jt=null,ye=null,Y=null,da=null,_t=()=>{},Ue="front",Ke=null,Je=null,w=null,ht=null,he=null,ve=null,De=!1,He=null;const ua=8,Xt=4,xe=e=>{const a=(e||"").toString().trim();return/::before|\{[^}]*\}|;/.test(a)&&a.length>120?"":a},Yt=e=>{if(!e||e==="front"||e!=="back")return!0;if(!l)return!1;if(Je)return!0;const t=l.dataset||{};return t.hasBack==="true"?!0:!!(t.backImage||t.backSvg)},gt=()=>{var T;if(!l)return null;const e=new Date,t=Ue||"front",a=Y;let r=null;if(a)try{r=new XMLSerializer().serializeToString(a),r&&!/xmlns=/i.test(r)&&(r=r.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(h){console.warn("[InkWise Studio] Unable to serialize current SVG.",h),r=null}const i=r?Et(r):Gt(t),s=la(),c=s.filter(h=>{const b=(h.value||"").trim(),C=(h.defaultValue||"").trim();return b===""||C!==""&&b===C}).map(h=>h.label||h.key).map(h=>(h||"").trim()).filter((h,b,C)=>h!==""&&C.indexOf(h)===b),d=[];if(a){const h=new Set;a.querySelectorAll('image,img,[data-changeable="image"]').forEach(b=>{const C=b.getAttribute("href")||b.getAttribute("xlink:href")||b.getAttributeNS("http://www.w3.org/1999/xlink","href")||b.getAttribute("data-src");if(!C)return;const g=b.getAttribute("data-preview-node")||b.id||`image-${d.length+1}`;h.has(g)||(h.add(g),d.push({key:g,href:C,x:b.getAttribute("x")||null,y:b.getAttribute("y")||null,width:b.getAttribute("width")||null,height:b.getAttribute("height")||null}))})}const u=l?{width:mt(l.dataset.canvasWidth),height:mt(l.dataset.canvasHeight),unit:l.dataset.canvasUnit||null,shape:l.dataset.canvasShape||null}:null,S=i?[i]:[];return{design:{updated_at:e.toISOString(),sides:{[t]:{svg:r,preview:i}},texts:s,images:d,canvas:u,placeholders:c},preview:{image:i,images:S},placeholders:c,product_id:((T=V==null?void 0:V.product)==null?void 0:T.id)??null}},Le=(e={},t={})=>{var u,S;const a=e&&e.summary?e.summary:{},r=Array.isArray(a.previewImages)?a.previewImages.filter(Boolean):Array.isArray(a.preview_images)?a.preview_images.filter(Boolean):[],i=Array.isArray((u=t==null?void 0:t.preview)==null?void 0:u.images)?t.preview.images.filter(Boolean):[],s=r.length?r:i,c=a.previewImage||a.preview_image||a.preview||((S=t==null?void 0:t.preview)==null?void 0:S.image)||s[0]||null;if(!c&&!s.length)return;const d={templateName:a.productName||a.templateName||document.title||"Saved template",previewImage:c||"",previewImages:s.length?s:c?[c]:[],metadata:{template:{name:a.productName||a.templateName||"Saved template"}}};try{window.sessionStorage.setItem("inkwise-finalstep",JSON.stringify(d))}catch{}try{const T={id:null,name:d.templateName,preview:d.previewImage};window.sessionStorage.setItem("inkwise-saved-template",JSON.stringify(T)),window.savedCustomerTemplate=T}catch{}},Kt=(...e)=>{const t=gt(...e);try{Le({},t)}catch{}return t};try{w=es({collectSnapshot:Kt,routes:_e,csrfToken:rt,statusLabel:oa,statusDot:pt,debounce:0,onAfterSave:(r,i)=>{try{Le(r,i)}catch{}}}),console.log("[InkWise Studio] Autosave initialized",w);const e=r=>{if(w)try{w.flush(r)}catch(i){console.debug("[InkWise Studio] Autosave flush skipped.",i)}},t=()=>{document.visibilityState==="hidden"&&e("visibility-hidden")},a=()=>{e("page-hide")};document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",a),window.addEventListener("beforeunload",a),ht=window.setInterval(()=>{e("heartbeat")},6e4),window.addEventListener("unload",()=>{ht&&(window.clearInterval(ht),ht=null),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",a),window.removeEventListener("beforeunload",a)}),setInterval(()=>{w&&(console.log("[InkWise Studio] Periodic autosave trigger"),w.schedule("periodic"))},1e4)}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),w=null}const Jt=async()=>{var h,b,C,g,_,z,ae;const e=await gt(),t=(e==null?void 0:e.design)||{},a=t.sides||{},r=Object.keys(a)[0],i=r?a[r]:null;let s=(i==null?void 0:i.svg)||null;if(!s&&f)try{s=new XMLSerializer().serializeToString(f)}catch{s=null}if(!s){const le=((h=V==null?void 0:V.svg)==null?void 0:h.front)||((b=V==null?void 0:V.svg)==null?void 0:b.back)||null;le&&(s=le)}const c=(i==null?void 0:i.preview)||((C=e==null?void 0:e.preview)==null?void 0:C.image)||Gt(r||"front"),d=t.canvas||{},u=d.width??(l?mt(l.dataset.canvasWidth):null),S=d.height??(l?mt(l.dataset.canvasHeight):null),T=(()=>{var le,re;try{if(!l)return null;const me=window.getComputedStyle(l);return(me==null?void 0:me.backgroundColor)||((le=l.dataset)==null?void 0:le.backgroundColor)||((re=l.style)==null?void 0:re.backgroundColor)||null}catch{return null}})();return{design_svg:s,design_json:t,preview_image:c,canvas_width:u,canvas_height:S,background_color:T,template_id:((g=V==null?void 0:V.template)==null?void 0:g.id)??(V==null?void 0:V.template_id)??null,order_item_id:((_=V==null?void 0:V.orderSummary)==null?void 0:_.order_item_id)??((z=V==null?void 0:V.orderSummary)==null?void 0:z.orderItemId)??((ae=V==null?void 0:V.orderSummary)==null?void 0:ae.item_id)??null}},we=document.querySelector('[data-action="proceed-review"]');if(we){const e=we.dataset.destination||_e.review||we.getAttribute("href")||window.location.href,t=_e.saveReview||_e.reviewSave||_e.review_design||_e.reviewDesign||null;we.addEventListener("click",async a=>{if(a.preventDefault(),we.dataset.navigating==="1")return;we.dataset.navigating="1",we.disabled=!0;const r=()=>{window.location.href=e},i=()=>{we.disabled=!1,we.dataset.navigating="0"};try{w&&await w.flush("navigate");const s=await Jt();if(!s.template_id)throw new Error("Missing template identifier.");if(!s.design_svg)throw new Error("Missing design SVG content.");if(!t)throw new Error("Save endpoint unavailable.");const c={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};rt&&(c["X-CSRF-TOKEN"]=rt);const d=await fetch(t,{method:"POST",headers:c,credentials:"same-origin",body:JSON.stringify(s)});if(!d.ok){const u=await d.text().catch(()=>"");throw new Error(`Save failed (${d.status}): ${u}`)}r()}catch(s){console.error("[InkWise Studio] Unable to save before navigating.",s),w&&w.notifyError(),alert("We could not save your latest design. Please try again before continuing."),i()}})}const We=document.getElementById("save-template-btn");We&&We.addEventListener("click",async e=>{if(e.preventDefault(),We.disabled)return;const t=prompt("Enter a name for your template:");if(!(!t||t.trim()==="")){We.disabled=!0,We.textContent="Saving…";try{w&&await w.flush("save-template");const a=await gt("save-template"),r=Object.assign({},a&&a.design?a.design:{}),i=a&&Array.isArray(a.placeholders)?a.placeholders:[];r.placeholders=i,a&&a.product_id&&(r.product_id=a.product_id);const s=a&&a.preview&&a.preview.image||null,c=a&&a.preview&&Array.isArray(a.preview.images)?a.preview.images.filter(Boolean):[],d={template_name:t.trim(),design:r,preview_image:s,preview_images:c,placeholders:i},u={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};rt&&(u["X-CSRF-TOKEN"]=rt);const S=await fetch(_e.saveTemplate,{method:"POST",headers:u,credentials:"same-origin",body:JSON.stringify(d)});if(!S.ok)throw new Error(`Server responded with ${S.status}`);const T=await S.json();alert(`Template "${T.template_name}" saved successfully!`)}catch(a){console.error("[InkWise Studio] Failed to save template.",a),alert("Failed to save template. Please try again.")}finally{We.disabled=!1,We.textContent="Save Template"}}});const yt=e=>{const t=je(e);if(!t)return;const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=r=>{const i=r.target.files&&r.target.files[0];if(!i)return;const s=new FileReader;s.onload=c=>{var S;const d=(S=c.target)==null?void 0:S.result;if(!d)return;At(t,d)&&(te(),w==null||w.schedule("image-replace"))},s.readAsDataURL(i)},a.click()},Zt=()=>l?((!Be||!Be.isConnected)&&(Be=document.createElement("div"),Be.className="canvas-overlay-layer",l.appendChild(Be)),Be):null,Mt=()=>{Ee.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),Ee.clear(),Ye.clear(),Be&&(Be.innerHTML=""),he=null,ve=null,aa(),document.body.classList.remove("text-toolbar-visible"),ra()},Ze=(e,t)=>{if(e==null)return t;const a=e.toString().split(/[\s,]+/).filter(Boolean);if(a.length===0)return t;const r=parseFloat(a[0]);return Number.isFinite(r)?r:t},st=e=>{if(!l)return;const t=Ee.get(e);if(!t||!t.overlay)return;const a=t.overlay,r=l.getBoundingClientRect(),i=e.getBoundingClientRect();if(r.width===0||r.height===0)return;const s=t.type==="text"?18:12,c=Math.max(s,i.width),d=Math.max(s,i.height);a.style.left=`${i.left-r.left}px`,a.style.top=`${i.top-r.top}px`,a.style.width=`${c}px`,a.style.height=`${d}px`},nt=()=>{Ee.forEach((e,t)=>{st(t)})},te=()=>{Ee.size!==0&&(jt&&cancelAnimationFrame(jt),jt=window.requestAnimationFrame(()=>{jt=null,nt()}))},bt=(e=3)=>{e<=0||requestAnimationFrame(()=>{te(),bt(e-1)})};window.addEventListener("resize",te),document.addEventListener("scroll",te,!0),window.addEventListener("load",te);const Bt=(e,t)=>{const a=Y||f;if(!a||typeof a.createSVGPoint!="function")return null;const r=a.createSVGPoint();r.x=e,r.y=t;const i=a.getScreenCTM();return i?r.matrixTransform(i.inverse()):null},fa=(e,t,a)=>{const r=Bt(a.clientX,a.clientY);if(!r)return null;const{node:i}=e,s=i.getBBox?i.getBBox():{x:0,y:0,width:0,height:0},c={data:e,overlay:e.overlay,node:i,type:e.type,handle:t,mode:t?"resize":"move",pointerId:a.pointerId,startPoint:r,startClient:{x:a.clientX,y:a.clientY},initialBBox:s,moved:!1};if(e.type==="text"){c.fontSize=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,c.x=Ze(i.getAttribute("x"),s.x);const d=s.y+s.height;c.y=Ze(i.getAttribute("y"),d)}else c.x=Ze(i.getAttribute("x"),s.x),c.y=Ze(i.getAttribute("y"),s.y),c.width=Ze(i.getAttribute("width"),Math.max(1,s.width)),c.height=Ze(i.getAttribute("height"),Math.max(1,s.height));return c},vt=(e,t,a)=>{if(e.type==="text"){const r=e.x+t,i=e.y+a;Number.isFinite(r)&&e.node.setAttribute("x",r),Number.isFinite(i)&&e.node.setAttribute("y",i)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+a)},pa=(e,t,a,r=!1)=>{if(e.type==="image"){let i=e.x,s=e.y,c=e.width,d=e.height;const u=["nw","ne","sw","se"].some(b=>e.handle===b),S=r||u,T=e.width/e.height;if(S&&u){const b=Math.abs(t),C=Math.abs(a);b>C?(e.handle.includes("e")?c=e.width+t:e.handle.includes("w")&&(c=e.width-t,i=e.x+t),d=c/T,e.handle.includes("n")&&(s=e.y+(e.height-d))):(e.handle.includes("s")?d=e.height+a:e.handle.includes("n")&&(d=e.height-a,s=e.y+a),c=d*T,e.handle.includes("w")&&(i=e.x+(e.width-c)))}else e.handle.includes("e")&&(c=e.width+t),e.handle.includes("w")&&(c=e.width-t,i=e.x+t),e.handle.includes("s")&&(d=e.height+a),e.handle.includes("n")&&(d=e.height-a,s=e.y+a);const h=4;c<h&&(i+=c-h,c=h),d<h&&(s+=d-h,d=h),e.node.setAttribute("x",i),e.node.setAttribute("y",s),e.node.setAttribute("width",c),e.node.setAttribute("height",d)}else if(e.type==="text"){const i=Math.max(1,e.initialBBox.width),s=Math.max(1,e.initialBBox.height);let c=0,d=0;e.handle.includes("e")?c=t:e.handle.includes("w")&&(c=-t),e.handle.includes("s")?d=a:e.handle.includes("n")&&(d=-a);const u=Math.max(4,i+c),S=Math.max(4,s+d),T=u/i,h=S/s,b=Math.max(T,h),C=Math.max(6,e.fontSize*b);e.node.setAttribute("font-size",C)}},Qt=e=>{if(!ye||e.pointerId!==ye.pointerId)return;const t=Bt(e.clientX,e.clientY);if(!t)return;const a=t.x-ye.startPoint.x,r=t.y-ye.startPoint.y;!ye.moved&&(Math.abs(a)>.5||Math.abs(r)>.5)&&(ye.moved=!0),ye.mode==="move"?vt(ye,a,r):pa(ye,a,r),te()},Rt=e=>{if(!ye||e.pointerId!==ye.pointerId)return;try{ye.overlay.releasePointerCapture(ye.pointerId)}catch{}ye.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",Qt),document.removeEventListener("pointerup",Rt),document.removeEventListener("pointercancel",Rt);const t=ye;ye=null,te(),t.moved?w==null||w.schedule("element-transform"):t.type==="text"?_t(t.data.previewKey):t.type==="image"&&yt(t.node)},ma=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t||t.dataset.cropSessionActive==="true")return;const a=Ye.get(t);if(!a)return;a.type==="text"?dt(a.previewKey||null):a.type==="image"&&ia(a.previewKey||null);const r=fa(a,e.target.dataset.handle||null,e);if(r){e.preventDefault(),ye=r,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",Qt),document.addEventListener("pointerup",Rt),document.addEventListener("pointercancel",Rt)}},Re=e=>{const t=Zt();if(!t)return null;let a=Ee.get(e);if(a)return a;const r=G(e)?"image":"text",i=e.getAttribute("data-preview-node")||"",s=document.createElement("div");return s.className=`editor-overlay editor-overlay--${r}`,s.dataset.previewNode=i,s.tabIndex=0,s.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(d=>{const u=document.createElement("div");u.className=`editor-overlay__handle editor-overlay__handle--${d}`,u.dataset.handle=d,s.appendChild(u)}),s.addEventListener("pointerdown",ma),s.addEventListener("dblclick",()=>{r==="text"?_t(i):r==="image"&&yt(e)}),s.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),r==="text"?_t(i):r==="image"&&yt(e))}),t.appendChild(s),a={overlay:s,node:e,type:r,previewKey:i},Ee.set(e,a),Ye.set(s,a),e.dataset.locked==="true"&&(s.classList.add("editor-overlay--locked"),s.style.pointerEvents="none"),aa(),te(),a},$t=(e,t,a={})=>{if(!l)return;const r=l.closest(".preview-canvas-wrapper"),i=Number(e),s=Number(t),c=a.persist===void 0?!0:!!a.persist,d=typeof a.unit=="string"&&a.unit?a.unit:(P==null?void 0:P.unit)??"px",u=typeof a.shape=="string"&&a.shape?a.shape:(P==null?void 0:P.shape)??null;if(!r||!Number.isFinite(i)||!Number.isFinite(s)||i<=0||s<=0)return;const S=Se/i,T=Tt/s,h=Math.min(1,S,T),b=Math.max(1,Math.round(i*h)),C=Math.max(1,Math.round(s*h));r.style.setProperty("--canvas-width",`${b}px`),r.style.setProperty("--canvas-height",`${C}px`),r.dataset.sourceWidth=i.toString(),r.dataset.sourceHeight=s.toString(),r.dataset.displayScale=h.toString(),r.dataset.canvasWidth=i.toString(),r.dataset.canvasHeight=s.toString(),r.dataset.canvasUnit=d,u&&(r.dataset.canvasShape=u),l.dataset.canvasWidth=i.toString(),l.dataset.canvasHeight=s.toString(),l.dataset.canvasUnit=d,u&&(l.dataset.canvasShape=u),f&&(f.setAttribute("viewBox",`0 0 ${i} ${s}`),f.setAttribute("preserveAspectRatio","xMidYMid meet")),Y&&!Y.getAttribute("viewBox")&&(Y.setAttribute("viewBox",`0 0 ${i} ${s}`),Y.setAttribute("preserveAspectRatio","xMidYMid meet")),I&&I.style.setProperty("--stage-width",`${b+112}px`),c&&(P={width:i,height:s,unit:d,shape:u}),te()},xt=(e,t,a,r=0)=>{K&&(Number.isFinite(e)?K.textContent=`${e.toFixed(r)}${a}`:K.textContent="—"),J&&(Number.isFinite(t)?J.textContent=`${t.toFixed(r)}${a}`:J.textContent="—")};P&&($t(P.width,P.height,{unit:P.unit,shape:P.shape}),xt(qe(P.width,P.unit),qe(P.height,P.unit),"in",2));const Qe=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),a=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!a)return Number.NaN;const r=parseFloat(a[1]);if(!Number.isFinite(r))return Number.NaN;const i=t.match(/([a-z%]+)$/i);switch(i?i[1].toLowerCase():""){case"":case"px":return r;case"mm":return r*(96/25.4);case"cm":return r*(96/2.54);case"in":return r*96;case"pt":return r*(96/72);default:return r}},_a=()=>!!(P&&Number.isFinite(P.width)&&P.width>0&&Number.isFinite(P.height)&&P.height>0),Ma=e=>{if(!e||_a())return;if(Ft.has(e)){const a=Ft.get(e);if(a){const r=a.unit||"px";$t(a.width,a.height,{unit:r,shape:P==null?void 0:P.shape}),xt(qe(a.width,r),qe(a.height,r),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};Ft.set(e,a),$t(a.width,a.height,{unit:a.unit,shape:P==null?void 0:P.shape}),xt(qe(a.width,a.unit),qe(a.height,a.unit),"in",2),te()},t.onerror=()=>{Ft.set(e,null)},t.src=e},ea={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},y=document.querySelectorAll("[data-modal-close]"),A=e=>{if(!e)return[];const t=new Map;let a=0;const r=(h,b,C="node")=>{let g=(h||"").toString().trim();g||(g=`${C}-${a+=1}`);let _=g,z=2;for(;t.has(_)&&t.get(_)!==b;)_=`${g}-${z}`,z+=1;return _},i=(h,b,C=null,g=null,_="node")=>{if(!h)return;const z=r(b,h,_);return h.setAttribute("data-preview-node",z),C&&!h.dataset.previewLabel&&(h.dataset.previewLabel=C),g&&!h.dataset.defaultText&&(h.dataset.defaultText=g),t.set(z,h),z};e.querySelectorAll("[data-preview-node]").forEach(h=>{var C,g;const b=h.getAttribute("data-preview-node");b&&i(h,b,((C=h.dataset)==null?void 0:C.previewLabel)||null,((g=h.dataset)==null?void 0:g.defaultText)||null,"node")});const c=[];e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(h=>{const b=h.getAttribute("data-layer-id");if(!b)return;const C=(h.getAttribute("aria-label")||b).replace(/\s+layer$/i,"")||b,g=h.querySelector(".canvas-layer__text");if(g){if(g.hasAttribute("data-preview-node")||g.setAttribute("data-preview-node",b),g.dataset.previewLabel||(g.dataset.previewLabel=C),!g.dataset.defaultText){const z=(g.textContent||"").trim();z&&(g.dataset.defaultText=z)}c.push(g)}const _=h.querySelector("img, image");if(_){const z=`${b}-image`;_.hasAttribute("data-preview-node")||_.setAttribute("data-preview-node",z),_.dataset.previewLabel||(_.dataset.previewLabel=C),c.push(_)}if(!g&&!_){if(h.hasAttribute("data-preview-node")||h.setAttribute("data-preview-node",b),h.dataset.previewLabel||(h.dataset.previewLabel=C),!h.dataset.defaultText){const z=(h.textContent||"").trim();z&&(h.dataset.defaultText=z)}c.push(h)}}),e.querySelectorAll("image, img").forEach((h,b)=>{var g;const C=h.getAttribute("data-preview-node")||`auto-image-${b+1}`;i(h,C,((g=h.dataset)==null?void 0:g.previewLabel)||null,null,"image")}),e.querySelectorAll("text, tspan").forEach((h,b)=>{var _,z;const C=(((_=h.dataset)==null?void 0:_.defaultText)||h.textContent||"").trim()||null,g=h.getAttribute("data-preview-node")||`auto-text-${b+1}`;i(h,g,((z=h.dataset)==null?void 0:z.previewLabel)||null,C,"text")}),c.length>0&&c.forEach((h,b)=>{var g,_;const C=h.getAttribute("data-preview-node")||`fallback-${b+1}`;i(h,C,((g=h.dataset)==null?void 0:g.previewLabel)||null,((_=h.dataset)==null?void 0:_.defaultText)||null,"node")});const T=[];return e.querySelectorAll("text[data-preview-node], tspan[data-preview-node]").forEach(h=>{const b=h.getAttribute("data-preview-node");if(b&&t.has(b)){const C=t.get(b);C&&!T.includes(C)&&T.push(C)}}),T.length>0?T:Array.from(t.values())},D=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const a=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);a==null||a.classList.remove("active"),t==="background"&&De&&(De=!1,ta(),ra())}},pe=()=>{Object.values(ea).forEach(e=>D(e))},Ce=e=>{const t=ea[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const a=t.querySelector('input:not([type="hidden"])');if(a==null||a.focus({preventScroll:!0}),e==="background"&&Kr(),e==="graphics"){const r=document.querySelector('.graphics-category-button[data-category="image"]');r?tr(r):($a(),Ra())}};X.length&&X.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",a=ea[t],r=a==null?void 0:a.classList.contains("is-open");pe(),X.forEach(i=>i.classList.remove("active")),r||(Ce(t),e.classList.add("active"))})}),y.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");D(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&D(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&D(t)}});const Ne=document.querySelector(".graphics-categories-labels"),k=document.getElementById("graphics-browser-samples"),Ve=document.querySelectorAll(".graphics-category-button"),Te=document.getElementById("graphics-search-form"),et=document.getElementById("graphics-search-input"),ha="53250708-d3f88461e75cb0c2c5366a181",zr={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:ha,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:ha,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},er=new Map;let Ba=0;function ya(e,t){const a=(t||"").trim();return a||e.query||e.defaultQuery||""}function Ra(){k&&(k.innerHTML="",k.dataset.category="",k.dataset.page="0",k.dataset.loading="0",k.dataset.hasMore="0",k.dataset.searchTerm="",k.dataset.requestToken="")}function $a(){if(!Ne||!k)return;Ne.querySelectorAll(".category-row").forEach(t=>{t.style.display="flex",t.dataset.expanded="0"}),Ve.forEach(t=>{t.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}),k.scrollTop=0,k.innerHTML="",k.dataset.category="",k.dataset.page="0",k.dataset.loading="0",k.dataset.hasMore="0",k.dataset.searchTerm="",k.dataset.requestToken="",Te&&(Te.classList.add("is-hidden"),Te.dataset.category=""),et&&(et.value="",et.blur())}function Pa(e){return zr[e]||null}async function tr(e){var h,b,C;const t=e.dataset.category;if(!t||!k||!Ne)return;if(e.getAttribute("aria-expanded")==="true"){$a(),Ra();return}const r=Pa(t);if(!r){console.warn(`[InkWise Studio] No graphics configuration found for category "${t}".`);return}$a();const i=er.get(t)||"",s=r.label||"",c=(C=(b=(h=e.closest(".category-row"))==null?void 0:h.querySelector(".category-label"))==null?void 0:b.textContent)==null?void 0:C.trim(),d=s||c||t,u=r.searchPlaceholder||`Search ${d.toLowerCase()}`;Te&&(Te.classList.remove("is-hidden"),Te.dataset.category=t),et&&(et.placeholder=u,et.value=i),e.setAttribute("aria-expanded","true"),e.classList.add("is-open"),Ne.querySelectorAll(".category-row").forEach(g=>{g.dataset.categoryRow===t?(g.style.display="flex",g.dataset.expanded="1"):g.style.display="none"}),k.innerHTML="",k.dataset.category=t,k.dataset.page="0",k.dataset.loading="0",k.dataset.hasMore="1",k.dataset.searchTerm=i,k.scrollTop=0;const T=String(++Ba);k.dataset.requestToken=T,ar(),await za(t,1,i,T)}function ar(){if(!k)return;const e=k.querySelector(".graphics-loading");if(e){e.style.display="flex";return}const t=document.createElement("div");t.className="graphics-loading",t.textContent="Loading assets…",k.appendChild(t)}function rr(){if(!k)return;const e=k.querySelector(".graphics-loading");e&&e.remove()}function ir(e){if(!k)return;k.innerHTML="";const t=document.createElement("div");t.className="graphics-error",t.textContent=e||"Unable to load assets at the moment.",k.appendChild(t)}function qr(e){if(!k||!Array.isArray(e))return;const t=document.createDocumentFragment();e.forEach(a=>{if(!a||!a.thumbUrl)return;const r=document.createElement("div");r.className="graphics-sample",r.title=a.alt||"Graphic sample";const i=document.createElement("img");if(i.src=a.thumbUrl,i.alt=a.alt||"Graphic sample",i.loading="lazy",r.appendChild(i),a.label){const s=document.createElement("span");s.className="sample-label",s.textContent=a.label,r.appendChild(s)}r.addEventListener("click",()=>{console.log("Selected asset",a)}),t.appendChild(r)}),rr(),k.appendChild(t)}async function za(e,t,a,r){if(!k)return;const i=Pa(e);if(!i)return;const s=k.dataset.requestToken||"",c=r||s||String(++Ba);if(!(k.dataset.loading==="1"&&c===s)){k.dataset.loading="1",ar();try{const d=typeof a=="string"?a:k.dataset.searchTerm||"",u=await Dr(i,t,d);if(k.dataset.requestToken!==c)return;if(k.dataset.loading="0",rr(),!u.length&&t===1){ir("No assets found for this category right now. Try again in a moment."),k.dataset.hasMore="0";return}qr(u),k.dataset.page=String(t);const S=i.perPage||12;k.dataset.hasMore=u.length>=S?"1":"0"}catch(d){if(console.error("[InkWise Studio] Failed to load graphics assets:",d),k.dataset.requestToken!==c)return;k.dataset.loading="0",ir("We ran into a problem loading assets. Please try again."),k.dataset.hasMore="0"}}}async function Dr(e,t,a){switch(e.provider){case"unsplash":return Or(e,t,a);case"pixabay":return Ur(e,t,a);case"flaticon":return Hr(e,t,a);case"iconify":return Wr(e,t,a);default:return console.warn("[InkWise Studio] Unknown graphics provider:",e.provider),[]}}async function Or(e,t,a){const r=e.perPage||12,i=ya(e,a),s=i?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",c=new URLSearchParams({per_page:String(r),page:String(t),client_id:e.apiKey});i&&(c.set("query",i),c.set("orientation","portrait"));const d=`${s}?${c.toString()}`,u=await fetch(d);if(!u.ok)throw new Error(`Unsplash API error: ${u.status}`);const S=await u.json();return(Array.isArray(S)?S:Array.isArray(S.results)?S.results:[]).map(h=>{const b=h.urls||{};return{id:`unsplash-${h.id}`,thumbUrl:b.small||b.thumb||b.regular||"",fullUrl:b.full||b.regular||b.raw||"",alt:h.alt_description||h.description||h.slug||"Unsplash image"}}).filter(h=>!!h.thumbUrl)}async function Ur(e,t,a){const r=e.perPage||18,i=new URLSearchParams({key:e.apiKey,q:ya(e,a),per_page:String(r),page:String(t),safesearch:"true",order:"popular"});e.imageType&&i.set("image_type",e.imageType),e.category&&i.set("category",e.category);const s=await fetch(`https://pixabay.com/api/?${i.toString()}`);if(!s.ok)throw new Error(`Pixabay API error: ${s.status}`);const c=await s.json();return(Array.isArray(c==null?void 0:c.hits)?c.hits:[]).map(u=>({id:`pixabay-${u.id}`,thumbUrl:u.previewURL||u.webformatURL||"",fullUrl:u.largeImageURL||u.webformatURL||"",alt:u.tags||"Pixabay asset",label:u.user?`@${u.user}`:null})).filter(u=>!!u.thumbUrl)}async function Hr(e,t,a){const r=e.perPage||48,i=new URLSearchParams({q:ya(e,a)||"icon",limit:String(r),page:String(t)});i.set("apikey",e.apiKey);const s=await fetch(`https://api.flaticon.com/v3/search/icons?${i.toString()}`,{headers:{Accept:"application/json",apikey:e.apiKey,Authorization:`Bearer ${e.apiKey}`}});if(!s.ok)throw new Error(`Flaticon API error: ${s.status}`);const c=await s.json();return(Array.isArray(c==null?void 0:c.data)?c.data:Array.isArray(c==null?void 0:c.icons)?c.icons:Array.isArray(c==null?void 0:c.result)?c.result:[]).map(u=>{var g;const S=(u==null?void 0:u.images)||u,T=(S==null?void 0:S.png)||{},h=(S==null?void 0:S.svg)||(S==null?void 0:S.svg)||null,b=T[128]||T[256]||h||(S==null?void 0:S["64"])||null,C=T[512]||T[256]||h||b;return b?{id:`flaticon-${(u==null?void 0:u.id)||(u==null?void 0:u.icon_id)||(u==null?void 0:u.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:b,fullUrl:C,alt:(u==null?void 0:u.description)||(Array.isArray(u==null?void 0:u.tags)?u.tags.join(", "):"Icon asset"),label:((g=u==null?void 0:u.uploader)==null?void 0:g.name)||(u==null?void 0:u.category)||null}:null}).filter(Boolean)}async function Wr(e,t,a){const r=e.perPage||36,i=Math.max(0,(t-1)*r),s=new URLSearchParams({query:ya(e,a)||"shape",limit:String(r),offset:String(i)});e.prefix&&s.set("prefix",e.prefix);const c=(e.baseUrl||"https://api.iconify.design").replace(/\/$/,""),d=await fetch(`${c}/search?${s.toString()}`,{headers:{Accept:"application/json"}});if(!d.ok)throw new Error(`Iconify API error: ${d.status}`);const u=await d.json(),S=Array.isArray(u==null?void 0:u.icons)?u.icons:[],T=Array.isArray(u==null?void 0:u.prefixes)&&u.prefixes.length===1?u.prefixes[0]:(u==null?void 0:u.prefix)||e.prefix||"";return S.map(h=>{if(typeof h=="string"){const b=h.includes(":")?h:T?`${T}:${h}`:h;if(!b)return null;const C=b.split(":").map(_=>encodeURIComponent(_)).join(":"),g=b.split(":").pop()||b;return{id:`iconify-${b.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${c}/${C}.svg?height=120&width=120`,fullUrl:`${c}/${C}.svg`,alt:g.replace(/[-_]/g," "),label:g.replace(/[-_]/g," ")}}if(h&&typeof h=="object"){const b=h.name||h.icon||h.id||"";if(!b)return null;const C=h.prefix||T,g=C?`${C}:${b}`:b,_=g.split(":").map(ae=>encodeURIComponent(ae)).join(":"),z=h.label||b;return{id:`iconify-${g.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${c}/${_}.svg?height=120&width=120`,fullUrl:`${c}/${_}.svg`,alt:z.replace(/[-_]/g," "),label:z.replace(/[-_]/g," ")}}return null}).filter(h=>!!(h!=null&&h.thumbUrl))}async function Vr(){if(!k)return;const e=k.dataset.category;if(!e||k.dataset.loading==="1"||k.dataset.hasMore==="0")return;if(k.scrollTop+k.clientHeight>=k.scrollHeight-180){const a=Number(k.dataset.page||"1")+1,r=k.dataset.searchTerm||"";await za(e,a,r)}}Ve.forEach(e=>{e.addEventListener("click",()=>tr(e))}),k&&(k.addEventListener("scroll",()=>{Vr().catch(e=>{console.error("[InkWise Studio] graphics scroll handler error:",e)})}),Ra()),Te&&et&&Te.addEventListener("submit",async e=>{if(e.preventDefault(),!k)return;const t=k.dataset.category;if(!t||!Pa(t))return;const a=et.value.trim();er.set(t,a),k.scrollTop=0,k.innerHTML="",k.dataset.page="0",k.dataset.hasMore="1",k.dataset.searchTerm=a,k.dataset.loading="0";const r=String(++Ba);k.dataset.requestToken=r;try{await za(t,1,a,r)}catch(i){console.error("[InkWise Studio] graphics search failed:",i)}}),pe(),Ce("text");const qa=document.querySelector('.sidenav-btn[data-nav="text"]');qa==null||qa.classList.add("active");const sr=e=>!e||!L?null:L.querySelector(`input[data-preview-target="${e}"]`),Gr=e=>!e||!M?null:M.querySelector(`[data-preview-node="${e}"]`),nr=(()=>{let e=!1;return()=>{if(e||typeof document>"u")return;const t=document.createElement("style");t.id="inkwise-crop-overlay-styles",t.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(t),e=!0}})(),wt=()=>{He&&(He.teardown(),He=null)},Xr=(e,t)=>{if(!e||!t)return null;nr(),getComputedStyle(e).position==="static"&&(e.style.position="relative");const a=(p,v,R)=>Math.min(Math.max(p,v),R);(()=>{if(t.dataset.cropSourceWidth&&t.dataset.cropSourceHeight)return;let p=null;try{p=t.getBBox()}catch{p=null}const v=p&&Number.isFinite(p.width)&&p.width>0?p.width:parseFloat(t.getAttribute("width"))||0,R=p&&Number.isFinite(p.height)&&p.height>0?p.height:parseFloat(t.getAttribute("height"))||0,E=p&&Number.isFinite(p.x)?p.x:parseFloat(t.getAttribute("x"))||0,se=p&&Number.isFinite(p.y)?p.y:parseFloat(t.getAttribute("y"))||0;v>0&&R>0&&(t.dataset.cropSourceWidth=v,t.dataset.cropSourceHeight=R,t.dataset.cropSourceX=E,t.dataset.cropSourceY=se)})();const i=document.createElement("div");i.className="crop-overlay";const s=(()=>{const p=typeof t.dataset.cropRect=="string"?t.dataset.cropRect:"",v=t.getAttribute("clip-path")||"",R=t.style&&typeof t.style.clipPath=="string"?t.style.clipPath:"",E=t.style&&typeof t.style.webkitClipPath=="string"?t.style.webkitClipPath:"",se=t.dataset.cropClipId||"",oe=(()=>{const Q=v.match(/^url\(#(.+)\)$/);return Q?Q[1]:""})(),ce=se||oe;let ee=null;if(ce){const Q=Ct(t.ownerSVGElement||null),O=Q==null?void 0:Q.querySelector(`#${ce}`),U=O==null?void 0:O.querySelector("rect");U&&(ee={x:U.getAttribute("x")||"",y:U.getAttribute("y")||"",width:U.getAttribute("width")||"",height:U.getAttribute("height")||""})}return{rectString:p,clipPathAttr:v,clipId:ce,clipRect:ee,clipPathStyle:R,webkitClipPathStyle:E}})(),c=[],d=document.createElement("div");d.className="crop-overlay__scrim crop-overlay__scrim--top";const u=document.createElement("div");u.className="crop-overlay__scrim crop-overlay__scrim--right";const S=document.createElement("div");S.className="crop-overlay__scrim crop-overlay__scrim--bottom";const T=document.createElement("div");T.className="crop-overlay__scrim crop-overlay__scrim--left",[d,u,S,T].forEach(p=>{p.style.pointerEvents="none",i.appendChild(p)});const b=document.createElement("div");b.className="crop-frame",i.appendChild(b);const C=document.createElement("div");C.className="crop-overlay__controls";const g=document.createElement("button");g.type="button",g.className="crop-overlay__button crop-overlay__button--cancel",g.textContent="Cancel";const _=document.createElement("button");_.type="button",_.className="crop-overlay__button crop-overlay__button--apply",_.textContent="Crop",C.appendChild(g),C.appendChild(_),i.appendChild(C);const z=["top-left","top-right","bottom-left","bottom-right"],ae=[],le={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};z.forEach(p=>{const v=document.createElement("div");v.className=`crop-frame__corner crop-frame__corner--${p}`,v.dataset.corner=p,v.style.pointerEvents="auto",v.style.cursor=le[p]||"nwse-resize";const R=document.createElement("span");R.className="corner-arm corner-arm--horizontal",R.style.pointerEvents="none";const E=document.createElement("span");E.className="corner-arm corner-arm--vertical",E.style.pointerEvents="none",v.appendChild(R),v.appendChild(E),b.appendChild(v),ae.push(v)});const re=["top","right","bottom","left"],me=[];re.forEach(p=>{const v=document.createElement("div");v.className=`crop-frame__edge-handle crop-frame__edge-handle--${p}`,v.dataset.edge=p,v.style.pointerEvents="auto",v.style.cursor=p==="top"||p==="bottom"?"ns-resize":"ew-resize",b.appendChild(v),me.push(v)}),e.appendChild(i);let W=e.getBoundingClientRect(),j=W.width||e.offsetWidth,F=W.height||e.offsetHeight,Pe=j,ft=F;if(!j||!F)return i.remove(),null;Ee.forEach(p=>{!p||!p.overlay||p.overlay!==e&&(p.overlay.classList.contains("editor-overlay--hidden-for-crop")||(p.overlay.classList.add("editor-overlay--hidden-for-crop"),c.push(p.overlay)))}),e.classList.add("editor-overlay--crop-active"),e.dataset.cropSessionActive="true",te(),i.style.pointerEvents="none",b.style.pointerEvents="auto";const tt=(()=>{const p=t.dataset.cropRect;if(!p)return null;const v=p.split(",").map(R=>Number(R));return v.length!==4||v.some(R=>!Number.isFinite(R))?null:{left:a(v[0],0,1),top:a(v[1],0,1),width:a(v[2],0,1),height:a(v[3],0,1)}})(),Ut=parseFloat(t.dataset.cropSourceWidth)||0,Aa=parseFloat(t.dataset.cropSourceHeight)||0;let fe,ge;const Ht=()=>{ge=Math.min(j,Math.max(48,j*.08)),fe=Math.min(F,Math.max(48,F*.08))};Ht();const N={left:0,top:0,width:0,height:0};if(tt&&tt.width>0&&tt.height>0){const p=tt.width*j,v=tt.height*F;N.width=a(p,ge,j),N.height=a(v,fe,F),N.left=a(tt.left*j,0,j-N.width),N.top=a(tt.top*F,0,F-N.height)}else{const p=Ut>0&&Aa>0?Ut/Aa:j>0&&F>0?j/F:1;let v,R;p>=1?(v=j*.85,R=v/p):(R=F*.85,v=R*p),N.width=a(v,ge,j),N.height=a(R,fe,F),N.left=Math.max(0,(j-N.width)/2),N.top=Math.max(0,(F-N.height)/2)}N.width=a(N.width,ge,j),N.height=a(N.height,fe,F),N.left=a(N.left,0,j-N.width),N.top=a(N.top,0,F-N.height);const Oi=()=>{const p=N.left+N.width,v=N.top+N.height;d.style.top="0px",d.style.left="0px",d.style.width="100%",d.style.height=`${Math.max(0,N.top)}px`,d.style.display=N.top>0?"block":"none",S.style.top=`${v}px`,S.style.left="0px",S.style.width="100%",S.style.height=`${Math.max(0,F-v)}px`,S.style.display=v<F?"block":"none",T.style.top=`${N.top}px`,T.style.left="0px",T.style.width=`${Math.max(0,N.left)}px`,T.style.height=`${N.height}px`,T.style.display=N.left>0?"block":"none",u.style.top=`${N.top}px`,u.style.left=`${p}px`,u.style.width=`${Math.max(0,j-p)}px`,u.style.height=`${N.height}px`,u.style.display=p<j?"block":"none"},Nr=(p,v,R,E)=>{const se=t.ownerSVGElement;if(!se)return;const oe=parseFloat(t.dataset.cropSourceWidth)||0,ce=parseFloat(t.dataset.cropSourceHeight)||0,ee=parseFloat(t.dataset.cropSourceX)||0,Q=parseFloat(t.dataset.cropSourceY)||0;let O=oe,U=ce,Oe=ee,Ta=Q;if(!O||!U){let Ie=null;try{Ie=t.getBBox()}catch{Ie=null}O=Ie&&Number.isFinite(Ie.width)&&Ie.width>0?Ie.width:parseFloat(t.getAttribute("width"))||0,U=Ie&&Number.isFinite(Ie.height)&&Ie.height>0?Ie.height:parseFloat(t.getAttribute("height"))||0,Oe=Ie&&Number.isFinite(Ie.x)?Ie.x:parseFloat(t.getAttribute("x"))||0,Ta=Ie&&Number.isFinite(Ie.y)?Ie.y:parseFloat(t.getAttribute("y"))||0}if(!O||!U)return;if(t instanceof HTMLImageElement){const Ie=a(v,0,1)*100,$r=a(p,0,1)*100,Yi=a(1-(v+E),0,1)*100,Ki=a(1-(p+R),0,1)*100,Ka=`inset(${Ie}% ${Ki}% ${Yi}% ${$r}%)`;t.style.clipPath=Ka,t.style.webkitClipPath=Ka,delete t.dataset.cropClipId,t.dataset.cropCssClip=Ka;return}const Vt=Ct(se);if(!Vt)return;const lt=t.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let Ge=Vt.querySelector(`#${lt}`);Ge||(Ge=document.createElementNS(q,"clipPath"),Ge.id=lt,Ge.setAttribute("clipPathUnits","userSpaceOnUse"),Vt.appendChild(Ge));let Xe=Ge.querySelector("rect");Xe||(Xe=document.createElementNS(q,"rect"),Ge.appendChild(Xe));const Wi=O*R,Vi=U*E,Gi=Oe+O*p,Xi=Ta+U*v;Xe.setAttribute("x",Gi),Xe.setAttribute("y",Xi),Xe.setAttribute("width",Wi),Xe.setAttribute("height",Vi),t.dataset.cropClipId=lt,t.setAttribute("clip-path",`url(#${lt})`),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip},Ui=()=>{if(!j||!F)return;const p=t.dataset.cropRect||"",v=typeof t.getAttribute("clip-path")=="string"&&t.getAttribute("clip-path").length>0,R=t.ownerSVGElement,E=N.left/j,se=N.top/F,oe=N.width/j,ce=N.height/F,ee=a(E,0,1),Q=a(se,0,1),O=a(oe,0,1-ee),U=a(ce,0,1-Q),Oe=ee+O,Ta=Q+U;if(ee<=.001&&Q<=.001&&Oe>=.999&&Ta>=.999){const lt=t.dataset.cropClipId;if(lt){const Ge=Ct(R),Xe=Ge==null?void 0:Ge.querySelector(`#${lt}`);Xe==null||Xe.remove(),delete t.dataset.cropClipId}t.removeAttribute("clip-path"),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip,delete t.dataset.cropRect,(p||v)&&(w==null||w.schedule("image-crop"),te());return}const Vt=[ee,Q,O,U].map(lt=>lt.toFixed(6)).join(",");t.dataset.cropRect=Vt,Nr(ee,Q,O,U),p!==Vt&&(w==null||w.schedule("image-crop"),te())},kr=()=>{var Q;const p=t.dataset.cropRect||"",v=t.getAttribute("clip-path")||"",R=t.dataset.cropClipId||"",E=t.ownerSVGElement,se=t.dataset.cropClipId;if(se&&se!==s.clipId){const O=Ct(E);(Q=O==null?void 0:O.querySelector(`#${se}`))==null||Q.remove()}if(s.rectString){t.dataset.cropRect=s.rectString,s.clipId?t.dataset.cropClipId=s.clipId:delete t.dataset.cropClipId;const O=s.rectString.split(",").map(U=>Number(U));O.length===4&&O.every(U=>Number.isFinite(U))&&Nr(O[0],O[1],O[2],O[3]),s.clipPathAttr?t.setAttribute("clip-path",s.clipPathAttr):t.removeAttribute("clip-path"),s.clipPathStyle?(t.style.clipPath=s.clipPathStyle,t.dataset.cropCssClip=s.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),s.webkitClipPathStyle?t.style.webkitClipPath=s.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}else{if(delete t.dataset.cropRect,s.clipId){if(t.dataset.cropClipId=s.clipId,s.clipRect){const O=Ct(E);if(O){let U=O.querySelector(`#${s.clipId}`);U||(U=document.createElementNS(q,"clipPath"),U.id=s.clipId,U.setAttribute("clipPathUnits","userSpaceOnUse"),O.appendChild(U));let Oe=U.querySelector("rect");Oe||(Oe=document.createElementNS(q,"rect"),U.appendChild(Oe)),Oe.setAttribute("x",s.clipRect.x),Oe.setAttribute("y",s.clipRect.y),Oe.setAttribute("width",s.clipRect.width),Oe.setAttribute("height",s.clipRect.height)}}s.clipPathAttr&&t.setAttribute("clip-path",s.clipPathAttr)}else delete t.dataset.cropClipId,s.clipPathAttr?t.setAttribute("clip-path",s.clipPathAttr):t.removeAttribute("clip-path");s.clipPathStyle?(t.style.clipPath=s.clipPathStyle,t.dataset.cropCssClip=s.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),s.webkitClipPathStyle?t.style.webkitClipPath=s.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}const oe=t.dataset.cropRect||"",ce=t.getAttribute("clip-path")||"",ee=t.dataset.cropClipId||"";(p!==oe||v!==ce||R!==ee)&&(w==null||w.schedule("image-crop"),te())},ot=()=>{b.style.left=`${N.left}px`,b.style.top=`${N.top}px`,b.style.width=`${N.width}px`,b.style.height=`${N.height}px`,Oi(),Ui()};ot();let Ae=null,ne=null;const Xa=()=>{const p=j||(W==null?void 0:W.width)||(l==null?void 0:l.clientWidth)||0,v=F||(W==null?void 0:W.height)||(l==null?void 0:l.clientHeight)||0,R=Math.min(p,v);return Math.max(8,Math.round(R*.02))},Wt=(p,v)=>{const R=[],E=Math.round(p/ua)*ua;R.push(E),Number.isFinite(v)&&v>0&&R.push(v/2);let se=p,oe=Number.POSITIVE_INFINITY;return R.forEach(ce=>{const ee=Math.abs(ce-p);ee<oe&&ee<=Xt&&(se=ce,oe=ee)}),se},Cr=p=>{if(p.button!==0||p.target!==b)return;p.preventDefault(),W=e.getBoundingClientRect();const v=W.width||j,R=W.height||F;Ae={pointerId:p.pointerId,startX:p.clientX,startY:p.clientY,widthLimit:v,heightLimit:R,startLeft:N.left,startTop:N.top},b.setPointerCapture(p.pointerId)},Ar=p=>{if(!Ae||p.pointerId!==Ae.pointerId)return;p.preventDefault();const v=p.clientX-Ae.startX,R=p.clientY-Ae.startY,E=Xa(),se=Math.max(0,Ae.widthLimit-N.width-E*2),oe=Math.max(0,Ae.heightLimit-N.height-E*2),ce=Ae.startLeft+v,ee=Ae.startTop+R,Q=Wt(ce,Ae.widthLimit),O=Wt(ee,Ae.heightLimit);N.left=a(Q,E,E+se),N.top=a(O,E,E+oe),ot()},Ea=p=>{if(!(!Ae||p.pointerId!==Ae.pointerId)){try{b.releasePointerCapture(p.pointerId)}catch{}Ae=null}};b.addEventListener("pointerdown",Cr),b.addEventListener("pointermove",Ar),b.addEventListener("pointerup",Ea),b.addEventListener("pointercancel",Ea);const Er=()=>{Ae=null};b.addEventListener("lostpointercapture",Er);const Ir=p=>{p.button===0&&(p.preventDefault(),p.stopPropagation(),W=e.getBoundingClientRect(),j=W.width||e.offsetWidth||j,F=W.height||e.offsetHeight||F,Ht(),ne={pointerId:p.pointerId,mode:"edge",edge:p.currentTarget.dataset.edge,anchor:{left:N.left,top:N.top,right:N.left+N.width,bottom:N.top+N.height},target:p.currentTarget},p.currentTarget.setPointerCapture(p.pointerId))},Lr=p=>{if(!ne||p.pointerId!==ne.pointerId||ne.mode!=="edge")return;p.preventDefault(),W=e.getBoundingClientRect(),j=W.width||e.offsetWidth||j,F=W.height||e.offsetHeight||F,Ht();const v=p.clientX-W.left,R=p.clientY-W.top,E=ne.anchor,se=Xa();let oe=E.left,ce=E.top,ee=a(E.right-E.left,ge,j),Q=a(E.bottom-E.top,fe,F);if(ne.edge==="top"){const O=Math.min(E.bottom-fe,F-fe),U=a(R,0,Math.max(0,O));ce=U,Q=Math.max(fe,E.bottom-U)}else if(ne.edge==="bottom"){const O=E.top+fe,U=a(R,O,F);ce=E.top,Q=Math.max(fe,U-E.top)}else if(ne.edge==="left"){const O=Math.min(E.right-ge,j-ge),U=a(v,0,Math.max(0,O));oe=U,ee=Math.max(ge,E.right-U)}else if(ne.edge==="right"){const O=E.left+ge,U=a(v,O,j);oe=E.left,ee=Math.max(ge,U-E.left)}ee=a(ee,ge,j),Q=a(Q,fe,F),oe=Wt(a(oe,se,j-se-ee),j),ce=Wt(a(ce,se,F-se-Q),F),N.left=oe,N.top=ce,N.width=ee,N.height=Q,ot()},Ia=p=>{var v;if(!(!ne||p.pointerId!==ne.pointerId)){try{(v=ne.target)==null||v.releasePointerCapture(p.pointerId)}catch{}ne=null,ot()}},Tr=()=>{ne=null},Fr=p=>{p.button===0&&(p.preventDefault(),p.stopPropagation(),W=e.getBoundingClientRect(),j=W.width||e.offsetWidth||j,F=W.height||e.offsetHeight||F,Ht(),ne={pointerId:p.pointerId,mode:"corner",corner:p.currentTarget.dataset.corner,anchor:{left:N.left,top:N.top,right:N.left+N.width,bottom:N.top+N.height},target:p.currentTarget},p.currentTarget.setPointerCapture(p.pointerId))},jr=p=>{if(!ne||p.pointerId!==ne.pointerId||ne.mode!=="corner")return;p.preventDefault(),W=e.getBoundingClientRect(),j=W.width||e.offsetWidth||j,F=W.height||e.offsetHeight||F,Ht();const v=p.clientX-W.left,R=p.clientY-W.top,E=ne.anchor,se=Xa();let oe=E.left,ce=E.top,ee=a(E.right-E.left,ge,j),Q=a(E.bottom-E.top,fe,F);switch(ne.corner){case"top-left":{const O=a(v,0,E.right-ge),U=a(R,0,E.bottom-fe);oe=O,ce=U,ee=Math.max(ge,E.right-O),Q=Math.max(fe,E.bottom-U);break}case"top-right":{const O=a(v,E.left+ge,j),U=a(R,0,E.bottom-fe);oe=E.left,ce=U,ee=Math.max(ge,O-E.left),Q=Math.max(fe,E.bottom-U);break}case"bottom-left":{const O=a(v,0,E.right-ge),U=a(R,E.top+fe,F);oe=O,ce=E.top,ee=Math.max(ge,E.right-O),Q=Math.max(fe,U-E.top);break}case"bottom-right":{const O=a(v,E.left+ge,j),U=a(R,E.top+fe,F);oe=E.left,ce=E.top,ee=Math.max(ge,O-E.left),Q=Math.max(fe,U-E.top);break}default:return}ee=a(ee,ge,j),Q=a(Q,fe,F),oe=Wt(a(oe,se,j-se-ee),j),ce=Wt(a(ce,se,F-se-Q),F),N.left=oe,N.top=ce,N.width=ee,N.height=Q,ot()},La=p=>{var v;if(!(!ne||p.pointerId!==ne.pointerId)){try{(v=ne.target)==null||v.releasePointerCapture(p.pointerId)}catch{}ne=null,ot()}},_r=()=>{ne=null};me.forEach(p=>{p.addEventListener("pointerdown",Ir),p.addEventListener("pointermove",Lr),p.addEventListener("pointerup",Ia),p.addEventListener("pointercancel",Ia),p.addEventListener("lostpointercapture",Tr)}),ae.forEach(p=>{p.addEventListener("pointerdown",Fr),p.addEventListener("pointermove",jr),p.addEventListener("pointerup",La),p.addEventListener("pointercancel",La),p.addEventListener("lostpointercapture",_r)});const Mr=p=>{p.preventDefault(),p.stopPropagation(),kr(),wt()},Br=p=>{p.preventDefault(),p.stopPropagation(),ot()};g.addEventListener("click",Mr),_.addEventListener("click",Br);const Rr=p=>{p.key==="Escape"&&(p.preventDefault(),kr(),wt()),p.key==="Enter"&&(p.metaKey||p.ctrlKey)&&(p.preventDefault(),ot(),wt())};document.addEventListener("keydown",Rr);const Ya=()=>{if(W=e.getBoundingClientRect(),j=W.width||e.offsetWidth||j,F=W.height||e.offsetHeight||F,!j||!F)return;Ht();const p=t.dataset.cropRect||null;if(p){const v=p.split(",").map(R=>Number(R));if(v.length===4&&v.every(R=>Number.isFinite(R))){const R=a(v[2]*j,ge,j),E=a(v[3]*F,fe,F),se=a(v[0]*j,0,j-R),oe=a(v[1]*F,0,F-E);N.left=se,N.top=oe,N.width=R,N.height=E}}else{const v=Pe?N.width/Pe:1,R=ft?N.height/ft:1,E=Pe?N.left/Pe:0,se=ft?N.top/ft:0;N.width=a(v*j,ge,j),N.height=a(R*F,fe,F),N.left=a(E*j,0,j-N.width),N.top=a(se*F,0,F-N.height)}Pe=j,ft=F,ot()};return window.addEventListener("resize",Ya),{overlay:e,refresh:Ya,teardown:()=>{var p;if(Ae&&typeof Ae.pointerId<"u"){try{b.releasePointerCapture(Ae.pointerId)}catch{}Ae=null}if(ne&&typeof ne.pointerId<"u"){try{(p=ne.target)==null||p.releasePointerCapture(ne.pointerId)}catch{}ne=null}window.removeEventListener("resize",Ya),b.removeEventListener("pointerdown",Cr),b.removeEventListener("pointermove",Ar),b.removeEventListener("pointerup",Ea),b.removeEventListener("pointercancel",Ea),b.removeEventListener("lostpointercapture",Er),me.forEach(v=>{v.removeEventListener("pointerdown",Ir),v.removeEventListener("pointermove",Lr),v.removeEventListener("pointerup",Ia),v.removeEventListener("pointercancel",Ia),v.removeEventListener("lostpointercapture",Tr)}),ae.forEach(v=>{v.removeEventListener("pointerdown",Fr),v.removeEventListener("pointermove",jr),v.removeEventListener("pointerup",La),v.removeEventListener("pointercancel",La),v.removeEventListener("lostpointercapture",_r)}),g.removeEventListener("click",Mr),_.removeEventListener("click",Br),document.removeEventListener("keydown",Rr),e.classList.remove("editor-overlay--crop-active"),delete e.dataset.cropSessionActive,c.forEach(v=>v.classList.remove("editor-overlay--hidden-for-crop")),c.length=0,te(),i.parentNode===e?e.removeChild(i):i.remove()}}},ta=()=>{he||ve||De?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},aa=()=>{Ee.forEach(({overlay:e,type:t})=>{var s;if(!e)return;const a=((s=e.dataset)==null?void 0:s.previewNode)||"",r=!!he&&a===he&&t==="text",i=!!ve&&a===ve&&t==="image";e.classList.toggle("editor-overlay--selected",r||i)})},$e=()=>De?"background":ve?"image":he?"text":null,Da=e=>{if(typeof e!="string")return null;const t=e.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!t)return null;const a=Number(t[1]),r=Number(t[2]),i=Number(t[3]);if([a,r,i].some(c=>Number.isNaN(c)||c<0||c>255))return null;const s=c=>c.toString(16).padStart(2,"0");return`#${s(a)}${s(r)}${s(i)}`.toUpperCase()};function Yr(e){var t;try{if(e==="background"){if(!l)return null;const r=window.getComputedStyle(l).backgroundColor||l.style.backgroundColor||"";return kt(r)||Da(r)||null}if(e==="text"){const a=Pt();if(!a.length)return null;const r=a[0],i=r.getAttribute("fill")||r.style.fill||r.dataset.color||"";return kt(i)||Da(i)||null}if(e==="image"){const a=St();if(!a.length)return null;const i=((t=a[0].dataset)==null?void 0:t.tintColor)||"";return kt(i)||null}}catch{return null}return null}const ra=()=>{if(typeof window>"u")return;const e=$e(),t=e==="text"?he:e==="image"?ve:null,a=Yr(e);try{const r=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t,color:a}});window.dispatchEvent(r)}catch{if(typeof document<"u"&&document.createEvent){const i=document.createEvent("CustomEvent");i.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t,color:a}),window.dispatchEvent(i)}}},dt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;he===t&&!ve||(wt(),he=t,t&&(ve=null,De=!1),aa(),ta(),ra())},ia=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;ve===t&&!he||(ve!==t&&wt(),ve=t,t&&(he=null,De=!1),aa(),ta(),ra())},Kr=()=>{De||(wt(),De=!0,he=null,ve=null,aa(),ta(),ra())},Pt=()=>{if(!he)return[];const e=Y||f||document;if(!e)return[];const t=`[data-preview-node="${he}"]`,a=new Set;return e.querySelectorAll(t).forEach(r=>{if(!r||G(r))return;const i=(r.tagName||"").toLowerCase();if(i==="tspan"||i==="g"){const s=r.closest("text");if(s){a.add(s);return}}a.add(r)}),Array.from(a)},St=()=>{if(!ve)return[];const e=Y||f||document;if(!e)return[];const t=`[data-preview-node="${ve}"]`,a=new Set;return e.querySelectorAll(t).forEach(r=>{const i=je(r);i&&a.add(i)}),Array.from(a)},zt=()=>sr(he),Nt=(e,t,a)=>{const r=Number(e);return Number.isFinite(r)?Math.min(Math.max(r,t),a):t},kt=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},ba=e=>{var s,c;if(!e||typeof e.getBBox!="function")return;const t=[],a=Number(((s=e.dataset)==null?void 0:s.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(a)&&a!==0)try{const d=e.getBBox(),u=d.x+d.width/2,S=d.y+d.height/2;t.push(`rotate(${a} ${u} ${S})`)}catch{t.push(`rotate(${a})`)}((c=e.dataset)==null?void 0:c.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const i=t.join(" ").trim();i?e.setAttribute("transform",i):e.removeAttribute("transform")},Fe=(e,t={})=>{const a=Pt();if(!a.length)return!1;if(a.forEach(r=>{try{e(r)}catch(i){console.warn("[InkWise Studio] Toolbar mutation failed.",i)}}),t.skipTransformUpdate||a.forEach(r=>{try{ba(r)}catch{}}),t.skipOverlaySync||te(),t.autosaveReason!==!1){const r=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";w==null||w.schedule(r)}return!0},qt=(e,t={})=>{const a=St();if(!a.length)return!1;if(a.forEach(r=>{try{e(r)}catch(i){console.warn("[InkWise Studio] Image mutation failed.",i)}}),t.skipTransformUpdate||a.forEach(r=>{try{ba(r)}catch{}}),t.skipOverlaySync||te(),t.autosaveReason!==!1){const r=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";w==null||w.schedule(r)}return!0},Ct=(e=null)=>{var r;let t=Y;if(!t&&e&&(t=e),!t)return null;if(typeof t.tagName=="string"&&t.tagName.toLowerCase()!=="svg"){const i=(r=t.closest)==null?void 0:r.call(t,"svg");i?t=i:e&&e!==t&&(t=e)}if(!t)return null;let a=t.querySelector('defs[data-inkwise-runtime="true"]');return a||(a=document.createElementNS(q,"defs"),a.setAttribute("data-inkwise-runtime","true"),t.insertBefore(a,t.firstChild||null)),a},va=e=>{const t=e.dataset.previewTarget;if(!t)return;const a=document.querySelector(`[data-preview-node="${t}"]`),r=a?a.dataset.defaultText||a.textContent:"",i=()=>{if(!a)return;const s=e.value.trim();a.textContent=s||r||"",te()};e.dataset.defaultValue||(e.dataset.defaultValue=r||""),e.addEventListener("focus",()=>{dt(t)}),e.addEventListener("input",()=>{i(),w==null||w.schedule("text-change")}),i()};o.forEach(va);const Jr=(e,t="")=>{const a=normalizeSideKey(Ue),r=xe(t),i=document.createElement("div");i.className="text-field-item";const s=document.createElement("span");s.className="text-field-label",s.textContent="Custom",i.appendChild(s);const c=document.createElement("input");c.type="text",c.className="text-field-input",c.placeholder="Add your text",c.dataset.previewTarget=e,c.dataset.templateSide=a,c.value=r,c.dataset.defaultValue=r||"",setStoredTextValue(a,e,r),captureDefaultTextValue(a,e,r),i.appendChild(c);const d=document.createElement("button");if(d.type="button",d.className="text-field-delete",d.setAttribute("aria-label","Delete field"),d.innerHTML='<i class="fa-regular fa-trash-can"></i>',i.appendChild(d),L.appendChild(i),M){const u=document.createElement("div");u.className="pill",u.dataset.previewNode=e,u.dataset.defaultText=t||"CUSTOM TEXT",u.textContent=t||"CUSTOM TEXT",M.appendChild(u)}return va(c),xa(i),w==null||w.schedule("add-text-field"),c},sa=()=>{f&&(Mt(),Y=null,da=null,f.innerHTML="",f.style.display="none")},Zr=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},or=e=>{if(!e)return;const t=r=>{var s,c,d;let i=(r==null?void 0:r.parentNode)||null;for(;i;){const u=typeof i.getAttribute=="function"?i.getAttribute("fill"):null,S=(s=i.style)==null?void 0:s.fill,T=((c=i.dataset)==null?void 0:c.color)||((d=i.dataset)==null?void 0:d.defaultColor)||null,h=u||S||T;if(h&&h!=="none"&&h!=="transparent")return h;i=i.parentNode||null}return null};e.querySelectorAll("text, tspan").forEach(r=>{var b,C;r.removeAttribute("opacity"),r.style.opacity="1",r.style&&r.style.mixBlendMode&&(r.style.mixBlendMode="normal");const i=r.getAttribute("fill"),s=(b=r.style)==null?void 0:b.fill,c=(C=r.dataset)==null?void 0:C.color;let d=i&&i!=="none"?i:null;if((!d||d==="transparent")&&s&&s!=="none"&&(d=s),(!d||d==="transparent")&&c&&c!=="none"&&(d=c),(!d||d==="transparent")&&typeof window<"u"&&typeof window.getComputedStyle=="function")try{const g=window.getComputedStyle(r).fill;g&&g!=="none"&&g!=="transparent"&&(d=g)}catch{}if(!d||d==="transparent"||d==="none"){const g=t(r);g&&g!=="none"&&g!=="transparent"&&(d=g)}const u=kt(d||"")||Da(d||"")||(d&&d!=="none"&&d!=="transparent"?d:null),T=u||"#111111";r.setAttribute("fill",T),r.style&&(r.style.fill=T,r.style.fillOpacity="1",r.style.strokeOpacity="1"),r.dataset&&(r.dataset.color=T,u&&(r.dataset.defaultColor=u)),r.removeAttribute("fill-opacity"),r.removeAttribute("stroke-opacity"),r.getAttribute("stroke")||r.setAttribute("stroke","none"),r.getAttribute("paint-order")||r.setAttribute("paint-order","stroke fill");const h=r.getAttribute("font-family")||r.style.fontFamily;if(h){const g=h.toLowerCase().replace(/[^a-z]/g,"");g.includes("greatvibes")?r.setAttribute("font-family","Great Vibes"):g.includes("poppins")&&r.setAttribute("font-family","Poppins")}})},Qr=async e=>{var t,a;if(!f||!e)return sa(),!1;try{let r="";if(e.startsWith("data:image/svg+xml")){const g=e.indexOf(","),_=g>=0?e.slice(0,g):e,z=g>=0?e.slice(g+1):"";if(/;base64/i.test(_))try{const le=z.replace(/\s+/g,"");r=typeof window<"u"&&typeof window.atob=="function"?window.atob(le):atob(le)}catch(le){try{r=decodeURIComponent(z)}catch(re){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",le,re),r=""}}else try{r=decodeURIComponent(z)}catch{r=z}}else{const g=await fetch(e,{cache:"no-store"});if(!g.ok)return console.warn("Failed to fetch SVG:",g.status),sa(),!1;r=await g.text()}if(!r)return sa(),!1;f.innerHTML=r,f.style.display="block";const i=document.getElementById("canvas-loading");i&&(i.style.display="none"),f.setAttribute("preserveAspectRatio","xMidYMid meet"),f.setAttribute("width","100%"),f.setAttribute("height","100%"),f.style.width="100%",f.style.height="100%",f.style.maxWidth="100%",f.style.maxHeight="100%";const s=f.querySelector("svg");s?(s.setAttribute("preserveAspectRatio","xMidYMid meet"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.style.width="100%",s.style.height="100%",s.style.maxWidth="100%",s.style.maxHeight="100%",Y=s):Y=f,Y&&(ct(Y),or(Y)),Y&&(Y.setAttribute("data-svg-editor","true"),Y.__inkwiseSvgTemplateEditor||(Y.__inkwiseSvgTemplateEditor=new ja(Y)),da=Y.__inkwiseSvgTemplateEditor);const d=new DOMParser().parseFromString(r,"image/svg+xml").documentElement;let u=Qe(d==null?void 0:d.getAttribute("width")),S=Qe(d==null?void 0:d.getAttribute("height"));if(!Number.isFinite(u)||!Number.isFinite(S)){const g=d==null?void 0:d.getAttribute("viewBox");if(g){const _=g.split(/[\s,]+/).map(Number),z=_[2],ae=_[3];!Number.isNaN(z)&&!Number.isNaN(ae)&&z>0&&ae>0&&(u=z,S=ae)}}let T=Number.isFinite(u)?u:Number.NaN,h=Number.isFinite(S)?S:Number.NaN;if(P&&Number.isFinite(P.width)&&Number.isFinite(P.height)){const g=P.width/P.height,_=Number.isFinite(T)&&Number.isFinite(h)?T/h:g,z=Math.abs(_-g)/g,ae=Number.isFinite(T)?Math.abs(T-P.width)/P.width:Number.POSITIVE_INFINITY,le=Number.isFinite(h)?Math.abs(h-P.height)/P.height:Number.POSITIVE_INFINITY;(!Number.isFinite(T)||!Number.isFinite(h)||z>.02||ae>.05&&le>.05)&&(T=P.width,h=P.height)}if(Number.isFinite(T)&&Number.isFinite(h)){const g=(P==null?void 0:P.unit)??"px";$t(T,h,{unit:g,shape:P==null?void 0:P.shape}),xt(qe(T,g),qe(h,g),"in",2)}const b=A(f);if(Mt(),L){L.innerHTML="";const g=(z,ae="",le="")=>{const re=document.createElement("div");re.className="text-field-item";const me=document.createElement("span");me.className="text-field-label",me.textContent=le||z,re.appendChild(me);const W=document.createElement("input");W.type="text",W.className="text-field-input",W.dataset.previewTarget=z,W.value=ae||"",W.dataset.defaultValue=ae||"",re.appendChild(W);const j=document.createElement("button");return j.type="button",j.className="text-field-delete",j.setAttribute("aria-label","Delete field"),j.innerHTML='<i class="fa-regular fa-trash-can"></i>',re.appendChild(j),L.appendChild(re),va(W),xa(re),W},_=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([ae,le])=>g(ae,"",le))};if(b.length>0){let z=!1;const ae=new Set,le=new Set;b.forEach(re=>{var F,Pe;const me=re.getAttribute("data-preview-node");if(!me||ae.has(me))return;ae.add(me);const W=G(re);if(de(re)){z=!0;const ft=((F=re.dataset)==null?void 0:F.previewLabel)||me,tt=((Pe=re.dataset)==null?void 0:Pe.defaultText)||ze(re)||"",Ut=(ft||"").toString().trim().toLowerCase(),Aa=(tt||"").toString().trim().toLowerCase(),fe=`${Ut}|${Aa}`;if(Ut&&le.has(fe))return;Ut&&le.add(fe),g(me,tt,ft)}}),z||_()}else _()}const C=(a=(t=V==null?void 0:V.orderSummary)==null?void 0:t.metadata)==null?void 0:a.design;return C&&It(C),b.forEach(g=>{const _=g.getAttribute("data-preview-node");if(!_)return;const z=G(g),ae=de(g);z&&g.setAttribute("data-changeable","image"),Re(g)&&st(g),ae?(g.setAttribute("contenteditable","true"),g.style.cursor="text",g.style.userSelect="text",g.addEventListener("input",()=>{const me=document.querySelector(`#textFieldList input[data-preview-target="${_}"]`);me&&(me.value=ze(g)),g.dataset.currentText=ze(g)||"",te(),w==null||w.schedule("text-edit")}),g.addEventListener("click",()=>{dt(_),wa(_)})):z&&(g.style.cursor="pointer",g.addEventListener("click",()=>{g.dataset.locked!=="true"&&(ia(_),yt(g))}));const re=document.querySelector(`#textFieldList input[data-preview-target="${_}"]`);re&&ae&&(re.addEventListener("input",()=>{at(g,re.value),w==null||w.schedule("text-change")}),re.value&&re.value.trim()!==""?at(g,re.value):re.value=ze(g)||"")}),requestAnimationFrame(()=>te()),bt(10),!0}catch(r){return console.warn("Could not load SVG for binding:",r),sa(),!1}},ei=async(e={})=>{var re,me,W,j;const{scale:t=3,filename:a="inkwise-template.png",download:r=!0}=e,i=Y||f;if(!i)throw new Error("No active canvas to export.");ct(i);const c=new XMLSerializer().serializeToString(i),d=F=>{const Pe=Number(F);return Number.isFinite(Pe)?Pe:null},u=(i.getAttribute("viewBox")||"").split(/[\s,]+/).map(d),S=u.length===4?u[2]:null,T=u.length===4?u[3]:null,h=d((re=l==null?void 0:l.dataset)==null?void 0:re.canvasWidth)||d((me=Z==null?void 0:Z.dataset)==null?void 0:me.canvasWidth)||S||1080,b=d((W=l==null?void 0:l.dataset)==null?void 0:W.canvasHeight)||d((j=Z==null?void 0:Z.dataset)==null?void 0:j.canvasHeight)||T||1527,C=Math.max(1,Math.round(h*Math.max(1,t))),g=Math.max(1,Math.round(b*Math.max(1,t))),_=new Image;_.crossOrigin="anonymous",_.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(c)}`,await new Promise((F,Pe)=>{_.onload=F,_.onerror=Pe});const z=document.createElement("canvas");z.width=C,z.height=g;const ae=z.getContext("2d");ae.fillStyle="#ffffff",ae.fillRect(0,0,C,g),ae.drawImage(_,0,0,C,g);const le=z.toDataURL("image/png",1);if(r){const F=document.createElement("a");F.href=le,F.download=a,F.click()}return{dataUrl:le,width:C,height:g}};typeof window<"u"&&(window.inkwiseExportCurrentSide=(e={})=>ei(e));const xa=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),a=e.querySelector("input[data-preview-target]");if(!t||!a||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const i=a.dataset.previewTarget;if(e.remove(),M){const s=M.querySelector(`[data-preview-node="${i}"]`);s==null||s.remove()}if(Y){const s=Y.querySelector(`[data-preview-node="${i}"]`);s==null||s.remove()}deleteStoredTextValue(normalizeSideKey(Ue),i),w==null||w.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>xa(e));const wa=e=>{if(!e)return;pe(),Ce("text"),X.forEach(a=>a.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const a=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(a){try{a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const s=document.getElementById("textFieldList");s&&(s.scrollTop=a.offsetTop-12)}a.focus({preventScroll:!1});return}const r=document.querySelector("[data-add-text-field]");r==null||r.focus({preventScroll:!1})},60)};_t=wa;const Dt=async e=>{if(!Yt(e)||(Ue=e,!l))return;let t="",a="";e==="front"&&Ke?(t=Ke,a=Ke):e==="back"&&Je?(t=Je,a=Je):(a=l.dataset[`${e}Svg`]||"",t=l.dataset[`${e}Image`]||"");let r=!1;if(a&&Zr(a)&&await Qr(a)&&(r=!0,l.style.backgroundImage="none",l.style.backgroundSize="",or(Y)),!r){const i=t||l.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,i||"<empty>"),sa(),l.style.backgroundImage=i?`url('${i}')`:"",l.style.backgroundSize=i?"cover":"",l.style.backgroundPosition=i?"center center":"",l.style.backgroundRepeat=i?"no-repeat":"",i&&Ma(i),Mt(),Y=null}x.forEach(i=>{i.classList.toggle("active",i.dataset.cardView===e)}),m.forEach(i=>{const s=i.dataset.cardThumb===e;i.classList.toggle("active",s),i.setAttribute("aria-pressed",s?"true":"false")})};x.forEach(e=>{e.addEventListener("click",()=>{Dt(e.dataset.cardView)})}),m.forEach(e=>{e.addEventListener("click",()=>{Dt(e.dataset.cardThumb)})});const Oa=Dt("front");Oa&&typeof Oa.then=="function"?Oa.catch(()=>{}).then(()=>{bt(6),w==null||w.schedule("initial-load")}):(bt(6),w==null||w.schedule("initial-load"));const lr=document.querySelector(".preview-overlay");lr&&lr.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const a=t.dataset.previewNode;a&&(G(t)?ia(a):(dt(a),wa(a)))}}),B&&L&&B.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${ke}`;ke+=1;const t=document.createElement("div");t.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",t.appendChild(a);const r=document.createElement("input");r.type="text",r.className="text-field-input",r.placeholder="Add your text",r.dataset.previewTarget=e,t.appendChild(r);const i=document.createElement("button");if(i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(i),L.appendChild(t),M){const c=document.createElement("div");c.className="pill",c.dataset.previewNode=e,c.dataset.defaultText="CUSTOM TEXT",c.textContent="CUSTOM TEXT",M.appendChild(c)}let s=null;console.log("[InkWise Studio] currentSvgRoot:",Y),Y?(console.log("[InkWise Studio] Creating SVG text element"),s=document.createElementNS("http://www.w3.org/2000/svg","text"),s.setAttribute("id",e),s.setAttribute("data-preview-node",e),s.setAttribute("data-default-text","CUSTOM TEXT"),s.setAttribute("x","50%"),s.setAttribute("y","50%"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","middle"),s.setAttribute("font-family","Arial, sans-serif"),s.setAttribute("font-size","24"),s.setAttribute("fill","#000000"),s.textContent="CUSTOM TEXT",s.setAttribute("contenteditable","true"),s.style.cursor="text",s.style.userSelect="text",s.addEventListener("input",()=>{r&&(r.value=s.textContent),s.dataset.currentText=s.textContent||"",te(),w==null||w.schedule("text-edit")}),s.addEventListener("click",()=>{dt(e),wa(e)}),Y.appendChild(s),Re(s)&&st(s),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),va(r),r.addEventListener("input",()=>{s&&(s.textContent=r.value,s.dataset.currentText=r.value),w==null||w.schedule("text-change")}),dt(e),s&&s.textContent&&s.textContent.trim()!==""?r.value=s.textContent:(r.value="CUSTOM TEXT",s&&(s.textContent="CUSTOM TEXT")),xa(t),setTimeout(()=>{try{L.scrollHeight>L.clientHeight&&L.scrollTo({top:L.scrollHeight,behavior:"smooth"})}catch{L.scrollTop=L.scrollHeight}r.focus({preventScroll:!1})},60)}),Ke=null,Je=null,Ue="front";const na=document.getElementById("image-upload"),cr=document.getElementById("upload-button"),dr=document.getElementById("quick-upload-button"),Sa=document.getElementById("recentUploadsGrid"),Na=document.getElementById("quickRecentUploads"),Ua="inkwise_recent_uploads",ur=12,Ha=()=>{try{const e=localStorage.getItem(Ua);return e?JSON.parse(e):[]}catch{return[]}},ti=(e,t,a)=>{const r=Ha(),i={id:Date.now(),dataUrl:e,filename:t,side:a,timestamp:new Date().toISOString()},s=r.filter(d=>d.filename!==t);s.unshift(i);const c=s.slice(0,ur);try{localStorage.setItem(Ua,JSON.stringify(c))}catch{const u=c.slice(0,Math.floor(ur/2));localStorage.setItem(Ua,JSON.stringify(u))}pr(),mr()},fr=(e,t,a="front")=>{e&&(ti(e,t||`upload-${Date.now()}`,a),a==="front"?Ke=e:a==="back"&&(Je=e),Ue===a&&Dt(a),w==null||w.schedule("image-upload"))},pr=()=>{if(!Sa)return;const e=Ha();if(e.length===0){Sa.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(r=>`
            <div class="recent-upload-item" data-upload-id="${r.id}" data-image-url="${r.dataUrl}" data-side="${r.side}">
                <img src="${r.dataUrl}" alt="${r.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${r.filename}</span>
                </div>
            </div>
        `).join("");Sa.innerHTML=t;const a=Sa.querySelectorAll(".recent-upload-item");a.forEach(r=>{r.addEventListener("click",()=>{const i=r.dataset.imageUrl,s=r.dataset.side;a.forEach(c=>c.classList.remove("selected")),r.classList.add("selected"),s==="front"?Ke=i:Je=i,Ue===s&&Dt(s),r.style.transform="scale(0.95)",setTimeout(()=>{r.style.transform=""},150),w==null||w.schedule("image-select")})})},mr=()=>{if(!Na)return;const t=Ha().slice(0,5);if(t.length===0){Na.innerHTML="";return}const a=t.map(i=>`
            <div class="quick-recent-upload-item" data-upload-id="${i.id}" data-image-url="${i.dataUrl}" data-side="${i.side}" title="${i.filename}">
                <img src="${i.dataUrl}" alt="${i.filename}" loading="lazy">
            </div>
        `).join("");Na.innerHTML=a;const r=Na.querySelectorAll(".quick-recent-upload-item");r.forEach(i=>{i.addEventListener("click",()=>{const s=i.dataset.imageUrl,c=i.dataset.side;r.forEach(d=>d.classList.remove("selected")),i.classList.add("selected"),c==="front"?Ke=s:Je=s,Ue===c&&Dt(c),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150),w==null||w.schedule("image-select")})})},ai=e=>{const t=e.files[0];if(!t)return;const a=new FileReader;a.onload=r=>{const i=r.target.result;fr(i,t.name,"front")},a.readAsDataURL(t)};na&&na.addEventListener("change",()=>ai(na)),cr&&cr.addEventListener("click",()=>{na.click()}),dr&&dr.addEventListener("click",()=>{na.click()});const ri=e=>{var a;const t=(a=e.clipboardData)==null?void 0:a.items;if(!(!t||t.length===0))for(const r of t){if(!r||typeof r.type!="string"||!r.type.startsWith("image/"))continue;const i=r.getAsFile();if(!i)continue;const s=new FileReader;s.onload=c=>{const d=c.target.result,u=i.name||`pasted-${Date.now()}.png`;fr(d,u,Ue||"front")},s.readAsDataURL(i),e.preventDefault();break}};pr(),mr(),document.addEventListener("paste",ri);const Wa=document.querySelectorAll(".pill-with-tooltip"),Va=document.querySelector(".preview-canvas-wrapper"),Ga=document.querySelector(".preview-guides"),hr=(e,t)=>{e==="safety-pill"&&(Va==null||Va.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(Ga==null||Ga.classList.toggle("highlight-bleed",t))},ka=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),a=e==null?void 0:e.querySelector(".tooltip");!t||!a||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),a.setAttribute("aria-hidden","true"),hr(t.id,!1))};Wa.forEach(e=>{const t=e.querySelector(".canvas-pill"),a=e.querySelector(".tooltip");!t||!a||(t.addEventListener("click",r=>{r.preventDefault();const i=!e.classList.contains("is-active");Wa.forEach(s=>{s!==e&&ka(s)}),i?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),a.setAttribute("aria-hidden","false"),hr(t.id,!0)):ka(e)}),t.addEventListener("mouseenter",()=>{a.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{a.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||a.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&a.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",r=>{r.key==="Escape"&&(ka(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||Wa.forEach(a=>ka(a))});const ii=e=>{if(!e)return!1;const t=Fe(a=>{a.setAttribute("font-family",e),a.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const a=zt();a&&(a.dataset.fontFamily=e)}return t},si=e=>{const t=Nt(e,6,400),a=Fe(r=>{r.setAttribute("font-size",t),r.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(a){const r=zt();r&&(r.dataset.fontSize=String(t))}return a},ni=e=>{const t=Nt(e,8,400),a=39;return qt(r=>{const i=typeof r.getBBox=="function"?r.getBBox():null,s=parseFloat(r.getAttribute("width")),c=parseFloat(r.getAttribute("height")),d=Number(r.dataset.baseWidth)||(Number.isFinite(s)?s:(i==null?void 0:i.width)||1),u=Number(r.dataset.baseHeight)||(Number.isFinite(c)?c:(i==null?void 0:i.height)||1);r.dataset.baseWidth||(r.dataset.baseWidth=d),r.dataset.baseHeight||(r.dataset.baseHeight=u);const S=t/a,T=Math.max(1,d*S),h=Math.max(1,u*S);r.setAttribute("width",T),r.setAttribute("height",h)},{autosaveReason:"image-scale"})},oi=e=>{const t=kt(e);if(!t)return!1;const a=Fe(r=>{r.setAttribute("fill",t),r.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(a){const r=zt();r&&(r.dataset.color=t)}return a},li=e=>{const t=kt(e);if(!t||!l)return!1;try{return l.style.backgroundColor=t,l.dataset.backgroundColor=t,w==null||w.schedule("background-color"),!0}catch(a){return console.warn("[InkWise Studio] Failed to apply background color",a),!1}},ci=e=>{const t=kt(e);return t?qt(a=>{if(t==="#FFFFFF"){const b=a.dataset.tintFilterId;if(b){const C=Ct(a.ownerSVGElement||null),g=C==null?void 0:C.querySelector(`#${b}`);g==null||g.remove(),delete a.dataset.tintFilterId}a.removeAttribute("filter");try{delete a.dataset.tintColor}catch{}return}const r=Ct(a.ownerSVGElement||null);if(!r)return;const i=a.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,s=parseInt(t.slice(1,3),16)/255,c=parseInt(t.slice(3,5),16)/255,d=parseInt(t.slice(5,7),16)/255;let u=r.querySelector(`#${i}`);if(!u){u=document.createElementNS(q,"filter"),u.id=i,u.setAttribute("color-interpolation-filters","sRGB");const b=document.createElementNS(q,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),u.appendChild(b);const C=document.createElementNS(q,"feComponentTransfer"),g=document.createElementNS(q,"feFuncR");g.setAttribute("type","linear"),C.appendChild(g);const _=document.createElementNS(q,"feFuncG");_.setAttribute("type","linear"),C.appendChild(_);const z=document.createElementNS(q,"feFuncB");z.setAttribute("type","linear"),C.appendChild(z);const ae=document.createElementNS(q,"feFuncA");ae.setAttribute("type","identity"),C.appendChild(ae),u.appendChild(C),r.appendChild(u)}const S=u.querySelector("feFuncR"),T=u.querySelector("feFuncG"),h=u.querySelector("feFuncB");S&&S.setAttribute("slope",s.toString()),T&&T.setAttribute("slope",c.toString()),h&&h.setAttribute("slope",d.toString()),a.dataset.tintFilterId=i,a.setAttribute("filter",`url(#${i})`);try{a.dataset.tintColor=t}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},di=()=>Fe(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",a=Number(t);t==="bold"||a>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),ui=()=>Fe(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),gr=e=>Fe(t=>{const r=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),i=new Set(r);i.has(e)?i.delete(e):i.add(e);const s=Array.from(i).join(" ");s?(t.style.textDecoration=s,t.setAttribute("text-decoration",s)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),fi=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},a={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},r=t[e]||"start",i=a[e]||"left",s=Fe(c=>{c.setAttribute("text-anchor",r);const d=c.getAttribute("x");d&&c.querySelectorAll("tspan").forEach(u=>u.setAttribute("x",d)),c.style.textAlign=i},{autosaveReason:"text-align",skipTransformUpdate:!0});if(s){const c=zt();c&&(c.dataset.align=i)}return s},pi=e=>{let t=null;const a=Fe(r=>{const i=r.textContent||"";let s=i;e==="uppercase"?s=i.toUpperCase():e==="lowercase"&&(s=i.toLowerCase()),r.textContent=s,r.dataset.currentText=s,t=s},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(a){const r=zt();r&&t!==null&&(r.value=t)}return a},mi=()=>{const e=zt();return Fe(t=>{const r=(t.textContent||"").split(/\r?\n/),i=t.dataset.listType==="bullet"||r.every(c=>c.trim().startsWith("•")),s=i?r.map(c=>c.replace(/^\s*•\s*/u,"")).join(`
`):r.map(c=>{const d=c.trim();return d?`• ${d}`:"•"}).join(`
`);i?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=s,t.dataset.currentText=s,e&&e.dataset.previewTarget===he&&(e.value=s)},{autosaveReason:"text-list",skipTransformUpdate:!0})},hi=e=>{const t=Nt(e,.5,5);return Fe(a=>{a.dataset.lineHeight=t,a.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},gi=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?Fe(a=>{if(Math.abs(t)<1e-4)a.style.letterSpacing="",a.removeAttribute("letter-spacing"),delete a.dataset.letterSpacing;else{const r=`${t.toFixed(2)}em`;a.style.letterSpacing=r,a.setAttribute("letter-spacing",r),a.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},yi=e=>{const t=typeof e=="string"?e:"none";return Fe(a=>{switch(t){case"shadow":a.dataset.effectStyle="shadow",a.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"highlight":a.dataset.effectStyle="highlight",a.style.filter="none",a.style.paintOrder="stroke fill",a.style.stroke="rgba(253, 224, 71, 0.85)",a.style.strokeWidth=6;break;case"glitch":a.dataset.effectStyle="glitch",a.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"echo":a.dataset.effectStyle="echo",a.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;default:delete a.dataset.effectStyle,a.style.filter="",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},bi=e=>{const t=e==="curve"?"curve":"none";return Fe(a=>{t==="curve"?a.dataset.effectShape="curve":delete a.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},vi=e=>{const t=Nt(e,0,100)/100;return Fe(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},xi=e=>{const t=Nt(e,0,100)/100;return qt(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},wi=e=>{const t=Nt(e,-180,180);return Fe(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},Si=e=>{const t=Nt(e,-180,180);return qt(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},yr=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let a=`${t}_${Date.now()}`,r=1;for(;document.querySelector(`[data-preview-node="${a}"]`);)a=`${t}_${Date.now()}_${r}`,r+=1;return a},Ni=()=>{const e=Pt();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=yr(he||"text"),r=t.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a,r.dataset.defaultText=r.dataset.defaultText||r.textContent||"",t.parentNode.appendChild(r),ba(r),Re(r)&&st(r);const s=Jr(a,r.textContent||"");return s&&(s.value=r.textContent||"",setTimeout(()=>{try{s.focus({preventScroll:!1})}catch{}},0)),dt(a),te(),w==null||w.schedule("duplicate-text-node"),!0},ki=()=>{const e=Pt();if(!e.length)return!1;const t=he;if(e.forEach(a=>{var i;const r=(i=Ee.get(a))==null?void 0:i.overlay;r&&(r.remove(),Ye.delete(r)),Ee.delete(a),a.remove()}),t){const a=sr(t),r=a==null?void 0:a.closest(".text-field-item");r&&r.remove();const i=Gr(t);i==null||i.remove()}return dt(null),te(),w==null||w.schedule("remove-text-node"),!0},Ci=()=>{const e=St();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=yr(ve||"image"),r=t.cloneNode(!0);r.setAttribute("data-preview-node",a),r.dataset.previewNode=a,r.id=a;const i=parseFloat(t.getAttribute("x"))||0,s=parseFloat(t.getAttribute("y"))||0;return r.setAttribute("x",i+10),r.setAttribute("y",s+10),r.dataset.tintFilterId&&(delete r.dataset.tintFilterId,r.removeAttribute("filter")),t.parentNode.appendChild(r),ba(r),Re(r)&&st(r),ia(a),te(),w==null||w.schedule("duplicate-image-node"),!0},Ai=()=>{const e=St();return e.length?(e.forEach(t=>{var r;const a=(r=Ee.get(t))==null?void 0:r.overlay;a&&(a.remove(),Ye.delete(a)),Ee.delete(t),t.remove()}),ia(null),te(),w==null||w.schedule("remove-image-node"),!0):!1},Ei=()=>{const e=$e();if(e==="text"){const t=Fe(a=>{var c;const i=!(a.dataset.locked==="true");i?a.dataset.locked="true":delete a.dataset.locked;const s=(c=Ee.get(a))==null?void 0:c.overlay;s&&(s.classList.toggle("editor-overlay--locked",i),s.style.pointerEvents=i?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&te(),t}if(e==="image"){const t=qt(a=>{var c;const i=!(a.dataset.locked==="true");i?a.dataset.locked="true":delete a.dataset.locked;const s=(c=Ee.get(a))==null?void 0:c.overlay;s&&(s.classList.toggle("editor-overlay--locked",i),s.style.pointerEvents=i?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&te(),t}return!1},Ii=()=>{var a;const e=Pt();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return navigator.clipboard.writeText(t).catch(r=>{console.warn("[InkWise Studio] Clipboard write failed.",r)}),!0;try{const r=document.createElement("textarea");return r.value=t,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select(),document.execCommand("copy"),r.remove(),!0}catch(r){return console.warn("[InkWise Studio] Clipboard fallback failed.",r),!1}},Li=()=>{var r;const e=St();if(!e.length)return!1;const t=e[0],a=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!a)return!1;if((r=navigator==null?void 0:navigator.clipboard)!=null&&r.writeText)return navigator.clipboard.writeText(a).catch(i=>{console.warn("[InkWise Studio] Clipboard write failed for image.",i)}),!0;try{const i=document.createElement("textarea");return i.value=a,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),i.remove(),!0}catch(i){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",i),!1}},Ti=()=>{const e=$e();return e==="text"?Ii():e==="image"?Li():!1},Fi=()=>{const e=$e();return e==="text"?Ni():e==="image"?Ci():!1},ji=()=>{const e=$e();return e==="text"?ki():e==="image"?Ai():!1},_i=e=>{const t=$e();return t==="text"?Pi(e):t==="image"?zi(e):!1},Mi=e=>{const t=$e();return t==="text"?vi(e):t==="image"?xi(e):!1},Bi=e=>{const t=$e();return t==="text"?wi(e):t==="image"?Si(e):!1},Ri=e=>{const t=$e();return t==="text"?oi(e):t==="image"?ci(e):t==="background"?li(e):!1},$i=e=>{const t=$e();return t==="text"?si(e):t==="image"?ni(e):!1},Pi=e=>{const t=Pt();if(!t.length)return!1;const a=t[0],r=a.parentNode;if(!r)return!1;const i=Array.from(r.children),s=i.indexOf(a);if(s===-1)return!1;if(e==="bring-to-front")r.appendChild(a);else if(e==="send-to-back")r.insertBefore(a,i[0]);else if(e==="bring-forward"){const c=Math.min(i.length-1,s+1);if(c!==s){const d=i[c+1]||null;r.insertBefore(a,d)}}else if(e==="send-backward"){const c=Math.max(0,s-1);if(c!==s){const d=i[c];r.insertBefore(a,d)}}else return!1;return te(),w==null||w.schedule("text-layer"),!0},zi=e=>{const t=St();if(!t.length)return!1;const a=t[0],r=a.parentNode;if(!r)return!1;const i=Array.from(r.children),s=i.indexOf(a);if(s===-1)return!1;if(e==="bring-to-front")r.appendChild(a);else if(e==="send-to-back")r.insertBefore(a,i[0]);else if(e==="bring-forward"){const c=Math.min(i.length-1,s+1);if(c!==s){const d=i[c+1]||null;r.insertBefore(a,d)}}else if(e==="send-backward"){const c=Math.max(0,s-1);if(c!==s){const d=i[c];r.insertBefore(a,d)}}else return!1;return te(),w==null||w.schedule("image-layer"),!0},qi={setFontFamily:e=>$e()!=="text"?!1:ii(e),setFontSize:e=>$i(e),setColor:e=>Ri(e),getActiveKey:()=>he,getSelection:()=>{const e=$e();return{type:e,key:e==="text"?he:e==="image"?ve:null,textKey:he,imageKey:ve}},dispatch(e,t){const a=$e();switch(e){case"bold":a==="text"&&di();break;case"italic":a==="text"&&ui();break;case"underline":a==="text"&&gr("underline");break;case"strikethrough":a==="text"&&gr("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":a==="text"&&fi(e);break;case"list-bullets":a==="text"&&mi();break;case"line-spacing":a==="text"&&hi(t);break;case"letter-spacing":a==="text"&&gi(t);break;case"uppercase":case"lowercase":a==="text"&&pi(e);break;case"effect-style":a==="text"&&yi(t);break;case"effect-shape":a==="text"&&bi(t);break;case"opacity":Mi(t);break;case"rotation":Bi(t);break;case"layer":_i(t);break;case"more":t==="duplicate"?Fi():t==="delete"?ji():t==="lock"?Ei():t==="copy"&&Ti();break;case"replace-image":const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=i=>{const s=i.target.files[0];if(s){const c=new FileReader;c.onload=d=>{const u=d.target.result;qt(S=>{S.setAttribute("href",u),S.setAttributeNS("http://www.w3.org/1999/xlink","href",u)}),w==null||w.schedule("image-replace")},c.readAsDataURL(s)}},r.click();break;case"crop":{const i=St();if(!i.length)break;const s=Ee.get(i[0]),c=s==null?void 0:s.overlay;if(!c)break;if(nr(),(He==null?void 0:He.overlay)===c)He.refresh();else{wt();const d=Xr(c,i[0]);d&&(He=d)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=qi);const Ot=document.getElementById("canvas-zoom-select"),br=document.getElementById("canvas-zoom-display"),Di=document.querySelectorAll("[data-zoom-step]"),vr=document.querySelector(".preview-canvas-wrapper"),Ca=I,ut=[.25,.5,.75,1,1.5,2,3];if(Ot&&vr&&Ca){const e=a=>{Ca.style.setProperty("--canvas-scale",a.toString()),vr.style.removeProperty("transform"),Ot.value=a.toString(),br&&(br.textContent=`${Math.round(a*100)}%`),te()},t=a=>{const r=parseFloat(Ot.value)||1,i=ut.indexOf(r);if(i===-1)return;let s=i;a==="up"&&i<ut.length-1&&(s=i+1),a==="down"&&i>0&&(s=i-1),s!==i&&e(ut[s])};Ot.addEventListener("change",a=>{const r=parseFloat(a.target.value)||1;e(r)}),Di.forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.zoomStep;r&&t(r==="up"?"up":"down")})}),Ca&&Ca.addEventListener("wheel",a=>{a.preventDefault();const r=parseFloat(Ot.value)||1;let i=r;if(a.deltaY>0){const s=ut.indexOf(r);s>0&&(i=ut[s-1])}else{const s=ut.indexOf(r);s<ut.length-1&&(i=ut[s+1])}i!==r&&e(i)},{passive:!1}),e(parseFloat(Ot.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement,a=t&&typeof t.matches=="function"&&t.matches("#textFieldList input"),r=t&&typeof t.closest=="function"&&t.closest(".studio-react-widgets");!a&&!r&&(he||ve||De?ta():document.body.classList.remove("text-toolbar-visible"))},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",be,{once:!0}):be()}const Ja=[{name:"Lobster",family:"Lobster",weight:"400",style:"normal"},{name:"Fredoka One",family:"Fredoka One",weight:"400",style:"normal"},{name:"Pacifico",family:"Pacifico",weight:"400",style:"normal"},{name:"Baloo 2",family:"Baloo 2",weight:"400",style:"normal"},{name:"Poppins Bold",family:"Poppins",weight:"700",style:"normal"},{name:"Anton",family:"Anton",weight:"400",style:"normal"},{name:"Gochi Hand",family:"Gochi Hand",weight:"400",style:"normal"},{name:"Bangers",family:"Bangers",weight:"400",style:"normal"},{name:"Chewy",family:"Chewy",weight:"400",style:"normal"},{name:"Rubik ExtraBold",family:"Rubik",weight:"800",style:"normal"},{name:"Comic Neue Bold",family:"Comic Neue",weight:"700",style:"normal"},{name:"Amatic SC Bold",family:"Amatic SC",weight:"700",style:"normal"},{name:"Luckiest Guy",family:"Luckiest Guy",weight:"400",style:"normal"},{name:"Kalam Bold",family:"Kalam",weight:"700",style:"normal"},{name:"Bubblegum Sans",family:"Bubblegum Sans",weight:"400",style:"normal"},{name:"Shrikhand",family:"Shrikhand",weight:"400",style:"normal"},{name:"Jua",family:"Jua",weight:"400",style:"normal"},{name:"DynaPuff",family:"DynaPuff",weight:"400",style:"normal"},{name:"Cabin Sketch",family:"Cabin Sketch",weight:"400",style:"normal"},{name:"Titan One",family:"Titan One",weight:"400",style:"normal"},{name:"Montserrat SemiBold",family:"Montserrat",weight:"600",style:"normal"},{name:"Helvetica Neue",family:"Helvetica Neue",weight:"400",style:"normal"},{name:"Lato Bold",family:"Lato",weight:"700",style:"normal"},{name:"Source Sans Pro",family:"Source Sans Pro",weight:"400",style:"normal"},{name:"Poppins Medium",family:"Poppins",weight:"500",style:"normal"},{name:"Roboto Condensed",family:"Roboto Condensed",weight:"400",style:"normal"},{name:"Open Sans",family:"Open Sans",weight:"400",style:"normal"},{name:"Oswald",family:"Oswald",weight:"400",style:"normal"},{name:"Nunito Sans",family:"Nunito Sans",weight:"400",style:"normal"},{name:"Inter SemiBold",family:"Inter",weight:"600",style:"normal"},{name:"Futura PT",family:"Futura PT",weight:"400",style:"normal"},{name:"Avenir Next",family:"Avenir Next",weight:"400",style:"normal"},{name:"Work Sans Medium",family:"Work Sans",weight:"500",style:"normal"},{name:"Proxima Nova",family:"Proxima Nova",weight:"400",style:"normal"},{name:"IBM Plex Sans",family:"IBM Plex Sans",weight:"400",style:"normal"},{name:"Barlow SemiCondensed",family:"Barlow Semi Condensed",weight:"400",style:"normal"},{name:"Sora",family:"Sora",weight:"400",style:"normal"},{name:"Metropolis",family:"Metropolis",weight:"400",style:"normal"},{name:"Urbanist",family:"Urbanist",weight:"400",style:"normal"},{name:"Manrope",family:"Manrope",weight:"400",style:"normal"},{name:"Quicksand Light",family:"Quicksand",weight:"300",style:"normal"},{name:"Great Vibes",family:"Great Vibes",weight:"400",style:"normal"},{name:"Parisienne",family:"Parisienne",weight:"400",style:"normal"},{name:"Nunito Light",family:"Nunito",weight:"300",style:"normal"},{name:"Cormorant Garamond",family:"Cormorant Garamond",weight:"400",style:"normal"},{name:"Playfair Display",family:"Playfair Display",weight:"400",style:"normal"},{name:"Allura",family:"Allura",weight:"400",style:"normal"},{name:"DM Sans",family:"DM Sans",weight:"400",style:"normal"},{name:"Satisfy",family:"Satisfy",weight:"400",style:"normal"},{name:"Karla",family:"Karla",weight:"400",style:"normal"},{name:"Josefin Light",family:"Josefin Sans",weight:"300",style:"normal"},{name:"Merriweather Light",family:"Merriweather",weight:"300",style:"normal"},{name:"Sacramento",family:"Sacramento",weight:"400",style:"normal"},{name:"Dancing Script",family:"Dancing Script",weight:"400",style:"normal"},{name:"Marcellus",family:"Marcellus",weight:"400",style:"normal"},{name:"Crimson Pro",family:"Crimson Pro",weight:"400",style:"normal"},{name:"ABeeZee",family:"ABeeZee",weight:"400",style:"normal"},{name:"GFS Didot",family:"GFS Didot",weight:"400",style:"normal"},{name:"Overlock Light",family:"Overlock",weight:"300",style:"normal"},{name:"Hind Soft",family:"Hind",weight:"400",style:"normal"},{name:"Cinzel",family:"Cinzel",weight:"400",style:"normal"},{name:"Cormorant Infant",family:"Cormorant Infant",weight:"400",style:"normal"},{name:"Playfair Display Italic",family:"Playfair Display",weight:"400",style:"italic"},{name:"Alex Brush",family:"Alex Brush",weight:"400",style:"normal"},{name:"Montserrat Light",family:"Montserrat",weight:"300",style:"normal"},{name:"Bodoni Moda",family:"Bodoni Moda",weight:"400",style:"normal"},{name:"Cormorant Upright",family:"Cormorant Upright",weight:"400",style:"normal"},{name:"Libre Baskerville Italic",family:"Libre Baskerville",weight:"400",style:"italic"},{name:"Tangerine",family:"Tangerine",weight:"400",style:"normal"},{name:"Cinzel Decorative",family:"Cinzel Decorative",weight:"400",style:"normal"},{name:"Forum",family:"Forum",weight:"400",style:"normal"},{name:"Cardo Italic",family:"Cardo",weight:"400",style:"italic"},{name:"Unna Italic",family:"Unna",weight:"400",style:"italic"},{name:"Prata",family:"Prata",weight:"400",style:"normal"},{name:"Gilda Display",family:"Gilda Display",weight:"400",style:"normal"},{name:"Cormorant SC",family:"Cormorant SC",weight:"400",style:"normal"},{name:"Quattrocento",family:"Quattrocento",weight:"400",style:"normal"},{name:"Marcellus SC",family:"Marcellus SC",weight:"400",style:"normal"}],as=[12,14,16,18,24,32,36,39,42,48,60];function Za(be,o,l){return Math.min(Math.max(be,o),l)}function rs({onFontChange:be=()=>{},onSizeChange:o=()=>{},onAction:l=()=>{},onColorChange:f=()=>{},activeElementType:m=null}){const x=$.useMemo(()=>Ja[0],[]),[M,L]=$.useState(x),[B,X]=$.useState(39),[I,q]=$.useState(!1),[K,J]=$.useState(!1),Z=$.useRef(null),ke=$.useRef(null),[ue,H]=$.useState(!1),ie=$.useRef(null),[G,de]=$.useState(!1),ze=$.useRef(null),[at,je]=$.useState(!1),At=$.useRef(null),[ct,V]=$.useState("#FFFFFF"),[_e,rt]=$.useState([]),oa=$.useMemo(()=>[{label:"Grayscale",colors:["#FFFFFF","#E5E7EB","#9CA3AF","#4B5563","#111827"]},{label:"Blues",colors:["#DCEEFB","#A8D1FF","#4DA1FF","#2563EB","#0B3D91"]},{label:"Greens",colors:["#DEF7EC","#BFEBD3","#34D399","#059669","#064E3B"]},{label:"Yellows",colors:["#FFFBEB","#FEF3C7","#FBBF24","#F59E0B","#B45309"]},{label:"Oranges",colors:["#FFF1E6","#FFD8B5","#FB923C","#F97316","#7C2D12"]},{label:"Reds",colors:["#FFEFF2","#FFD6DD","#EF4444","#DC2626","#58151C"]}],[]),[pt,mt]=$.useState(0),[Et,Gt]=$.useState(0),[It,la]=$.useState(100),[it,Lt]=$.useState("swatches"),qe=$.useRef(null),ca=$.useRef(!1),Me=m==="text",P=m==="image",Se=Me||P,[Tt,Ft]=$.useState(0),[Be,Ee]=$.useState(0),[Ye,jt]=$.useState(0),[ye,Y]=$.useState(0);function da(y,A,D,pe){const Ce=y/100,Ne=A/100,k=D/100,Ve=pe/100,Te=Math.round(255*(1-Ce)*(1-Ve)),et=Math.round(255*(1-Ne)*(1-Ve)),ha=Math.round(255*(1-k)*(1-Ve)),ga=Qa=>Qa.toString(16).padStart(2,"0").toUpperCase();return`#${ga(Te)}${ga(et)}${ga(ha)}`}$.useEffect(()=>{try{const y=typeof window<"u"?window.inkwiseToolbar:null;if(y&&typeof y.getSelection=="function"){const A=y.getSelection();if(A){if(A.fontFamily){const D=Ja.find(pe=>pe.family===A.fontFamily||pe.name===A.fontFamily);D&&L(D)}Number.isFinite(Number(A.fontSize))&&X(Number(A.fontSize)),A.color&&V(String(A.color))}}}catch{}if(it==="cmyk")try{const y=da(Tt,Be,Ye,ye);V(y),f(y)}catch{}},[Tt,Be,Ye,ye,it]);function _t(y){const A=y.replace("#",""),D=parseInt(A,16),pe=D>>16&255,Ce=D>>8&255,Ne=D&255;return{r:pe,g:Ce,b:Ne}}function Ue(y,A,D){y/=255,A/=255,D/=255;const pe=Math.max(y,A,D),Ce=Math.min(y,A,D);let Ne=0,k=0,Ve=(pe+Ce)/2;if(pe!==Ce){const Te=pe-Ce;switch(k=Ve>.5?Te/(2-pe-Ce):Te/(pe+Ce),pe){case y:Ne=(A-D)/Te+(A<D?6:0);break;case A:Ne=(D-y)/Te+2;break;case D:Ne=(y-A)/Te+4;break}Ne/=6}return{h:Math.round(Ne*360),s:Math.round(k*100),l:Math.round(Ve*100)}}function Ke(y,A,D){A/=100,D/=100;const pe=k=>(k+y/30)%12,Ce=A*Math.min(D,1-D),Ne=k=>{const Ve=D-Ce*Math.max(-1,Math.min(pe(k)-3,Math.min(9-pe(k),1)));return Math.round(255*Ve).toString(16).padStart(2,"0")};return`#${Ne(0)}${Ne(8)}${Ne(4)}`.toUpperCase()}$.useEffect(()=>{try{const y=_t(ct.replace("#","")),{h:A,s:D,l:pe}=Ue(y.r,y.g,y.b);mt(A),Gt(D),la(pe)}catch{}},[ct]),$.useEffect(()=>{const y=Ke(pt,Et,It);V(y)},[pt,Et,It]);const Je=y=>{ca.current=!0,w(y),window.addEventListener("mousemove",w),window.addEventListener("mouseup",ht)},w=y=>{if(!qe.current)return;const A=qe.current.getBoundingClientRect(),D=Math.min(Math.max(0,(y.clientX-A.left)/A.width),1),pe=Math.min(Math.max(0,(y.clientY-A.top)/A.height),1),Ce=Math.round(D*100),Ne=Math.round((1-pe)*100);Gt(Ce),la(Ne)},ht=()=>{ca.current=!1,window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",ht)};$.useEffect(()=>{const y=D=>{(I&&Z.current&&!Z.current.contains(D.target)||K&&ke.current&&!ke.current.contains(D.target)||ue&&ie.current&&!ie.current.contains(D.target)||G&&ze.current&&!ze.current.contains(D.target)||Xt&&Yt.current&&!Yt.current.contains(D.target)||gt&&Kt.current&&!Kt.current.contains(D.target)||Jt&&We.current&&!We.current.contains(D.target)||st&&Bt.current&&!Bt.current.contains(D.target))&&(q(!1),J(!1),H(!1),de(!1),xe(!1),Le(!1),we(!1),nt(!1))},A=D=>{(D.key==="Escape"||D.key==="Esc")&&(q(!1),J(!1),H(!1),de(!1),xe(!1),Le(!1),we(!1),nt(!1),vt(!1),Re(!1),Qe(!1),je(!1))};return(I||K||ue||G||Xt||gt||Jt||at||st||fa||ma||xt)&&(document.addEventListener("mousedown",y),document.addEventListener("keydown",A)),()=>{document.removeEventListener("mousedown",y),document.removeEventListener("keydown",A)}},[I,K]);const he=y=>{Me&&(L(y),be(y.family),q(!1))},ve=y=>{const A=(y||"#FFFFFF").toUpperCase();V(A),f(A),rt(D=>[A,...D.filter(Ce=>Ce!==A)].slice(0,8)),J(!1)},De=y=>{const A=Za(y,8,96);X(A),o(A)},He=y=>{Se&&De(B+y)},ua=y=>{if(!Se)return;const A=Number(y.target.value);Number.isFinite(A)&&De(A)},[Xt,xe]=$.useState(!1),Yt=$.useRef(null),[gt,Le]=$.useState(!1),Kt=$.useRef(null),[Jt,we]=$.useState(!1),We=$.useRef(null),[yt,Zt]=$.useState(1.4),[Mt,Ze]=$.useState(.12),[st,nt]=$.useState(!1),[te,bt]=$.useState(100),Bt=$.useRef(null),[fa,vt]=$.useState(!1),[pa,Qt]=$.useState(0),Rt=$.useRef(null),[ma,Re]=$.useState(!1),$t=$.useRef(null),[xt,Qe]=$.useState(!1),_a=$.useRef(null);$.useEffect(()=>{Me||(q(!1),H(!1),de(!1),xe(!1),Le(!1),we(!1),je(!1))},[Me]),$.useEffect(()=>{Se||(J(!1),nt(!1),vt(!1),Re(!1),Qe(!1))},[Se]);const Ma=()=>{Me&&(Zt(1.4),l("line-spacing")(1.4))},ea=()=>{Me&&(Ze(.12),l("letter-spacing")(.12))};return n.jsxs("div",{className:`text-mini-toolbar ${Se?"floating":""}`,role:"toolbar","aria-label":P?"Image editing toolbar":"Text editing toolbar",children:[n.jsxs("div",{className:"toolbar-group toolbar-group--font",children:[P?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>l("replace-image"),children:"Replace Image"}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("button",{type:"button",className:"ghost-button",onClick:()=>l("crop"),children:[n.jsx("i",{className:"fa-solid fa-crop-simple"})," Crop"]})]}):n.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>{Me&&q(y=>!y)},"aria-label":Me?"Choose font family":"Font selection available for text elements","aria-haspopup":"listbox","aria-expanded":I,disabled:!Me,children:[Me?M.name:"Select element"," ",n.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),Me&&I&&n.jsx("div",{className:"font-modal",ref:Z,children:n.jsx("div",{className:"font-modal-content",children:Ja.map(y=>n.jsx("button",{type:"button",className:"font-option",onClick:()=>he(y),style:{fontFamily:y.family,fontWeight:y.weight,fontStyle:y.style},children:y.name},y.name))})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--size",role:"group","aria-label":P?"Image scale":"Font size",children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":P?"Decrease image scale":"Decrease font size",onClick:()=>He(-2),disabled:!Se,children:n.jsx("i",{className:"fa-solid fa-minus","aria-hidden":"true"})}),n.jsx("label",{className:"sr-only",htmlFor:"mini-toolbar-size",children:P?"Image scale":"Font size"}),n.jsx("select",{id:"mini-toolbar-size",className:"size-select",value:B,onChange:ua,disabled:!Se,children:as.map(y=>n.jsx("option",{value:y,children:y},y))}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":P?"Increase image scale":"Increase font size",onClick:()=>He(2),disabled:!Se,children:n.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"color-swatch","aria-label":P?"Choose image tint":"Choose text color",onClick:()=>{Se&&(q(!1),J(y=>!y))},disabled:!Se,"aria-expanded":K,children:n.jsx("span",{className:"color-swatch__chip",style:{background:ct}})}),K&&n.jsx("div",{className:"color-modal",ref:ke,children:n.jsxs("div",{className:"color-modal-content",children:[n.jsxs("div",{className:"color-modal-header",children:[n.jsx("div",{className:"color-modal-title",children:P?"Image tint":"Text color"}),n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>J(!1),"aria-label":"Close color picker",children:n.jsx("i",{className:"fa-solid fa-x"})})]}),n.jsx("div",{className:"color-picker-area",children:n.jsx("div",{className:"inline-color-picker",children:n.jsxs("div",{className:"spectrum-picker",children:[n.jsx("div",{className:"spectrum-area",ref:qe,onMouseDown:Je,style:{background:`linear-gradient(to right, #fff, hsl(${pt}, 100%, 50%)), linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,1))`},role:"application","aria-label":"Color spectrum",children:n.jsx("div",{className:"spectrum-handle",style:{left:`${Et}%`,top:`${100-It}%`},"aria-hidden":"true"})}),n.jsx("div",{className:"hue-row",children:n.jsx("input",{className:"hue-range",type:"range",min:"0",max:"360",value:pt,onChange:y=>mt(Number(y.target.value)),style:{background:`linear-gradient(to right, ${Array.from({length:13}).map((y,A)=>`hsl(${A*30},100%,50%)`).join(",")})`},"aria-label":"Hue"})}),n.jsxs("div",{className:"hex-row",children:[n.jsx("input",{type:"text",className:"hex-input",value:Ke(pt,Et,It),onChange:y=>V(y.target.value),"aria-label":"Hex color value"}),n.jsx("button",{type:"button",className:"eyedropper-button",title:"Eyedropper","aria-label":"Eyedropper",children:n.jsx("i",{className:"fa-solid fa-eye-dropper"})})]})]})})}),n.jsxs("div",{className:"swatch-sections",children:[n.jsxs("div",{className:"tabs",children:[n.jsx("div",{className:`tab ${it==="swatches"?"active":""}`,onClick:()=>Lt("swatches"),children:"Swatches"}),n.jsx("div",{className:`tab ${it==="cmyk"?"active":""}`,onClick:()=>Lt("cmyk"),children:"CMYK"})]}),n.jsx("div",{className:"section-divider","aria-hidden":"true"}),it==="swatches"&&n.jsxs(n.Fragment,{children:[_e.length>0&&n.jsxs("div",{className:"swatch-section",children:[n.jsx("div",{className:"swatch-title",children:"Recent colors"}),n.jsx("div",{className:"swatches-grid",children:_e.map(y=>n.jsx("button",{type:"button",className:"swatch",style:{background:y},onClick:()=>ve(y)},y))})]}),_e.length>0&&oa.length>0&&n.jsx("div",{className:"section-divider","aria-hidden":"true"}),n.jsx("div",{className:"swatch-section",children:n.jsx("div",{className:"preset-groups",children:oa.map((y,A)=>n.jsx("div",{className:"swatch-group",children:n.jsx("div",{className:"swatches-grid preset",children:y.colors.map(D=>n.jsx("button",{type:"button",className:"swatch",style:{background:D},onClick:()=>ve(D)},D))})},A))})})]}),it==="cmyk"&&n.jsxs("div",{className:"swatch-section cmyk-section",children:[n.jsx("div",{className:"swatch-title",children:"CMYK (preview)"}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"C"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Tt,onChange:y=>Ft(Number(y.target.value)),className:"cmyk-range c-range","aria-label":"Cyan"}),n.jsxs("div",{className:"cmyk-value",children:[Tt,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"M"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Be,onChange:y=>Ee(Number(y.target.value)),className:"cmyk-range m-range","aria-label":"Magenta"}),n.jsxs("div",{className:"cmyk-value",children:[Be,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"Y"}),n.jsx("input",{type:"range",min:"0",max:"100",value:Ye,onChange:y=>jt(Number(y.target.value)),className:"cmyk-range y-range","aria-label":"Yellow"}),n.jsxs("div",{className:"cmyk-value",children:[Ye,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"K"}),n.jsx("input",{type:"range",min:"0",max:"100",value:ye,onChange:y=>Y(Number(y.target.value)),className:"cmyk-range k-range","aria-label":"Key Black"}),n.jsxs("div",{className:"cmyk-value",children:[ye,"%"]})]})]})]})]})})]}),Me&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--actions",role:"group","aria-label":"Text format actions",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bold",onClick:()=>{H(y=>!y),J(!1),q(!1)},children:n.jsx("span",{className:"toolbar-label",children:"B"})}),ue&&n.jsx("div",{className:"format-modal",ref:ie,role:"dialog","aria-label":"Text formatting options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option",title:"Bold",onClick:()=>{l("bold"),H(!1)},children:n.jsx("i",{className:"fi fi-ss-bold","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Italic",onClick:()=>{l("italic"),H(!1)},children:n.jsx("i",{className:"fi fi-br-italic","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Underline",onClick:()=>{l("underline"),H(!1)},children:n.jsx("i",{className:"fi fi-br-underline","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Strikethrough",onClick:()=>{l("strikethrough"),H(!1)},children:n.jsx("i",{className:"fi fi-br-strikethrough","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Align center",onClick:()=>{xe(y=>!y),H(!1),J(!1),q(!1)},children:n.jsx("i",{className:"fa-solid fa-align-center","aria-hidden":"true"})}),Xt&&n.jsx("div",{className:"align-modal",ref:Yt,role:"dialog","aria-label":"Alignment options",children:n.jsxs("div",{className:"align-modal-content",children:[n.jsx("button",{type:"button",className:"align-option",title:"Align-justify",onClick:()=>{l("align-justify"),xe(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-center",onClick:()=>{l("align-center"),xe(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"5",y:"4",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"5",y:"14",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-left",onClick:()=>{l("align-left"),xe(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-right",onClick:()=>{l("align-right"),xe(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"9",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"9",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bulleted list",onClick:()=>{Le(y=>!y),xe(!1),H(!1),J(!1),q(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})}),gt&&n.jsx("div",{className:"list-modal",ref:Kt,role:"dialog","aria-label":"List options",children:n.jsxs("div",{className:"list-modal-content",children:[n.jsx("button",{type:"button",className:"list-option",title:"Numbered list",onClick:()=>{Le(!1),we(!0)},children:n.jsx("i",{className:"fa-solid fa-list-ol","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"list-option",title:"Bulleted list",onClick:()=>{l("list-bullets"),Le(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Numbered list",onClick:()=>{we(y=>!y),Le(!1),xe(!1),H(!1),J(!1),q(!1)},children:n.jsx("i",{className:"fa-solid fa-text-height","aria-hidden":"true"})}),Jt&&n.jsx("div",{className:"number-modal",ref:We,role:"dialog","aria-label":"Text spacing options",children:n.jsxs("div",{className:"number-modal-content",children:[n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Line spacing"}),n.jsx("input",{type:"range",min:"0.8",max:"3",step:"0.01",value:yt,onChange:y=>{const A=Number(y.target.value);Zt(A),l("line-spacing")(A)},className:"number-range line-range","aria-label":"Line spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:Ma,"aria-label":"Reset line spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:yt,onChange:y=>{const A=Number(y.target.value);Zt(A),l("line-spacing")(A)}})]}),n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Letter spacing"}),n.jsx("input",{type:"range",min:"-0.5",max:"1",step:"0.01",value:Mt,onChange:y=>{const A=Number(y.target.value);Ze(A),l("letter-spacing")(A)},className:"number-range letter-range","aria-label":"Letter spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:ea,"aria-label":"Reset letter spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:Mt,onChange:y=>{const A=Number(y.target.value);Ze(A),l("letter-spacing")(A)}})]})]})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--menu",role:"group","aria-label":"Text styles",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"text-button",onClick:()=>{de(y=>!y),Le(!1),xe(!1),J(!1),q(!1),we(!1),H(!1),je(!1)},"aria-label":"Format",children:"Format"}),G&&n.jsx("div",{className:"case-modal format-modal",ref:ze,role:"dialog","aria-label":"Case options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option ",title:"Lowercase",onClick:()=>{l("lowercase"),de(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"a"})}),n.jsx("button",{type:"button",className:"format-option ",title:"Uppercase",onClick:()=>{l("uppercase"),de(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"A"})})]})}),n.jsxs("button",{type:"button",className:"text-button",onClick:()=>{je(y=>!y),de(!1),Le(!1),xe(!1),H(!1),J(!1),q(!1),we(!1)},children:["T",n.jsx("span",{className:"text-button__super",children:"+"})," Effects"]}),at&&n.jsxs("div",{className:"effects-modal",ref:At,role:"dialog","aria-label":"Text effects",children:[n.jsx("button",{type:"button",className:"modal-close-btn","aria-label":"Close effects",onClick:()=>je(!1),children:n.jsx("i",{className:"fa-solid fa-x","aria-hidden":"true"})}),n.jsxs("div",{className:"effects-modal-content",children:[n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Style"}),n.jsxs("div",{className:"effects-grid",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-style")("none")},children:n.jsx("div",{className:"effect-preview none",children:n.jsx("i",{className:"fa-solid fa-ban","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Shadow",onClick:()=>{l("effect-style")("shadow")},children:n.jsx("div",{className:"effect-preview shadow",children:n.jsx("i",{className:"fi fi-rr-text-shadow","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Highlight",onClick:()=>{l("effect-style")("highlight")},children:n.jsx("div",{className:"effect-preview highlight",children:n.jsx("i",{className:"fa-solid fa-highlighter","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Glitch",onClick:()=>{l("effect-style")("glitch")},children:n.jsx("div",{className:"effect-preview glitch",children:n.jsx("span",{className:"glitch-mark",children:"/A"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Echo",onClick:()=>{l("effect-style")("echo")},children:n.jsx("div",{className:"effect-preview echo",children:n.jsx("span",{className:"echo-mark",children:"//A"})})})]})]}),n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Shape"}),n.jsxs("div",{className:"effects-grid two",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{l("effect-shape")("none")},children:n.jsx("div",{className:"effect-preview none",children:"None"})}),n.jsx("button",{type:"button",className:"effect-option",title:"Curve",onClick:()=>{l("effect-shape")("curve")},children:n.jsx("div",{className:"effect-preview curve",children:"Curve"})})]})]})]})]})]})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--utility",role:"group","aria-label":"Utility actions",style:{position:"relative"},children:[n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Spacing",onClick:()=>{Se&&(nt(y=>!y),je(!1),de(!1),Le(!1),xe(!1),H(!1),J(!1),q(!1),we(!1))},disabled:!Se,children:n.jsx("i",{className:"fi fi-rr-chess-board","aria-hidden":"true"})}),st&&n.jsx("div",{className:"opacity-modal",ref:Bt,role:"dialog","aria-label":"Opacity",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"opacity-modal-content",children:[n.jsxs("div",{className:"opacity-row",children:[n.jsx("label",{className:"opacity-label",children:"Opacity"}),n.jsx("input",{className:"opacity-input",type:"number",min:"0",max:"100",value:te,onChange:y=>{const A=Za(Number(y.target.value)||0,0,100);bt(A),l("opacity")(A)},"aria-label":"Opacity percent"})]}),n.jsx("div",{className:"opacity-slider-row",children:n.jsx("input",{type:"range",min:"0",max:"100",value:te,onChange:y=>{const A=Number(y.target.value);bt(A),l("opacity")(A)},className:"opacity-slider","aria-label":"Opacity slider",style:{background:"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1))"}})})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Layers",onClick:()=>{Se&&(Re(y=>!y),vt(!1),nt(!1),je(!1),de(!1),Le(!1),xe(!1),H(!1),J(!1),q(!1),we(!1))},disabled:!Se,children:n.jsx("i",{className:"fa-solid fa-layer-group","aria-hidden":"true"})}),ma&&n.jsx("div",{className:"layers-modal",ref:$t,role:"dialog","aria-label":"Layer management",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"layers-modal-content",children:[n.jsxs("button",{type:"button",className:"layer-option",title:"Bring to front",onClick:()=>{l("layer")("bring-to-front"),Re(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring to front"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Bring forward",onClick:()=>{l("layer")("bring-forward"),Re(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring forward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send backward",onClick:()=>{l("layer")("send-backward"),Re(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send backward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send to back",onClick:()=>{l("layer")("send-to-back"),Re(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send to back"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Share / Rotation",onClick:()=>{Se&&(vt(y=>!y),nt(!1),je(!1),de(!1),Le(!1),xe(!1),H(!1),J(!1),q(!1),we(!1))},disabled:!Se,children:n.jsx("i",{className:"fi fi-rr-refresh","aria-hidden":"true"})}),fa&&n.jsx("div",{className:"rotation-modal",ref:Rt,role:"dialog","aria-label":"Rotation",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"rotation-modal-content",children:[n.jsxs("div",{className:"rotation-row",children:[n.jsx("label",{className:"rotation-label",children:"Rotation"}),n.jsx("input",{className:"rotation-input",type:"number",min:"-180",max:"180",value:pa,onChange:y=>{const A=Za(Number(y.target.value)||0,-180,180);Qt(A),l("rotation")(A)},"aria-label":"Rotation degrees"})]}),n.jsxs("div",{className:"rotation-slider-row",children:[n.jsx("input",{type:"range",min:"-180",max:"180",value:pa,onChange:y=>{const A=Number(y.target.value);Qt(A),l("rotation")(A)},className:"rotation-slider","aria-label":"Rotation slider"}),n.jsx("i",{className:"fa-solid fa-rotate-right rotation-icon","aria-hidden":"true"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"More options",onClick:()=>{Se&&(Qe(y=>!y),Re(!1),vt(!1),nt(!1),je(!1),de(!1),Le(!1),xe(!1),H(!1),J(!1),q(!1),we(!1))},disabled:!Se,children:n.jsx("i",{className:"fa-solid fa-ellipsis","aria-hidden":"true"})}),xt&&n.jsx("div",{className:"more-modal",ref:_a,role:"dialog","aria-label":"More options",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"more-modal-content",children:[n.jsxs("button",{type:"button",className:"more-option",title:"Duplicate",onClick:()=>{l("more")("duplicate"),Qe(!1)},children:[n.jsx("i",{className:"fa-solid fa-clone","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Duplicate"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Delete",onClick:()=>{l("more")("delete"),Qe(!1)},children:[n.jsx("i",{className:"fi fi-rr-trash","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Delete"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Lock",onClick:()=>{l("more")("lock"),Qe(!1)},children:[n.jsx("i",{className:"fi fi-rr-unlock","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Lock"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Copy",onClick:()=>{l("more")("copy"),Qe(!1)},children:[n.jsx("i",{className:"fa-solid fa-copy","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Copy"})]})]})})]})]})]})}function is(){const be=document.getElementById("inkwise-customer-studio-bootstrap");if(be)try{const o=JSON.parse(be.textContent||"{}");if(o&&typeof o=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=o),o}catch(o){console.error("[InkWise Studio] Failed to parse bootstrap payload.",o)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function ss(){const be=$.useMemo(()=>is(),[]),[o,l]=$.useState("initializing"),[f,m]=$.useState("text");if($.useEffect(()=>{ts(),l("ready")},[]),$.useEffect(()=>{if(typeof window>"u")return;const X=q=>{const K=(q==null?void 0:q.detail)||{};m(K.type||null)};window.addEventListener("inkwise:active-element",X);const I=window.inkwiseToolbar;if(I&&typeof I.getSelection=="function")try{const q=I.getSelection();q&&q.type&&m(q.type)}catch(q){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",q)}return()=>{window.removeEventListener("inkwise:active-element",X)}},[]),!be||Object.keys(be).length===0)return null;const x=X=>{const I=typeof window<"u"?window.inkwiseToolbar:null;if(!I||typeof I.setFontFamily!="function"){console.debug("[InkWise Studio] Font change ignored (bridge unavailable).",X);return}I.setFontFamily(X)},M=X=>{const I=typeof window<"u"?window.inkwiseToolbar:null;if(!I||typeof I.setFontSize!="function"){console.debug("[InkWise Studio] Size change ignored (bridge unavailable).",X);return}I.setFontSize(X)},L=X=>{const I=typeof window<"u"?window.inkwiseToolbar:null;if(!I||typeof I.setColor!="function"){console.debug("[InkWise Studio] Color change ignored (bridge unavailable).",X);return}I.setColor(X)},B=X=>{const I=typeof window<"u"?window.inkwiseToolbar:null;return!I||typeof I.dispatch!="function"?(console.debug("[InkWise Studio] Toolbar action ignored (bridge unavailable).",X),()=>{}):new Set(["line-spacing","letter-spacing","effect-style","effect-shape","opacity","rotation","layer","more"]).has(X)?K=>{I.dispatch(X,K)}:(I.dispatch(X),()=>{})};return n.jsx("div",{className:"studio-react-widgets",children:n.jsx(rs,{onAction:B,onFontChange:x,onSizeChange:M,onColorChange:L,activeElementType:f})})}function ns(){const be=()=>{const o=document.getElementById("inkwise-customer-studio-root");if(!o)return;Ji.createRoot(o).render(n.jsx(Zi.StrictMode,{children:n.jsx(ss,{})}))};if(document.readyState==="complete"||document.readyState==="interactive"){be();return}document.addEventListener("DOMContentLoaded",be,{once:!0})}ns();
