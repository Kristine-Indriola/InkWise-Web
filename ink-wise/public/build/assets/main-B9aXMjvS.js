import{r as x,j as n,c as Ra,R as Da}from"./client-Cv0X-2PX.js";class St{constructor(c,o={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",c),this.svg=c,this.options={onImageChange:o.onImageChange||null,onTextChange:o.onTextChange||null,...o};const u=document&&document.body&&document.body.dataset?document.body.dataset:{},f=(u.imageReplacementMode||"").toLowerCase();let S="full";f==="panel-only"||f==="disabled"?S=f:u.allowImageReplacement==="false"&&(S="disabled"),this.imageReplacementMode=S,this.allowCanvasImageTools=S!=="disabled",this.changeableImages=[],this.textElements=[],this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const c=this.svg.dataset.svgData;if(c){const o=JSON.parse(c);this.changeableImages=o.changeable_images||[],this.textElements=o.text_elements||[]}}toSvgPoint(c,o){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const u=this.svg.createSVGPoint();u.x=c,u.y=o;const f=this.svg.getScreenCTM();return f?u.matrixTransform(f.inverse()):null}setupImageHandlers(){const c=this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image]');if(console.log("SvgTemplateEditor: Found",c.length,"changeable image elements"),!this.allowCanvasImageTools){c.forEach(o=>{if(o.style.cursor="default",o.classList.remove("svg-changeable-image"),o.classList.remove("changeable-image-hover"),o._boundingBox){try{o._boundingBox.remove()}catch{}o._boundingBox=null}});return}setTimeout(()=>{c.forEach((o,u)=>{console.log("SvgTemplateEditor: Setting up element",u,o),o.style.cursor="pointer",o.classList.add("svg-changeable-image"),o.classList.add("changeable-image-hover"),o.addEventListener("mouseenter",function(){o.classList.add("changeable-image-active")}),o.addEventListener("mouseleave",function(){o.classList.remove("changeable-image-active")});const f=this.createBoundingBox(o);o._boundingBox=f,this.makeDraggable(o)})},200)}createBoundingBox(c){const o=c.getBBox(),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.classList.add("svg-bounding-box");const f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.classList.add("svg-bounding-box__rect"),f.setAttribute("fill","none"),f.setAttribute("stroke","#007cba"),f.setAttribute("stroke-width","2"),f.setAttribute("stroke-dasharray","5,5"),f.setAttribute("rx","3"),f.style.pointerEvents="none",u.appendChild(f),this.createResizeHandles().forEach(k=>u.appendChild(k)),this.svg.appendChild(u),this.positionBoundingElements(u,o),u}createResizeHandles(){const c=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(u=>{const f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("r","4"),f.setAttribute("fill","#007cba"),f.setAttribute("stroke","#ffffff"),f.setAttribute("stroke-width","1"),f.classList.add("resize-handle",`handle-${u.name}`),f.style.pointerEvents="all",f.style.cursor=`${u.name}-resize`,c.push(f)}),c}positionBoundingElements(c,o){const u=c.querySelector(".svg-bounding-box__rect");if(!u)return;const f=5,S=o.x-f,k=o.y-f,w=o.width+f*2,v=o.height+f*2;u.setAttribute("x",S),u.setAttribute("y",k),u.setAttribute("width",Math.max(w,0)),u.setAttribute("height",Math.max(v,0)),c.querySelectorAll(".resize-handle").forEach(y=>{y.classList.contains("handle-nw")?(y.setAttribute("cx",S),y.setAttribute("cy",k)):y.classList.contains("handle-ne")?(y.setAttribute("cx",S+w),y.setAttribute("cy",k)):y.classList.contains("handle-sw")?(y.setAttribute("cx",S),y.setAttribute("cy",k+v)):y.classList.contains("handle-se")?(y.setAttribute("cx",S+w),y.setAttribute("cy",k+v)):y.classList.contains("handle-n")?(y.setAttribute("cx",S+w/2),y.setAttribute("cy",k)):y.classList.contains("handle-s")?(y.setAttribute("cx",S+w/2),y.setAttribute("cy",k+v)):y.classList.contains("handle-e")?(y.setAttribute("cx",S+w),y.setAttribute("cy",k+v/2)):y.classList.contains("handle-w")&&(y.setAttribute("cx",S),y.setAttribute("cy",k+v/2))})}updateBoundingBox(c){if(!c._boundingBox)return;const o=c.getBBox();this.positionBoundingElements(c._boundingBox,o)}makeDraggable(c){let o=!1,u=0,f=0,S=0,k=0,w=0,v=0;const L=T=>{if(T.target.closest(".resize-handle"))return;const M=this.toSvgPoint(T.clientX,T.clientY);if(!M)return;const K=c.getBBox();u=parseFloat(c.getAttribute("x")),f=parseFloat(c.getAttribute("y")),Number.isNaN(u)&&(u=K.x,c.setAttribute("x",u)),Number.isNaN(f)&&(f=K.y,c.setAttribute("y",f)),S=M.x-u,k=M.y-f,w=u,v=f,o=!0,c.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",T.preventDefault()},y=T=>{if(!o)return;const M=this.toSvgPoint(T.clientX,T.clientY);M&&(w=M.x-S,v=M.y-k,c.removeAttribute("transform"),c.setAttribute("x",w),c.setAttribute("y",v),this.updateBoundingBox(c),T.preventDefault())},C=T=>{if(!o)return;o=!1,c.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(c);const M=new CustomEvent("svgImageMoved",{detail:{element:c,x:w,y:v}});this.svg.dispatchEvent(M),T.preventDefault()};c.addEventListener("mousedown",L),document.addEventListener("mousemove",y),document.addEventListener("mouseup",C),c._boundingBox.querySelectorAll(".resize-handle").forEach(T=>{this.makeResizable(c,T)})}makeResizable(c,o){let u=!1,f=null,S=0,k=0,w=0,v=0,L="",y=0;const C=M=>{const K=this.toSvgPoint(M.clientX,M.clientY);if(!K)return;const z=c.getBBox();S=z.width,k=z.height,w=parseFloat(c.getAttribute("x")),v=parseFloat(c.getAttribute("y")),Number.isNaN(w)&&(w=z.x,c.setAttribute("x",w)),Number.isNaN(v)&&(v=z.y,c.setAttribute("y",v)),y=parseFloat(c.getAttribute("font-size"))||parseFloat(window.getComputedStyle(c).fontSize)||16,f=K,L=Array.from(o.classList).find(A=>A.startsWith("handle-"))||"",u=!0,c.style.cursor=o.style.cursor,this.svg.style.cursor=o.style.cursor,document.body.style.userSelect="none",M.preventDefault(),M.stopPropagation()},_=M=>{if(!u)return;const K=this.toSvgPoint(M.clientX,M.clientY);if(!K)return;const z=K.x-f.x,A=K.y-f.y;let O=S,B=k,U=w,ve=v;switch(L){case"handle-se":O=S+z,B=k+A;break;case"handle-sw":O=S-z,B=k+A,U=w+z;break;case"handle-ne":O=S+z,B=k-A,ve=v+A;break;case"handle-nw":O=S-z,B=k-A,U=w+z,ve=v+A;break}O=Math.max(20,O),B=Math.max(20,B);const De=c.tagName.toLowerCase();if(De==="image"||De==="rect")c.setAttribute("width",O),c.setAttribute("height",B),c.setAttribute("x",U),c.setAttribute("y",ve);else{const pe=Math.max(1,S),tt=Math.max(1,k),Ce=O/pe,we=B/tt,le=Math.max(Ce,we),at=Math.max(6,y*le);c.setAttribute("font-size",at)}this.updateBoundingBox(c),M.preventDefault(),M.stopPropagation()},T=M=>{if(!u)return;u=!1,c.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const K={element:c,width:parseFloat(c.getAttribute("width")),height:parseFloat(c.getAttribute("height")),x:parseFloat(c.getAttribute("x")),y:parseFloat(c.getAttribute("y"))},z=new CustomEvent("svgImageResized",{detail:K});this.svg.dispatchEvent(z),M.preventDefault(),M.stopPropagation()};o.addEventListener("mousedown",C),document.addEventListener("mousemove",_),document.addEventListener("mouseup",T)}setupTextHandlers(){const c=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(u=>{u.style.cursor="pointer",u.classList.add("svg-editable-text"),u.addEventListener("click",function(f){f.preventDefault(),c.showTextEditDialog(u)}),u.addEventListener("mouseenter",function(){u.classList.add("editable-text-hover")}),u.addEventListener("mouseleave",function(){u.classList.remove("editable-text-hover")})})}showImageUploadDialog(c){const o=this,u=document.createElement("input");u.type="file",u.accept="image/*",u.style.display="none",u.addEventListener("change",function(f){const S=f.target.files[0];S&&o.handleImageUpload(S,c),document.body.removeChild(u)}),document.body.appendChild(u),u.click()}handleImageUpload(c,o){const u=this,f=new FileReader;f.onload=function(S){const k=S.target.result;if(o.tagName.toLowerCase()==="image")o.setAttribute("href",k),o.hasAttribute("xlink:href")&&o.removeAttribute("xlink:href");else if(o.tagName.toLowerCase()==="rect"){const v=document.createElementNS("http://www.w3.org/2000/svg","image");v.setAttribute("x",o.getAttribute("x")||"0"),v.setAttribute("y",o.getAttribute("y")||"0"),v.setAttribute("width",o.getAttribute("width")||"100"),v.setAttribute("height",o.getAttribute("height")||"100"),v.setAttribute("href",k),v.setAttribute("preserveAspectRatio","xMidYMid slice"),v.classList.add("uploaded-image"),o.parentNode.replaceChild(v,o),o=v}const w=new CustomEvent("svgImageChanged",{detail:{element:o,imageUrl:k,file:c}});u.svg.dispatchEvent(w),u.options.onImageChange&&u.options.onImageChange(o,k,c)},f.readAsDataURL(c)}showTextEditDialog(c){const o=this,u=c.textContent||"",f=document.createElement("input");f.type="text",f.value=u,f.className="svg-text-editor";const S=c.getBoundingClientRect(),k=o.svg.getBoundingClientRect();f.style.position="absolute",f.style.left=S.left-k.left+"px",f.style.top=S.top-k.top+"px",f.style.width=Math.max(S.width,100)+"px",f.style.fontSize=window.getComputedStyle(c).fontSize,f.style.fontFamily=window.getComputedStyle(c).fontFamily,f.style.border="1px solid #007cba",f.style.padding="2px",f.style.background="white",f.style.zIndex="1000",c.style.visibility="hidden",o.svg.parentNode.appendChild(f),f.focus(),f.select();const w=function(){const v=f.value;for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(document.createTextNode(v)),c.style.visibility="visible",f.parentNode&&f.parentNode.removeChild(f);const L=new CustomEvent("svgTextChanged",{detail:{element:c,oldText:u,newText:v}});o.svg.dispatchEvent(L),o.options.onTextChange&&o.options.onTextChange(c,u,v)};f.addEventListener("blur",w),f.addEventListener("keydown",function(v){v.key==="Enter"?w():v.key==="Escape"&&(c.style.visibility="visible",f.parentNode&&f.parentNode.removeChild(f))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const c=document.createElement("style");c.id="svg-editor-styles",c.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
        `,document.head.appendChild(c)}getSvgString(){return new XMLSerializer().serializeToString(this.svg)}getSvgDataUrl(){const c=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c)))}async saveSvg(c,o="front"){const u=this.getSvgString();try{return await(await fetch(`/staff/templates/${c}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:u,side:o})})).json()}catch(f){return console.error("Failed to save SVG:",f),{success:!1,error:f.message}}}}function Oa(){const H=()=>{const c=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",c.length,"SVGs with data-svg-editor attribute"),c.forEach((o,u)=>{o.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",u,"for SVG:",o),o.__inkwiseSvgTemplateEditor=new St(o))})};if(document.readyState==="complete"||document.readyState==="interactive"?H():document.addEventListener("DOMContentLoaded",H,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const c=new MutationObserver(o=>{o.forEach(u=>{u.addedNodes.forEach(f=>{f.nodeType===1&&f.matches&&f.matches("svg[data-svg-editor]")&&(f.__inkwiseSvgTemplateEditor||(f.__inkwiseSvgTemplateEditor=new St(f)))})})});c.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=c}}typeof window<"u"&&(window.SvgTemplateEditor=St,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,Oa()));function za(H={}){const{collectSnapshot:c,routes:o={},statusLabel:u=null,statusDot:f=null,csrfToken:S=null,debounce:k=1200,onAfterSave:w=null}=H;if(typeof c!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let v=null,L=null,y=null,C=null;const _=(A,O={})=>{if(f instanceof HTMLElement&&f.setAttribute("data-state",A),u instanceof HTMLElement)switch(A){case"saving":u.textContent="Saving…";break;case"dirty":u.textContent="Unsaved changes";break;case"error":u.textContent="Save failed";break;case"saved":{const U=(O.timestamp instanceof Date?O.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});u.textContent=`Saved ${U}`;break}default:u.textContent="Saved";break}},T=async A=>{const O=o.autosave;if(!O)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const B=await fetch(O,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...S?{"X-CSRF-TOKEN":S}:{}},credentials:"same-origin",body:JSON.stringify(A)});if(!B.ok){const U=new Error(`Autosave responded with ${B.status}`);throw U.status=B.status,U.responseText=await B.text().catch(()=>null),U}try{return await B.json()}catch{return{}}},M=async A=>{if(y)try{await y}catch{}L=null,_("saving");let O;try{O=await c(A)}catch(B){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",B),_("error"),B}if(!O||typeof O!="object")return _("saved",{timestamp:new Date}),null;y=T(O);try{const B=await y;if(C=new Date,_("saved",{timestamp:C}),typeof w=="function")try{w(B,O)}catch(U){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",U)}return B}catch(B){throw console.error("[InkWise Studio] Autosave request failed.",B),_("error"),B}finally{y=null}};return{schedule:(A="change")=>{L=A,v&&clearTimeout(v),_("dirty"),v=window.setTimeout(()=>{v=null,M(L).catch(()=>{})},Math.max(250,k))},flush:async(A="flush")=>(v&&(clearTimeout(v),v=null),y&&await y,L!==null?M(A):null),isSaving:()=>!!y,getLastSavedAt:()=>C,notifyError:()=>_("error"),markDirty:()=>_("dirty")}}function Ua(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const H=()=>{var _t,Wt,Ht;const c=document.querySelectorAll("[data-preview-target]"),o=document.querySelector(".preview-card-bg"),u=document.getElementById("preview-svg"),f=document.querySelectorAll("[data-card-thumb]"),S=document.querySelectorAll("[data-card-view]"),k=document.getElementById("extraPreviewContainer"),w=document.getElementById("textFieldList"),v=document.querySelector("[data-add-text-field]"),L=document.querySelectorAll(".sidenav-btn"),y=document.querySelector(".canvas-stage"),C="http://www.w3.org/2000/svg",_=document.querySelector(".canvas-measure-horizontal .measure-value"),T=document.querySelector(".canvas-measure-vertical .measure-value"),M=document.querySelector(".preview-canvas-wrapper");let K=1;const z=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{},A=(z==null?void 0:z.routes)??{},O=((_t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:_t.getAttribute("content"))||((Wt=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:Wt.getAttribute("content"))||null,B=document.querySelector(".topbar-status-label"),U=document.querySelector(".topbar-status-dot"),ve=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},De=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},pe=e=>{var r,l;if(!o)return null;const t=window.getComputedStyle(o),s=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(s&&s[2])return s[2];const i=`${e}Image`;return i&&((r=o.dataset)!=null&&r[i])?o.dataset[i]:((l=o.dataset)==null?void 0:l.frontImage)||null},tt=()=>w?Array.from(w.querySelectorAll("input[data-preview-target]")).map(e=>{var s,i;const t=e.closest(".text-field-item"),a=((i=(s=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:s.textContent)==null?void 0:i.trim())||e.dataset.previewTarget||"";return{key:e.dataset.previewTarget||"",label:a,value:e.value||"",defaultValue:e.dataset.defaultValue||""}}):[],Ce=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const a=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return a?parseFloat(a[0]):Number.NaN}return Number.NaN},we=e=>{if(!e)return null;if(typeof e=="string"){const b=e.trim();if(!b)return null;try{const F=JSON.parse(b);return we(F)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((b,F)=>F&&typeof F=="object"?Object.assign(b,F):b,{}):Object.assign({},e),a=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,s=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,i=Ce(a),r=Ce(s);if(!Number.isFinite(i)||i<=0||!Number.isFinite(r)||r<=0)return null;const l=t.shape??t.Shape??t.canvasShape??null,p=t.unit??t.Unit??t.canvasUnit??null;return{width:i,height:r,shape:typeof l=="string"&&l.trim()!==""?l.trim():null,unit:typeof p=="string"&&p.trim()!==""?p.trim():"px"}},le=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},at=we(M==null?void 0:M.dataset);let N=we(((Ht=z==null?void 0:z.template)==null?void 0:Ht.canvas)??null)||at||null;const rt=720,Ge=920,Oe=new Map;let he=null;const Z=new Map,ye=new Map;let ze=null,P=null,$=null,ie=null,ce=()=>{},q="front",be=null,Se=null,h=null,V=null,G=null;const kt=()=>{if(!o)return null;const e=new Date,t=q||"front",a=$;let s=null;if(a)try{s=new XMLSerializer().serializeToString(a),s&&!/xmlns=/i.test(s)&&(s=s.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(m){console.warn("[InkWise Studio] Unable to serialize current SVG.",m),s=null}const i=s?De(s):pe(t),r=tt(),l=r.filter(m=>{const E=(m.value||"").trim(),I=(m.defaultValue||"").trim();return E===""||I!==""&&E===I}).map(m=>m.label||m.key).map(m=>(m||"").trim()).filter((m,E,I)=>m!==""&&I.indexOf(m)===E),p=[];if(a){const m=new Set;a.querySelectorAll('image,img,[data-changeable="image"]').forEach(E=>{const I=E.getAttribute("href")||E.getAttribute("xlink:href")||E.getAttributeNS("http://www.w3.org/1999/xlink","href")||E.getAttribute("data-src");if(!I)return;const j=E.getAttribute("data-preview-node")||E.id||`image-${p.length+1}`;m.has(j)||(m.add(j),p.push({key:j,href:I,x:E.getAttribute("x")||null,y:E.getAttribute("y")||null,width:E.getAttribute("width")||null,height:E.getAttribute("height")||null}))})}const b=o?{width:ve(o.dataset.canvasWidth),height:ve(o.dataset.canvasHeight),unit:o.dataset.canvasUnit||null,shape:o.dataset.canvasShape||null}:null,F=i?[i]:[];return{design:{updated_at:e.toISOString(),sides:{[t]:{svg:s,preview:i}},texts:r,images:p,canvas:b},preview:{image:i,images:F},placeholders:l}};try{h=za({collectSnapshot:kt,routes:A,csrfToken:O,statusLabel:B,statusDot:U})}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),h=null}const de=document.querySelector('[data-action="proceed-review"]');if(de){const e=de.dataset.destination||A.review||de.getAttribute("href")||window.location.href;de.addEventListener("click",async t=>{if(t.preventDefault(),de.dataset.navigating==="1")return;de.dataset.navigating="1",de.disabled=!0;const a=()=>{window.location.href=e};if(!h){a();return}try{await h.flush("navigate"),a()}catch(s){console.error("[InkWise Studio] Unable to save before navigating.",s),h.notifyError(),de.disabled=!1,de.dataset.navigating="0"}})}const Xe=e=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=a=>{const s=a.target.files&&a.target.files[0];if(!s)return;const i=new FileReader;i.onload=r=>{var p;const l=(p=r.target)==null?void 0:p.result;l&&(e instanceof SVGImageElement?(e.setAttributeNS("http://www.w3.org/1999/xlink","href",l),e.setAttribute("href",l)):e instanceof HTMLImageElement&&(e.src=l),D(),h==null||h.schedule("image-replace"))},i.readAsDataURL(s)},t.click()},Ct=()=>o?((!he||!he.isConnected)&&(he=document.createElement("div"),he.className="canvas-overlay-layer",o.appendChild(he)),he):null,st=()=>{Z.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),Z.clear(),ye.clear(),he&&(he.innerHTML=""),V=null,G=null,_e(),document.body.classList.remove("text-toolbar-visible"),Je()},Ee=(e,t)=>{if(e==null)return t;const a=e.toString().split(/[\s,]+/).filter(Boolean);if(a.length===0)return t;const s=parseFloat(a[0]);return Number.isFinite(s)?s:t},Ae=e=>{if(!o)return;const t=Z.get(e);if(!t||!t.overlay)return;const a=t.overlay,s=o.getBoundingClientRect(),i=e.getBoundingClientRect();if(s.width===0||s.height===0)return;const r=t.type==="text"?18:12,l=Math.max(r,i.width),p=Math.max(r,i.height);a.style.left=`${i.left-s.left}px`,a.style.top=`${i.top-s.top}px`,a.style.width=`${l}px`,a.style.height=`${p}px`},Et=()=>{Z.forEach((e,t)=>{Ae(t)})},D=()=>{Z.size!==0&&(ze&&cancelAnimationFrame(ze),ze=window.requestAnimationFrame(()=>{ze=null,Et()}))},Ue=(e=3)=>{e<=0||requestAnimationFrame(()=>{D(),Ue(e-1)})};window.addEventListener("resize",D),document.addEventListener("scroll",D,!0),window.addEventListener("load",D);const ot=(e,t)=>{const a=$||u;if(!a||typeof a.createSVGPoint!="function")return null;const s=a.createSVGPoint();s.x=e,s.y=t;const i=a.getScreenCTM();return i?s.matrixTransform(i.inverse()):null},lt=(e,t,a)=>{const s=ot(a.clientX,a.clientY);if(!s)return null;const{node:i}=e,r=i.getBBox?i.getBBox():{x:0,y:0,width:0,height:0},l={data:e,overlay:e.overlay,node:i,type:e.type,handle:t,mode:t?"resize":"move",pointerId:a.pointerId,startPoint:s,startClient:{x:a.clientX,y:a.clientY},initialBBox:r,moved:!1};if(e.type==="text"){l.fontSize=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,l.x=Ee(i.getAttribute("x"),r.x);const p=r.y+r.height;l.y=Ee(i.getAttribute("y"),p)}else l.x=Ee(i.getAttribute("x"),r.x),l.y=Ee(i.getAttribute("y"),r.y),l.width=Ee(i.getAttribute("width"),Math.max(1,r.width)),l.height=Ee(i.getAttribute("height"),Math.max(1,r.height));return l},ct=(e,t,a)=>{if(e.type==="text"){const s=e.x+t,i=e.y+a;Number.isFinite(s)&&e.node.setAttribute("x",s),Number.isFinite(i)&&e.node.setAttribute("y",i)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+a)},dt=(e,t,a)=>{if(e.type==="image"){let s=e.x,i=e.y,r=e.width,l=e.height;e.handle.includes("e")&&(r=e.width+t),e.handle.includes("w")&&(r=e.width-t,s=e.x+t),e.handle.includes("s")&&(l=e.height+a),e.handle.includes("n")&&(l=e.height-a,i=e.y+a);const p=4;r<p&&(s+=r-p,r=p),l<p&&(i+=l-p,l=p),e.node.setAttribute("x",s),e.node.setAttribute("y",i),e.node.setAttribute("width",r),e.node.setAttribute("height",l)}else if(e.type==="text"){const s=Math.max(1,e.initialBBox.width),i=Math.max(1,e.initialBBox.height);let r=0,l=0;e.handle.includes("e")?r=t:e.handle.includes("w")&&(r=-t),e.handle.includes("s")?l=a:e.handle.includes("n")&&(l=-a);const p=Math.max(4,s+r),b=Math.max(4,i+l),F=p/s,m=b/i,E=Math.max(F,m),I=Math.max(6,e.fontSize*E);e.node.setAttribute("font-size",I)}},ut=e=>{if(!P||e.pointerId!==P.pointerId)return;const t=ot(e.clientX,e.clientY);if(!t)return;const a=t.x-P.startPoint.x,s=t.y-P.startPoint.y;!P.moved&&(Math.abs(a)>.5||Math.abs(s)>.5)&&(P.moved=!0),P.mode==="move"?ct(P,a,s):dt(P,a,s),D()},je=e=>{if(!P||e.pointerId!==P.pointerId)return;try{P.overlay.releasePointerCapture(P.pointerId)}catch{}P.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",ut),document.removeEventListener("pointerup",je),document.removeEventListener("pointercancel",je);const t=P;P=null,D(),t.moved?h==null||h.schedule("element-transform"):t.type==="text"?ce(t.data.previewKey):t.type==="image"&&Xe(t.node)},Q=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t)return;const a=ye.get(t);if(!a)return;a.type==="text"?ge(a.previewKey||null):a.type==="image"&&Ie(a.previewKey||null);const s=lt(a,e.target.dataset.handle||null,e);if(s){e.preventDefault(),P=s,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",ut),document.addEventListener("pointerup",je),document.addEventListener("pointercancel",je)}},Le=e=>{const t=Ct();if(!t)return null;let a=Z.get(e);if(a)return a;const s=typeof e.tagName=="string"?e.tagName.toLowerCase():"",i=s==="image"||s==="img"?"image":"text",r=e.getAttribute("data-preview-node")||"",l=document.createElement("div");return l.className=`editor-overlay editor-overlay--${i}`,l.dataset.previewNode=r,l.tabIndex=0,l.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(b=>{const F=document.createElement("div");F.className=`editor-overlay__handle editor-overlay__handle--${b}`,F.dataset.handle=b,l.appendChild(F)}),l.addEventListener("pointerdown",Q),l.addEventListener("dblclick",()=>{i==="text"?ce(r):i==="image"&&Xe(e)}),l.addEventListener("keydown",b=>{b.key==="Enter"&&(b.preventDefault(),i==="text"?ce(r):i==="image"&&Xe(e))}),t.appendChild(l),a={overlay:l,node:e,type:i,previewKey:r},Z.set(e,a),ye.set(l,a),e.dataset.locked==="true"&&(l.classList.add("editor-overlay--locked"),l.style.pointerEvents="none"),_e(),D(),a},Te=(e,t,a={})=>{if(!o)return;const s=o.closest(".preview-canvas-wrapper"),i=Number(e),r=Number(t),l=a.persist===void 0?!0:!!a.persist,p=typeof a.unit=="string"&&a.unit?a.unit:(N==null?void 0:N.unit)??"px",b=typeof a.shape=="string"&&a.shape?a.shape:(N==null?void 0:N.shape)??null;if(!s||!Number.isFinite(i)||!Number.isFinite(r)||i<=0||r<=0)return;const F=rt/i,m=Ge/r,E=Math.min(1,F,m),I=Math.max(1,Math.round(i*E)),j=Math.max(1,Math.round(r*E));s.style.setProperty("--canvas-width",`${I}px`),s.style.setProperty("--canvas-height",`${j}px`),s.dataset.sourceWidth=i.toString(),s.dataset.sourceHeight=r.toString(),s.dataset.displayScale=E.toString(),s.dataset.canvasWidth=i.toString(),s.dataset.canvasHeight=r.toString(),s.dataset.canvasUnit=p,b&&(s.dataset.canvasShape=b),o.dataset.canvasWidth=i.toString(),o.dataset.canvasHeight=r.toString(),o.dataset.canvasUnit=p,b&&(o.dataset.canvasShape=b),y&&y.style.setProperty("--stage-width",`${I+112}px`),l&&(N={width:i,height:r,unit:p,shape:b}),D()},ee=(e,t,a,s=0)=>{_&&(Number.isFinite(e)?_.textContent=`${e.toFixed(s)}${a}`:_.textContent="—"),T&&(Number.isFinite(t)?T.textContent=`${t.toFixed(s)}${a}`:T.textContent="—")};N&&(Te(N.width,N.height,{unit:N.unit,shape:N.shape}),ee(le(N.width,N.unit),le(N.height,N.unit),"in",2));const Ye=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),a=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!a)return Number.NaN;const s=parseFloat(a[1]);if(!Number.isFinite(s))return Number.NaN;const i=t.match(/([a-z%]+)$/i);switch(i?i[1].toLowerCase():""){case"":case"px":return s;case"mm":return s*(96/25.4);case"cm":return s*(96/2.54);case"in":return s*96;case"pt":return s*(96/72);default:return s}},it=e=>{if(!e)return;if(Oe.has(e)){const a=Oe.get(e);if(a){const s=a.unit||"px";Te(a.width,a.height,{unit:s,shape:N==null?void 0:N.shape}),ee(le(a.width,s),le(a.height,s),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};Oe.set(e,a),Te(a.width,a.height,{unit:a.unit,shape:N==null?void 0:N.shape}),ee(le(a.width,a.unit),le(a.height,a.unit),"in",2),D()},t.onerror=()=>{Oe.set(e,null)},t.src=e},ue={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},nt=document.querySelectorAll("[data-modal-close]"),ft=e=>{if(!e)return[];const t=Array.from(e.querySelectorAll("[data-preview-node]"));return t.length>0?t:(e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(r=>{const l=r.getAttribute("data-layer-id");if(!l)return;const p=(r.getAttribute("aria-label")||l).replace(/\s+layer$/i,"")||l,b=r.querySelector(".canvas-layer__text");if(b&&(b.hasAttribute("data-preview-node")||b.setAttribute("data-preview-node",l),b.dataset.previewLabel||(b.dataset.previewLabel=p),!b.dataset.defaultText)){const m=(b.textContent||"").trim();m&&(b.dataset.defaultText=m)}const F=r.querySelector("img, image");if(F){const m=`${l}-image`;F.hasAttribute("data-preview-node")||F.setAttribute("data-preview-node",m),F.dataset.previewLabel||(F.dataset.previewLabel=p)}if(!b&&!F&&(r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",l),r.dataset.previewLabel||(r.dataset.previewLabel=p),!r.dataset.defaultText)){const m=(r.textContent||"").trim();m&&(r.dataset.defaultText=m)}}),e.querySelectorAll("image, img").forEach((r,l)=>{r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",`auto-image-${l}`)}),e.querySelectorAll("text, tspan").forEach((r,l)=>{r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",`auto-text-${l}`)}),Array.from(e.querySelectorAll("[data-preview-node]")))},Fe=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const a=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);a==null||a.classList.remove("active")}},Ke=()=>{Object.values(ue).forEach(e=>Fe(e))},$e=e=>{const t=ue[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const a=t.querySelector('input:not([type="hidden"])');a==null||a.focus({preventScroll:!0})};L.length&&L.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",a=ue[t],s=a==null?void 0:a.classList.contains("is-open");Ke(),L.forEach(i=>i.classList.remove("active")),s||($e(t),e.classList.add("active"))})}),nt.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");Fe(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&Fe(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&Fe(t)}}),Ke(),$e("text");const qe=document.querySelector('.sidenav-btn[data-nav="text"]');qe==null||qe.classList.add("active");const Ne=e=>!e||!w?null:w.querySelector(`input[data-preview-target="${e}"]`),mt=e=>!e||!k?null:k.querySelector(`[data-preview-node="${e}"]`),_e=()=>{Z.forEach(({overlay:e,type:t})=>{var r;if(!e)return;const a=((r=e.dataset)==null?void 0:r.previewNode)||"",s=!!V&&a===V&&t==="text",i=!!G&&a===G&&t==="image";e.classList.toggle("editor-overlay--selected",s||i)})},te=()=>G?"image":V?"text":null,Je=()=>{if(typeof window>"u")return;const e=te(),t=e==="text"?V:e==="image"?G:null;try{const a=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t}});window.dispatchEvent(a)}catch{if(typeof document<"u"&&document.createEvent){const s=document.createEvent("CustomEvent");s.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t}),window.dispatchEvent(s)}}},ge=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;V===t&&!G||(V=t,t&&(G=null),_e(),t||G?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible"),Je())},Ie=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;G===t&&!V||(G=t,t&&(V=null),_e(),t||V?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible"),Je())},Me=()=>{if(!V)return[];const e=$||u||document;if(!e)return[];const t=`[data-preview-node="${V}"]`,a=new Set;return e.querySelectorAll(t).forEach(s=>{if(!s)return;const i=(s.tagName||"").toLowerCase();if(i==="text"){a.add(s);return}if(i==="tspan"||i==="g"){const r=s.closest("text");r&&a.add(r)}}),Array.from(a)},We=()=>{if(!G)return[];const e=$||u||document;if(!e)return[];const t=`[data-preview-node="${G}"]`;return Array.from(e.querySelectorAll(t)).filter(a=>{if(!a)return!1;const s=(a.tagName||"").toLowerCase();return s==="image"||s==="img"})},ke=()=>Ne(V),ne=(e,t,a)=>{const s=Number(e);return Number.isFinite(s)?Math.min(Math.max(s,t),a):t},ht=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},He=e=>{var r,l;if(!e||typeof e.getBBox!="function")return;const t=[],a=Number(((r=e.dataset)==null?void 0:r.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(a)&&a!==0)try{const p=e.getBBox(),b=p.x+p.width/2,F=p.y+p.height/2;t.push(`rotate(${a} ${b} ${F})`)}catch{t.push(`rotate(${a})`)}((l=e.dataset)==null?void 0:l.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const i=t.join(" ").trim();i?e.setAttribute("transform",i):e.removeAttribute("transform")},W=(e,t={})=>{const a=Me();if(!a.length)return!1;if(a.forEach(s=>{try{e(s)}catch(i){console.warn("[InkWise Studio] Toolbar mutation failed.",i)}}),t.skipTransformUpdate||a.forEach(s=>{try{He(s)}catch{}}),t.skipOverlaySync||D(),t.autosaveReason!==!1){const s=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";h==null||h.schedule(s)}return!0},Pe=(e,t={})=>{const a=We();if(!a.length)return!1;if(a.forEach(s=>{try{e(s)}catch(i){console.warn("[InkWise Studio] Image mutation failed.",i)}}),t.skipTransformUpdate||a.forEach(s=>{try{He(s)}catch{}}),t.skipOverlaySync||D(),t.autosaveReason!==!1){const s=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";h==null||h.schedule(s)}return!0},gt=()=>{if(!$)return null;let e=$;if(typeof e.tagName=="string"&&e.tagName.toLowerCase()!=="svg"&&(e=e.closest("svg")||$),!e)return null;let t=e.querySelector('defs[data-inkwise-runtime="true"]');return t||(t=document.createElementNS(C,"defs"),t.setAttribute("data-inkwise-runtime","true"),e.insertBefore(t,e.firstChild||null)),t},Ze=e=>{const t=e.dataset.previewTarget;if(!t)return;const a=document.querySelector(`[data-preview-node="${t}"]`),s=a?a.dataset.defaultText||a.textContent:"",i=()=>{if(!a)return;const r=e.value.trim();a.textContent=r||s||"",D()};e.dataset.defaultValue||(e.dataset.defaultValue=s||""),e.addEventListener("focus",()=>{ge(t)}),e.addEventListener("input",()=>{i(),h==null||h.schedule("text-change")}),i()};c.forEach(Ze);const d=(e,t="")=>{const a=document.createElement("div");a.className="text-field-item";const s=document.createElement("span");s.className="text-field-label",s.textContent="Custom",a.appendChild(s);const i=document.createElement("input");i.type="text",i.className="text-field-input",i.placeholder="Add your text",i.dataset.previewTarget=e,i.value=t,i.dataset.defaultValue=t||"",a.appendChild(i);const r=document.createElement("button");r.type="button",r.className="text-field-delete",r.setAttribute("aria-label","Delete field"),r.innerHTML='<i class="fa-regular fa-trash-can"></i>',a.appendChild(r),w.appendChild(a);const l=document.createElement("div");return l.className="pill",l.dataset.previewNode=e,l.dataset.defaultText=t||"CUSTOM TEXT",l.textContent=t||"CUSTOM TEXT",k.appendChild(l),Ze(i),Y(a),h==null||h.schedule("add-text-field"),i},g=()=>{u&&(st(),$=null,ie=null,u.innerHTML="",u.style.display="none")},R=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},X=async e=>{if(!u||!e)return g(),!1;try{let t="";if(e.startsWith("data:image/svg+xml")){const[,m=""]=e.split(",",2);try{t=decodeURIComponent(m)}catch{t=m}}else{const m=await fetch(e,{cache:"no-store"});if(!m.ok)return console.warn("Failed to fetch SVG:",m.status),g(),!1;t=await m.text()}if(!t)return g(),!1;u.innerHTML=t,u.style.display="block",u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.style.width="100%",u.style.height="100%",u.style.maxWidth="100%",u.style.maxHeight="100%";const a=u.querySelector("svg");a?(a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",$=a):$=u,$&&($.setAttribute("data-svg-editor","true"),$.__inkwiseSvgTemplateEditor||($.__inkwiseSvgTemplateEditor=new St($)),ie=$.__inkwiseSvgTemplateEditor);const i=new DOMParser().parseFromString(t,"image/svg+xml").documentElement;let r=Ye(i==null?void 0:i.getAttribute("width")),l=Ye(i==null?void 0:i.getAttribute("height"));if(!Number.isFinite(r)||!Number.isFinite(l)){const m=i==null?void 0:i.getAttribute("viewBox");if(m){const E=m.split(/[\s,]+/).map(Number),I=E[2],j=E[3];!Number.isNaN(I)&&!Number.isNaN(j)&&I>0&&j>0&&(r=I,l=j)}}let p=Number.isFinite(r)?r:Number.NaN,b=Number.isFinite(l)?l:Number.NaN;if(N&&Number.isFinite(N.width)&&Number.isFinite(N.height)){const m=N.width/N.height,E=Number.isFinite(p)&&Number.isFinite(b)?p/b:m,I=Math.abs(E-m)/m,j=Number.isFinite(p)?Math.abs(p-N.width)/N.width:Number.POSITIVE_INFINITY,J=Number.isFinite(b)?Math.abs(b-N.height)/N.height:Number.POSITIVE_INFINITY;(!Number.isFinite(p)||!Number.isFinite(b)||I>.02||j>.05&&J>.05)&&(p=N.width,b=N.height)}if(Number.isFinite(p)&&Number.isFinite(b)){const m=(N==null?void 0:N.unit)??"px";Te(p,b,{unit:m,shape:N==null?void 0:N.shape}),ee(le(p,m),le(b,m),"in",2)}const F=ft(u);if(st(),w){w.innerHTML="";const m=(I,j="",J="")=>{const me=document.createElement("div");me.className="text-field-item";const se=document.createElement("span");se.className="text-field-label",se.textContent=J||I,me.appendChild(se);const oe=document.createElement("input");oe.type="text",oe.className="text-field-input",oe.dataset.previewTarget=I,oe.value=j||"",oe.dataset.defaultValue=j||"",me.appendChild(oe);const Re=document.createElement("button");return Re.type="button",Re.className="text-field-delete",Re.setAttribute("aria-label","Delete field"),Re.innerHTML='<i class="fa-regular fa-trash-can"></i>',me.appendChild(Re),w.appendChild(me),Ze(oe),Y(me),oe},E=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([j,J])=>m(j,"",J))};if(F.length>0){let I=!1;F.forEach(j=>{var Re,Pt;const J=j.getAttribute("data-preview-node");if(!J)return;const me=typeof j.tagName=="string"?j.tagName.toLowerCase():"";if(!(me==="image"||me==="img")){I=!0;const Ma=((Re=j.dataset)==null?void 0:Re.previewLabel)||J,Ba=((Pt=j.dataset)==null?void 0:Pt.defaultText)||j.textContent||"";m(J,Ba,Ma)}}),I||E()}else E()}return F.forEach(m=>{const E=m.getAttribute("data-preview-node");if(!E)return;const I=typeof m.tagName=="string"?m.tagName.toLowerCase():"",j=I==="image"||I==="img",J=!j;j&&m.setAttribute("data-changeable","image"),Le(m)&&Ae(m),J?(m.setAttribute("contenteditable","true"),m.style.cursor="text",m.style.userSelect="text",m.addEventListener("input",()=>{const oe=document.querySelector(`#textFieldList input[data-preview-target="${E}"]`);oe&&(oe.value=m.textContent),m.dataset.currentText=m.textContent||"",D(),h==null||h.schedule("text-edit")}),m.addEventListener("click",()=>{ge(E),fe(E)})):j&&(m.style.cursor="pointer",m.addEventListener("click",()=>{m.dataset.locked!=="true"&&(Ie(E),Xe(m))}));const se=document.querySelector(`#textFieldList input[data-preview-target="${E}"]`);se&&J&&(se.addEventListener("input",()=>{m.textContent=se.value,m.dataset.currentText=se.value,h==null||h.schedule("text-change")}),se.value&&se.value.trim()!==""?m.textContent=se.value:se.value=m.textContent||"")}),requestAnimationFrame(()=>D()),Ue(10),!0}catch(t){return console.warn("Could not load SVG for binding:",t),g(),!1}},Y=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),a=e.querySelector("input[data-preview-target]");if(!t||!a||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const i=a.dataset.previewTarget;if(e.remove(),k){const r=k.querySelector(`[data-preview-node="${i}"]`);r==null||r.remove()}if($){const r=$.querySelector(`[data-preview-node="${i}"]`);r==null||r.remove()}h==null||h.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>Y(e));const fe=e=>{if(!e)return;Ke(),$e("text"),L.forEach(a=>a.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const a=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(a){try{a.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const r=document.getElementById("textFieldList");r&&(r.scrollTop=a.offsetTop-12)}a.focus({preventScroll:!1});return}const s=document.querySelector("[data-add-text-field]");s==null||s.focus({preventScroll:!1})},60)};ce=fe;const re=async e=>{if(q=e,!o)return;let t="",a="";e==="front"&&be?(t=be,a=be):e==="back"&&Se?(t=Se,a=Se):(a=o.dataset[`${e}Svg`]||"",t=o.dataset[`${e}Image`]||"");let s=!1;if(a&&R(a)&&await X(a)&&(s=!0,o.style.backgroundImage="none",o.style.backgroundSize=""),!s){const i=t||o.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,i||"<empty>"),g(),o.style.backgroundImage=i?`url('${i}')`:"",o.style.backgroundSize="",o.style.backgroundPosition="",o.style.backgroundRepeat="",i&&it(i),st(),$=null}S.forEach(i=>{i.classList.toggle("active",i.dataset.cardView===e)}),f.forEach(i=>{const r=i.dataset.cardThumb===e;i.classList.toggle("active",r),i.setAttribute("aria-pressed",r?"true":"false")})};S.forEach(e=>{e.addEventListener("click",()=>{re(e.dataset.cardView)})}),f.forEach(e=>{e.addEventListener("click",()=>{re(e.dataset.cardThumb)})});const xe=re("front");xe&&typeof xe.then=="function"?xe.catch(()=>{}).then(()=>{Ue(6),h==null||h.schedule("initial-load")}):(Ue(6),h==null||h.schedule("initial-load"));const pt=document.querySelector(".preview-overlay");pt&&pt.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const a=t.dataset.previewNode;if(a){const s=(t.tagName||"").toLowerCase();s==="image"||s==="img"?Ie(a):(ge(a),fe(a))}}}),v&&w&&v.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${K}`;K+=1;const t=document.createElement("div");t.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",t.appendChild(a);const s=document.createElement("input");s.type="text",s.className="text-field-input",s.placeholder="Add your text",s.dataset.previewTarget=e,t.appendChild(s);const i=document.createElement("button");if(i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(i),w.appendChild(t),k){const l=document.createElement("div");l.className="pill",l.dataset.previewNode=e,l.dataset.defaultText="CUSTOM TEXT",l.textContent="CUSTOM TEXT",k.appendChild(l)}let r=null;console.log("[InkWise Studio] currentSvgRoot:",$),$?(console.log("[InkWise Studio] Creating SVG text element"),r=document.createElementNS("http://www.w3.org/2000/svg","text"),r.setAttribute("id",e),r.setAttribute("data-preview-node",e),r.setAttribute("data-default-text","CUSTOM TEXT"),r.setAttribute("x","50%"),r.setAttribute("y","50%"),r.setAttribute("text-anchor","middle"),r.setAttribute("dominant-baseline","middle"),r.setAttribute("font-family","Arial, sans-serif"),r.setAttribute("font-size","24"),r.setAttribute("fill","#000000"),r.textContent="CUSTOM TEXT",r.setAttribute("contenteditable","true"),r.style.cursor="text",r.style.userSelect="text",r.addEventListener("input",()=>{s&&(s.value=r.textContent),r.dataset.currentText=r.textContent||"",D(),h==null||h.schedule("text-edit")}),r.addEventListener("click",()=>{ge(e),fe(e)}),$.appendChild(r),Le(r)&&Ae(r),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),Ze(s),s.addEventListener("input",()=>{r&&(r.textContent=s.value,r.dataset.currentText=s.value),h==null||h.schedule("text-change")}),ge(e),r&&r.textContent&&r.textContent.trim()!==""?s.value=r.textContent:(s.value="CUSTOM TEXT",r&&(r.textContent="CUSTOM TEXT")),Y(t),setTimeout(()=>{try{w.scrollHeight>w.clientHeight&&w.scrollTo({top:w.scrollHeight,behavior:"smooth"})}catch{w.scrollTop=w.scrollHeight}s.focus({preventScroll:!1})},60)}),be=null,Se=null,q="front";const Ve=document.getElementById("image-upload"),Qe=document.getElementById("upload-button"),yt=document.getElementById("quick-upload-button"),bt=document.getElementById("recentUploadsGrid"),xt=document.getElementById("quickRecentUploads"),At="inkwise_recent_uploads",Mt=12,jt=()=>{try{const e=localStorage.getItem(At);return e?JSON.parse(e):[]}catch{return[]}},Gt=(e,t,a)=>{const s=jt(),i={id:Date.now(),dataUrl:e,filename:t,side:a,timestamp:new Date().toISOString()},r=s.filter(p=>p.filename!==t);r.unshift(i);const l=r.slice(0,Mt);try{localStorage.setItem(At,JSON.stringify(l))}catch{const b=l.slice(0,Math.floor(Mt/2));localStorage.setItem(At,JSON.stringify(b))}Rt(),Dt()},Bt=(e,t,a="front")=>{e&&(Gt(e,t||`upload-${Date.now()}`,a),a==="front"?be=e:a==="back"&&(Se=e),q===a&&re(a),h==null||h.schedule("image-upload"))},Rt=()=>{if(!bt)return;const e=jt();if(e.length===0){bt.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(s=>`
            <div class="recent-upload-item" data-upload-id="${s.id}" data-image-url="${s.dataUrl}" data-side="${s.side}">
                <img src="${s.dataUrl}" alt="${s.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${s.filename}</span>
                </div>
            </div>
        `).join("");bt.innerHTML=t;const a=bt.querySelectorAll(".recent-upload-item");a.forEach(s=>{s.addEventListener("click",()=>{const i=s.dataset.imageUrl,r=s.dataset.side;a.forEach(l=>l.classList.remove("selected")),s.classList.add("selected"),r==="front"?be=i:Se=i,q===r&&re(r),s.style.transform="scale(0.95)",setTimeout(()=>{s.style.transform=""},150),h==null||h.schedule("image-select")})})},Dt=()=>{if(!xt)return;const t=jt().slice(0,5);if(t.length===0){xt.innerHTML="";return}const a=t.map(i=>`
            <div class="quick-recent-upload-item" data-upload-id="${i.id}" data-image-url="${i.dataUrl}" data-side="${i.side}" title="${i.filename}">
                <img src="${i.dataUrl}" alt="${i.filename}" loading="lazy">
            </div>
        `).join("");xt.innerHTML=a;const s=xt.querySelectorAll(".quick-recent-upload-item");s.forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.imageUrl,l=i.dataset.side;s.forEach(p=>p.classList.remove("selected")),i.classList.add("selected"),l==="front"?be=r:Se=r,q===l&&re(l),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150),h==null||h.schedule("image-select")})})},Xt=e=>{const t=e.files[0];if(!t)return;const a=new FileReader;a.onload=s=>{const i=s.target.result;Bt(i,t.name,"front")},a.readAsDataURL(t)};Ve&&Ve.addEventListener("change",()=>Xt(Ve)),Qe&&Qe.addEventListener("click",()=>{Ve.click()}),yt&&yt.addEventListener("click",()=>{Ve.click()});const Yt=e=>{var a;const t=(a=e.clipboardData)==null?void 0:a.items;if(!(!t||t.length===0))for(const s of t){if(!s||typeof s.type!="string"||!s.type.startsWith("image/"))continue;const i=s.getAsFile();if(!i)continue;const r=new FileReader;r.onload=l=>{const p=l.target.result,b=i.name||`pasted-${Date.now()}.png`;Bt(p,b,q||"front")},r.readAsDataURL(i),e.preventDefault();break}};Rt(),Dt(),document.addEventListener("paste",Yt);const Lt=document.querySelectorAll(".pill-with-tooltip"),Tt=document.querySelector(".preview-canvas-wrapper"),Ft=document.querySelector(".preview-guides"),Ot=(e,t)=>{e==="safety-pill"&&(Tt==null||Tt.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(Ft==null||Ft.classList.toggle("highlight-bleed",t))},vt=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),a=e==null?void 0:e.querySelector(".tooltip");!t||!a||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),a.setAttribute("aria-hidden","true"),Ot(t.id,!1))};Lt.forEach(e=>{const t=e.querySelector(".canvas-pill"),a=e.querySelector(".tooltip");!t||!a||(t.addEventListener("click",s=>{s.preventDefault();const i=!e.classList.contains("is-active");Lt.forEach(r=>{r!==e&&vt(r)}),i?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),a.setAttribute("aria-hidden","false"),Ot(t.id,!0)):vt(e)}),t.addEventListener("mouseenter",()=>{a.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{a.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||a.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&a.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",s=>{s.key==="Escape"&&(vt(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||Lt.forEach(a=>vt(a))});const Kt=e=>{if(!e)return!1;const t=W(a=>{a.setAttribute("font-family",e),a.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const a=ke();a&&(a.dataset.fontFamily=e)}return t},Jt=e=>{const t=ne(e,6,400),a=W(s=>{s.setAttribute("font-size",t),s.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(a){const s=ke();s&&(s.dataset.fontSize=String(t))}return a},Zt=e=>{const t=ne(e,8,400),a=39;return Pe(s=>{const i=typeof s.getBBox=="function"?s.getBBox():null,r=parseFloat(s.getAttribute("width")),l=parseFloat(s.getAttribute("height")),p=Number(s.dataset.baseWidth)||(Number.isFinite(r)?r:(i==null?void 0:i.width)||1),b=Number(s.dataset.baseHeight)||(Number.isFinite(l)?l:(i==null?void 0:i.height)||1);s.dataset.baseWidth||(s.dataset.baseWidth=p),s.dataset.baseHeight||(s.dataset.baseHeight=b);const F=t/a,m=Math.max(1,p*F),E=Math.max(1,b*F);s.setAttribute("width",m),s.setAttribute("height",E)},{autosaveReason:"image-scale"})},Qt=e=>{const t=ht(e);if(!t)return!1;const a=W(s=>{s.setAttribute("fill",t),s.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(a){const s=ke();s&&(s.dataset.color=t)}return a},ea=e=>{const t=ht(e);return t?Pe(a=>{if(t==="#FFFFFF"){const I=a.dataset.tintFilterId;if(I){const j=gt(),J=j==null?void 0:j.querySelector(`#${I}`);J==null||J.remove(),delete a.dataset.tintFilterId}a.removeAttribute("filter");return}const s=gt();if(!s)return;const i=a.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,r=parseInt(t.slice(1,3),16)/255,l=parseInt(t.slice(3,5),16)/255,p=parseInt(t.slice(5,7),16)/255;let b=s.querySelector(`#${i}`);if(!b){b=document.createElementNS(C,"filter"),b.id=i,b.setAttribute("color-interpolation-filters","sRGB");const I=document.createElementNS(C,"feColorMatrix");I.setAttribute("type","matrix"),I.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),b.appendChild(I);const j=document.createElementNS(C,"feComponentTransfer"),J=document.createElementNS(C,"feFuncR");J.setAttribute("type","linear"),j.appendChild(J);const me=document.createElementNS(C,"feFuncG");me.setAttribute("type","linear"),j.appendChild(me);const se=document.createElementNS(C,"feFuncB");se.setAttribute("type","linear"),j.appendChild(se);const oe=document.createElementNS(C,"feFuncA");oe.setAttribute("type","identity"),j.appendChild(oe),b.appendChild(j),s.appendChild(b)}const F=b.querySelector("feFuncR"),m=b.querySelector("feFuncG"),E=b.querySelector("feFuncB");F&&F.setAttribute("slope",r.toString()),m&&m.setAttribute("slope",l.toString()),E&&E.setAttribute("slope",p.toString()),a.dataset.tintFilterId=i,a.setAttribute("filter",`url(#${i})`)},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},ta=()=>W(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",a=Number(t);t==="bold"||a>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),aa=()=>W(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),zt=e=>W(t=>{const s=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),i=new Set(s);i.has(e)?i.delete(e):i.add(e);const r=Array.from(i).join(" ");r?(t.style.textDecoration=r,t.setAttribute("text-decoration",r)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),sa=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},a={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},s=t[e]||"start",i=a[e]||"left",r=W(l=>{l.setAttribute("text-anchor",s);const p=l.getAttribute("x");p&&l.querySelectorAll("tspan").forEach(b=>b.setAttribute("x",p)),l.style.textAlign=i},{autosaveReason:"text-align",skipTransformUpdate:!0});if(r){const l=ke();l&&(l.dataset.align=i)}return r},ia=e=>{let t=null;const a=W(s=>{const i=s.textContent||"";let r=i;e==="uppercase"?r=i.toUpperCase():e==="lowercase"&&(r=i.toLowerCase()),s.textContent=r,s.dataset.currentText=r,t=r},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(a){const s=ke();s&&t!==null&&(s.value=t)}return a},na=()=>{const e=ke();return W(t=>{const s=(t.textContent||"").split(/\r?\n/),i=t.dataset.listType==="bullet"||s.every(l=>l.trim().startsWith("•")),r=i?s.map(l=>l.replace(/^\s*•\s*/u,"")).join(`
`):s.map(l=>{const p=l.trim();return p?`• ${p}`:"•"}).join(`
`);i?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=r,t.dataset.currentText=r,e&&e.dataset.previewTarget===V&&(e.value=r)},{autosaveReason:"text-list",skipTransformUpdate:!0})},ra=e=>{const t=ne(e,.5,5);return W(a=>{a.dataset.lineHeight=t,a.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},oa=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?W(a=>{if(Math.abs(t)<1e-4)a.style.letterSpacing="",a.removeAttribute("letter-spacing"),delete a.dataset.letterSpacing;else{const s=`${t.toFixed(2)}em`;a.style.letterSpacing=s,a.setAttribute("letter-spacing",s),a.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},la=e=>{const t=typeof e=="string"?e:"none";return W(a=>{switch(t){case"shadow":a.dataset.effectStyle="shadow",a.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"highlight":a.dataset.effectStyle="highlight",a.style.filter="none",a.style.paintOrder="stroke fill",a.style.stroke="rgba(253, 224, 71, 0.85)",a.style.strokeWidth=6;break;case"glitch":a.dataset.effectStyle="glitch",a.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;case"echo":a.dataset.effectStyle="echo",a.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break;default:delete a.dataset.effectStyle,a.style.filter="",a.style.stroke="",a.style.strokeWidth="",a.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},ca=e=>{const t=e==="curve"?"curve":"none";return W(a=>{t==="curve"?a.dataset.effectShape="curve":delete a.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},da=e=>{const t=ne(e,0,100)/100;return W(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},ua=e=>{const t=ne(e,0,100)/100;return Pe(a=>{a.style.opacity=t,a.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},fa=e=>{const t=ne(e,-180,180);return W(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},ma=e=>{const t=ne(e,-180,180);return Pe(a=>{Math.abs(t)<1e-4?(delete a.dataset.rotation,a.removeAttribute("data-rotation")):(a.dataset.rotation=t,a.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},Ut=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let a=`${t}_${Date.now()}`,s=1;for(;document.querySelector(`[data-preview-node="${a}"]`);)a=`${t}_${Date.now()}_${s}`,s+=1;return a},ha=()=>{const e=Me();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=Ut(V||"text"),s=t.cloneNode(!0);s.setAttribute("data-preview-node",a),s.dataset.previewNode=a,s.id=a,s.dataset.defaultText=s.dataset.defaultText||s.textContent||"",t.parentNode.appendChild(s),He(s),Le(s)&&Ae(s);const r=d(a,s.textContent||"");return r&&(r.value=s.textContent||"",setTimeout(()=>{try{r.focus({preventScroll:!1})}catch{}},0)),ge(a),D(),h==null||h.schedule("duplicate-text-node"),!0},ga=()=>{const e=Me();if(!e.length)return!1;const t=V;if(e.forEach(a=>{var i;const s=(i=Z.get(a))==null?void 0:i.overlay;s&&(s.remove(),ye.delete(s)),Z.delete(a),a.remove()}),t){const a=Ne(t),s=a==null?void 0:a.closest(".text-field-item");s&&s.remove();const i=mt(t);i==null||i.remove()}return ge(null),D(),h==null||h.schedule("remove-text-node"),!0},pa=()=>{const e=We();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const a=Ut(G||"image"),s=t.cloneNode(!0);s.setAttribute("data-preview-node",a),s.dataset.previewNode=a,s.id=a;const i=parseFloat(t.getAttribute("x"))||0,r=parseFloat(t.getAttribute("y"))||0;return s.setAttribute("x",i+10),s.setAttribute("y",r+10),s.dataset.tintFilterId&&(delete s.dataset.tintFilterId,s.removeAttribute("filter")),t.parentNode.appendChild(s),He(s),Le(s)&&Ae(s),Ie(a),D(),h==null||h.schedule("duplicate-image-node"),!0},ya=()=>{const e=We();return e.length?(e.forEach(t=>{var s;const a=(s=Z.get(t))==null?void 0:s.overlay;a&&(a.remove(),ye.delete(a)),Z.delete(t),t.remove()}),Ie(null),D(),h==null||h.schedule("remove-image-node"),!0):!1},ba=()=>{const e=te();if(e==="text"){const t=W(a=>{var l;const i=!(a.dataset.locked==="true");i?a.dataset.locked="true":delete a.dataset.locked;const r=(l=Z.get(a))==null?void 0:l.overlay;r&&(r.classList.toggle("editor-overlay--locked",i),r.style.pointerEvents=i?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&D(),t}if(e==="image"){const t=Pe(a=>{var l;const i=!(a.dataset.locked==="true");i?a.dataset.locked="true":delete a.dataset.locked;const r=(l=Z.get(a))==null?void 0:l.overlay;r&&(r.classList.toggle("editor-overlay--locked",i),r.style.pointerEvents=i?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&D(),t}return!1},xa=()=>{var a;const e=Me();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((a=navigator==null?void 0:navigator.clipboard)!=null&&a.writeText)return navigator.clipboard.writeText(t).catch(s=>{console.warn("[InkWise Studio] Clipboard write failed.",s)}),!0;try{const s=document.createElement("textarea");return s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),s.remove(),!0}catch(s){return console.warn("[InkWise Studio] Clipboard fallback failed.",s),!1}},va=()=>{var s;const e=We();if(!e.length)return!1;const t=e[0],a=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!a)return!1;if((s=navigator==null?void 0:navigator.clipboard)!=null&&s.writeText)return navigator.clipboard.writeText(a).catch(i=>{console.warn("[InkWise Studio] Clipboard write failed for image.",i)}),!0;try{const i=document.createElement("textarea");return i.value=a,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),i.remove(),!0}catch(i){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",i),!1}},wa=()=>{const e=te();return e==="text"?xa():e==="image"?va():!1},Sa=()=>{const e=te();return e==="text"?ha():e==="image"?pa():!1},Na=()=>{const e=te();return e==="text"?ga():e==="image"?ya():!1},ka=e=>{const t=te();return t==="text"?La(e):t==="image"?Ta(e):!1},Ca=e=>{const t=te();return t==="text"?da(e):t==="image"?ua(e):!1},Ea=e=>{const t=te();return t==="text"?fa(e):t==="image"?ma(e):!1},Aa=e=>{const t=te();return t==="text"?Qt(e):t==="image"?ea(e):!1},ja=e=>{const t=te();return t==="text"?Jt(e):t==="image"?Zt(e):!1},La=e=>{const t=Me();if(!t.length)return!1;const a=t[0],s=a.parentNode;if(!s)return!1;const i=Array.from(s.children),r=i.indexOf(a);if(r===-1)return!1;if(e==="bring-to-front")s.appendChild(a);else if(e==="send-to-back")s.insertBefore(a,i[0]);else if(e==="bring-forward"){const l=Math.min(i.length-1,r+1);if(l!==r){const p=i[l+1]||null;s.insertBefore(a,p)}}else if(e==="send-backward"){const l=Math.max(0,r-1);if(l!==r){const p=i[l];s.insertBefore(a,p)}}else return!1;return D(),h==null||h.schedule("text-layer"),!0},Ta=e=>{const t=We();if(!t.length)return!1;const a=t[0],s=a.parentNode;if(!s)return!1;const i=Array.from(s.children),r=i.indexOf(a);if(r===-1)return!1;if(e==="bring-to-front")s.appendChild(a);else if(e==="send-to-back")s.insertBefore(a,i[0]);else if(e==="bring-forward"){const l=Math.min(i.length-1,r+1);if(l!==r){const p=i[l+1]||null;s.insertBefore(a,p)}}else if(e==="send-backward"){const l=Math.max(0,r-1);if(l!==r){const p=i[l];s.insertBefore(a,p)}}else return!1;return D(),h==null||h.schedule("image-layer"),!0},Fa={setFontFamily:e=>te()!=="text"?!1:Kt(e),setFontSize:e=>ja(e),setColor:e=>Aa(e),getActiveKey:()=>V,getSelection:()=>{const e=te();return{type:e,key:e==="text"?V:e==="image"?G:null,textKey:V,imageKey:G}},dispatch(e,t){const a=te();switch(e){case"bold":a==="text"&&ta();break;case"italic":a==="text"&&aa();break;case"underline":a==="text"&&zt("underline");break;case"strikethrough":a==="text"&&zt("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":a==="text"&&sa(e);break;case"list-bullets":a==="text"&&na();break;case"line-spacing":a==="text"&&ra(t);break;case"letter-spacing":a==="text"&&oa(t);break;case"uppercase":case"lowercase":a==="text"&&ia(e);break;case"effect-style":a==="text"&&la(t);break;case"effect-shape":a==="text"&&ca(t);break;case"opacity":Ca(t);break;case"rotation":Ea(t);break;case"layer":ka(t);break;case"more":t==="duplicate"?Sa():t==="delete"?Na():t==="lock"?ba():t==="copy"&&wa();break;default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=Fa);const et=document.getElementById("canvas-zoom-select"),$t=document.getElementById("canvas-zoom-display"),Ia=document.querySelectorAll("[data-zoom-step]"),qt=document.querySelector(".preview-canvas-wrapper"),wt=y,Be=[.25,.5,.75,1,1.5,2,3];if(et&&qt&&wt){const e=a=>{wt.style.setProperty("--canvas-scale",a.toString()),qt.style.removeProperty("transform"),et.value=a.toString(),$t&&($t.textContent=`${Math.round(a*100)}%`),D()},t=a=>{const s=parseFloat(et.value)||1,i=Be.indexOf(s);if(i===-1)return;let r=i;a==="up"&&i<Be.length-1&&(r=i+1),a==="down"&&i>0&&(r=i-1),r!==i&&e(Be[r])};et.addEventListener("change",a=>{const s=parseFloat(a.target.value)||1;e(s)}),Ia.forEach(a=>{a.addEventListener("click",()=>{const s=a.dataset.zoomStep;s&&t(s==="up"?"up":"down")})}),wt&&wt.addEventListener("wheel",a=>{a.preventDefault();const s=parseFloat(et.value)||1;let i=s;if(a.deltaY>0){const r=Be.indexOf(s);r>0&&(i=Be[r-1])}else{const r=Be.indexOf(s);r<Be.length-1&&(i=Be[r+1])}i!==s&&e(i)},{passive:!1}),e(parseFloat(et.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement;(!t||!t.matches("#textFieldList input")&&!t.closest(".studio-react-widgets"))&&document.body.classList.remove("text-toolbar-visible")},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",H,{once:!0}):H()}const Vt=[{name:"Lobster",family:"Lobster",weight:"400",style:"normal"},{name:"Fredoka One",family:"Fredoka One",weight:"400",style:"normal"},{name:"Pacifico",family:"Pacifico",weight:"400",style:"normal"},{name:"Baloo 2",family:"Baloo 2",weight:"400",style:"normal"},{name:"Poppins Bold",family:"Poppins",weight:"700",style:"normal"},{name:"Anton",family:"Anton",weight:"400",style:"normal"},{name:"Gochi Hand",family:"Gochi Hand",weight:"400",style:"normal"},{name:"Bangers",family:"Bangers",weight:"400",style:"normal"},{name:"Chewy",family:"Chewy",weight:"400",style:"normal"},{name:"Rubik ExtraBold",family:"Rubik",weight:"800",style:"normal"},{name:"Comic Neue Bold",family:"Comic Neue",weight:"700",style:"normal"},{name:"Amatic SC Bold",family:"Amatic SC",weight:"700",style:"normal"},{name:"Luckiest Guy",family:"Luckiest Guy",weight:"400",style:"normal"},{name:"Kalam Bold",family:"Kalam",weight:"700",style:"normal"},{name:"Bubblegum Sans",family:"Bubblegum Sans",weight:"400",style:"normal"},{name:"Shrikhand",family:"Shrikhand",weight:"400",style:"normal"},{name:"Jua",family:"Jua",weight:"400",style:"normal"},{name:"DynaPuff",family:"DynaPuff",weight:"400",style:"normal"},{name:"Cabin Sketch",family:"Cabin Sketch",weight:"400",style:"normal"},{name:"Titan One",family:"Titan One",weight:"400",style:"normal"},{name:"Montserrat SemiBold",family:"Montserrat",weight:"600",style:"normal"},{name:"Helvetica Neue",family:"Helvetica Neue",weight:"400",style:"normal"},{name:"Lato Bold",family:"Lato",weight:"700",style:"normal"},{name:"Source Sans Pro",family:"Source Sans Pro",weight:"400",style:"normal"},{name:"Poppins Medium",family:"Poppins",weight:"500",style:"normal"},{name:"Roboto Condensed",family:"Roboto Condensed",weight:"400",style:"normal"},{name:"Open Sans",family:"Open Sans",weight:"400",style:"normal"},{name:"Oswald",family:"Oswald",weight:"400",style:"normal"},{name:"Nunito Sans",family:"Nunito Sans",weight:"400",style:"normal"},{name:"Inter SemiBold",family:"Inter",weight:"600",style:"normal"},{name:"Futura PT",family:"Futura PT",weight:"400",style:"normal"},{name:"Avenir Next",family:"Avenir Next",weight:"400",style:"normal"},{name:"Work Sans Medium",family:"Work Sans",weight:"500",style:"normal"},{name:"Proxima Nova",family:"Proxima Nova",weight:"400",style:"normal"},{name:"IBM Plex Sans",family:"IBM Plex Sans",weight:"400",style:"normal"},{name:"Barlow SemiCondensed",family:"Barlow Semi Condensed",weight:"400",style:"normal"},{name:"Sora",family:"Sora",weight:"400",style:"normal"},{name:"Metropolis",family:"Metropolis",weight:"400",style:"normal"},{name:"Urbanist",family:"Urbanist",weight:"400",style:"normal"},{name:"Manrope",family:"Manrope",weight:"400",style:"normal"},{name:"Quicksand Light",family:"Quicksand",weight:"300",style:"normal"},{name:"Great Vibes",family:"Great Vibes",weight:"400",style:"normal"},{name:"Parisienne",family:"Parisienne",weight:"400",style:"normal"},{name:"Nunito Light",family:"Nunito",weight:"300",style:"normal"},{name:"Cormorant Garamond",family:"Cormorant Garamond",weight:"400",style:"normal"},{name:"Playfair Display",family:"Playfair Display",weight:"400",style:"normal"},{name:"Allura",family:"Allura",weight:"400",style:"normal"},{name:"DM Sans",family:"DM Sans",weight:"400",style:"normal"},{name:"Satisfy",family:"Satisfy",weight:"400",style:"normal"},{name:"Karla",family:"Karla",weight:"400",style:"normal"},{name:"Josefin Light",family:"Josefin Sans",weight:"300",style:"normal"},{name:"Merriweather Light",family:"Merriweather",weight:"300",style:"normal"},{name:"Sacramento",family:"Sacramento",weight:"400",style:"normal"},{name:"Dancing Script",family:"Dancing Script",weight:"400",style:"normal"},{name:"Marcellus",family:"Marcellus",weight:"400",style:"normal"},{name:"Crimson Pro",family:"Crimson Pro",weight:"400",style:"normal"},{name:"ABeeZee",family:"ABeeZee",weight:"400",style:"normal"},{name:"GFS Didot",family:"GFS Didot",weight:"400",style:"normal"},{name:"Overlock Light",family:"Overlock",weight:"300",style:"normal"},{name:"Hind Soft",family:"Hind",weight:"400",style:"normal"},{name:"Cinzel",family:"Cinzel",weight:"400",style:"normal"},{name:"Cormorant Infant",family:"Cormorant Infant",weight:"400",style:"normal"},{name:"Playfair Display Italic",family:"Playfair Display",weight:"400",style:"italic"},{name:"Alex Brush",family:"Alex Brush",weight:"400",style:"normal"},{name:"Montserrat Light",family:"Montserrat",weight:"300",style:"normal"},{name:"Bodoni Moda",family:"Bodoni Moda",weight:"400",style:"normal"},{name:"Cormorant Upright",family:"Cormorant Upright",weight:"400",style:"normal"},{name:"Libre Baskerville Italic",family:"Libre Baskerville",weight:"400",style:"italic"},{name:"Tangerine",family:"Tangerine",weight:"400",style:"normal"},{name:"Cinzel Decorative",family:"Cinzel Decorative",weight:"400",style:"normal"},{name:"Forum",family:"Forum",weight:"400",style:"normal"},{name:"Cardo Italic",family:"Cardo",weight:"400",style:"italic"},{name:"Unna Italic",family:"Unna",weight:"400",style:"italic"},{name:"Prata",family:"Prata",weight:"400",style:"normal"},{name:"Gilda Display",family:"Gilda Display",weight:"400",style:"normal"},{name:"Cormorant SC",family:"Cormorant SC",weight:"400",style:"normal"},{name:"Quattrocento",family:"Quattrocento",weight:"400",style:"normal"},{name:"Marcellus SC",family:"Marcellus SC",weight:"400",style:"normal"}],$a=[12,14,16,18,24,32,36,39,42,48,60];function It(H,c,o){return Math.min(Math.max(H,c),o)}function qa({onFontChange:H=()=>{},onSizeChange:c=()=>{},onAction:o=()=>{},onColorChange:u=()=>{},activeElementType:f=null}){const S=x.useMemo(()=>Vt[0],[]),[k,w]=x.useState(S),[v,L]=x.useState(39),[y,C]=x.useState(!1),[_,T]=x.useState(!1),M=x.useRef(null),K=x.useRef(null),[z,A]=x.useState(!1),O=x.useRef(null),[B,U]=x.useState(!1),ve=x.useRef(null),[De,pe]=x.useState(!1),tt=x.useRef(null),[Ce,we]=x.useState("#FFFFFF"),[le,at]=x.useState([]),Nt=x.useMemo(()=>[{label:"Grayscale",colors:["#FFFFFF","#E5E7EB","#9CA3AF","#4B5563","#111827"]},{label:"Blues",colors:["#DCEEFB","#A8D1FF","#4DA1FF","#2563EB","#0B3D91"]},{label:"Greens",colors:["#DEF7EC","#BFEBD3","#34D399","#059669","#064E3B"]},{label:"Yellows",colors:["#FFFBEB","#FEF3C7","#FBBF24","#F59E0B","#B45309"]},{label:"Oranges",colors:["#FFF1E6","#FFD8B5","#FB923C","#F97316","#7C2D12"]},{label:"Reds",colors:["#FFEFF2","#FFD6DD","#EF4444","#DC2626","#58151C"]}],[]),[N,rt]=x.useState(0),[Ge,Oe]=x.useState(0),[he,Z]=x.useState(100),[ye,ze]=x.useState("swatches"),P=x.useRef(null),$=x.useRef(!1),ie=f==="text",ce=f==="image",q=ie||ce,[be,Se]=x.useState(0),[h,V]=x.useState(0),[G,kt]=x.useState(0),[de,Xe]=x.useState(0);function Ct(d,g,R,X){const Y=d/100,ae=g/100,fe=R/100,re=X/100,xe=Math.round(255*(1-Y)*(1-re)),pt=Math.round(255*(1-ae)*(1-re)),Ve=Math.round(255*(1-fe)*(1-re)),Qe=yt=>yt.toString(16).padStart(2,"0").toUpperCase();return`#${Qe(xe)}${Qe(pt)}${Qe(Ve)}`}x.useEffect(()=>{if(ye==="cmyk")try{const d=Ct(be,h,G,de);we(d),u(d)}catch{}},[be,h,G,de,ye]);function st(d){const g=d.replace("#",""),R=parseInt(g,16),X=R>>16&255,Y=R>>8&255,ae=R&255;return{r:X,g:Y,b:ae}}function Ee(d,g,R){d/=255,g/=255,R/=255;const X=Math.max(d,g,R),Y=Math.min(d,g,R);let ae=0,fe=0,re=(X+Y)/2;if(X!==Y){const xe=X-Y;switch(fe=re>.5?xe/(2-X-Y):xe/(X+Y),X){case d:ae=(g-R)/xe+(g<R?6:0);break;case g:ae=(R-d)/xe+2;break;case R:ae=(d-g)/xe+4;break}ae/=6}return{h:Math.round(ae*360),s:Math.round(fe*100),l:Math.round(re*100)}}function Ae(d,g,R){g/=100,R/=100;const X=fe=>(fe+d/30)%12,Y=g*Math.min(R,1-R),ae=fe=>{const re=R-Y*Math.max(-1,Math.min(X(fe)-3,Math.min(9-X(fe),1)));return Math.round(255*re).toString(16).padStart(2,"0")};return`#${ae(0)}${ae(8)}${ae(4)}`.toUpperCase()}x.useEffect(()=>{try{const d=st(Ce.replace("#","")),{h:g,s:R,l:X}=Ee(d.r,d.g,d.b);rt(g),Oe(R),Z(X)}catch{}},[Ce]),x.useEffect(()=>{const d=Ae(N,Ge,he);we(d)},[N,Ge,he]);const Et=d=>{$.current=!0,D(d),window.addEventListener("mousemove",D),window.addEventListener("mouseup",Ue)},D=d=>{if(!P.current)return;const g=P.current.getBoundingClientRect(),R=Math.min(Math.max(0,(d.clientX-g.left)/g.width),1),X=Math.min(Math.max(0,(d.clientY-g.top)/g.height),1),Y=Math.round(R*100),ae=Math.round((1-X)*100);Oe(Y),Z(ae)},Ue=()=>{$.current=!1,window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",Ue)};x.useEffect(()=>{const d=g=>{(y&&M.current&&!M.current.contains(g.target)||_&&K.current&&!K.current.contains(g.target)||z&&O.current&&!O.current.contains(g.target)||B&&ve.current&&!ve.current.contains(g.target)||je&&Le.current&&!Le.current.contains(g.target)||Te&&Ye.current&&!Ye.current.contains(g.target)||it&&nt.current&&!nt.current.contains(g.target)||qe&&te.current&&!te.current.contains(g.target))&&(C(!1),T(!1),A(!1),U(!1),Q(!1),ee(!1),ue(!1),Ne(!1))};return(y||_||z||B||je||Te||it||De||qe||Je||ke||He)&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[y,_]);const ot=d=>{ie&&(w(d),H(d.family),C(!1))},lt=d=>{const g=(d||"#FFFFFF").toUpperCase();we(g),u(g),at(R=>[g,...R.filter(Y=>Y!==g)].slice(0,8)),T(!1)},ct=d=>{const g=It(d,8,96);L(g),c(g)},dt=d=>{q&&ct(v+d)},ut=d=>{if(!q)return;const g=Number(d.target.value);Number.isFinite(g)&&ct(g)},[je,Q]=x.useState(!1),Le=x.useRef(null),[Te,ee]=x.useState(!1),Ye=x.useRef(null),[it,ue]=x.useState(!1),nt=x.useRef(null),[ft,Fe]=x.useState(1.4),[Ke,$e]=x.useState(.12),[qe,Ne]=x.useState(!1),[mt,_e]=x.useState(100),te=x.useRef(null),[Je,ge]=x.useState(!1),[Ie,Me]=x.useState(0),We=x.useRef(null),[ke,ne]=x.useState(!1),ht=x.useRef(null),[He,W]=x.useState(!1),Pe=x.useRef(null);x.useEffect(()=>{ie||(C(!1),A(!1),U(!1),Q(!1),ee(!1),ue(!1),pe(!1))},[ie]),x.useEffect(()=>{q||(T(!1),Ne(!1),ge(!1),ne(!1),W(!1))},[q]);const gt=()=>{ie&&(Fe(1.4),o("line-spacing")(1.4))},Ze=()=>{ie&&($e(.12),o("letter-spacing")(.12))};return n.jsxs("div",{className:"text-mini-toolbar",role:"toolbar","aria-label":ce?"Image editing toolbar":"Text editing toolbar",children:[n.jsxs("div",{className:"toolbar-group toolbar-group--font",children:[n.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>{ie&&C(d=>!d)},"aria-label":ie?"Choose font family":"Font selection available for text elements",disabled:!ie,children:[ie?k.name:ce?"Image selected":"Select element"," ",n.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),ie&&y&&n.jsx("div",{className:"font-modal",ref:M,children:n.jsx("div",{className:"font-modal-content",children:Vt.map(d=>n.jsx("button",{type:"button",className:"font-option",onClick:()=>ot(d),style:{fontFamily:d.family,fontWeight:d.weight,fontStyle:d.style},children:d.name},d.name))})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--size",role:"group","aria-label":ce?"Image scale":"Font size",children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":ce?"Decrease image scale":"Decrease font size",onClick:()=>dt(-2),disabled:!q,children:n.jsx("i",{className:"fa-solid fa-minus","aria-hidden":"true"})}),n.jsx("label",{className:"sr-only",htmlFor:"mini-toolbar-size",children:ce?"Image scale":"Font size"}),n.jsx("select",{id:"mini-toolbar-size",className:"size-select",value:v,onChange:ut,disabled:!q,children:$a.map(d=>n.jsx("option",{value:d,children:d},d))}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":ce?"Increase image scale":"Increase font size",onClick:()=>dt(2),disabled:!q,children:n.jsx("i",{className:"fa-solid fa-plus","aria-hidden":"true"})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"color-swatch","aria-label":ce?"Choose image tint":"Choose text color",onClick:()=>{q&&(C(!1),T(d=>!d))},disabled:!q,children:n.jsx("span",{className:"color-swatch__chip",style:{background:Ce}})}),_&&n.jsx("div",{className:"color-modal",ref:K,children:n.jsxs("div",{className:"color-modal-content",children:[n.jsxs("div",{className:"color-modal-header",children:[n.jsx("div",{className:"color-modal-title",children:ce?"Image tint":"Text color"}),n.jsx("button",{type:"button",className:"ghost-button",onClick:()=>T(!1),"aria-label":"Close color picker",children:n.jsx("i",{className:"fa-solid fa-x"})})]}),n.jsx("div",{className:"color-picker-area",children:n.jsx("div",{className:"inline-color-picker",children:n.jsxs("div",{className:"spectrum-picker",children:[n.jsx("div",{className:"spectrum-area",ref:P,onMouseDown:Et,style:{background:`linear-gradient(to right, #fff, hsl(${N}, 100%, 50%)), linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,1))`},role:"application","aria-label":"Color spectrum",children:n.jsx("div",{className:"spectrum-handle",style:{left:`${Ge}%`,top:`${100-he}%`},"aria-hidden":"true"})}),n.jsx("div",{className:"hue-row",children:n.jsx("input",{className:"hue-range",type:"range",min:"0",max:"360",value:N,onChange:d=>rt(Number(d.target.value)),style:{background:`linear-gradient(to right, ${Array.from({length:13}).map((d,g)=>`hsl(${g*30},100%,50%)`).join(",")})`},"aria-label":"Hue"})}),n.jsxs("div",{className:"hex-row",children:[n.jsx("input",{type:"text",className:"hex-input",value:Ae(N,Ge,he),onChange:d=>we(d.target.value),"aria-label":"Hex color value"}),n.jsx("button",{type:"button",className:"eyedropper-button",title:"Eyedropper","aria-label":"Eyedropper",children:n.jsx("i",{className:"fa-solid fa-eye-dropper"})})]})]})})}),n.jsxs("div",{className:"swatch-sections",children:[n.jsxs("div",{className:"tabs",children:[n.jsx("div",{className:`tab ${ye==="swatches"?"active":""}`,onClick:()=>ze("swatches"),children:"Swatches"}),n.jsx("div",{className:`tab ${ye==="cmyk"?"active":""}`,onClick:()=>ze("cmyk"),children:"CMYK"})]}),n.jsx("div",{className:"section-divider","aria-hidden":"true"}),ye==="swatches"&&n.jsxs(n.Fragment,{children:[le.length>0&&n.jsxs("div",{className:"swatch-section",children:[n.jsx("div",{className:"swatch-title",children:"Recent colors"}),n.jsx("div",{className:"swatches-grid",children:le.map(d=>n.jsx("button",{type:"button",className:"swatch",style:{background:d},onClick:()=>lt(d)},d))})]}),le.length>0&&Nt.length>0&&n.jsx("div",{className:"section-divider","aria-hidden":"true"}),n.jsx("div",{className:"swatch-section",children:n.jsx("div",{className:"preset-groups",children:Nt.map((d,g)=>n.jsx("div",{className:"swatch-group",children:n.jsx("div",{className:"swatches-grid preset",children:d.colors.map(R=>n.jsx("button",{type:"button",className:"swatch",style:{background:R},onClick:()=>lt(R)},R))})},g))})})]}),ye==="cmyk"&&n.jsxs("div",{className:"swatch-section cmyk-section",children:[n.jsx("div",{className:"swatch-title",children:"CMYK (preview)"}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"C"}),n.jsx("input",{type:"range",min:"0",max:"100",value:be,onChange:d=>Se(Number(d.target.value)),className:"cmyk-range c-range","aria-label":"Cyan"}),n.jsxs("div",{className:"cmyk-value",children:[be,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"M"}),n.jsx("input",{type:"range",min:"0",max:"100",value:h,onChange:d=>V(Number(d.target.value)),className:"cmyk-range m-range","aria-label":"Magenta"}),n.jsxs("div",{className:"cmyk-value",children:[h,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"Y"}),n.jsx("input",{type:"range",min:"0",max:"100",value:G,onChange:d=>kt(Number(d.target.value)),className:"cmyk-range y-range","aria-label":"Yellow"}),n.jsxs("div",{className:"cmyk-value",children:[G,"%"]})]}),n.jsxs("div",{className:"cmyk-row",children:[n.jsx("div",{className:"cmyk-label",children:"K"}),n.jsx("input",{type:"range",min:"0",max:"100",value:de,onChange:d=>Xe(Number(d.target.value)),className:"cmyk-range k-range","aria-label":"Key Black"}),n.jsxs("div",{className:"cmyk-value",children:[de,"%"]})]})]})]})]})})]}),ie&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--actions",role:"group","aria-label":"Text format actions",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bold",onClick:()=>{A(d=>!d),T(!1),C(!1)},children:n.jsx("span",{className:"toolbar-label",children:"B"})}),z&&n.jsx("div",{className:"format-modal",ref:O,role:"dialog","aria-label":"Text formatting options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option",title:"Bold",onClick:()=>{o("bold"),A(!1)},children:n.jsx("i",{className:"fi fi-ss-bold","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Italic",onClick:()=>{o("italic"),A(!1)},children:n.jsx("i",{className:"fi fi-br-italic","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Underline",onClick:()=>{o("underline"),A(!1)},children:n.jsx("i",{className:"fi fi-br-underline","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"format-option",title:"Strikethrough",onClick:()=>{o("strikethrough"),A(!1)},children:n.jsx("i",{className:"fi fi-br-strikethrough","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Align center",onClick:()=>{Q(d=>!d),A(!1),T(!1),C(!1)},children:n.jsx("i",{className:"fa-solid fa-align-center","aria-hidden":"true"})}),je&&n.jsx("div",{className:"align-modal",ref:Le,role:"dialog","aria-label":"Alignment options",children:n.jsxs("div",{className:"align-modal-content",children:[n.jsx("button",{type:"button",className:"align-option",title:"Align-justify",onClick:()=>{o("align-justify"),Q(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-center",onClick:()=>{o("align-center"),Q(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"5",y:"4",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"5",y:"14",width:"14",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-left",onClick:()=>{o("align-left"),Q(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"3",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})}),n.jsx("button",{type:"button",className:"align-option",title:"Align-right",onClick:()=>{o("align-right"),Q(!1)},children:n.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[n.jsx("rect",{x:"9",y:"4",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"9",width:"18",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"9",y:"14",width:"12",height:"2",rx:"1",fill:"currentColor"}),n.jsx("rect",{x:"3",y:"19",width:"18",height:"2",rx:"1",fill:"currentColor"})]})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Bulleted list",onClick:()=>{ee(d=>!d),Q(!1),A(!1),T(!1),C(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})}),Te&&n.jsx("div",{className:"list-modal",ref:Ye,role:"dialog","aria-label":"List options",children:n.jsxs("div",{className:"list-modal-content",children:[n.jsx("button",{type:"button",className:"list-option",title:"Numbered list",onClick:()=>{ee(!1),ue(!0)},children:n.jsx("i",{className:"fa-solid fa-list-ol","aria-hidden":"true"})}),n.jsx("button",{type:"button",className:"list-option",title:"Bulleted list",onClick:()=>{o("list-bullets"),ee(!1)},children:n.jsx("i",{className:"fa-solid fa-list-ul","aria-hidden":"true"})})]})}),n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Numbered list",onClick:()=>{ue(d=>!d),ee(!1),Q(!1),A(!1),T(!1),C(!1)},children:n.jsx("i",{className:"fa-solid fa-text-height","aria-hidden":"true"})}),it&&n.jsx("div",{className:"number-modal",ref:nt,role:"dialog","aria-label":"Text spacing options",children:n.jsxs("div",{className:"number-modal-content",children:[n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Line spacing"}),n.jsx("input",{type:"range",min:"0.8",max:"3",step:"0.01",value:ft,onChange:d=>{const g=Number(d.target.value);Fe(g),o("line-spacing")(g)},className:"number-range line-range","aria-label":"Line spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:gt,"aria-label":"Reset line spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:ft,onChange:d=>{const g=Number(d.target.value);Fe(g),o("line-spacing")(g)}})]}),n.jsxs("div",{className:"slider-row number-row",children:[n.jsx("label",{className:"slider-label",children:"Letter spacing"}),n.jsx("input",{type:"range",min:"-0.5",max:"1",step:"0.01",value:Ke,onChange:d=>{const g=Number(d.target.value);$e(g),o("letter-spacing")(g)},className:"number-range letter-range","aria-label":"Letter spacing"}),n.jsx("button",{type:"button",className:"reset-button",title:"Reset",onClick:Ze,"aria-label":"Reset letter spacing",children:"⟲"}),n.jsx("input",{className:"slider-value-input",type:"number",step:"0.01",value:Ke,onChange:d=>{const g=Number(d.target.value);$e(g),o("letter-spacing")(g)}})]})]})})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--menu",role:"group","aria-label":"Text styles",style:{position:"relative"},children:[n.jsx("button",{type:"button",className:"text-button",onClick:()=>{U(d=>!d),ee(!1),Q(!1),T(!1),C(!1),ue(!1),A(!1),pe(!1)},"aria-label":"Format",children:"Format"}),B&&n.jsx("div",{className:"case-modal format-modal",ref:ve,role:"dialog","aria-label":"Case options",children:n.jsxs("div",{className:"format-modal-content",children:[n.jsx("button",{type:"button",className:"format-option ",title:"Lowercase",onClick:()=>{o("lowercase"),U(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"a"})}),n.jsx("button",{type:"button",className:"format-option ",title:"Uppercase",onClick:()=>{o("uppercase"),U(!1)},children:n.jsx("span",{className:"format-text-icon","aria-hidden":"true",children:"A"})})]})}),n.jsxs("button",{type:"button",className:"text-button",onClick:()=>{pe(d=>!d),U(!1),ee(!1),Q(!1),A(!1),T(!1),C(!1),ue(!1)},children:["T",n.jsx("span",{className:"text-button__super",children:"+"})," Effects"]}),De&&n.jsxs("div",{className:"effects-modal",ref:tt,role:"dialog","aria-label":"Text effects",children:[n.jsx("button",{type:"button",className:"modal-close-btn","aria-label":"Close effects",onClick:()=>pe(!1),children:n.jsx("i",{className:"fa-solid fa-x","aria-hidden":"true"})}),n.jsxs("div",{className:"effects-modal-content",children:[n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Style"}),n.jsxs("div",{className:"effects-grid",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{o("effect-style")("none")},children:n.jsx("div",{className:"effect-preview none",children:n.jsx("i",{className:"fa-solid fa-ban","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Shadow",onClick:()=>{o("effect-style")("shadow")},children:n.jsx("div",{className:"effect-preview shadow",children:n.jsx("i",{className:"fi fi-rr-text-shadow","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Highlight",onClick:()=>{o("effect-style")("highlight")},children:n.jsx("div",{className:"effect-preview highlight",children:n.jsx("i",{className:"fa-solid fa-highlighter","aria-hidden":"true"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Glitch",onClick:()=>{o("effect-style")("glitch")},children:n.jsx("div",{className:"effect-preview glitch",children:n.jsx("span",{className:"glitch-mark",children:"/A"})})}),n.jsx("button",{type:"button",className:"effect-option",title:"Echo",onClick:()=>{o("effect-style")("echo")},children:n.jsx("div",{className:"effect-preview echo",children:n.jsx("span",{className:"echo-mark",children:"//A"})})})]})]}),n.jsxs("div",{className:"effects-section",children:[n.jsx("div",{className:"effects-section-title",children:"Shape"}),n.jsxs("div",{className:"effects-grid two",children:[n.jsx("button",{type:"button",className:"effect-option",title:"None",onClick:()=>{o("effect-shape")("none")},children:n.jsx("div",{className:"effect-preview none",children:"None"})}),n.jsx("button",{type:"button",className:"effect-option",title:"Curve",onClick:()=>{o("effect-shape")("curve")},children:n.jsx("div",{className:"effect-preview curve",children:"Curve"})})]})]})]})]})]})]}),n.jsx("div",{className:"toolbar-divider","aria-hidden":"true"}),n.jsxs("div",{className:"toolbar-group toolbar-group--utility",role:"group","aria-label":"Utility actions",style:{position:"relative"},children:[n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Spacing",onClick:()=>{q&&(Ne(d=>!d),pe(!1),U(!1),ee(!1),Q(!1),A(!1),T(!1),C(!1),ue(!1))},disabled:!q,children:n.jsx("i",{className:"fi fi-rr-chess-board","aria-hidden":"true"})}),qe&&n.jsx("div",{className:"opacity-modal",ref:te,role:"dialog","aria-label":"Opacity",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"opacity-modal-content",children:[n.jsxs("div",{className:"opacity-row",children:[n.jsx("label",{className:"opacity-label",children:"Opacity"}),n.jsx("input",{className:"opacity-input",type:"number",min:"0",max:"100",value:mt,onChange:d=>{const g=It(Number(d.target.value)||0,0,100);_e(g),o("opacity")(g)},"aria-label":"Opacity percent"})]}),n.jsx("div",{className:"opacity-slider-row",children:n.jsx("input",{type:"range",min:"0",max:"100",value:mt,onChange:d=>{const g=Number(d.target.value);_e(g),o("opacity")(g)},className:"opacity-slider","aria-label":"Opacity slider",style:{background:"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1))"}})})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Layers",onClick:()=>{q&&(ne(d=>!d),ge(!1),Ne(!1),pe(!1),U(!1),ee(!1),Q(!1),A(!1),T(!1),C(!1),ue(!1))},disabled:!q,children:n.jsx("i",{className:"fa-solid fa-layer-group","aria-hidden":"true"})}),ke&&n.jsx("div",{className:"layers-modal",ref:ht,role:"dialog","aria-label":"Layer management",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"layers-modal-content",children:[n.jsxs("button",{type:"button",className:"layer-option",title:"Bring to front",onClick:()=>{o("layer")("bring-to-front"),ne(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring to front"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Bring forward",onClick:()=>{o("layer")("bring-forward"),ne(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-up","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Bring forward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send backward",onClick:()=>{o("layer")("send-backward"),ne(!1)},children:[n.jsx("i",{className:"fi fi-rr-angle-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send backward"})]}),n.jsxs("button",{type:"button",className:"layer-option",title:"Send to back",onClick:()=>{o("layer")("send-to-back"),ne(!1)},children:[n.jsx("i",{className:"fi fi-rr-chevron-double-down","aria-hidden":"true"}),n.jsx("span",{className:"layer-label",children:"Send to back"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"Share / Rotation",onClick:()=>{q&&(ge(d=>!d),Ne(!1),pe(!1),U(!1),ee(!1),Q(!1),A(!1),T(!1),C(!1),ue(!1))},disabled:!q,children:n.jsx("i",{className:"fi fi-rr-refresh","aria-hidden":"true"})}),Je&&n.jsx("div",{className:"rotation-modal",ref:We,role:"dialog","aria-label":"Rotation",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"rotation-modal-content",children:[n.jsxs("div",{className:"rotation-row",children:[n.jsx("label",{className:"rotation-label",children:"Rotation"}),n.jsx("input",{className:"rotation-input",type:"number",min:"-180",max:"180",value:Ie,onChange:d=>{const g=It(Number(d.target.value)||0,-180,180);Me(g),o("rotation")(g)},"aria-label":"Rotation degrees"})]}),n.jsxs("div",{className:"rotation-slider-row",children:[n.jsx("input",{type:"range",min:"-180",max:"180",value:Ie,onChange:d=>{const g=Number(d.target.value);Me(g),o("rotation")(g)},className:"rotation-slider","aria-label":"Rotation slider"}),n.jsx("i",{className:"fa-solid fa-rotate-right rotation-icon","aria-hidden":"true"})]})]})})]}),n.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[n.jsx("button",{type:"button",className:"ghost-button","aria-label":"More options",onClick:()=>{q&&(W(d=>!d),ne(!1),ge(!1),Ne(!1),pe(!1),U(!1),ee(!1),Q(!1),A(!1),T(!1),C(!1),ue(!1))},disabled:!q,children:n.jsx("i",{className:"fa-solid fa-ellipsis","aria-hidden":"true"})}),He&&n.jsx("div",{className:"more-modal",ref:Pe,role:"dialog","aria-label":"More options",style:{position:"absolute",right:0,top:"42px",zIndex:1200},children:n.jsxs("div",{className:"more-modal-content",children:[n.jsxs("button",{type:"button",className:"more-option",title:"Duplicate",onClick:()=>{o("more")("duplicate"),W(!1)},children:[n.jsx("i",{className:"fa-solid fa-clone","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Duplicate"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Delete",onClick:()=>{o("more")("delete"),W(!1)},children:[n.jsx("i",{className:"fi fi-rr-trash","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Delete"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Lock",onClick:()=>{o("more")("lock"),W(!1)},children:[n.jsx("i",{className:"fi fi-rr-unlock","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Lock"})]}),n.jsxs("button",{type:"button",className:"more-option",title:"Copy",onClick:()=>{o("more")("copy"),W(!1)},children:[n.jsx("i",{className:"fa-solid fa-copy","aria-hidden":"true"}),n.jsx("span",{className:"more-label",children:"Copy"})]})]})})]})]})]})}function _a(){const H=document.getElementById("inkwise-customer-studio-bootstrap");if(H)try{const c=JSON.parse(H.textContent||"{}");if(c&&typeof c=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=c),c}catch(c){console.error("[InkWise Studio] Failed to parse bootstrap payload.",c)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Wa(){const H=x.useMemo(()=>_a(),[]),[c,o]=x.useState("initializing"),[u,f]=x.useState(null);if(x.useEffect(()=>{Ua(),o("ready")},[]),x.useEffect(()=>{if(typeof window>"u")return;const L=C=>{const _=(C==null?void 0:C.detail)||{};f(_.type||null)};window.addEventListener("inkwise:active-element",L);const y=window.inkwiseToolbar;if(y&&typeof y.getSelection=="function")try{const C=y.getSelection();C&&C.type&&f(C.type)}catch(C){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",C)}return()=>{window.removeEventListener("inkwise:active-element",L)}},[]),!H||Object.keys(H).length===0)return null;const S=L=>{const y=typeof window<"u"?window.inkwiseToolbar:null;if(!y||typeof y.setFontFamily!="function"){console.debug("[InkWise Studio] Font change ignored (bridge unavailable).",L);return}y.setFontFamily(L)},k=L=>{const y=typeof window<"u"?window.inkwiseToolbar:null;if(!y||typeof y.setFontSize!="function"){console.debug("[InkWise Studio] Size change ignored (bridge unavailable).",L);return}y.setFontSize(L)},w=L=>{const y=typeof window<"u"?window.inkwiseToolbar:null;if(!y||typeof y.setColor!="function"){console.debug("[InkWise Studio] Color change ignored (bridge unavailable).",L);return}y.setColor(L)},v=L=>{const y=typeof window<"u"?window.inkwiseToolbar:null;return!y||typeof y.dispatch!="function"?(console.debug("[InkWise Studio] Toolbar action ignored (bridge unavailable).",L),()=>{}):new Set(["line-spacing","letter-spacing","effect-style","effect-shape","opacity","rotation","layer","more"]).has(L)?_=>{y.dispatch(L,_)}:(y.dispatch(L),()=>{})};return n.jsx("div",{className:"studio-react-widgets",children:n.jsx(qa,{onAction:v,onFontChange:S,onSizeChange:k,onColorChange:w,activeElementType:u})})}function Ha(){const H=()=>{const c=document.getElementById("inkwise-customer-studio-root");if(!c)return;Ra.createRoot(c).render(n.jsx(Da.StrictMode,{children:n.jsx(Wa,{})}))};if(document.readyState==="complete"||document.readyState==="interactive"){H();return}document.addEventListener("DOMContentLoaded",H,{once:!0})}Ha();
