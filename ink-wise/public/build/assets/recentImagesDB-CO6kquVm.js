const w="inkwise-recent-images-v1",s="images";function d(){return new Promise((n,t)=>{const e=indexedDB.open(w,1);e.onupgradeneeded=o=>{const r=o.target.result;r.objectStoreNames.contains(s)||r.createObjectStore(s,{keyPath:"id"}).createIndex("uploadedAt","uploadedAt")},e.onsuccess=()=>n(e.result),e.onerror=()=>t(e.error)})}async function m(n,t,e,o=new Date().toISOString()){const r=await d();return new Promise((c,a)=>{const i=r.transaction(s,"readwrite");i.objectStore(s).put({id:n,fileName:t,blob:e,uploadedAt:o}),i.oncomplete=()=>c(!0),i.onerror=()=>a(i.error)})}async function u(){const n=await d();return new Promise((t,e)=>{const c=n.transaction(s,"readonly").objectStore(s).getAll();c.onsuccess=()=>t(c.result||[]),c.onerror=()=>e(c.error)})}async function g(n){const t=await d();return new Promise((e,o)=>{const r=t.transaction(s,"readwrite");r.objectStore(s).delete(n),r.oncomplete=()=>e(!0),r.onerror=()=>o(r.error)})}async function p(){const n=await d();return new Promise((t,e)=>{const o=n.transaction(s,"readwrite");o.objectStore(s).clear(),o.oncomplete=()=>t(!0),o.onerror=()=>e(o.error)})}async function b(n=10){const t=await u();if(t.length<=n)return;t.sort((r,c)=>new Date(r.uploadedAt)-new Date(c.uploadedAt));const e=t.slice(0,t.length-n),o=await d();return new Promise((r,c)=>{const a=o.transaction(s,"readwrite"),i=a.objectStore(s);e.forEach(l=>i.delete(l.id)),a.oncomplete=()=>r(!0),a.onerror=()=>c(a.error)})}const S={openDB:d,saveImage:m,getAllImages:u,deleteImage:g,clearAllImages:p,pruneOld:b};export{p as clearAllImages,S as default,g as deleteImage,u as getAllImages,b as pruneOld,m as saveImage};
