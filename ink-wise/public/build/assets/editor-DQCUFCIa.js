document.addEventListener("DOMContentLoaded",()=>{var Tt,Ct,At,Mt,Ot,zt;const u=document.getElementById("zoomOutBtn"),I=document.getElementById("zoomInBtn"),x=document.querySelector(".zoom-controls span"),o=document.getElementById("templateCanvas"),e=o.getContext("2d");let n=100;function W(){o.style.transform=`scale(${n/100})`,x.textContent=`${n}%`,Nt(),f()}u==null||u.addEventListener("click",()=>{n>10&&(n-=10,W())}),I==null||I.addEventListener("click",()=>{n<300&&(n+=10,W())});let G=[],y=[],h=[],a=null,M=null,K=!1,V=!1,Z={x:0,y:0},v=null,O=null,Q=!1,tt=!1,et={x:0,y:0},S=null,r=null,z=null,R=null,N=null;function Dt(t){y=[],h=[],t.pages&&Array.isArray(t.pages)&&t.pages.forEach(s=>{s.nodes&&Array.isArray(s.nodes)&&s.nodes.forEach(l=>{var d,c,i,g,p,F,J,P;if(l.type==="text")y.push({x:((d=l.frame)==null?void 0:d.x)||0,y:((c=l.frame)==null?void 0:c.y)||0,w:((i=l.frame)==null?void 0:i.width)||100,h:((g=l.frame)==null?void 0:g.height)||50,text:l.content||"",fontSize:l.fontSize||24,color:l.fill||"#000000",fontFamily:l.fontFamily||"Arial, sans-serif",textAlign:l.textAlign||"left",fontStyle:l.fontStyle||"normal",fontWeight:l.fontWeight||"400",textTransform:l.textTransform||"none",textDecoration:l.textDecoration||""});else if(l.type==="image"){const b=new Image;b.onload=function(){f()},b.src=l.src||"",h.push({type:"image",img:b,x:((p=l.frame)==null?void 0:p.x)||0,y:((F=l.frame)==null?void 0:F.y)||0,w:((J=l.frame)==null?void 0:J.width)||100,h:((P=l.frame)==null?void 0:P.height)||100,locked:!1})}else l.type})}),f()}function f(){e.clearRect(0,0,o.width,o.height),R&&R.complete&&R.naturalWidth>0&&e.drawImage(R,0,0,o.width,o.height),N&&N.complete&&N.naturalWidth>0&&e.drawImage(N,0,0,o.width,o.height),Ft(),y.forEach(t=>{e.save(),e.strokeStyle=a===t?"#2563eb":"#aaa",e.lineWidth=a===t?2:1,e.strokeRect(t.x*(n/100),t.y*(n/100),t.w*(n/100),t.h*(n/100));const s=t.fontStyle&&t.fontStyle!=="normal"?t.fontStyle+" ":"",l=t.fontWeight||"400";e.font=`${s}${l} ${t.fontSize*(n/100)}px ${t.fontFamily}`,e.fillStyle=t.color,e.textBaseline="top",e.textAlign=t.textAlign||"left",e.save(),e.beginPath(),e.rect(t.x*(n/100)+8,t.y*(n/100)+8,(t.w-16)*(n/100),(t.h-16)*(n/100)),e.clip();const d=t.textTransform==="uppercase"?(t.text||"").toUpperCase():t.text||"";if(e.fillText(d,t.x*(n/100)+8,t.y*(n/100)+8,(t.w-16)*(n/100)),t.textDecoration&&t.textDecoration.includes("underline")){e.measureText(d);const i=t.y*(n/100)+8+t.fontSize*(n/100);e.beginPath(),e.strokeStyle=t.color||"#000",e.lineWidth=Math.max(1,t.fontSize*(n/100)/12);let g=t.x*(n/100)+8,p=t.x*(n/100)+(t.w-16)*(n/100);e.moveTo(g,i),e.lineTo(p,i),e.stroke()}e.restore(),e.fillStyle="#2563eb",e.fillRect(t.x*(n/100)+t.w*(n/100)-8,t.y*(n/100)+t.h*(n/100)-8,8,8),e.font="bold 18px Arial",e.fillStyle="#e11d48",e.textAlign="right",e.textBaseline="top",e.fillText("‚úï",t.x*(n/100)+t.w*(n/100)-12,t.y*(n/100)+4);const c=[[t.x,t.y],[t.x+t.w,t.y],[t.x,t.y+t.h],[t.x+t.w,t.y+t.h]];e.fillStyle="#2563eb",c.forEach(([i,g])=>{e.fillRect(i*(n/100)-4,g*(n/100)-4,8,8)}),e.restore()})}function Ft(){h.forEach(t=>{e.save(),t.type==="image"&&t.img&&e.drawImage(t.img,t.x*(n/100),t.y*(n/100),t.w*(n/100),t.h*(n/100)),t.type==="video"&&(e.strokeStyle="#aaa",e.strokeRect(t.x*(n/100),t.y*(n/100),t.w*(n/100),t.h*(n/100)),e.font="bold 16px Arial",e.fillStyle="#888",e.fillText("Video",t.x*(n/100)+10,t.y*(n/100)+24)),e.fillStyle="#2563eb",e.beginPath(),e.arc(t.x*(n/100)+t.w*(n/100)-12,t.y*(n/100)+t.h*(n/100)-12,12,0,2*Math.PI),e.fill(),e.font="20px Arial",e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText("‚§¢",t.x*(n/100)+t.w*(n/100)-12,t.y*(n/100)+t.h*(n/100)-12),e.font="28px Arial",e.textAlign="right",e.textBaseline="top",e.fillStyle="#2563eb",t.locked?e.fillText("üîí",(t.x+t.w)*(n/100)-10,t.y*(n/100)+2):e.fillText("üîì",(t.x+t.w)*(n/100)-10,t.y*(n/100)+2),e.font="28px Arial",e.fillStyle="#e11d48",e.textAlign="left",e.textBaseline="top",e.fillText("‚®Ø",t.x*(n/100)+4,t.y*(n/100)+4),e.font="22px Arial",e.fillStyle="#2563eb",e.textAlign="center",e.textBaseline="middle",e.fillText("‚á≤",t.x*(n/100)+t.w*(n/100)-32,t.y*(n/100)+t.h*(n/100)-32),e.restore()})}o.addEventListener("mousedown",function(t){if(r)return;const s=o.getBoundingClientRect(),l=(t.clientX-s.left)*(o.width/s.width)/(n/100),d=(t.clientY-s.top)*(o.height/s.height)/(n/100);for(let c=y.length-1;c>=0;c--){const i=y[c],g=i.x+i.w-24,p=i.y+4;if(l>g&&l<g+20&&d>p&&d<p+20){ut(),y.splice(c,1),a=null,rt(),f();return}}for(let c=h.length-1;c>=0;c--){const i=h[c],g=i.x+i.w-24,p=i.y+2;if(l>g&&l<g+22&&d>p&&d<p+22){i.locked=!i.locked,f();return}}a=null,O=null,v=null,K=!1,V=!1;for(let c=y.length-1;c>=0;c--){const i=y[c],g=[{name:"tl",x:i.x,y:i.y},{name:"tr",x:i.x+i.w,y:i.y},{name:"bl",x:i.x,y:i.y+i.h},{name:"br",x:i.x+i.w,y:i.y+i.h}];for(const p of g)if(l>p.x-8&&l<p.x+8&&d>p.y-8&&d<p.y+8){a=i,V=!0,v=i,O=p.name,Z={x:l-i.x,y:d-i.y},f(),Y();return}if(l>i.x&&l<i.x+i.w&&d>i.y&&d<i.y+i.h){ut(),a=i,K=!0,O="move",v=i,Z={x:l-i.x,y:d-i.y},f(),Y();return}}M=null,Q=!1,tt=!1,S=null;for(let c=h.length-1;c>=0;c--){const i=h[c];if(!i.locked){if(l>i.x+i.w-8&&l<i.x+i.w&&d>i.y+i.h-8&&d<i.y+i.h){M=i,tt=!0,S=i,et={x:l-i.x,y:d-i.y};return}if(l>i.x&&l<i.x+i.w&&d>i.y&&d<i.y+i.h){M=i,Q=!0,S=i,et={x:l-i.x,y:d-i.y};return}}}f(),a||rt()}),o.addEventListener("mousemove",function(t){const s=o.getBoundingClientRect(),l=(t.clientX-s.left)*(o.width/s.width)/(n/100),d=(t.clientY-s.top)*(o.height/s.height)/(n/100);if(K&&O==="move"&&v&&(v.x=l-Z.x,v.y=d-Z.y,f(),a&&mt(a)),V&&v){let c=v.x,i=v.y,g=v.w,p=v.h;O==="tl"?(g+=c-l,p+=i-d,c=l,i=d):O==="tr"?(g=l-v.x,p+=i-d,i=d):O==="bl"?(g+=c-l,c=l,p=d-v.y):O==="br"&&(g=l-v.x,p=d-v.y),v.x=c,v.y=i,v.w=Math.max(40,g),v.h=Math.max(28,p),f(),a&&mt(a)}Q&&S&&(S.x=l-et.x,S.y=d-et.y,f()),tt&&S&&(S.w=Math.max(40,l-S.x),S.h=Math.max(30,d-S.y),f())}),document.addEventListener("mouseup",function(){K=!1,V=!1,O=null,v=null,Q=!1,tt=!1,S=null}),o.addEventListener("dblclick",function(t){if(r)return;const s=o.getBoundingClientRect(),l=(t.clientX-s.left)*(o.width/s.width)/(n/100),d=(t.clientY-s.top)*(o.height/s.height)/(n/100);for(let c=y.length-1;c>=0;c--){const i=y[c];if(l>i.x&&l<i.x+i.w&&d>i.y&&d<i.y+i.h){a=i,z=i,Rt(i),Y();return}}});let nt=[],it=[];function ut(){nt.push({textBoxes:JSON.parse(JSON.stringify(y)),mediaBoxes:JSON.parse(JSON.stringify(h))}),it=[]}function ht(t){t&&(y=JSON.parse(JSON.stringify(t.textBoxes)),h=JSON.parse(JSON.stringify(t.mediaBoxes)),f(),rt())}(Tt=document.getElementById("undoBtn"))==null||Tt.addEventListener("click",function(){if(nt.length>0){it.push({textBoxes:JSON.parse(JSON.stringify(y)),mediaBoxes:JSON.parse(JSON.stringify(h))});const t=nt.pop();ht(t)}}),(Ct=document.getElementById("redoBtn"))==null||Ct.addEventListener("click",function(){if(it.length>0){nt.push({textBoxes:JSON.parse(JSON.stringify(y)),mediaBoxes:JSON.parse(JSON.stringify(h))});const t=it.pop();ht(t)}});function Rt(t){if(r)return;r=document.createElement("textarea"),r.value=t.text,r.style.position="absolute",r.style.left=o.offsetLeft+t.x*(n/100)+"px",r.style.top=o.offsetTop+t.y*(n/100)+"px",r.style.width=t.w*(n/100)+"px",r.style.height=t.h*(n/100)+"px",r.style.fontSize=t.fontSize*(n/100)+"px",r.style.fontFamily=t.fontFamily,r.style.color=t.color,r.style.zIndex=10,r.style.background="rgba(255,255,255,0.95)",r.style.border="1px solid #2563eb",r.style.resize="none",r.style.overflow="hidden",r.style.padding="2px 4px",r.style.boxSizing="border-box",r.style.outline="none",r.style.borderRadius="6px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.08)",r.rows=1;const s=o.parentNode;s.appendChild(r),r.focus(),r.addEventListener("blur",function(){t.text=r.value,s.removeChild(r),r=null,z=null,f()})}function Nt(){!r||!z||(r.style.left=o.offsetLeft+z.x*(n/100)+"px",r.style.top=o.offsetTop+z.y*(n/100)+"px",r.style.width=z.w*(n/100)+"px",r.style.height=z.h*(n/100)+"px",r.style.fontSize=z.fontSize*(n/100)+"px")}const D=document.querySelector(".small-floating-toolbar"),ot=document.getElementById("fontSizeToolbar"),lt=document.getElementById("boldToolbar"),at=document.getElementById("italicToolbar"),st=document.getElementById("underlineToolbar"),xt=document.getElementById("alignLeftToolbar"),vt=document.getElementById("alignCenterToolbar"),wt=document.getElementById("alignJustifyToolbar"),Et=document.getElementById("uppercaseToolbar"),It=document.getElementById("colorPickerInput");function rt(){D&&(D.style.display="none");const t=document.getElementById("colorPickerDropdown");t&&(t.style.display="none")}function mt(t){if(!D||!t)return;const s=n/100,l=o.offsetLeft+t.x*s+t.w*s/2,d=o.offsetTop+t.y*s-46;D.style.transform="",D.style.left=l-20+"px",D.style.top=Math.max(6,d)+"px",D.style.display="flex"}function Y(){if(D){if(!a){rt();return}ot&&(ot.value=a.fontSize||20),lt&&lt.classList.toggle("active",parseInt(a.fontWeight||"400")>=700),at&&at.classList.toggle("active",a.fontStyle==="italic"),st&&st.classList.toggle("active",a.textDecoration&&a.textDecoration.includes("underline")),mt(a)}}ot&&ot.addEventListener("input",function(){a&&(a.fontSize=parseInt(this.value,10)||12,f(),r&&(r.style.fontSize=a.fontSize*(n/100)+"px"))}),lt&&lt.addEventListener("click",function(){a&&(a.fontWeight=parseInt(a.fontWeight||"400")>=700?"400":"700",f())}),at&&at.addEventListener("click",function(){a&&(a.fontStyle=a.fontStyle==="italic"?"normal":"italic",f())}),st&&st.addEventListener("click",function(){a&&(a.textDecoration=a.textDecoration&&a.textDecoration.includes("underline")?"":"underline",f())}),xt&&xt.addEventListener("click",function(){a&&(a.textAlign="left",f())}),vt&&vt.addEventListener("click",function(){a&&(a.textAlign="center",f())}),wt&&wt.addEventListener("click",function(){a&&(a.textAlign="justify",f())}),Et&&Et.addEventListener("click",function(){a&&(a.textTransform=a.textTransform==="uppercase"?"none":"uppercase",f())}),It&&It.addEventListener("input",function(){a&&(a.color=this.value,f(),r&&(r.style.color=this.value))});const bt=document.getElementById("symbolToolbar");bt&&bt.addEventListener("click",function(){if(!a)return;const t="‚òÖ";typeof a.text!="string"&&(a.text=""),a.text=a.text+t,r&&z===a&&(r.value=a.text),Y(),f()});function j(t="New Text",s=20,l="normal"){ut(),y.push({text:t,x:60,y:60,w:180,h:40,fontSize:s,fontWeight:l,fontFamily:G[0],color:"#222"}),a=y[y.length-1],f(),Y()}const yt=document.querySelectorAll(".editor-sidebar li"),H=document.getElementById("floatingPanel"),Ht={Text:`
            <h3>Text Tools</h3>
            <input type="search" id="fontSearch" placeholder="Search fonts...">
            <div class="font-list" id="fontList"></div>
            <label style="display:block;margin:8px 0 4px 0;font-size:13px;">Font Size</label>
            <input type="number" id="fontSizeInput" min="8" max="120" value="20" style="width:70px;margin-bottom:10px;">
            <label style="display:block;margin:8px 0 4px 0;font-size:13px;">Text Color</label>
            <input type="color" id="textColorPicker" value="#222" style="margin-bottom:10px;">
            <div id="colorPalette" style="display:flex;flex-wrap:wrap;margin-bottom:10px;"></div>
            <button class="btn full" id="addTextBox">+ Add Text Box</button>
            <div style="margin-top:10px;">
                <button class="btn full" id="addHeading">Add Heading</button>
                <button class="btn full" id="addSubHeading">Add Sub Heading</button>
                <button class="btn full" id="addBodyText">Add Body Text</button>
            </div>
        `,Images:`
            <h3>Image/Video Tools</h3>
            <input type="search" id="imageSearch" placeholder="Search images...">
            <button class="btn full" id="searchImageBtn">Search Image</button>
            <input type="file" accept="image/*,video/*" id="uploadMedia">
            <button class="btn full" id="uploadMediaBtn">Upload Image/Video</button>
            <div class="font-list" id="mediaList"></div>
            <div id="imageResults" style="margin-top:10px;"></div>
        `,Graphics:`
            <h3>Graphics Tools</h3>
            <input type="search" id="graphicSearch" placeholder="Search graphics...">
            <p><strong>Shapes</strong></p>
            <div class="shape-grid">
                <button title="Circle">‚ö™</button>
                <button title="Square">‚¨õ</button>
                <button title="Triangle">üî∫</button>
                <button title="Line">‚ûñ</button>
            </div>
            <p><strong>Icons</strong></p>
            <div class="icon-grid">
                <button>‚≠ê</button>
                <button>‚ù§Ô∏è</button>
                <button>üíç</button>
                <button>üç∑</button>
                <button>üéÇ</button>
                <button>üé∂</button>
                <button>üå∏</button>
                <button>üåô</button>
                <button>üî•</button>
                <button>üíí</button>
            </div>
        `};yt.forEach(t=>{t.addEventListener("click",()=>{yt.forEach(c=>c.classList.remove("active")),t.classList.add("active");const s=Ht[t.textContent.trim()];if(s){if(H.innerHTML=s,H.style.display="block",t.textContent.trim()==="Text"){let X=function(w=""){c.innerHTML="",G.filter(E=>E.toLowerCase().includes(w.toLowerCase())).forEach(E=>{const m=document.createElement("div");m.textContent=E,m.style.fontFamily=E,m.style.cursor="pointer",m.style.padding="2px 6px",m.style.borderRadius="4px",m.onmouseover=()=>m.style.background="#e0e7ff",m.onmouseout=()=>m.style.background="",m.addEventListener("click",()=>{a&&(a.fontFamily=E,f(),r&&(r.style.fontFamily=E))}),c.appendChild(m)})};var l=X;const c=document.getElementById("fontList"),i=document.getElementById("fontSearch"),g=document.getElementById("addTextBox"),p=document.getElementById("addHeading"),F=document.getElementById("addSubHeading"),J=document.getElementById("addBodyText"),P=document.getElementById("textColorPicker"),b=document.getElementById("fontSizeInput");async function pt(){const w=localStorage.getItem("googleFontsList");if(w)return JSON.parse(w);try{const T=(await(await fetch("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyCSdMyA37wm0nt9gJIZSjTrxEHgXwxBMeM")).json()).items.map(L=>L.family);return localStorage.setItem("googleFontsList",JSON.stringify(T)),T}catch(E){return console.error("Failed to fetch fonts:",E),["Nunito","Roboto","Montserrat","Poppins","Oswald","Playfair Display","Great Vibes","Lobster","Dancing Script","Merriweather"]}}(async()=>(G=await pt(),X()))(),X(),i.addEventListener("input",w=>X(w.target.value)),setTimeout(()=>i.focus(),100),P&&P.addEventListener("input",w=>{a&&(a.color=w.target.value,f(),r&&(r.style.color=w.target.value))}),b&&b.addEventListener("input",w=>{a&&(a.fontSize=parseInt(w.target.value,10)||20,f(),r&&(r.style.fontSize=a.fontSize*(n/100)+"px"))}),g&&g.addEventListener("click",()=>j("New Text",20,"bold")),p&&p.addEventListener("click",()=>j("Heading Text",32,"bold")),F&&F.addEventListener("click",()=>j("Sub Heading",24,"600")),J&&J.addEventListener("click",()=>j("A little bit of body text...",16,"normal"))}if(t.textContent.trim()==="Images"){let F=function(){g.innerHTML="",p.forEach((w,E)=>{const m=document.createElement("img");m.src=w.url,m.alt="Uploaded image preview",m.style.width="48px",m.style.height="48px",m.style.objectFit="cover",m.style.margin="6px",m.style.cursor="pointer",m.title="Insert again",m.setAttribute("tabindex","0"),m.setAttribute("aria-label","Insert image"),m.onclick=()=>{h.push({type:"image",img:w.img,x:120+Math.random()*60,y:120+Math.random()*60,w:200,h:150,locked:!1}),f()},g.appendChild(m)})};var d=F;const c=document.getElementById("uploadMedia"),i=document.getElementById("uploadMediaBtn"),g=document.getElementById("mediaList");let p=[];i.addEventListener("click",()=>c.click()),c.addEventListener("change",function(w){const E=w.target.files[0];if(!E)return;const m=URL.createObjectURL(E);if(E.type.startsWith("image/")){const T=new window.Image;T.onload=function(){h.push({type:"image",img:T,x:100,y:100,w:200,h:150,locked:!1}),p.push({img:T,url:m}),f(),F()},T.src=m}});const J=document.getElementById("imageSearch"),P=document.getElementById("searchImageBtn"),b=document.getElementById("imageResults");b.style.maxHeight="260px",b.style.overflowY="auto";const pt="AIzaSyBRCDdZjTcR4brOsHV_OBsDO11We11BVi0",X="c5ae3ced1c423443c";P.addEventListener("click",async()=>{const w=J.value.trim();if(w){b.innerHTML="Searching...";try{const m=await(await fetch(`https://www.googleapis.com/customsearch/v1?key=${pt}&cx=${X}&searchType=image&q=${encodeURIComponent(w)}&num=8`)).json();b.innerHTML="",m.items&&m.items.length?m.items.forEach(T=>{const L=document.createElement("img");L.src=T.link,L.style.width="60px",L.style.height="60px",L.style.objectFit="cover",L.style.margin="4px",L.style.cursor="pointer",L.title="Insert image",L.onclick=()=>{const ct=new window.Image;ct.crossOrigin="anonymous",ct.onload=function(){h.push({type:"image",img:ct,x:120+Math.random()*60,y:120+Math.random()*60,w:200,h:150,locked:!1}),f()},ct.src=T.link},b.appendChild(L)}):b.innerHTML="No images found."}catch{b.innerHTML="Error loading images."}}})}t.textContent.trim()}else H.style.display="none"})}),(At=yt[0])==null||At.click();const Bt=document.getElementById("insertQuickText");Bt&&Bt.addEventListener("click",function(){const t=document.getElementById("quickTextInput"),s=document.getElementById("quickFontSelect"),l=document.getElementById("quickTextColor"),d=t?t.value.trim():"",c=s?s.value:G[0]||"Arial",i=l?l.value:"#222";if(!d)return;j(d,20,"normal");const g=y[y.length-1];g&&(g.fontFamily=c,g.color=i),f()});function dt(t){t._highlight=!0,f(),setTimeout(()=>{t._highlight=!1,f()},400)}document.getElementById("bringForwardBtn").onclick=()=>{if(a){const t=y.indexOf(a);t<y.length-1&&([y[t],y[t+1]]=[y[t+1],y[t]],dt(a))}if(M){const t=h.indexOf(M);t<h.length-1&&([h[t],h[t+1]]=[h[t+1],h[t]],dt(M))}f()},document.getElementById("sendBackwardBtn").onclick=()=>{if(a){const t=y.indexOf(a);t>0&&([y[t],y[t-1]]=[y[t-1],y[t]],dt(a))}if(M){const t=h.indexOf(M);t>0&&([h[t],h[t-1]]=[h[t-1],h[t]],dt(M))}f()},y.forEach(t=>{e.save(),t._highlight&&(e.shadowColor="#8c52ff",e.shadowBlur=16),e.restore()}),h.forEach(t=>{e.save(),t._highlight&&(e.shadowColor="#8c52ff",e.shadowBlur=16),e.restore()}),document.getElementById("exportBtn").addEventListener("click",()=>{const t=o.toDataURL("image/png"),s=document.createElement("a");s.href=t,s.download="template.png",s.click()}),document.getElementById("exportPdfBtn").addEventListener("click",()=>{const t=new jsPDF({orientation:"portrait",unit:"px",format:[o.width,o.height]});t.addImage(o.toDataURL("image/png"),"PNG",0,0,o.width,o.height),t.save("template.pdf")});const k=document.createElement("div");k.style.position="absolute",k.style.right="10px",k.style.top="10px",k.style.background="#fff",k.style.padding="2px 8px",k.style.borderRadius="4px",k.style.fontSize="12px",k.style.boxShadow="0 1px 3px rgba(0,0,0,.08)",k.style.zIndex=100,o.parentNode.appendChild(k),o.addEventListener("mousemove",function(t){const s=o.getBoundingClientRect(),l=Math.round((t.clientX-s.left)*(o.width/s.width)),d=Math.round((t.clientY-s.top)*(o.height/s.height));k.textContent=`X: ${l}, Y: ${d}`}),o.addEventListener("mouseleave",function(){k.textContent=""});let gt=!1,St=0,kt=0;H.addEventListener("mousedown",function(t){t.target===H&&(gt=!0,St=t.offsetX,kt=t.offsetY)}),document.addEventListener("mousemove",function(t){gt&&(H.style.left=t.clientX-St+"px",H.style.top=t.clientY-kt+"px")}),document.addEventListener("mouseup",function(){gt=!1}),document.addEventListener("keydown",function(t){var s,l;(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z"&&(t.preventDefault(),(s=document.getElementById("undoBtn"))==null||s.click()),(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="y"&&(t.preventDefault(),(l=document.getElementById("redoBtn"))==null||l.click())});const Lt=document.getElementById("inkwise-builder-bootstrap");if(Lt)try{const t=JSON.parse(Lt.textContent),s=(Mt=t.template)==null?void 0:Mt.preview_front;s&&(R=new Image,R.onload=function(){f()},R.src=s);const l=(Ot=t.template)==null?void 0:Ot.svg_path;l&&(N=new Image,N.onload=function(){f()},N.src=l);const d=(zt=t.template)==null?void 0:zt.design;d&&d.pages&&Dt(d)}catch(t){console.error("Failed to load bootstrap data:",t)}});console.log(window.TEMPLATE_ID,window.CSRF_TOKEN);window.addImageToCanvas=function(u){const I=100+Math.random()*80,x=100+Math.random()*80,o=Math.min(u.width,200),e=Math.min(u.height,150);mediaBoxes.push({type:"image",img:u,x:I,y:x,w:o,h:e,locked:!1}),draw()};const A=document.getElementById("imageDropZone"),Jt=document.getElementById("sidebarImageInput"),C=document.getElementById("sidebarImageThumbs"),q=document.getElementById("imageUploadSpinner"),B=document.getElementById("imageUploadError");let _=[];function Pt(u){B.style.display="none",q.style.display="block";let I=0,x=0;Array.from(u).forEach(o=>{if(!o.type.startsWith("image/")){B.textContent="Only image files are allowed.",B.style.display="block",q.style.display="none";return}if(o.size>5*1024*1024){B.textContent="File too large (max 5MB).",B.style.display="block",q.style.display="none";return}x++;const e=URL.createObjectURL(o),n=new window.Image;n.onload=function(){if(_.push({img:n,url:e}),ft(),I++,I===x){q.style.display="none";const W=C.querySelectorAll("img");W.length&&W[W.length-x].focus()}},n.onerror=function(){B.textContent="Failed to load image.",B.style.display="block",q.style.display="none"},n.src=e}),x===0&&(q.style.display="none")}C.addEventListener("keydown",function(u){if((u.key==="Delete"||u.key==="Backspace")&&document.activeElement.tagName==="IMG"){const x=Array.from(C.querySelectorAll("img")).indexOf(document.activeElement);if(x!==-1){_.splice(x,1),ft();const o=Array.from(C.querySelectorAll("img"));o[x]?o[x].focus():o[x-1]&&o[x-1].focus()}}});A.setAttribute("role","button");A.setAttribute("aria-label","Upload images by drag and drop or click");C.setAttribute("role","list");function ft(){C.innerHTML="",_.forEach((u,I)=>{const x=document.createElement("div");x.style.position="relative",x.style.display="inline-block",x.setAttribute("role","listitem");const o=document.createElement("img");o.src=u.url,o.alt="Uploaded image preview",o.style.width="48px",o.style.height="48px",o.style.objectFit="cover",o.style.borderRadius="6px",o.style.cursor="pointer",o.title="Insert image to canvas",o.setAttribute("tabindex","0"),o.setAttribute("aria-label","Insert image to canvas"),o.onclick=()=>{window.addImageToCanvas&&window.addImageToCanvas(u.img)},o.onkeydown=function(n){(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),window.addImageToCanvas&&window.addImageToCanvas(u.img))},o.addEventListener("focus",function(){o.style.outline="2px solid #2563eb",o.style.boxShadow="0 0 0 3px #e0e7ff"}),o.addEventListener("blur",function(){o.style.outline="",o.style.boxShadow=""});const e=document.createElement("span");e.textContent="‚úï",e.style.position="absolute",e.style.right="2px",e.style.top="2px",e.style.background="#fff",e.style.color="#e11d48",e.style.borderRadius="50%",e.style.cursor="pointer",e.style.fontSize="14px",e.style.padding="2px 5px",e.title="Remove image",e.setAttribute("aria-label","Remove image"),e.onclick=n=>{n.stopPropagation(),_.splice(I,1),ft()},x.appendChild(o),x.appendChild(e),C.appendChild(x)})}const $=document.createElement("button");$.textContent="Clear All Images";$.className="btn full";$.style.margin="10px 0";$.onclick=function(){_=[],ft()};C.parentNode&&C.parentNode.insertBefore($,C);A.addEventListener("dragover",u=>{u.preventDefault(),A.classList.add("dragover")});A.addEventListener("dragleave",u=>{A.classList.remove("dragover")});A.addEventListener("drop",u=>{u.preventDefault(),A.classList.remove("dragover"),Pt(u.dataTransfer.files)});A.addEventListener("keydown",function(u){(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),Jt.click())});A.setAttribute("tabindex","0");const U=document.getElementById("templateCanvas");U&&(U.addEventListener("dragover",u=>{u.preventDefault(),U.style.border="2px dashed #2563eb"}),U.addEventListener("dragleave",u=>{U.style.border=""}),U.addEventListener("drop",u=>{u.preventDefault(),U.style.border="",Array.from(u.dataTransfer.files).forEach(I=>{if(!I.type.startsWith("image/")){B.textContent="Only image files are allowed.",B.style.display="block";return}if(I.size>5*1024*1024){B.textContent="File too large (max 5MB).",B.style.display="block";return}const x=URL.createObjectURL(I),o=new window.Image;o.onload=function(){window.addImageToCanvas&&window.addImageToCanvas(o)},o.onerror=function(){B.textContent="Failed to load image.",B.style.display="block"},o.src=x})}));
