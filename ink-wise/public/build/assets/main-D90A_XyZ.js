import{c as ke,j as re,R as Te,r as Ut}from"./client-Cv0X-2PX.js";class xt{constructor(o,a={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",o),this.svg=o,this.options={onImageChange:a.onImageChange||null,onTextChange:a.onTextChange||null,...a};const c=document&&document.body&&document.body.dataset?document.body.dataset:{},l=(c.imageReplacementMode||"").toLowerCase();let m="full";l==="panel-only"||l==="disabled"?m=l:c.allowImageReplacement==="false"&&(m="disabled"),this.imageReplacementMode=m,this.allowCanvasImageTools=m!=="disabled",this.changeableImages=[],this.textElements=[],this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const o=this.svg.dataset.svgData;if(o){const a=JSON.parse(o);this.changeableImages=a.changeable_images||[],this.textElements=a.text_elements||[]}}toSvgPoint(o,a){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const c=this.svg.createSVGPoint();c.x=o,c.y=a;const l=this.svg.getScreenCTM();return l?c.matrixTransform(l.inverse()):null}setupImageHandlers(){const o=this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image]');if(console.log("SvgTemplateEditor: Found",o.length,"changeable image elements"),!this.allowCanvasImageTools){o.forEach(a=>{if(a.style.cursor="default",a.classList.remove("svg-changeable-image"),a.classList.remove("changeable-image-hover"),a._boundingBox){try{a._boundingBox.remove()}catch{}a._boundingBox=null}});return}setTimeout(()=>{o.forEach((a,c)=>{console.log("SvgTemplateEditor: Setting up element",c,a),a.style.cursor="pointer",a.classList.add("svg-changeable-image"),a.classList.add("changeable-image-hover"),a.addEventListener("mouseenter",function(){a.classList.add("changeable-image-active")}),a.addEventListener("mouseleave",function(){a.classList.remove("changeable-image-active")});const l=this.createBoundingBox(a);a._boundingBox=l,this.makeDraggable(a)})},200)}createBoundingBox(o){const a=o.getBBox(),c=document.createElementNS("http://www.w3.org/2000/svg","g");c.classList.add("svg-bounding-box");const l=document.createElementNS("http://www.w3.org/2000/svg","rect");return l.classList.add("svg-bounding-box__rect"),l.setAttribute("fill","none"),l.setAttribute("stroke","#007cba"),l.setAttribute("stroke-width","2"),l.setAttribute("stroke-dasharray","5,5"),l.setAttribute("rx","3"),l.style.pointerEvents="none",c.appendChild(l),this.createResizeHandles().forEach(w=>c.appendChild(w)),this.svg.appendChild(c),this.positionBoundingElements(c,a),c}createResizeHandles(){const o=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(c=>{const l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("r","4"),l.setAttribute("fill","#007cba"),l.setAttribute("stroke","#ffffff"),l.setAttribute("stroke-width","1"),l.classList.add("resize-handle",`handle-${c.name}`),l.style.pointerEvents="all",l.style.cursor=`${c.name}-resize`,o.push(l)}),o}positionBoundingElements(o,a){const c=o.querySelector(".svg-bounding-box__rect");if(!c)return;const l=5,m=a.x-l,w=a.y-l,v=a.width+l*2,h=a.height+l*2;c.setAttribute("x",m),c.setAttribute("y",w),c.setAttribute("width",Math.max(v,0)),c.setAttribute("height",Math.max(h,0)),o.querySelectorAll(".resize-handle").forEach(p=>{p.classList.contains("handle-nw")?(p.setAttribute("cx",m),p.setAttribute("cy",w)):p.classList.contains("handle-ne")?(p.setAttribute("cx",m+v),p.setAttribute("cy",w)):p.classList.contains("handle-sw")?(p.setAttribute("cx",m),p.setAttribute("cy",w+h)):p.classList.contains("handle-se")?(p.setAttribute("cx",m+v),p.setAttribute("cy",w+h)):p.classList.contains("handle-n")?(p.setAttribute("cx",m+v/2),p.setAttribute("cy",w)):p.classList.contains("handle-s")?(p.setAttribute("cx",m+v/2),p.setAttribute("cy",w+h)):p.classList.contains("handle-e")?(p.setAttribute("cx",m+v),p.setAttribute("cy",w+h/2)):p.classList.contains("handle-w")&&(p.setAttribute("cx",m),p.setAttribute("cy",w+h/2))})}updateBoundingBox(o){if(!o._boundingBox)return;const a=o.getBBox();this.positionBoundingElements(o._boundingBox,a)}makeDraggable(o){let a=!1,c=0,l=0,m=0,w=0,v=0,h=0;const B=T=>{if(T.target.closest(".resize-handle"))return;const S=this.toSvgPoint(T.clientX,T.clientY);if(!S)return;const C=o.getBBox();c=parseFloat(o.getAttribute("x")),l=parseFloat(o.getAttribute("y")),Number.isNaN(c)&&(c=C.x,o.setAttribute("x",c)),Number.isNaN(l)&&(l=C.y,o.setAttribute("y",l)),m=S.x-c,w=S.y-l,v=c,h=l,a=!0,o.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",T.preventDefault()},p=T=>{if(!a)return;const S=this.toSvgPoint(T.clientX,T.clientY);S&&(v=S.x-m,h=S.y-w,o.removeAttribute("transform"),o.setAttribute("x",v),o.setAttribute("y",h),this.updateBoundingBox(o),T.preventDefault())},O=T=>{if(!a)return;a=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(o);const S=new CustomEvent("svgImageMoved",{detail:{element:o,x:v,y:h}});this.svg.dispatchEvent(S),T.preventDefault()};o.addEventListener("mousedown",B),document.addEventListener("mousemove",p),document.addEventListener("mouseup",O),o._boundingBox.querySelectorAll(".resize-handle").forEach(T=>{this.makeResizable(o,T)})}makeResizable(o,a){let c=!1,l=null,m=0,w=0,v=0,h=0,B="",p=0;const O=S=>{const C=this.toSvgPoint(S.clientX,S.clientY);if(!C)return;const M=o.getBBox();m=M.width,w=M.height,v=parseFloat(o.getAttribute("x")),h=parseFloat(o.getAttribute("y")),Number.isNaN(v)&&(v=M.x,o.setAttribute("x",v)),Number.isNaN(h)&&(h=M.y,o.setAttribute("y",h)),p=parseFloat(o.getAttribute("font-size"))||parseFloat(window.getComputedStyle(o).fontSize)||16,l=C,B=Array.from(a.classList).find(k=>k.startsWith("handle-"))||"",c=!0,o.style.cursor=a.style.cursor,this.svg.style.cursor=a.style.cursor,document.body.style.userSelect="none",S.preventDefault(),S.stopPropagation()},D=S=>{if(!c)return;const C=this.toSvgPoint(S.clientX,S.clientY);if(!C)return;const M=C.x-l.x,k=C.y-l.y;let I=m,A=w,z=v,it=h;switch(B){case"handle-se":I=m+M,A=w+k;break;case"handle-sw":I=m-M,A=w+k,z=v+M;break;case"handle-ne":I=m+M,A=w-k,it=h+k;break;case"handle-nw":I=m-M,A=w-k,z=v+M,it=h+k;break}I=Math.max(20,I),A=Math.max(20,A);const rt=o.tagName.toLowerCase();if(rt==="image"||rt==="rect")o.setAttribute("width",I),o.setAttribute("height",A),o.setAttribute("x",z),o.setAttribute("y",it);else{const St=Math.max(1,m),ot=Math.max(1,w),nt=I/St,P=A/ot,Et=Math.max(nt,P),$t=Math.max(6,p*Et);o.setAttribute("font-size",$t)}this.updateBoundingBox(o),S.preventDefault(),S.stopPropagation()},T=S=>{if(!c)return;c=!1,o.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const C={element:o,width:parseFloat(o.getAttribute("width")),height:parseFloat(o.getAttribute("height")),x:parseFloat(o.getAttribute("x")),y:parseFloat(o.getAttribute("y"))},M=new CustomEvent("svgImageResized",{detail:C});this.svg.dispatchEvent(M),S.preventDefault(),S.stopPropagation()};a.addEventListener("mousedown",O),document.addEventListener("mousemove",D),document.addEventListener("mouseup",T)}setupTextHandlers(){const o=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(c=>{c.style.cursor="pointer",c.classList.add("svg-editable-text"),c.addEventListener("click",function(l){l.preventDefault(),o.showTextEditDialog(c)}),c.addEventListener("mouseenter",function(){c.classList.add("editable-text-hover")}),c.addEventListener("mouseleave",function(){c.classList.remove("editable-text-hover")})})}showImageUploadDialog(o){const a=this,c=document.createElement("input");c.type="file",c.accept="image/*",c.style.display="none",c.addEventListener("change",function(l){const m=l.target.files[0];m&&a.handleImageUpload(m,o),document.body.removeChild(c)}),document.body.appendChild(c),c.click()}handleImageUpload(o,a){const c=this,l=new FileReader;l.onload=function(m){const w=m.target.result;if(a.tagName.toLowerCase()==="image")a.setAttribute("href",w),a.hasAttribute("xlink:href")&&a.removeAttribute("xlink:href");else if(a.tagName.toLowerCase()==="rect"){const h=document.createElementNS("http://www.w3.org/2000/svg","image");h.setAttribute("x",a.getAttribute("x")||"0"),h.setAttribute("y",a.getAttribute("y")||"0"),h.setAttribute("width",a.getAttribute("width")||"100"),h.setAttribute("height",a.getAttribute("height")||"100"),h.setAttribute("href",w),h.setAttribute("preserveAspectRatio","xMidYMid slice"),h.classList.add("uploaded-image"),a.parentNode.replaceChild(h,a),a=h}const v=new CustomEvent("svgImageChanged",{detail:{element:a,imageUrl:w,file:o}});c.svg.dispatchEvent(v),c.options.onImageChange&&c.options.onImageChange(a,w,o)},l.readAsDataURL(o)}showTextEditDialog(o){const a=this,c=o.textContent||"",l=document.createElement("input");l.type="text",l.value=c,l.className="svg-text-editor";const m=o.getBoundingClientRect(),w=a.svg.getBoundingClientRect();l.style.position="absolute",l.style.left=m.left-w.left+"px",l.style.top=m.top-w.top+"px",l.style.width=Math.max(m.width,100)+"px",l.style.fontSize=window.getComputedStyle(o).fontSize,l.style.fontFamily=window.getComputedStyle(o).fontFamily,l.style.border="1px solid #007cba",l.style.padding="2px",l.style.background="white",l.style.zIndex="1000",o.style.visibility="hidden",a.svg.parentNode.appendChild(l),l.focus(),l.select();const v=function(){const h=l.value;for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(document.createTextNode(h)),o.style.visibility="visible",l.parentNode&&l.parentNode.removeChild(l);const B=new CustomEvent("svgTextChanged",{detail:{element:o,oldText:c,newText:h}});a.svg.dispatchEvent(B),a.options.onTextChange&&a.options.onTextChange(o,c,h)};l.addEventListener("blur",v),l.addEventListener("keydown",function(h){h.key==="Enter"?v():h.key==="Escape"&&(o.style.visibility="visible",l.parentNode&&l.parentNode.removeChild(l))})}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const o=document.createElement("style");o.id="svg-editor-styles",o.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }
        `,document.head.appendChild(o)}getSvgString(){return new XMLSerializer().serializeToString(this.svg)}getSvgDataUrl(){const o=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o)))}async saveSvg(o,a="front"){const c=this.getSvgString();try{return await(await fetch(`/staff/templates/${o}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:c,side:a})})).json()}catch(l){return console.error("Failed to save SVG:",l),{success:!1,error:l.message}}}}function Ce(){const F=()=>{const o=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",o.length,"SVGs with data-svg-editor attribute"),o.forEach((a,c)=>{a.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",c,"for SVG:",a),a.__inkwiseSvgTemplateEditor=new xt(a))})};if(document.readyState==="complete"||document.readyState==="interactive"?F():document.addEventListener("DOMContentLoaded",F,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const o=new MutationObserver(a=>{a.forEach(c=>{c.addedNodes.forEach(l=>{l.nodeType===1&&l.matches&&l.matches("svg[data-svg-editor]")&&(l.__inkwiseSvgTemplateEditor||(l.__inkwiseSvgTemplateEditor=new xt(l)))})})});o.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=o}}typeof window<"u"&&(window.SvgTemplateEditor=xt,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,Ce()));function Fe(F={}){const{collectSnapshot:o,routes:a={},statusLabel:c=null,statusDot:l=null,csrfToken:m=null,debounce:w=1200,onAfterSave:v=null}=F;if(typeof o!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let h=null,B=null,p=null,O=null;const D=(k,I={})=>{if(l instanceof HTMLElement&&l.setAttribute("data-state",k),c instanceof HTMLElement)switch(k){case"saving":c.textContent="Saving…";break;case"dirty":c.textContent="Unsaved changes";break;case"error":c.textContent="Save failed";break;case"saved":{const z=(I.timestamp instanceof Date?I.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});c.textContent=`Saved ${z}`;break}default:c.textContent="Saved";break}},T=async k=>{const I=a.autosave;if(!I)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const A=await fetch(I,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...m?{"X-CSRF-TOKEN":m}:{}},credentials:"same-origin",body:JSON.stringify(k)});if(!A.ok){const z=new Error(`Autosave responded with ${A.status}`);throw z.status=A.status,z.responseText=await A.text().catch(()=>null),z}try{return await A.json()}catch{return{}}},S=async k=>{if(p)try{await p}catch{}B=null,D("saving");let I;try{I=await o(k)}catch(A){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",A),D("error"),A}if(!I||typeof I!="object")return D("saved",{timestamp:new Date}),null;p=T(I);try{const A=await p;if(O=new Date,D("saved",{timestamp:O}),typeof v=="function")try{v(A,I)}catch(z){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",z)}return A}catch(A){throw console.error("[InkWise Studio] Autosave request failed.",A),D("error"),A}finally{p=null}};return{schedule:(k="change")=>{B=k,h&&clearTimeout(h),D("dirty"),h=window.setTimeout(()=>{h=null,S(B).catch(()=>{})},Math.max(250,w))},flush:async(k="flush")=>(h&&(clearTimeout(h),h=null),p&&await p,B!==null?S(k):null),isSaving:()=>!!p,getLastSavedAt:()=>O,notifyError:()=>D("error"),markDirty:()=>D("dirty")}}function Be(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const F=()=>{var ie,ne,se;const o=document.querySelectorAll("[data-preview-target]"),a=document.querySelector(".preview-card-bg"),c=document.getElementById("preview-svg"),l=document.querySelectorAll("[data-card-thumb]"),m=document.querySelectorAll("[data-card-view]"),w=document.getElementById("extraPreviewContainer"),v=document.getElementById("textFieldList"),h=document.querySelector("[data-add-text-field]"),B=document.querySelectorAll(".sidenav-btn"),p=document.querySelector(".canvas-stage"),O=document.querySelector(".canvas-measure-horizontal .measure-value"),D=document.querySelector(".canvas-measure-vertical .measure-value"),T=document.querySelector(".preview-canvas-wrapper");let S=1;const C=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{},M=(C==null?void 0:C.routes)??{},k=((ie=document.querySelector('meta[name="csrf-token"]'))==null?void 0:ie.getAttribute("content"))||((ne=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:ne.getAttribute("content"))||null,I=document.querySelector(".topbar-status-label"),A=document.querySelector(".topbar-status-dot"),z=t=>{if(t==null||t==="")return null;const e=Number(t);return Number.isFinite(e)?e:null},it=t=>{if(!t||typeof t!="string")return null;try{const e=t.startsWith("<?xml")?t:`<?xml version="1.0" encoding="UTF-8"?>${t}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(e)))}`}catch(e){return console.warn("[InkWise Studio] Failed to encode SVG preview.",e),null}},rt=t=>{var r,d;if(!a)return null;const e=window.getComputedStyle(a),n=((e==null?void 0:e.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(n&&n[2])return n[2];const s=`${t}Image`;return s&&((r=a.dataset)!=null&&r[s])?a.dataset[s]:((d=a.dataset)==null?void 0:d.frontImage)||null},St=()=>v?Array.from(v.querySelectorAll("input[data-preview-target]")).map(t=>{var n,s;const e=t.closest(".text-field-item"),i=((s=(n=e==null?void 0:e.querySelector(".text-field-label"))==null?void 0:n.textContent)==null?void 0:s.trim())||t.dataset.previewTarget||"";return{key:t.dataset.previewTarget||"",label:i,value:t.value||"",defaultValue:t.dataset.defaultValue||""}}):[],ot=t=>{if(typeof t=="number")return Number.isFinite(t)?t:Number.NaN;if(typeof t=="string"){const e=t.trim();if(!e)return Number.NaN;const i=e.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return i?parseFloat(i[0]):Number.NaN}return Number.NaN},nt=t=>{if(!t)return null;if(typeof t=="string"){const f=t.trim();if(!f)return null;try{const L=JSON.parse(f);return nt(L)}catch{return null}}if(typeof t!="object")return null;const e=Array.isArray(t)?t.reduce((f,L)=>L&&typeof L=="object"?Object.assign(f,L):f,{}):Object.assign({},t),i=e.width??e.Width??e.canvasWidth??e.w??e.maxWidth??e.naturalWidth,n=e.height??e.Height??e.canvasHeight??e.h??e.maxHeight??e.naturalHeight,s=ot(i),r=ot(n);if(!Number.isFinite(s)||s<=0||!Number.isFinite(r)||r<=0)return null;const d=e.shape??e.Shape??e.canvasShape??null,g=e.unit??e.Unit??e.canvasUnit??null;return{width:s,height:r,shape:typeof d=="string"&&d.trim()!==""?d.trim():null,unit:typeof g=="string"&&g.trim()!==""?g.trim():"px"}},P=(t,e="px")=>{if(!Number.isFinite(t))return Number.NaN;switch((e||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return t;case"mm":return t/25.4;case"cm":return t/2.54;case"pt":return t/72;default:return t/96}},Et=nt(T==null?void 0:T.dataset);let y=nt(((se=C==null?void 0:C.template)==null?void 0:se.canvas)??null)||Et||null;const oe=720,ce=920,ct=new Map;let X=null;const G=new Map,At=new Map;let lt=null,q=null,U=null,Ht=null,dt=()=>{},J="front",b=null;const le=()=>{if(!a)return null;const t=new Date,e=J||"front",i=U;let n=null;if(i)try{n=new XMLSerializer().serializeToString(i),n&&!/xmlns=/i.test(n)&&(n=n.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'))}catch(u){console.warn("[InkWise Studio] Unable to serialize current SVG.",u),n=null}const s=n?it(n):rt(e),r=St(),d=r.filter(u=>{const x=(u.value||"").trim(),E=(u.defaultValue||"").trim();return x===""||E!==""&&x===E}).map(u=>u.label||u.key).map(u=>(u||"").trim()).filter((u,x,E)=>u!==""&&E.indexOf(u)===x),g=[];if(i){const u=new Set;i.querySelectorAll('image,img,[data-changeable="image"]').forEach(x=>{const E=x.getAttribute("href")||x.getAttribute("xlink:href")||x.getAttributeNS("http://www.w3.org/1999/xlink","href")||x.getAttribute("data-src");if(!E)return;const N=x.getAttribute("data-preview-node")||x.id||`image-${g.length+1}`;u.has(N)||(u.add(N),g.push({key:N,href:E,x:x.getAttribute("x")||null,y:x.getAttribute("y")||null,width:x.getAttribute("width")||null,height:x.getAttribute("height")||null}))})}const f=a?{width:z(a.dataset.canvasWidth),height:z(a.dataset.canvasHeight),unit:a.dataset.canvasUnit||null,shape:a.dataset.canvasShape||null}:null,L=s?[s]:[];return{design:{updated_at:t.toISOString(),sides:{[e]:{svg:n,preview:s}},texts:r,images:g,canvas:f},preview:{image:s,images:L},placeholders:d}};try{b=Fe({collectSnapshot:le,routes:M,csrfToken:k,statusLabel:I,statusDot:A})}catch(t){console.warn("[InkWise Studio] Autosave controller failed to initialize.",t),b=null}const V=document.querySelector('[data-action="proceed-review"]');if(V){const t=V.dataset.destination||M.review||V.getAttribute("href")||window.location.href;V.addEventListener("click",async e=>{if(e.preventDefault(),V.dataset.navigating==="1")return;V.dataset.navigating="1",V.disabled=!0;const i=()=>{window.location.href=t};if(!b){i();return}try{await b.flush("navigate"),i()}catch(n){console.error("[InkWise Studio] Unable to save before navigating.",n),b.notifyError(),V.disabled=!1,V.dataset.navigating="0"}})}const ut=t=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=i=>{const n=i.target.files&&i.target.files[0];if(!n)return;const s=new FileReader;s.onload=r=>{var g;const d=(g=r.target)==null?void 0:g.result;d&&(t instanceof SVGImageElement?(t.setAttributeNS("http://www.w3.org/1999/xlink","href",d),t.setAttribute("href",d)):t instanceof HTMLImageElement&&(t.src=d),_(),b==null||b.schedule("image-replace"))},s.readAsDataURL(n)},e.click()},de=()=>a?((!X||!X.isConnected)&&(X=document.createElement("div"),X.className="canvas-overlay-layer",a.appendChild(X)),X):null,Lt=()=>{G.forEach(({overlay:t})=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),G.clear(),At.clear(),X&&(X.innerHTML="")},K=(t,e)=>{if(t==null)return e;const i=t.toString().split(/[\s,]+/).filter(Boolean);if(i.length===0)return e;const n=parseFloat(i[0]);return Number.isFinite(n)?n:e},Ot=t=>{if(!a)return;const e=G.get(t);if(!e||!e.overlay)return;const i=e.overlay,n=a.getBoundingClientRect(),s=t.getBoundingClientRect();if(n.width===0||n.height===0)return;const r=e.type==="text"?18:12,d=Math.max(r,s.width),g=Math.max(r,s.height);i.style.left=`${s.left-n.left}px`,i.style.top=`${s.top-n.top}px`,i.style.width=`${d}px`,i.style.height=`${g}px`},ue=()=>{G.forEach((t,e)=>{Ot(e)})},_=()=>{G.size!==0&&(lt&&cancelAnimationFrame(lt),lt=window.requestAnimationFrame(()=>{lt=null,ue()}))},gt=(t=3)=>{t<=0||requestAnimationFrame(()=>{_(),gt(t-1)})};window.addEventListener("resize",_),document.addEventListener("scroll",_,!0),window.addEventListener("load",_);const Wt=(t,e)=>{const i=U||c;if(!i||typeof i.createSVGPoint!="function")return null;const n=i.createSVGPoint();n.x=t,n.y=e;const s=i.getScreenCTM();return s?n.matrixTransform(s.inverse()):null},ge=(t,e,i)=>{const n=Wt(i.clientX,i.clientY);if(!n)return null;const{node:s}=t,r=s.getBBox?s.getBBox():{x:0,y:0,width:0,height:0},d={data:t,overlay:t.overlay,node:s,type:t.type,handle:e,mode:e?"resize":"move",pointerId:i.pointerId,startPoint:n,startClient:{x:i.clientX,y:i.clientY},initialBBox:r,moved:!1};if(t.type==="text"){d.fontSize=parseFloat(s.getAttribute("font-size"))||parseFloat(window.getComputedStyle(s).fontSize)||16,d.x=K(s.getAttribute("x"),r.x);const g=r.y+r.height;d.y=K(s.getAttribute("y"),g)}else d.x=K(s.getAttribute("x"),r.x),d.y=K(s.getAttribute("y"),r.y),d.width=K(s.getAttribute("width"),Math.max(1,r.width)),d.height=K(s.getAttribute("height"),Math.max(1,r.height));return d},he=(t,e,i)=>{if(t.type==="text"){const n=t.x+e,s=t.y+i;Number.isFinite(n)&&t.node.setAttribute("x",n),Number.isFinite(s)&&t.node.setAttribute("y",s)}else t.node.setAttribute("x",t.x+e),t.node.setAttribute("y",t.y+i)},fe=(t,e,i)=>{if(t.type==="image"){let n=t.x,s=t.y,r=t.width,d=t.height;t.handle.includes("e")&&(r=t.width+e),t.handle.includes("w")&&(r=t.width-e,n=t.x+e),t.handle.includes("s")&&(d=t.height+i),t.handle.includes("n")&&(d=t.height-i,s=t.y+i);const g=4;r<g&&(n+=r-g,r=g),d<g&&(s+=d-g,d=g),t.node.setAttribute("x",n),t.node.setAttribute("y",s),t.node.setAttribute("width",r),t.node.setAttribute("height",d)}else if(t.type==="text"){const n=Math.max(1,t.initialBBox.width),s=Math.max(1,t.initialBBox.height);let r=0,d=0;t.handle.includes("e")?r=e:t.handle.includes("w")&&(r=-e),t.handle.includes("s")?d=i:t.handle.includes("n")&&(d=-i);const g=Math.max(4,n+r),f=Math.max(4,s+d),L=g/n,u=f/s,x=Math.max(L,u),E=Math.max(6,t.fontSize*x);t.node.setAttribute("font-size",E)}},Pt=t=>{if(!q||t.pointerId!==q.pointerId)return;const e=Wt(t.clientX,t.clientY);if(!e)return;const i=e.x-q.startPoint.x,n=e.y-q.startPoint.y;!q.moved&&(Math.abs(i)>.5||Math.abs(n)>.5)&&(q.moved=!0),q.mode==="move"?he(q,i,n):fe(q,i,n),_()},ht=t=>{if(!q||t.pointerId!==q.pointerId)return;try{q.overlay.releasePointerCapture(q.pointerId)}catch{}q.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",Pt),document.removeEventListener("pointerup",ht),document.removeEventListener("pointercancel",ht);const e=q;q=null,_(),e.moved?b==null||b.schedule("element-transform"):e.type==="text"?dt(e.data.previewKey):e.type==="image"&&ut(e.node)},me=t=>{if(!t.isPrimary||t.button!==0)return;const e=t.target.closest(".editor-overlay");if(!e)return;const i=At.get(e);if(!i)return;const n=ge(i,t.target.dataset.handle||null,t);if(n){t.preventDefault(),q=n,e.classList.add("editor-overlay--active");try{e.setPointerCapture(t.pointerId)}catch{}document.addEventListener("pointermove",Pt),document.addEventListener("pointerup",ht),document.addEventListener("pointercancel",ht)}},pe=t=>{const e=de();if(!e)return null;let i=G.get(t);if(i)return i;const n=typeof t.tagName=="string"?t.tagName.toLowerCase():"",s=n==="image"||n==="img"?"image":"text",r=t.getAttribute("data-preview-node")||"",d=document.createElement("div");return d.className=`editor-overlay editor-overlay--${s}`,d.dataset.previewNode=r,d.tabIndex=0,d.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(f=>{const L=document.createElement("div");L.className=`editor-overlay__handle editor-overlay__handle--${f}`,L.dataset.handle=f,d.appendChild(L)}),d.addEventListener("pointerdown",me),d.addEventListener("dblclick",()=>{s==="text"?dt(r):s==="image"&&ut(t)}),d.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),s==="text"?dt(r):s==="image"&&ut(t))}),e.appendChild(d),i={overlay:d,node:t,type:s,previewKey:r},G.set(t,i),At.set(d,i),_(),i},ft=(t,e,i={})=>{if(!a)return;const n=a.closest(".preview-canvas-wrapper"),s=Number(t),r=Number(e),d=i.persist===void 0?!0:!!i.persist,g=typeof i.unit=="string"&&i.unit?i.unit:(y==null?void 0:y.unit)??"px",f=typeof i.shape=="string"&&i.shape?i.shape:(y==null?void 0:y.shape)??null;if(!n||!Number.isFinite(s)||!Number.isFinite(r)||s<=0||r<=0)return;const L=oe/s,u=ce/r,x=Math.min(1,L,u),E=Math.max(1,Math.round(s*x)),N=Math.max(1,Math.round(r*x));n.style.setProperty("--canvas-width",`${E}px`),n.style.setProperty("--canvas-height",`${N}px`),n.dataset.sourceWidth=s.toString(),n.dataset.sourceHeight=r.toString(),n.dataset.displayScale=x.toString(),n.dataset.canvasWidth=s.toString(),n.dataset.canvasHeight=r.toString(),n.dataset.canvasUnit=g,f&&(n.dataset.canvasShape=f),a.dataset.canvasWidth=s.toString(),a.dataset.canvasHeight=r.toString(),a.dataset.canvasUnit=g,f&&(a.dataset.canvasShape=f),p&&p.style.setProperty("--stage-width",`${E+112}px`),d&&(y={width:s,height:r,unit:g,shape:f}),_()},mt=(t,e,i,n=0)=>{O&&(Number.isFinite(t)?O.textContent=`${t.toFixed(n)}${i}`:O.textContent="—"),D&&(Number.isFinite(e)?D.textContent=`${e.toFixed(n)}${i}`:D.textContent="—")};y&&(ft(y.width,y.height,{unit:y.unit,shape:y.shape}),mt(P(y.width,y.unit),P(y.height,y.unit),"in",2));const Vt=t=>{if(typeof t!="string"||!t.trim())return Number.NaN;const e=t.trim(),i=e.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!i)return Number.NaN;const n=parseFloat(i[1]);if(!Number.isFinite(n))return Number.NaN;const s=e.match(/([a-z%]+)$/i);switch(s?s[1].toLowerCase():""){case"":case"px":return n;case"mm":return n*(96/25.4);case"cm":return n*(96/2.54);case"in":return n*96;case"pt":return n*(96/72);default:return n}},ve=t=>{if(!t)return;if(ct.has(t)){const i=ct.get(t);if(i){const n=i.unit||"px";ft(i.width,i.height,{unit:n,shape:y==null?void 0:y.shape}),mt(P(i.width,n),P(i.height,n),"in",2)}return}const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const i={width:e.naturalWidth,height:e.naturalHeight,unit:"px"};ct.set(t,i),ft(i.width,i.height,{unit:i.unit,shape:y==null?void 0:y.shape}),mt(P(i.width,i.unit),P(i.height,i.unit),"in",2),_()},e.onerror=()=>{ct.set(t,null)},e.src=t},Nt={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")},ye=document.querySelectorAll("[data-modal-close]"),be=t=>{if(!t)return[];const e=Array.from(t.querySelectorAll("[data-preview-node]"));return e.length>0?e:(t.querySelectorAll(".canvas-layer[data-layer-id]").forEach(r=>{const d=r.getAttribute("data-layer-id");if(!d)return;const g=(r.getAttribute("aria-label")||d).replace(/\s+layer$/i,"")||d,f=r.querySelector(".canvas-layer__text");if(f&&(f.hasAttribute("data-preview-node")||f.setAttribute("data-preview-node",d),f.dataset.previewLabel||(f.dataset.previewLabel=g),!f.dataset.defaultText)){const u=(f.textContent||"").trim();u&&(f.dataset.defaultText=u)}const L=r.querySelector("img, image");if(L){const u=`${d}-image`;L.hasAttribute("data-preview-node")||L.setAttribute("data-preview-node",u),L.dataset.previewLabel||(L.dataset.previewLabel=g)}if(!f&&!L&&(r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",d),r.dataset.previewLabel||(r.dataset.previewLabel=g),!r.dataset.defaultText)){const u=(r.textContent||"").trim();u&&(r.dataset.defaultText=u)}}),t.querySelectorAll("image, img").forEach((r,d)=>{r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",`auto-image-${d}`)}),t.querySelectorAll("text, tspan").forEach((r,d)=>{r.hasAttribute("data-preview-node")||r.setAttribute("data-preview-node",`auto-text-${d}`)}),Array.from(t.querySelectorAll("[data-preview-node]")))},pt=t=>{if(!t)return;t.classList.remove("is-open"),t.setAttribute("aria-hidden","true");const e=t.dataset.section;if(e){const i=document.querySelector(`.sidenav-btn[data-nav="${e}"]`);i==null||i.classList.remove("active")}},It=()=>{Object.values(Nt).forEach(t=>pt(t))},kt=t=>{const e=Nt[t];if(!e)return;e.classList.add("is-open"),e.setAttribute("aria-hidden","false");const i=e.querySelector('input:not([type="hidden"])');i==null||i.focus({preventScroll:!0})};B.length&&B.forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.nav||"text",i=Nt[e],n=i==null?void 0:i.classList.contains("is-open");It(),B.forEach(s=>s.classList.remove("active")),n||(kt(e),t.classList.add("active"))})}),ye.forEach(t=>{t.addEventListener("click",()=>{const e=t.closest(".modal");pt(e)})}),window.addEventListener("click",t=>{t.target.classList.contains("modal")&&t.target.classList.contains("is-open")&&pt(t.target)}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.querySelector(".modal.is-open");e&&pt(e)}}),It(),kt("text");const Tt=document.querySelector('.sidenav-btn[data-nav="text"]');Tt==null||Tt.classList.add("active");const Ct=t=>{const e=t.dataset.previewTarget;if(!e)return;const i=document.querySelector(`[data-preview-node="${e}"]`),n=i?i.dataset.defaultText||i.textContent:"",s=()=>{if(!i)return;const r=t.value.trim();i.textContent=r||n||"",_()};t.dataset.defaultValue||(t.dataset.defaultValue=n||""),t.addEventListener("input",()=>{s(),b==null||b.schedule("text-change")}),s()};o.forEach(Ct);const st=()=>{c&&(Lt(),U=null,Ht=null,c.innerHTML="",c.style.display="none")},we=t=>{if(typeof t!="string")return!1;const e=t.trim();return e?e.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(e):!1},xe=async t=>{if(!c||!t)return st(),!1;try{let e="";if(t.startsWith("data:image/svg+xml")){const[,u=""]=t.split(",",2);try{e=decodeURIComponent(u)}catch{e=u}}else{const u=await fetch(t,{cache:"no-store"});if(!u.ok)return console.warn("Failed to fetch SVG:",u.status),st(),!1;e=await u.text()}if(!e)return st(),!1;c.innerHTML=e,c.style.display="block",c.setAttribute("preserveAspectRatio","xMidYMid meet"),c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.style.width="100%",c.style.height="100%",c.style.maxWidth="100%",c.style.maxHeight="100%";const i=c.querySelector("svg");i?(i.setAttribute("preserveAspectRatio","xMidYMid meet"),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.style.width="100%",i.style.height="100%",i.style.maxWidth="100%",i.style.maxHeight="100%",U=i):U=c,U&&(U.setAttribute("data-svg-editor","true"),U.__inkwiseSvgTemplateEditor||(U.__inkwiseSvgTemplateEditor=new xt(U)),Ht=U.__inkwiseSvgTemplateEditor);const s=new DOMParser().parseFromString(e,"image/svg+xml").documentElement;let r=Vt(s==null?void 0:s.getAttribute("width")),d=Vt(s==null?void 0:s.getAttribute("height"));if(!Number.isFinite(r)||!Number.isFinite(d)){const u=s==null?void 0:s.getAttribute("viewBox");if(u){const x=u.split(/[\s,]+/).map(Number),E=x[2],N=x[3];!Number.isNaN(E)&&!Number.isNaN(N)&&E>0&&N>0&&(r=E,d=N)}}let g=Number.isFinite(r)?r:Number.NaN,f=Number.isFinite(d)?d:Number.NaN;if(y&&Number.isFinite(y.width)&&Number.isFinite(y.height)){const u=y.width/y.height,x=Number.isFinite(g)&&Number.isFinite(f)?g/f:u,E=Math.abs(x-u)/u,N=Number.isFinite(g)?Math.abs(g-y.width)/y.width:Number.POSITIVE_INFINITY,$=Number.isFinite(f)?Math.abs(f-y.height)/y.height:Number.POSITIVE_INFINITY;(!Number.isFinite(g)||!Number.isFinite(f)||E>.02||N>.05&&$>.05)&&(g=y.width,f=y.height)}if(Number.isFinite(g)&&Number.isFinite(f)){const u=(y==null?void 0:y.unit)??"px";ft(g,f,{unit:u,shape:y==null?void 0:y.shape}),mt(P(g,u),P(f,u),"in",2)}const L=be(c);if(Lt(),v){v.innerHTML="";const u=(E,N="",$="")=>{const W=document.createElement("div");W.className="text-field-item";const R=document.createElement("span");R.className="text-field-label",R.textContent=$||E,W.appendChild(R);const H=document.createElement("input");H.type="text",H.className="text-field-input",H.dataset.previewTarget=E,H.value=N||"",H.dataset.defaultValue=N||"",W.appendChild(H);const j=document.createElement("button");return j.type="button",j.className="text-field-delete",j.setAttribute("aria-label","Delete field"),j.innerHTML='<i class="fa-regular fa-trash-can"></i>',W.appendChild(j),v.appendChild(W),Ct(H),Ft(W),H},x=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([N,$])=>u(N,"",$))};if(L.length>0){let E=!1;L.forEach(N=>{var j,ae;const $=N.getAttribute("data-preview-node");if(!$)return;const W=typeof N.tagName=="string"?N.tagName.toLowerCase():"";if(!(W==="image"||W==="img")){E=!0;const Ne=((j=N.dataset)==null?void 0:j.previewLabel)||$,Ie=((ae=N.dataset)==null?void 0:ae.defaultText)||N.textContent||"";u($,Ie,Ne)}}),E||x()}else x()}return L.forEach(u=>{const x=u.getAttribute("data-preview-node");if(!x)return;const E=typeof u.tagName=="string"?u.tagName.toLowerCase():"",N=E==="image"||E==="img",$=!N;N&&u.setAttribute("data-changeable","image"),pe(u)&&Ot(u),$?(u.setAttribute("contenteditable","true"),u.style.cursor="text",u.style.userSelect="text",u.addEventListener("input",()=>{const H=document.querySelector(`#textFieldList input[data-preview-target="${x}"]`);H&&(H.value=u.textContent),u.dataset.currentText=u.textContent||"",_(),b==null||b.schedule("text-edit")}),u.addEventListener("click",()=>{Bt(x)})):N&&(u.style.cursor="pointer",u.addEventListener("click",()=>{ut(u)}));const R=document.querySelector(`#textFieldList input[data-preview-target="${x}"]`);R&&$&&(R.addEventListener("input",()=>{u.textContent=R.value,u.dataset.currentText=R.value,b==null||b.schedule("text-change")}),R.value&&R.value.trim()!==""?u.textContent=R.value:R.value=u.textContent||"")}),requestAnimationFrame(()=>_()),gt(10),!0}catch(e){return console.warn("Could not load SVG for binding:",e),st(),!1}},Ft=t=>{if(!t)return;const e=t.querySelector(".text-field-delete"),i=t.querySelector("input[data-preview-target]");if(!e||!i||e.disabled||e.getAttribute("aria-disabled")==="true")return;e.replaceWith(e.cloneNode(!0)),t.querySelector(".text-field-delete").addEventListener("click",()=>{const s=i.dataset.previewTarget;if(t.remove(),w){const r=w.querySelector(`[data-preview-node="${s}"]`);r==null||r.remove()}b==null||b.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(t=>Ft(t));const Bt=t=>{if(!t)return;It(),kt("text"),B.forEach(i=>i.classList.remove("active"));const e=document.querySelector('.sidenav-btn[data-nav="text"]');e==null||e.classList.add("active"),setTimeout(()=>{const i=document.querySelector(`#textFieldList input[data-preview-target="${t}"]`);if(i){try{i.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const r=document.getElementById("textFieldList");r&&(r.scrollTop=i.offsetTop-12)}i.focus({preventScroll:!1});return}const n=document.querySelector("[data-add-text-field]");n==null||n.focus({preventScroll:!1})},60)};dt=Bt;const Z=async t=>{if(J=t,!a)return;let e="",i="";t==="front"&&Q?(e=Q,i=Q):t==="back"&&tt?(e=tt,i=tt):(i=a.dataset[`${t}Svg`]||"",e=a.dataset[`${t}Image`]||"");let n=!1;if(i&&we(i)&&await xe(i)&&(n=!0,a.style.backgroundImage="none",a.style.backgroundSize=""),!n){const s=e||a.dataset[`${t}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",t,s||"<empty>"),st(),a.style.backgroundImage=s?`url('${s}')`:"",a.style.backgroundSize="",a.style.backgroundPosition="",a.style.backgroundRepeat="",s&&ve(s),Lt(),U=null}m.forEach(s=>{s.classList.toggle("active",s.dataset.cardView===t)}),l.forEach(s=>{const r=s.dataset.cardThumb===t;s.classList.toggle("active",r),s.setAttribute("aria-pressed",r?"true":"false")})};m.forEach(t=>{t.addEventListener("click",()=>{Z(t.dataset.cardView)})}),l.forEach(t=>{t.addEventListener("click",()=>{Z(t.dataset.cardThumb)})});const Mt=Z("front");Mt&&typeof Mt.then=="function"?Mt.catch(()=>{}).then(()=>{gt(6),b==null||b.schedule("initial-load")}):(gt(6),b==null||b.schedule("initial-load"));const Xt=document.querySelector(".preview-overlay");Xt&&Xt.addEventListener("click",t=>{const e=t.target.closest("[data-preview-node]");if(e){t.stopPropagation();const i=e.dataset.previewNode;i&&Bt(i)}}),h&&v&&w&&h.addEventListener("click",()=>{const t=`custom_${Date.now()}_${S}`;S+=1;const e=document.createElement("div");e.className="text-field-item";const i=document.createElement("span");i.className="text-field-label",i.textContent="Custom",e.appendChild(i);const n=document.createElement("input");n.type="text",n.className="text-field-input",n.placeholder="Add your text",n.dataset.previewTarget=t,e.appendChild(n);const s=document.createElement("button");s.type="button",s.className="text-field-delete",s.setAttribute("aria-label","Delete field"),s.innerHTML='<i class="fa-regular fa-trash-can"></i>',e.appendChild(s),v.appendChild(e);const r=document.createElement("div");r.className="pill",r.dataset.previewNode=t,r.dataset.defaultText="CUSTOM TEXT",r.textContent="CUSTOM TEXT",w.appendChild(r),Ct(n),Ft(e),setTimeout(()=>{try{v.scrollHeight>v.clientHeight&&v.scrollTo({top:v.scrollHeight,behavior:"smooth"})}catch{v.scrollTop=v.scrollHeight}n.focus({preventScroll:!1})},60)});let Q=null,tt=null;J="front";const at=document.getElementById("image-upload"),Yt=document.getElementById("upload-button"),jt=document.getElementById("quick-upload-button"),vt=document.getElementById("recentUploadsGrid"),yt=document.getElementById("quickRecentUploads"),qt="inkwise_recent_uploads",Gt=12,Dt=()=>{try{const t=localStorage.getItem(qt);return t?JSON.parse(t):[]}catch{return[]}},Se=(t,e,i)=>{const n=Dt(),s={id:Date.now(),dataUrl:t,filename:e,side:i,timestamp:new Date().toISOString()},r=n.filter(g=>g.filename!==e);r.unshift(s);const d=r.slice(0,Gt);try{localStorage.setItem(qt,JSON.stringify(d))}catch{const f=d.slice(0,Math.floor(Gt/2));localStorage.setItem(qt,JSON.stringify(f))}Kt(),Zt()},Jt=(t,e,i="front")=>{t&&(Se(t,e||`upload-${Date.now()}`,i),i==="front"?Q=t:i==="back"&&(tt=t),J===i&&Z(i),b==null||b.schedule("image-upload"))},Kt=()=>{if(!vt)return;const t=Dt();if(t.length===0){vt.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const e=t.map(n=>`
            <div class="recent-upload-item" data-upload-id="${n.id}" data-image-url="${n.dataUrl}" data-side="${n.side}">
                <img src="${n.dataUrl}" alt="${n.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${n.filename}</span>
                </div>
            </div>
        `).join("");vt.innerHTML=e;const i=vt.querySelectorAll(".recent-upload-item");i.forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.imageUrl,r=n.dataset.side;i.forEach(d=>d.classList.remove("selected")),n.classList.add("selected"),r==="front"?Q=s:tt=s,J===r&&Z(r),n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150),b==null||b.schedule("image-select")})})},Zt=()=>{if(!yt)return;const e=Dt().slice(0,5);if(e.length===0){yt.innerHTML="";return}const i=e.map(s=>`
            <div class="quick-recent-upload-item" data-upload-id="${s.id}" data-image-url="${s.dataUrl}" data-side="${s.side}" title="${s.filename}">
                <img src="${s.dataUrl}" alt="${s.filename}" loading="lazy">
            </div>
        `).join("");yt.innerHTML=i;const n=yt.querySelectorAll(".quick-recent-upload-item");n.forEach(s=>{s.addEventListener("click",()=>{const r=s.dataset.imageUrl,d=s.dataset.side;n.forEach(g=>g.classList.remove("selected")),s.classList.add("selected"),d==="front"?Q=r:tt=r,J===d&&Z(d),s.style.transform="scale(0.9)",setTimeout(()=>{s.style.transform=""},150),b==null||b.schedule("image-select")})})},Ee=t=>{const e=t.files[0];if(!e)return;const i=new FileReader;i.onload=n=>{const s=n.target.result;Jt(s,e.name,"front")},i.readAsDataURL(e)};at&&at.addEventListener("change",()=>Ee(at)),Yt&&Yt.addEventListener("click",()=>{at.click()}),jt&&jt.addEventListener("click",()=>{at.click()});const Ae=t=>{var i;const e=(i=t.clipboardData)==null?void 0:i.items;if(!(!e||e.length===0))for(const n of e){if(!n||typeof n.type!="string"||!n.type.startsWith("image/"))continue;const s=n.getAsFile();if(!s)continue;const r=new FileReader;r.onload=d=>{const g=d.target.result,f=s.name||`pasted-${Date.now()}.png`;Jt(g,f,J||"front")},r.readAsDataURL(s),t.preventDefault();break}};Kt(),Zt(),document.addEventListener("paste",Ae);const zt=document.querySelectorAll(".pill-with-tooltip"),_t=document.querySelector(".preview-canvas-wrapper"),Rt=document.querySelector(".preview-guides"),Qt=(t,e)=>{t==="safety-pill"&&(_t==null||_t.classList.toggle("highlight-safety",e)),t==="bleed-pill"&&(Rt==null||Rt.classList.toggle("highlight-bleed",e))},bt=t=>{const e=t==null?void 0:t.querySelector(".canvas-pill"),i=t==null?void 0:t.querySelector(".tooltip");!e||!i||(t.classList.remove("is-active"),e.setAttribute("aria-expanded","false"),i.setAttribute("aria-hidden","true"),Qt(e.id,!1))};zt.forEach(t=>{const e=t.querySelector(".canvas-pill"),i=t.querySelector(".tooltip");!e||!i||(e.addEventListener("click",n=>{n.preventDefault();const s=!t.classList.contains("is-active");zt.forEach(r=>{r!==t&&bt(r)}),s?(t.classList.add("is-active"),e.setAttribute("aria-expanded","true"),i.setAttribute("aria-hidden","false"),Qt(e.id,!0)):bt(t)}),e.addEventListener("mouseenter",()=>{i.setAttribute("aria-hidden","false")}),e.addEventListener("focus",()=>{i.setAttribute("aria-hidden","false")}),t.addEventListener("mouseleave",()=>{t.classList.contains("is-active")||i.setAttribute("aria-hidden","true")}),e.addEventListener("blur",()=>{!t.contains(document.activeElement)&&!t.classList.contains("is-active")&&i.setAttribute("aria-hidden","true")}),e.addEventListener("keydown",n=>{n.key==="Escape"&&(bt(t),e.blur())}))}),document.addEventListener("click",t=>{t.target.closest(".pill-with-tooltip")||zt.forEach(i=>bt(i))});const et=document.getElementById("canvas-zoom-select"),te=document.getElementById("canvas-zoom-display"),Le=document.querySelectorAll("[data-zoom-step]"),ee=document.querySelector(".preview-canvas-wrapper"),wt=p,Y=[.25,.5,.75,1,1.5,2,3];if(et&&ee&&wt){const t=i=>{wt.style.setProperty("--canvas-scale",i.toString()),ee.style.removeProperty("transform"),et.value=i.toString(),te&&(te.textContent=`${Math.round(i*100)}%`),_()},e=i=>{const n=parseFloat(et.value)||1,s=Y.indexOf(n);if(s===-1)return;let r=s;i==="up"&&s<Y.length-1&&(r=s+1),i==="down"&&s>0&&(r=s-1),r!==s&&t(Y[r])};et.addEventListener("change",i=>{const n=parseFloat(i.target.value)||1;t(n)}),Le.forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.zoomStep;n&&e(n==="up"?"up":"down")})}),wt&&wt.addEventListener("wheel",i=>{i.preventDefault();const n=parseFloat(et.value)||1;let s=n;if(i.deltaY>0){const r=Y.indexOf(n);r>0&&(s=Y[r-1])}else{const r=Y.indexOf(n);r<Y.length-1&&(s=Y[r+1])}s!==n&&t(s)},{passive:!1}),t(parseFloat(et.value)||1)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",F,{once:!0}):F()}function Me(){const F=document.getElementById("inkwise-customer-studio-bootstrap");if(F)try{const o=JSON.parse(F.textContent||"{}");if(o&&typeof o=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=o),o}catch(o){console.error("[InkWise Studio] Failed to parse bootstrap payload.",o)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function qe(){const F=Ut.useMemo(()=>Me(),[]),[o,a]=Ut.useState("initializing");return Ut.useEffect(()=>{Be(),a("ready")},[]),!F||Object.keys(F).length===0,null}function De(){const F=()=>{const o=document.getElementById("inkwise-customer-studio-root");if(!o)return;ke.createRoot(o).render(re.jsx(Te.StrictMode,{children:re.jsx(qe,{})}))};if(document.readyState==="complete"||document.readyState==="interactive"){F();return}document.addEventListener("DOMContentLoaded",F,{once:!0})}De();
