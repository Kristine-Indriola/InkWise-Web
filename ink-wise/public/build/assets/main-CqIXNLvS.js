import{r as Ne,j as y,c as Vt,R as Xt}from"./client-Cv0X-2PX.js";const zt="http://www.w3.org/2000/svg",Mn="http://www.w3.org/1999/xlink";class Kt{constructor(s,c={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",s),this.svg=s,this.options={onImageChange:c.onImageChange||null,onTextChange:c.onTextChange||null,...c};const l=document&&document.body&&document.body.dataset?document.body.dataset:{},p=(l.imageReplacementMode||"").toLowerCase();let w="full";p==="panel-only"||p==="disabled"?w=p:l.allowImageReplacement==="false"&&(w="disabled"),this.imageReplacementMode=w,this.allowCanvasImageTools=w!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),typeof window<"u"&&window.addEventListener("inkwise:text-style-changed",s=>{try{const c=s&&s.detail?s.detail:{},{attribute:l,value:p,key:w}=c;if(!l)return;const x=this._currentInlineEditor||null;if(x&&x.element){const k=x.element.getAttribute("data-preview-node")||x.element.id||null;if(w&&k&&w!==k)return;const E=x.editable;if(!E)return;if(l==="font-family")x.element.setAttribute("font-family",String(p)),x.element.style&&(x.element.style.fontFamily=String(p)),E.style.fontFamily=String(p)||E.style.fontFamily;else if(l==="font-size"){const L=Number(p);Number.isFinite(L)&&(x.element.setAttribute("font-size",String(L)),x.element.style&&(x.element.style.fontSize=`${L}px`),E.style.fontSize=`${L}px`)}else(l==="fill"||l==="color")&&(x.element.setAttribute("fill",String(p)),x.element.style&&(x.element.style.fill=String(p)),E.style.color=String(p)||E.style.color);x.element._boundingBox&&x.element._boundingBox.classList.add("svg-bounding-box--active");return}let A=[];if(w&&typeof w=="string")try{const k=typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(w):w;A=Array.from(this.svg.querySelectorAll(`[data-preview-node="${k}"]`))}catch{A=Array.from(this.svg.querySelectorAll(`[data-preview-node="${w}"]`))}if(!A.length){const k=this.svg.querySelector(".svg-text-focus");k&&A.push(k)}A.forEach(k=>{if(k){if(l==="font-family"){k.setAttribute("font-family",String(p)),k.style&&(k.style.fontFamily=String(p));try{const E=k.getAttribute("style")||"";k.setAttribute("style",`font-family: '${String(p)}', system-ui, sans-serif; ${E}`)}catch{}}else if(l==="font-size"){const E=Number(p);Number.isFinite(E)&&(k.setAttribute("font-size",String(E)),k.style&&(k.style.fontSize=`${E}px`))}else(l==="fill"||l==="color")&&(k.setAttribute("fill",String(p)),k.style&&(k.style.fill=String(p)));try{this.updateBoundingBox(k)}catch{}try{k._boundingBox&&k._boundingBox.classList.add("svg-bounding-box--active")}catch{}}})}catch(c){console.warn("SvgTemplateEditor: failed to apply toolbar style change to inline editor or SVG nodes",c)}}),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const s=this.svg.dataset.svgData;if(s)try{const c=JSON.parse(s);this.changeableImages=c.changeable_images||[],this.textElements=c.text_elements||[],this.textElements.forEach(l=>{const p=this.svg.querySelector(`[data-element-id="${l.id}"]`)||this.svg.querySelector(`#${l.id}`);p&&p.setAttribute("data-editable","true")})}catch(c){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",c),this.fallbackParseSvg()}else this.fallbackParseSvg()}fallbackParseSvg(){console.log("SvgTemplateEditor: Using fallback SVG parsing"),this.changeableImages=[],this.textElements=[],this.svg.querySelectorAll("text").forEach((l,p)=>{const w=`fallback-text-${p}`;l.setAttribute("data-element-id",w),l.setAttribute("data-editable","true"),this.textElements.push({id:w,text:l.textContent||"",fontFamily:l.getAttribute("font-family")||"Arial",fontSize:parseFloat(l.getAttribute("font-size"))||16,fill:l.getAttribute("fill")||"#000000",x:parseFloat(l.getAttribute("x"))||0,y:parseFloat(l.getAttribute("y"))||0})}),this.svg.querySelectorAll("image, img").forEach((l,p)=>{const w=`fallback-image-${p}`;l.setAttribute("data-element-id",w),l.setAttribute("data-changeable","image"),this.changeableImages.push({id:w,src:l.getAttribute("href")||l.getAttribute("src")||"",x:parseFloat(l.getAttribute("x"))||0,y:parseFloat(l.getAttribute("y"))||0,width:parseFloat(l.getAttribute("width"))||100,height:parseFloat(l.getAttribute("height"))||100})}),console.log("SvgTemplateEditor: Fallback parsed",this.textElements.length,"text elements,",this.changeableImages.length,"images")}readDatasetTokens(s){return!s||!s.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(l=>s.dataset[l]).filter(l=>typeof l=="string"&&l.trim()!=="").map(l=>l.trim().toLowerCase())}findImageContentNode(s){return!s||typeof s.querySelector!="function"?null:s.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(s){if(!s)return!1;const c=typeof s.tagName=="string"?s.tagName.toLowerCase():"";if(c==="image"||c==="img"||this.readDatasetTokens(s).some(p=>p==="image"||p==="photo"||p==="graphic")||typeof s.hasAttribute=="function"&&(s.hasAttribute("data-editable-image")||s.hasAttribute("data-changeable-image")))return!0;if(s.classList){for(const p of this.imageClassTokens)if(s.classList.contains(p))return!0}return c==="foreignobject"?!!this.findImageContentNode(s):!1}resolveImageNode(s){if(!s)return null;if(this.nodeRepresentsImage(s))return s;if(typeof s.closest=="function"){const c=s.closest("[data-preview-node]");if(c&&c!==s&&this.nodeRepresentsImage(c))return c}return this.findImageContentNode(s)}resolveImageHandleNodes(s){const c=this.resolveImageNode(s);return c?{interactionNode:typeof c.closest=="function"&&c.closest("foreignObject")||c,contentNode:c}:null}applyImageSourceToNode(s,c){if(!s||!c)return null;const l=typeof s.tagName=="string"?s.tagName.toLowerCase():"";if(l==="image")return s.setAttributeNS(Mn,"href",c),s.setAttribute("href",c),s.dataset&&(s.dataset.src=c),s;if(l==="img")return s.setAttribute("src",c),s.dataset&&(s.dataset.src=c),s;if(l==="foreignobject"){const p=this.findImageContentNode(s);return p&&p!==s?this.applyImageSourceToNode(p,c):null}return l==="rect"?this.convertRectToImage(s,c):(s.style&&typeof s.style.setProperty=="function"&&(s.style.backgroundImage=`url('${c}')`),s.dataset&&(s.dataset.src=c,s.dataset.replacedImage="true"),s)}convertRectToImage(s,c){if(!s||!s.parentNode)return null;const l=document.createElementNS(zt,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(w=>{s.hasAttribute&&s.hasAttribute(w)&&l.setAttribute(w,s.getAttribute(w))}),Array.from(s.attributes||[]).forEach(w=>{(w.name==="id"||w.name.startsWith("data-"))&&l.setAttribute(w.name,w.value)}),s.classList&&s.classList.length&&s.classList.forEach(w=>l.classList.add(w)),l.setAttribute("href",c),l.setAttributeNS(Mn,"href",c),l.hasAttribute("preserveAspectRatio")||l.setAttribute("preserveAspectRatio","xMidYMid slice"),s.parentNode.replaceChild(l,s),l}escapeSelector(s){return typeof s!="string"||!s.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(s):s.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(s){if(!s||typeof s!="object")return null;const c=s.id||s.element_id||s.node_id;if(c){const p=`#${this.escapeSelector(c)}`,w=this.svg.querySelector(p);if(w)return w}const l=s.selector||s.css_selector;if(l)try{const p=this.svg.querySelector(l);if(p)return p}catch(p){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",l,p)}return null}collectImageCandidates(){const s=new Set;return this.changeableImages.forEach(l=>{const p=this.resolveNodeFromMetadata(l);p&&s.add(p)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(l=>{s.add(l)}),Array.from(s)}getBBoxSafe(s){if(!s||typeof s.getBBox!="function")return null;try{return s.getBBox()}catch(c){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",c,s),null}}toSvgPoint(s,c){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const l=this.svg.createSVGPoint();l.x=s,l.y=c;const p=this.svg.getScreenCTM();return p?l.matrixTransform(p.inverse()):null}setupImageHandlers(){const s=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",s.length,"changeable image elements"),!this.allowCanvasImageTools){s.forEach(c=>{const l=this.resolveImageHandleNodes(c);if(!l)return;const{interactionNode:p}=l;if(p.style.cursor="default",p.classList.remove("svg-changeable-image"),p.classList.remove("changeable-image-hover"),p._boundingBox){try{p._boundingBox.remove()}catch{}p._boundingBox=null}});return}setTimeout(()=>{s.forEach((c,l)=>{const p=this.resolveImageHandleNodes(c);if(!p)return;const{interactionNode:w,contentNode:x}=p;if(!w||w.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",l,w),w.__inkwiseSvgImageBound=!0,w.__inkwiseImageContent=x||w,w.style.cursor="pointer",w.classList.add("svg-changeable-image"),w.classList.add("changeable-image-hover"),w.addEventListener("mouseenter",()=>{w.classList.add("changeable-image-active")}),w.addEventListener("mouseleave",()=>{w.classList.remove("changeable-image-active")}),w.addEventListener("click",k=>{k.preventDefault(),this.showImageUploadDialog(w)});const A=this.createBoundingBox(w);A&&(w._boundingBox=A),this.makeDraggable(w)})},200)}createBoundingBox(s){const c=this.getBBoxSafe(s);if(!c)return null;const l=document.createElementNS(zt,"g");l.classList.add("svg-bounding-box");const p=document.createElementNS(zt,"rect");return p.classList.add("svg-bounding-box__rect"),p.setAttribute("fill","transparent"),p.setAttribute("stroke","#007cba"),p.setAttribute("stroke-width","2"),p.setAttribute("stroke-dasharray","5,5"),p.setAttribute("rx","3"),p.style.pointerEvents="all",l.appendChild(p),this.createResizeHandles().forEach(x=>l.appendChild(x)),l.style.pointerEvents="all",l.style.cursor="pointer",l.addEventListener("click",x=>{try{x.preventDefault(),x.stopPropagation();const A=l._targetElement||s,E=(this.resolveImageHandleNodes(A)||{interactionNode:A}).interactionNode||A;this.focusElement(E)}catch(A){console.warn("SvgTemplateEditor: bbox click handler error",A)}}),this.svg.appendChild(l),this.positionBoundingElements(l,c),l}createResizeHandles(){const s=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(l=>{const p=document.createElementNS(zt,"circle");p.setAttribute("r","4"),p.setAttribute("fill","#007cba"),p.setAttribute("stroke","#ffffff"),p.setAttribute("stroke-width","1"),p.classList.add("resize-handle",`handle-${l.name}`),p.style.pointerEvents="all",p.style.cursor=`${l.name}-resize`,s.push(p)}),s}positionBoundingElements(s,c){if(!s||!c)return;const l=s.querySelector(".svg-bounding-box__rect");if(!l)return;const p=5,w=c.x-p,x=c.y-p,A=c.width+p*2,k=c.height+p*2;l.setAttribute("x",w),l.setAttribute("y",x),l.setAttribute("width",Math.max(A,0)),l.setAttribute("height",Math.max(k,0)),s.querySelectorAll(".resize-handle").forEach(L=>{L.classList.contains("handle-nw")?(L.setAttribute("cx",w),L.setAttribute("cy",x)):L.classList.contains("handle-ne")?(L.setAttribute("cx",w+A),L.setAttribute("cy",x)):L.classList.contains("handle-sw")?(L.setAttribute("cx",w),L.setAttribute("cy",x+k)):L.classList.contains("handle-se")?(L.setAttribute("cx",w+A),L.setAttribute("cy",x+k)):L.classList.contains("handle-n")?(L.setAttribute("cx",w+A/2),L.setAttribute("cy",x)):L.classList.contains("handle-s")?(L.setAttribute("cx",w+A/2),L.setAttribute("cy",x+k)):L.classList.contains("handle-e")?(L.setAttribute("cx",w+A),L.setAttribute("cy",x+k/2)):L.classList.contains("handle-w")&&(L.setAttribute("cx",w),L.setAttribute("cy",x+k/2))})}updateBoundingBox(s){if(!s||!s._boundingBox)return;const c=this.getBBoxSafe(s);this.positionBoundingElements(s._boundingBox,c)}focusElementById(s){if(!s||!this.svg)return!1;const c=`#${this.escapeSelector(s)}`;let l=null;try{l=this.svg.querySelector(c)}catch(p){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",s,p),!1}return l||(l=this.svg.querySelector(`[data-element-id="${s}"]`)),l?this.focusElement(l):!1}focusElement(s){const l=(this.resolveImageHandleNodes(s)||{interactionNode:s}).interactionNode||s;if(!this.getBBoxSafe(l))return!1;if(l._boundingBox||(l._boundingBox=this.createBoundingBox(l),l._boundingBox&&(l._boundingBox._targetElement=l,l._boundingBox.querySelectorAll(".resize-handle").forEach(x=>this.makeResizable(l,x)),this.makeDraggable(l._boundingBox))),this.updateBoundingBox(l),l._boundingBox&&(l._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{l._boundingBox&&l._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof l.scrollIntoView=="function"&&l.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),l.classList.add("changeable-image-active"),setTimeout(()=>l.classList.remove("changeable-image-active"),1200),l.tagName&&l.tagName.toLowerCase()==="text"){const w=l.getAttribute("data-preview-node")||l.id||null;try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text",key:w}}))}catch{if(typeof document<"u"&&document.createEvent){const A=document.createEvent("CustomEvent");A.initCustomEvent("inkwise:active-element",!0,!0,{type:"text",key:w}),window.dispatchEvent(A)}}this.showTextEditDialog(l)}return!0}makeDraggable(s){let c=!1,l=0,p=0,w=0,x=0,A=0,k=0;const E=s._targetElement||s,L=fe=>{if(fe.target.closest(".resize-handle"))return;const X=this.toSvgPoint(fe.clientX,fe.clientY);if(!X)return;const q=this.getBBoxSafe(E);if(!q)return;const U=typeof E.getAttribute=="function",O=typeof E.setAttribute=="function";l=U?parseFloat(E.getAttribute("x")):q.x,p=U?parseFloat(E.getAttribute("y")):q.y,Number.isNaN(l)&&(l=q.x,O&&E.setAttribute("x",l)),Number.isNaN(p)&&(p=q.y,O&&E.setAttribute("y",p)),w=X.x-l,x=X.y-p,A=l,k=p,c=!0,s.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",fe.preventDefault()},W=fe=>{if(!c)return;const X=this.toSvgPoint(fe.clientX,fe.clientY);X&&(A=X.x-w,k=X.y-x,typeof E.removeAttribute=="function"&&E.removeAttribute("transform"),typeof E.setAttribute=="function"&&(E.setAttribute("x",A),E.setAttribute("y",k)),this.updateBoundingBox(E),fe.preventDefault())},le=fe=>{if(!c)return;c=!1,s.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(E);const X=new CustomEvent("svgImageMoved",{detail:{element:E,x:A,y:k}});this.svg.dispatchEvent(X),fe.preventDefault()};s.addEventListener("mousedown",L),document.addEventListener("mousemove",W),document.addEventListener("mouseup",le),s._boundingBox&&s._boundingBox.querySelectorAll(".resize-handle").forEach(X=>{this.makeResizable(s,X)})}makeResizable(s,c){let l=!1,p=null,w=0,x=0,A=0,k=0,E="",L=0;const W=X=>{const q=this.toSvgPoint(X.clientX,X.clientY);if(!q)return;const U=this.getBBoxSafe(s);if(!U)return;w=U.width,x=U.height;const O=typeof s.getAttribute=="function",Y=typeof s.setAttribute=="function";A=O?parseFloat(s.getAttribute("x")):U.x,k=O?parseFloat(s.getAttribute("y")):U.y,Number.isNaN(A)&&(A=U.x,Y&&s.setAttribute("x",A)),Number.isNaN(k)&&(k=U.y,Y&&s.setAttribute("y",k)),L=parseFloat(s.getAttribute("font-size"))||parseFloat(window.getComputedStyle(s).fontSize)||16,p=q,E=Array.from(c.classList).find(B=>B.startsWith("handle-"))||"",l=!0,s.style.cursor=c.style.cursor,this.svg.style.cursor=c.style.cursor,document.body.style.userSelect="none",X.preventDefault(),X.stopPropagation()},le=X=>{if(!l)return;const q=this.toSvgPoint(X.clientX,X.clientY);if(!q)return;const U=q.x-p.x,O=q.y-p.y;let Y=w,B=x,M=A,ne=k;switch(E){case"handle-se":Y=w+U,B=x+O;break;case"handle-sw":Y=w-U,B=x+O,M=A+U;break;case"handle-ne":Y=w+U,B=x-O,ne=k+O;break;case"handle-nw":Y=w-U,B=x-O,M=A+U,ne=k+O;break}Y=Math.max(20,Y),B=Math.max(20,B);const De=s.tagName.toLowerCase();if((De==="image"||De==="rect")&&typeof s.setAttribute=="function")s.setAttribute("width",Y),s.setAttribute("height",B),s.setAttribute("x",M),s.setAttribute("y",ne);else{const Ue=Math.max(1,w),v=Math.max(1,x),R=Y/Ue,Q=B/v,P=Math.max(R,Q),Ee=Math.max(6,L*P);typeof s.setAttribute=="function"&&s.setAttribute("font-size",Ee)}this.updateBoundingBox(s),X.preventDefault(),X.stopPropagation()},fe=X=>{if(!l)return;l=!1,s.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const q={element:s,width:parseFloat(s.getAttribute?s.getAttribute("width"):"")||w,height:parseFloat(s.getAttribute?s.getAttribute("height"):"")||x,x:parseFloat(s.getAttribute?s.getAttribute("x"):"")||A,y:parseFloat(s.getAttribute?s.getAttribute("y"):"")||k},U=new CustomEvent("svgImageResized",{detail:q});this.svg.dispatchEvent(U),X.preventDefault(),X.stopPropagation()};c.addEventListener("mousedown",W),document.addEventListener("mousemove",le),document.addEventListener("mouseup",fe)}setupTextHandlers(){const s=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(l=>{l.style.cursor="pointer",l.classList.add("svg-editable-text"),l.addEventListener("click",function(p){p.preventDefault(),s.focusElement(l)}),l.addEventListener("mouseenter",function(){l.classList.add("editable-text-hover")}),l.addEventListener("mouseleave",function(){l.classList.remove("editable-text-hover")})})}showImageUploadDialog(s){const c=this,l=document.createElement("input");l.type="file",l.accept="image/*",l.style.display="none",l.addEventListener("change",function(p){const w=p.target.files[0];w&&c.handleImageUpload(w,s),l.parentNode&&l.parentNode.removeChild(l)}),document.body.appendChild(l),l.click()}async handleImageUpload(s,c){var L;const l=this,p=c&&c.__inkwiseImageContent?c.__inkwiseImageContent:c,w=((L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.getAttribute("content"))||null,x=new FormData;x.append("image",s),w&&x.append("_token",w);let A=null;try{const W=await fetch("/design/upload-image",{method:"POST",body:x,credentials:"same-origin"});if(!W.ok){const fe=await W.text().catch(()=>"");throw new Error(`Upload failed (${W.status}): ${fe}`)}const le=await W.json();A=le.url||le.path||null}catch(W){console.error("SvgTemplateEditor: Failed to upload image",W),alert("We could not upload your image. Please try again.");const le=new CustomEvent("svgImageUploadFailed",{detail:{error:W,file:s}});l.svg.dispatchEvent(le);return}if(!A){alert("Upload did not return a usable image URL.");return}const k=l.applyImageSourceToNode(p,A)||p;c&&k&&c.__inkwiseImageContent!==k&&(c.__inkwiseImageContent=k);const E=new CustomEvent("svgImageChanged",{detail:{element:k,imageUrl:A,file:s}});l.svg.dispatchEvent(E),l.options.onImageChange&&l.options.onImageChange(k,A,s),l.updateBoundingBox(c||k)}showTextEditDialog(s){const c=this,l=s.textContent||"",p=this.getBBoxSafe(s);if(!p)return;const w=2,x=document.createElementNS(zt,"foreignObject");x.setAttribute("x",p.x-w),x.setAttribute("y",p.y-w),x.setAttribute("width",Math.max(p.width+w*2,40)),x.setAttribute("height",Math.max(p.height+w*2,20)),x.classList.add("svg-text-foreignobject"),x.style.pointerEvents="all";const A="http://www.w3.org/1999/xhtml",k=document.createElementNS(A,"div");k.setAttribute("xmlns",A),k.contentEditable="true",k.className="svg-text-editor-fo";const E=window.getComputedStyle(s);k.style.fontSize=E.fontSize||"16px",k.style.fontFamily=E.fontFamily||"sans-serif",k.style.lineHeight=E.lineHeight||"1";const L=s.getAttribute("fill")||E.color||"#000";k.style.color=L,k.style.width="100%",k.style.height="100%",k.style.background="transparent",k.style.padding="2px",k.style.outline="none",k.style.overflow="hidden",k.style.resize="none",k.style.whiteSpace="pre",k.style.textAlign=s.getAttribute("text-anchor")==="middle"?"center":"left",k.style.caretColor="#007cba",k.textContent=l,s.style.visibility="hidden";const W=function(Y=!0){try{fe&&(X&&fe.removeEventListener("mousedown",X),q&&fe.removeEventListener("mouseup",q))}catch{}const B=k.textContent||"";if(s.style.visibility="visible",x.parentNode&&x.parentNode.removeChild(x),Y){for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(document.createTextNode(B));const M=new CustomEvent("svgTextChanged",{detail:{element:s,oldText:l,newText:B}});c.svg.dispatchEvent(M),c.options.onTextChange&&c.options.onTextChange(s,l,B)}s._boundingBox&&s._boundingBox.classList.remove("svg-bounding-box--active");try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:null}}))}catch{if(typeof document<"u"&&document.createEvent){const ne=document.createEvent("CustomEvent");ne.initCustomEvent("inkwise:active-element",!0,!0,{type:null}),window.dispatchEvent(ne)}}},le=function(){try{fe&&(X&&fe.removeEventListener("mousedown",X),q&&fe.removeEventListener("mouseup",q))}catch{}s.style.visibility="visible",x.parentNode&&x.parentNode.removeChild(x),s._boundingBox&&s._boundingBox.classList.remove("svg-bounding-box--active");try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:null}}))}catch{if(typeof document<"u"&&document.createEvent){const B=document.createEvent("CustomEvent");B.initCustomEvent("inkwise:active-element",!0,!0,{type:null}),window.dispatchEvent(B)}}},fe=typeof document<"u"?document.querySelector(".studio-react-widgets"):null;let X=null,q=null,U=!1;fe&&(X=function(){U=!0},q=function(){setTimeout(()=>{U=!1;try{k.focus()}catch{}},0)},fe.addEventListener("mousedown",X),fe.addEventListener("mouseup",q)),k.addEventListener("focus",function(){try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text"}}))}catch{if(typeof document<"u"&&document.createEvent){const B=document.createEvent("CustomEvent");B.initCustomEvent("inkwise:active-element",!0,!0,{type:"text"}),window.dispatchEvent(B)}}}),k.addEventListener("blur",function(){U||W(!0)}),k.addEventListener("keydown",function(Y){Y.key==="Enter"?(Y.preventDefault(),W(!0)):Y.key==="Escape"&&(Y.preventDefault(),le())}),x.appendChild(k),this.svg.appendChild(x),s._boundingBox&&s._boundingBox.classList.add("svg-bounding-box--active"),k.focus();const O=window.getSelection();try{const Y=document.createRange();Y.selectNodeContents(k),O.removeAllRanges(),O.addRange(Y)}catch{}}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const s=document.createElement("style");s.id="svg-editor-styles",s.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }

            /* foreignObject inline editor styles */
            .svg-text-foreignobject { pointer-events: all; }
            .svg-text-editor-fo {
                width: 100%;
                height: 100%;
                box-sizing: border-box;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                padding: 2px;
                white-space: pre;
                overflow: hidden;
                outline: none;
            }

            .svg-bounding-box--active .svg-bounding-box__rect {
                stroke: #007cba;
                stroke-width: 3;
                opacity: 1;
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(s)}getSvgString(){const s=this.svg.cloneNode(!0);s.querySelectorAll('.svg-bounding-box, .inkwise-editor-marker, [data-editor-only="true"]').forEach(p=>{var w;(w=p.parentNode)==null||w.removeChild(p)}),s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),s.style.width="",s.style.height="",s.style.maxWidth="",s.style.maxHeight="",s.removeAttribute("preserveAspectRatio");const c=document.createElementNS(zt,"style");return c.id="inkwise-export-styles",c.textContent=`
            @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            text { white-space: pre; }
        `,s.insertBefore(c,s.firstChild),new XMLSerializer().serializeToString(s)}getSvgDataUrl(){const s=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)))}async saveSvg(s,c="front"){const l=this.getSvgString();try{const p=await fetch(`/staff/templates/${s}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:l,side:c})});if(!p.ok){const x=await p.text().catch(()=>"");throw new Error(x||`Request failed with status ${p.status}`)}let w;try{w=await p.json()}catch(x){console.warn("SvgTemplateEditor: Failed to parse save response",x),w={success:!1,error:"Invalid response from server"}}return w}catch(p){return console.error("Failed to save SVG:",p),{success:!1,error:p.message}}}}function pa(){const ae=()=>{const s=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",s.length,"SVGs with data-svg-editor attribute"),s.forEach((c,l)=>{c.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",l,"for SVG:",c),c.__inkwiseSvgTemplateEditor=new Kt(c))})};if(document.readyState==="complete"||document.readyState==="interactive"?ae():document.addEventListener("DOMContentLoaded",ae,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const s=new MutationObserver(c=>{c.forEach(l=>{l.addedNodes.forEach(p=>{p.nodeType===1&&p.matches&&p.matches("svg[data-svg-editor]")&&(p.__inkwiseSvgTemplateEditor||(p.__inkwiseSvgTemplateEditor=new Kt(p)))})})});s.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=s}}typeof window<"u"&&(window.SvgTemplateEditor=Kt,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,pa()));function ha(ae={}){const{collectSnapshot:s,routes:c={},statusLabel:l=null,statusDot:p=null,csrfToken:w=null,debounce:x=1200,onAfterSave:A=null}=ae;if(typeof s!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let k=null,E=null,L=null,W=null;const le=(O,Y={})=>{if(p instanceof HTMLElement&&p.setAttribute("data-state",O),l instanceof HTMLElement)switch(O){case"saving":l.textContent="Savingâ€¦";break;case"dirty":l.textContent="Unsaved changes";break;case"error":l.textContent="Save failed";break;case"saved":{const M=(Y.timestamp instanceof Date?Y.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});l.textContent=`Saved ${M}`;break}default:l.textContent="Saved";break}},fe=async O=>{const Y=c.autosave;if(!Y)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const B=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...w?{"X-CSRF-TOKEN":w}:{}},credentials:"same-origin",body:JSON.stringify(O)});if(!B.ok){const M=new Error(`Autosave responded with ${B.status}`);throw M.status=B.status,M.responseText=await B.text().catch(()=>null),M}try{return await B.json()}catch{return{}}},X=async O=>{if(console.log("[Autosave] Saving",O),L)try{await L}catch{}E=null,le("saving");let Y;try{Y=await s(O)}catch(B){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",B),le("error"),B}if(!Y||typeof Y!="object")return le("saved",{timestamp:new Date}),null;L=fe(Y);try{const B=await L;if(W=new Date,le("saved",{timestamp:W}),typeof A=="function")try{A(B,Y)}catch(M){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",M)}return B}catch(B){throw console.error("[InkWise Studio] Autosave request failed.",B),le("error"),B}finally{L=null}};return{schedule:(O="change")=>{console.log("[Autosave] Scheduling",O),E=O,k&&clearTimeout(k),le("dirty"),k=window.setTimeout(()=>{k=null,X(E).catch(()=>{})},Math.max(250,x))},flush:async(O="flush")=>(k&&(clearTimeout(k),k=null),L&&await L,E!==null?X(O):null),isSaving:()=>!!L,getLastSavedAt:()=>W,notifyError:()=>le("error"),markDirty:()=>le("dirty")}}const ga=100*1024,ma=3;function ya(ae){const s=/^data:([^;]+);base64,(.*)$/s.exec(ae.replace(/\s+/g,""));if(!s)return null;const c=s[1],l=atob(s[2]);let p=l.length;const w=new Uint8Array(p);for(;p--;)w[p]=l.charCodeAt(p);return new Blob([w],{type:c})}async function ba(ae,s,c){const l=new FormData;l.append("image",ae,`upload-${Date.now()}.png`);const p=await fetch(s,{method:"POST",body:l,credentials:"same-origin",headers:c?{"X-CSRF-TOKEN":c}:{}});if(!p.ok){const w=await p.text().catch(()=>null),x=new Error(`Upload failed: ${p.status}`);throw x.status=p.status,x.responseText=w,x}return p.json()}const va=/data:([a-zA-Z0-9/+-.]+\/[a-zA-Z0-9.+-]+);base64,[A-Za-z0-9+/=\n]+/g;async function Pn(ae,s={}){var O,Y;const{routes:c={},csrfToken:l=null,imageSizeThreshold:p=ga,maxParallelUploads:w=ma}=s;if(!ae||typeof ae!="object")return ae;const x=c.uploadImage||"/design/upload-image",A=[];try{const B=((O=ae==null?void 0:ae.design)==null?void 0:O.sides)||{};Object.keys(B).forEach(M=>{const ne=B[M];ne&&(typeof ne.svg=="string"&&(ne.svg.match(va)||[]).forEach(Ue=>A.push({type:"svg",dataUrl:Ue})),typeof ne.preview=="string"&&ne.preview.startsWith("data:")&&A.push({type:"preview",dataUrl:ne.preview}))}),ae!=null&&ae.preview&&Array.isArray(ae.preview.images)&&ae.preview.images.forEach(M=>{typeof M=="string"&&M.startsWith("data:")&&A.push({type:"preview",dataUrl:M})}),ae!=null&&ae.design&&Array.isArray(ae.design.images)&&ae.design.images.forEach(M=>{typeof M=="string"&&M.startsWith("data:")?A.push({type:"image",dataUrl:M}):M&&(M.dataUrl||M.src)&&(M.dataUrl||M.src).startsWith("data:")&&A.push({type:"image",dataUrl:M.dataUrl||M.src})})}catch(B){console.warn("[imageUploadHelpers] Error scanning snapshot",B)}const k=[],E=new Set;for(const B of A)E.has(B.dataUrl)||(E.add(B.dataUrl),k.push(B));const L=k.filter(B=>B.dataUrl&&B.dataUrl.length>p);if(!L.length)return ae;const W=new Map,le=L.slice();async function fe(){for(;le.length;){const B=le.shift();try{const M=ya(B.dataUrl);if(!M)throw new Error("Invalid data URL");const ne=await ba(M,x,l);ne&&ne.url?W.set(B.dataUrl,ne.url):ne&&ne.path&&W.set(B.dataUrl,ne.path)}catch(M){console.warn("[imageUploadHelpers] upload failed for one candidate",M)}}}const X=[];for(let B=0;B<Math.min(w,L.length);B++)X.push(fe());await Promise.all(X);const q=JSON.parse(JSON.stringify(ae)),U=B=>{if(typeof B!="string")return B;let M=B;return W.forEach((ne,De)=>{M=M.split(De).join(ne)}),M};try{const B=((Y=q==null?void 0:q.design)==null?void 0:Y.sides)||{};Object.keys(B).forEach(M=>{const ne=B[M];ne&&(typeof ne.svg=="string"&&(ne.svg=U(ne.svg)),typeof ne.preview=="string"&&(ne.preview=U(ne.preview)))}),q.preview&&Array.isArray(q.preview.images)&&(q.preview.images=q.preview.images.map(U)),q.design&&Array.isArray(q.design.images)&&(q.design.images=q.design.images.map(M=>typeof M=="string"?U(M):(M&&M.dataUrl&&(M.dataUrl=U(M.dataUrl)),M&&M.src&&(M.src=U(M.src)),M)))}catch(B){console.warn("[imageUploadHelpers] Replacement failed",B)}return q}function wa(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const ae=async()=>{var bn,vn,wn;const s=document.querySelectorAll("[data-preview-target]"),c=document.querySelector(".preview-card-bg"),l=document.getElementById("preview-svg"),p=document.querySelectorAll("[data-card-thumb]"),w=document.querySelectorAll("[data-card-view]"),x=document.getElementById("extraPreviewContainer"),A=document.getElementById("textFieldList"),k=document.querySelector("[data-add-text-field]"),E=document.querySelectorAll(".sidenav-btn"),L=document.querySelector(".canvas-stage"),W="http://www.w3.org/2000/svg",le=document.querySelector(".canvas-measure-horizontal .measure-value"),fe=document.querySelector(".canvas-measure-vertical .measure-value"),X=document.querySelector(".preview-canvas-wrapper");let q=1,U,O;U=document.getElementById("preview-svg-front"),O=document.getElementById("preview-svg-back");let Y=Promise.resolve(),B=Promise.resolve();if(U&&O&&c){const e=c.dataset.frontSvg,t=c.dataset.backSvg;e&&(Y=an(U,e)),t&&(B=an(O,t))}const M=e=>{const t=e==="front"?"cardFront":"cardBack",r=document.getElementById(t);return r?r.querySelector("svg"):null},ne=e=>{try{const t=document.querySelector(`#template-editor-container-${e} svg`),r=document.getElementById(`preview-${e}-svg`),n=document.getElementById(`preview-${e}-card`)||document.getElementById(`preview-${e}-card`);if(!t||!r)return!1;const i=t.cloneNode(!0);for(;r.firstChild;)r.removeChild(r.firstChild);try{for(let a=0;a<i.attributes.length;a++){const o=i.attributes[a];o&&o.name&&o.value&&r.setAttribute(o.name,o.value)}}catch{}Array.from(i.childNodes).forEach(a=>r.appendChild(a.cloneNode(!0)));try{const a=document.getElementById("preview-front-card"),o=document.getElementById("preview-back-card");a&&o&&(e==="front"?(a.classList.add("active"),o.classList.remove("active")):(o.classList.add("active"),a.classList.remove("active")))}catch{}return!0}catch(t){return console.warn("[Preview] failed to update preview from canvas for",e,t),!1}},De=document.getElementById("preview-show-front"),Ue=document.getElementById("preview-show-back");De&&De.addEventListener("click",e=>{e.preventDefault(),ne("front"),De.setAttribute("aria-pressed","true"),Ue&&Ue.setAttribute("aria-pressed","false");const t=document.getElementById("preview-modal");t&&t.getAttribute("aria-hidden")==="true"&&t.setAttribute("aria-hidden","false")}),Ue&&Ue.addEventListener("click",e=>{e.preventDefault(),ne("back"),Ue.setAttribute("aria-pressed","true"),De&&De.setAttribute("aria-pressed","false");const t=document.getElementById("preview-modal");t&&t.getAttribute("aria-hidden")==="true"&&t.setAttribute("aria-hidden","false")}),window.addEventListener("inkwise:canvas-changed",e=>{var t;try{const r=(t=e==null?void 0:e.detail)==null?void 0:t.side,n=document.getElementById("preview-modal");if(!r)return;n&&n.getAttribute("aria-hidden")==="false"&&ne(r)}catch{}});const v=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),R=e=>!e||!e.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(r=>e.dataset[r]).filter(r=>typeof r=="string"&&r.trim()!=="").map(r=>r.trim().toLowerCase()),Q=e=>!e||typeof e.querySelector!="function"?null:e.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image'),P=e=>{if(!e)return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="image"||t==="img"||R(e).some(n=>n==="image"||n==="photo"||n==="graphic")||typeof e.hasAttribute=="function"&&(e.hasAttribute("data-editable-image")||e.hasAttribute("data-changeable-image")))return!0;if(e.classList){for(const n of v)if(e.classList.contains(n))return!0}return!!(t==="foreignobject"&&Q(e))},Ee=e=>{if(!e||P(e))return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="style"||t==="script"||t==="defs"||t==="title"||t==="metadata")return!1;if(t==="text"||t==="tspan"||R(e).some(a=>a.includes("text")||a==="names"||a==="heading"))return!0;const n=(e.textContent||"").trim();return!(!n||/\{[^}]*\}|;/.test(n)&&n.length>80)},K=e=>{if(!e)return"";const t=e.querySelectorAll("tspan");return t&&t.length>0?er(Array.from(t).map(r=>r.textContent||"").join(`
`)):er(e.textContent||"")},se=(e,t)=>{if(!e)return;const r=er(t),n=e.querySelectorAll("tspan");if(n&&n.length>0){const i=String(r??"").split(/\r?\n/);n.forEach((a,o)=>{a.textContent=i[o]??""})}else e.textContent=r??"";e.dataset&&(e.dataset.currentText=r??"")},ce=e=>{if(!e)return null;if(P(e))return e;if(typeof e.closest=="function"){const r=e.closest("[data-preview-node]");if(r&&r!==e&&P(r))return r}const t=Q(e);return t||null},ie=(e,t)=>{if(!e||!t)return!1;const r=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(r==="image")return e.setAttributeNS("http://www.w3.org/1999/xlink","href",t),e.setAttribute("href",t),e.dataset.src=t,!0;if(r==="img")return e.setAttribute("src",t),e.dataset.src=t,!0;if(r==="foreignobject"){const n=Q(e);return n&&n!==e?ie(n,t):!1}return e.style&&(e.style.backgroundImage=`url('${t}')`),e.dataset&&(e.dataset.src=t,e.dataset.replacedImage="true"),!0},me=e=>{if(!e||typeof e.insertBefore!="function"||e.querySelector('[data-inkwise-bg="true"]'))return;const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("fill","#ffffff"),r.setAttribute("data-inkwise-bg","true"),e.insertBefore(r,e.firstChild)},oe=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{};console.log("[InkWise Studio] Bootstrap payload:",oe);const de=(oe==null?void 0:oe.routes)??{};console.log("[InkWise Studio] Routes:",de);const Se=((bn=document.querySelector('meta[name="csrf-token"]'))==null?void 0:bn.getAttribute("content"))||((vn=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:vn.getAttribute("content"))||null,Fe=document.querySelector(".topbar-status-label"),he=document.querySelector(".topbar-status-dot"),ze=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},We=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},Ve=async(e,t=1080,r=1527)=>{if(!e||typeof e!="string")return null;try{const n=new Image;n.crossOrigin="anonymous",n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`,await new Promise((o,u)=>{n.onload=o,n.onerror=u});const i=document.createElement("canvas");i.width=t,i.height=r;const a=i.getContext("2d");return a.fillStyle="#ffffff",a.fillRect(0,0,t,r),a.drawImage(n,0,0,t,r),i.toDataURL("image/png",1)}catch(n){return console.warn("[InkWise Studio] Failed to convert SVG to PNG preview.",n),null}},et=e=>{var a,o;if(!c)return null;const t=window.getComputedStyle(c),n=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(n&&n[2])return n[2];const i=e?`${e}Image`:null;return i&&((a=c.dataset)!=null&&a[i])?c.dataset[i]:((o=c.dataset)==null?void 0:o.frontImage)||null},mt=e=>{!e||!J||(e.texts&&Array.isArray(e.texts)&&e.texts.forEach(t=>{const{key:r,value:n,fontFamily:i,fontSize:a,color:o}=t,u=J.querySelector(`[data-preview-node="${r}"]`);if(u){if(n!==void 0){se(u,n);const d=document.querySelector(`input[data-preview-target="${r}"]`);d&&(d.value=n)}if(i){u.setAttribute("font-family",i),u.style.fontFamily=i;try{u.dataset.fontFamily=i}catch{}}if(a){u.setAttribute("font-size",a),u.style.fontSize=a;try{u.dataset.fontSize=a}catch{}}if(o){u.setAttribute("fill",o),u.style.fill=o;try{u.dataset.color=o}catch{}}}}),e.images&&Array.isArray(e.images)&&e.images.forEach(t=>{const{key:r,href:n,x:i,y:a,width:o,height:u}=t,d=J.querySelector(`[data-preview-node="${r}"]`);d&&(n&&(d.setAttribute("href",n),d.setAttribute("xlink:href",n)),i!==void 0&&d.setAttribute("x",i),a!==void 0&&d.setAttribute("y",a),o!==void 0&&d.setAttribute("width",o),u!==void 0&&d.setAttribute("height",u))}))},At=()=>A?Array.from(A.querySelectorAll("input[data-preview-target]")).map(e=>{var d,S;const t=e.closest(".text-field-item"),r=((S=(d=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:d.textContent)==null?void 0:S.trim())||e.dataset.previewTarget||"",n=e.dataset.previewTarget||"",i=J==null?void 0:J.querySelector(`[data-preview-node="${n}"]`);let a=null,o=null,u=null;return i&&(a=i.getAttribute("font-family")||i.style.fontFamily||i.dataset.fontFamily,o=i.getAttribute("font-size")||i.style.fontSize||i.dataset.fontSize,u=i.getAttribute("fill")||i.style.fill||i.dataset.color),{key:n,label:r,value:e.value||"",defaultValue:e.dataset.defaultValue||"",fontFamily:a,fontSize:o,color:u}}):[],Et=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const r=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return r?parseFloat(r[0]):Number.NaN}return Number.NaN},_t=e=>{if(!e)return null;if(typeof e=="string"){const d=e.trim();if(!d)return null;try{const S=JSON.parse(d);return _t(S)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((d,S)=>S&&typeof S=="object"?Object.assign(d,S):d,{}):Object.assign({},e),r=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,n=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,i=Et(r),a=Et(n);if(!Number.isFinite(i)||i<=0||!Number.isFinite(a)||a<=0)return null;const o=t.shape??t.Shape??t.canvasShape??null,u=t.unit??t.Unit??t.canvasUnit??null;return{width:i,height:a,shape:typeof o=="string"&&o.trim()!==""?o.trim():null,unit:typeof u=="string"&&u.trim()!==""?u.trim():"px"}},rt=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},Jt=_t(X==null?void 0:X.dataset);let be=_t(((wn=oe==null?void 0:oe.template)==null?void 0:wn.canvas)??null)||Jt||null;const Zt=720,_=920,z=new Map;let ee=null;const te=new Map,T=new Map,re=new Map;let ge=null,ke=null,J=null,qe=null,Ze=()=>{},Xe="front",Ct=null,yt=null,N=null,Qt=null,je=null,He=null,st=!1,ot=null;const Ur=8,Dn=4,er=e=>{const r=(e||"").toString().trim();return/::before|\{[^}]*\}|;/.test(r)&&r.length>120?"":r},qn=e=>{if(!e||e==="front"||e!=="back")return!0;if(!c)return!1;if(yt)return!0;const t=c.dataset||{};return t.hasBack==="true"?!0:!!(t.backImage||t.backSvg)},zn=async e=>{if(!e||typeof e!="string")return null;if(e.startsWith("data:"))return e;try{const t=new Image;if(t.crossOrigin="anonymous",await new Promise(n=>{t.onload=()=>n(!0),t.onerror=()=>n(!1);const i=e.includes("?")?"&":"?";t.src=e+i+"_t="+Date.now()})&&t.naturalWidth>0&&t.naturalHeight>0){const n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0);try{const a=n.toDataURL("image/png");if(a&&a!=="data:,")return a}catch{console.warn("[InkWise Studio] Canvas tainted, trying fetch approach:",e)}}}catch(t){console.warn("[InkWise Studio] Canvas approach failed:",e,t)}try{const t=await fetch(e,{credentials:"include",mode:"cors"});if(!t.ok)return console.warn("[InkWise Studio] Failed to fetch image for base64 conversion:",e,t.status),null;const r=await t.blob();return new Promise(n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=()=>n(null),i.readAsDataURL(r)})}catch(t){console.warn("[InkWise Studio] Fetch approach also failed:",e,t)}try{const r=await(await fetch(e,{mode:"no-cors"})).blob();if(r.size>0)return new Promise(n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=()=>n(null),i.readAsDataURL(r)})}catch(t){console.warn("[InkWise Studio] No-cors fetch also failed:",e,t)}return null},Un=async e=>{[".svg-bounding-box",".resize-handle",".selection-indicator",".inkwise-selection",".inkwise-overlay",'[data-ui-element="true"]','[data-temp-element="true"]',"g.svg-bounding-box"].forEach(a=>{e.querySelectorAll(a).forEach(o=>o.remove())}),e.querySelectorAll("text").forEach(a=>{a.removeAttribute("contenteditable"),a.style.cursor="",a.style.userSelect=""}),e.querySelectorAll("image").forEach(a=>{a.style.cursor="",a.style.pointerEvents=""});const r=a=>{if(!a||a.startsWith("data:"))return a;try{const o=new URL(a,window.location.origin),u=[/\/InkWise-Web\/ink-wise\/public\/storage\//gi,/\/ink-wise\/public\/storage\//gi,/\/public\/storage\//gi];let d=o.pathname;for(const S of u)if(S.test(d)){d=d.replace(S,"/storage/");break}return o.pathname=d,(o.hostname==="localhost"||o.hostname==="127.0.0.1")&&(o.hostname=window.location.hostname,o.port=window.location.port,o.protocol=window.location.protocol),o.href}catch{return a}},n=e.querySelectorAll("image");console.log("[InkWise Studio] Found",n.length,"image elements to convert");const i=Array.from(n).map(async a=>{let o=a.getAttribute("href")||a.getAttribute("xlink:href")||a.getAttributeNS("http://www.w3.org/1999/xlink","href");if(console.log("[InkWise Studio] Processing image with href:",o),!o||o.startsWith("data:")){console.log("[InkWise Studio] Image already embedded or no href, skipping");return}const u=r(o);console.log("[InkWise Studio] Normalized URL:",u);const d=await zn(u);d?(console.log("[InkWise Studio] Successfully converted image to base64, length:",d.length),a.removeAttribute("href"),a.removeAttribute("xlink:href"),a.removeAttributeNS("http://www.w3.org/1999/xlink","href"),a.removeAttribute("data-src"),a.setAttribute("href",d),a.setAttribute("xlink:href",d),a.setAttributeNS("http://www.w3.org/1999/xlink","href",d),console.log("[InkWise Studio] Image href attributes updated to base64")):console.warn("[InkWise Studio] Failed to embed image, keeping original URL:",u)});await Promise.all(i),console.log("[InkWise Studio] All image conversions completed")},Sr=async()=>{var we;if(!c)return null;const e=new Date,t=Xe||"front";let r=null;const n={},i=[],a=async(xe,Z)=>{var Ae,ue,G,H;if(!xe)return{svg:null,preview:et(Z)};try{const Re=xe.cloneNode(!0),Ke=Z==="front"?cardFront:cardBack,Je=((Ae=Ke==null?void 0:Ke.dataset)==null?void 0:Ae.canvasWidth)||((ue=c==null?void 0:c.dataset)==null?void 0:ue.canvasWidth),nt=((G=Ke==null?void 0:Ke.dataset)==null?void 0:G.canvasHeight)||((H=c==null?void 0:c.dataset)==null?void 0:H.canvasHeight);Je&&nt&&(Re.setAttribute("width",Je),Re.setAttribute("height",nt),Re.style.width=Je+"px",Re.style.height=nt+"px"),Re.setAttribute("preserveAspectRatio","xMidYMid meet"),await Un(Re);let ct=Re.querySelector("style#inkwise-export-styles");ct||(ct=document.createElementNS(W,"style"),ct.id="inkwise-export-styles",Re.insertBefore(ct,Re.firstChild)),ct.textContent="@import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap'); text { white-space: pre; }";let Le=new XMLSerializer().serializeToString(Re);Le&&!/xmlns=/i.test(Le)&&(Le=Le.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'));const kt=await Ve(Le,Je||1080,nt||1527);return{svg:Le,preview:kt||We(Le)||et(Z)}}catch(Re){return console.warn("[InkWise Studio] Unable to serialize "+Z+" SVG.",Re),{svg:null,preview:et(Z)}}},o=M("front"),u=M("back"),d=await a(o,"front"),S=await a(u,"back");d.svg?(n.front={svg:d.svg,preview:d.preview},i.push(d.preview),r=r||d.svg):t==="front"&&(r=r||null),S.svg&&(n.back={svg:S.svg,preview:S.preview},i.push(S.preview),!r&&t==="back"&&(r=S.svg)),i.length?i[0]:et(t);const b=At(),f=b.filter(xe=>{const Z=(xe.value||"").trim(),Ae=(xe.defaultValue||"").trim();return Z===""||Ae!==""&&Z===Ae}).map(xe=>xe.label||xe.key).map(xe=>(xe||"").trim()).filter((xe,Z,Ae)=>xe!==""&&Ae.indexOf(xe)===Z),h=[],C=new Set;[o,u].forEach(xe=>{xe&&xe.querySelectorAll('image,img,[data-changeable="image"]').forEach(Z=>{const Ae=Z.getAttribute("href")||Z.getAttribute("xlink:href")||Z.getAttributeNS("http://www.w3.org/1999/xlink","href")||Z.getAttribute("data-src");if(!Ae)return;const ue=Z.getAttribute("data-preview-node")||Z.id||`image-${h.length+1}`;C.has(ue)||(C.add(ue),h.push({key:ue,href:Ae,x:Z.getAttribute("x")||null,y:Z.getAttribute("y")||null,width:Z.getAttribute("width")||null,height:Z.getAttribute("height")||null}))})});const g=c?{width:ze(c.dataset.canvasWidth),height:ze(c.dataset.canvasHeight),unit:c.dataset.canvasUnit||null,shape:c.dataset.canvasShape||null}:null,I=i.filter(Boolean),D=I[0]||et(t);return{design:{updated_at:e.toISOString(),sides:Object.keys(n).length?n:{[t]:{svg:r,preview:D}},texts:b,images:h,canvas:g,placeholders:f},preview:{image:D,images:I},svg_markup:r,placeholders:f,product_id:((we=oe==null?void 0:oe.product)==null?void 0:we.id)??null}},Wr=(e={},t={})=>{var d,S;const r=e&&e.summary?e.summary:{},n=Array.isArray(r.previewImages)?r.previewImages.filter(Boolean):Array.isArray(r.preview_images)?r.preview_images.filter(Boolean):[],i=Array.isArray((d=t==null?void 0:t.preview)==null?void 0:d.images)?t.preview.images.filter(Boolean):[],a=n.length?n:i,o=r.previewImage||r.preview_image||r.preview||((S=t==null?void 0:t.preview)==null?void 0:S.image)||a[0]||null;if(!o&&!a.length)return;const u={templateName:r.productName||r.templateName||document.title||"Saved template",previewImage:o||"",previewImages:a.length?a:o?[o]:[],metadata:{template:{name:r.productName||r.templateName||"Saved template"}}};try{window.sessionStorage.setItem("inkwise-finalstep",JSON.stringify(u))}catch{}try{const b={id:null,name:u.templateName,preview:u.previewImage};window.sessionStorage.setItem("inkwise-saved-template",JSON.stringify(b)),window.savedCustomerTemplate=b}catch{}},Wn=async(...e)=>{const t=await Sr(...e);try{Wr({},t)}catch{}return t};try{N=ha({collectSnapshot:Wn,routes:de,csrfToken:Se,statusLabel:Fe,statusDot:he,debounce:0,onAfterSave:(n,i)=>{try{Wr(n,i)}catch{}}}),console.log("[InkWise Studio] Autosave initialized",N);const e=n=>{if(N)try{N.flush(n)}catch(i){console.debug("[InkWise Studio] Autosave flush skipped.",i)}},t=()=>{document.visibilityState==="hidden"&&e("visibility-hidden")},r=()=>{e("page-hide")};document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",r),window.addEventListener("beforeunload",r),Qt=window.setInterval(()=>{e("heartbeat")},6e4),window.addEventListener("unload",()=>{Qt&&(window.clearInterval(Qt),Qt=null),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",r),window.removeEventListener("beforeunload",r)}),setInterval(()=>{N&&(console.log("[InkWise Studio] Periodic autosave trigger"),N.schedule("periodic"))},1e4)}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),N=null}const jn=async()=>{var f,h,C,g,I,D,we,xe;const e=await Sr(),t=(e==null?void 0:e.design)||{},r=t.sides||{},n=JSON.parse(JSON.stringify(t||{})),i=((f=r.front)==null?void 0:f.svg)||(e==null?void 0:e.svg_markup)||null,a=((h=r.front)==null?void 0:h.preview)||((C=e==null?void 0:e.preview)==null?void 0:C.image)||et("front")||null,o=(Array.isArray((g=e==null?void 0:e.preview)==null?void 0:g.images)?e.preview.images:[]).filter(Z=>typeof Z=="string"&&Z.trim()!==""),u=n.canvas||{},d=u.width??(c?ze(c.dataset.canvasWidth):null),S=u.height??(c?ze(c.dataset.canvasHeight):null),b=(()=>{var Z,Ae;try{if(!c)return null;const ue=window.getComputedStyle(c);return(ue==null?void 0:ue.backgroundColor)||((Z=c.dataset)==null?void 0:Z.backgroundColor)||((Ae=c.style)==null?void 0:Ae.backgroundColor)||null}catch{return null}})();return{design_svg:i,design_json:n,preview_image:a,preview_images:o,canvas_width:d,canvas_height:S,background_color:b,template_id:((I=oe==null?void 0:oe.template)==null?void 0:I.id)??(oe==null?void 0:oe.template_id)??null,order_item_id:((D=oe==null?void 0:oe.orderSummary)==null?void 0:D.order_item_id)??((we=oe==null?void 0:oe.orderSummary)==null?void 0:we.orderItemId)??((xe=oe==null?void 0:oe.orderSummary)==null?void 0:xe.item_id)??null}},dt=document.querySelector('[data-action="proceed-review"]');if(dt){const e=dt.dataset.destination||de.review||dt.getAttribute("href")||window.location.href,t=de.saveReview||de.reviewSave||de.review_design||de.reviewDesign||null;dt.addEventListener("click",async r=>{if(r.preventDefault(),dt.dataset.navigating==="1")return;dt.dataset.navigating="1",dt.disabled=!0;const n=()=>{window.location.href=e},i=()=>{dt.disabled=!1,dt.dataset.navigating="0"};try{N&&await N.flush("navigate");let a=await jn();try{const d=await Pn(a,{routes:de,csrfToken:Se});d&&(a=d)}catch(d){console.warn("[InkWise Studio] Pre-save image upload failed; proceeding with original payload",d)}if(!a.template_id)throw new Error("Missing template identifier.");if(!t)throw new Error("Save endpoint unavailable.");const o={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};Se&&(o["X-CSRF-TOKEN"]=Se);const u=await fetch(t,{method:"POST",headers:o,credentials:"same-origin",body:JSON.stringify(a)});if(!u.ok){const d=await u.text().catch(()=>"");throw new Error(`Save failed (${u.status}): ${d}`)}n()}catch(a){console.error("[InkWise Studio] Unable to save before navigating.",a),N&&N.notifyError(),alert("We could not save your latest design. Please try again before continuing."),i()}})}const It=document.getElementById("save-template-btn");It&&It.addEventListener("click",async e=>{if(e.preventDefault(),It.disabled)return;const t=prompt("Enter a name for your template:");if(!(!t||t.trim()==="")){It.disabled=!0,It.textContent="Savingâ€¦";try{N&&await N.flush("save-template");const r=await Sr("save-template"),n=Object.assign({},r&&r.design?r.design:{}),i=r&&Array.isArray(r.placeholders)?r.placeholders:[];n.placeholders=i,r&&r.product_id&&(n.product_id=r.product_id);const a=r&&r.preview&&r.preview.image||null,o=r&&r.preview&&Array.isArray(r.preview.images)?r.preview.images.filter(Boolean):[],u={template_name:t.trim(),design:n,preview_image:a,preview_images:o,placeholders:i,svg_markup:r.svg_markup};let d=u;try{const h=await Pn(u,{routes:de,csrfToken:Se});h&&(d=h)}catch(h){console.warn("[InkWise Studio] Pre-save image upload failed for template save; proceeding with original payload",h)}const S={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};Se&&(S["X-CSRF-TOKEN"]=Se);const b=await fetch(de.saveTemplate,{method:"POST",headers:S,credentials:"same-origin",body:JSON.stringify(d)});if(!b.ok)throw new Error(`Server responded with ${b.status}`);const f=await b.json();alert(`Template "${f.template_name}" saved successfully!`)}catch(r){console.error("[InkWise Studio] Failed to save template.",r),alert("Failed to save template. Please try again.")}finally{It.disabled=!1,It.textContent="Save Template"}}});const Ut=e=>{const t=ce(e);if(!t)return;const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=n=>{const i=n.target.files&&n.target.files[0];if(!i)return;const a=new FileReader;a.onload=o=>{var S;const u=(S=o.target)==null?void 0:S.result;if(!u)return;ie(t,u)&&(_e(),N==null||N.schedule("image-replace"))},a.readAsDataURL(i)},r.click()};window.addEventListener("inkwise-image-clicked",e=>{var t;try{const r=(t=e==null?void 0:e.detail)==null?void 0:t.node;if(!r)return;Ut(r)}catch(r){console.warn("[Preview] image click handler failed",r)}});const Hn=()=>c?((!ee||!ee.isConnected)&&(ee=document.createElement("div"),ee.className="canvas-overlay-layer",c.appendChild(ee)),ee):null,tr=()=>{T.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),T.clear(),re.clear(),ee&&(ee.innerHTML=""),te.forEach(e=>{e&&e.isConnected&&(e.innerHTML="")}),te.clear(),je=null,He=null,jt(),document.body.classList.remove("text-toolbar-visible"),Ht()},Bt=(e,t)=>{if(e==null)return t;const r=e.toString().split(/[\s,]+/).filter(Boolean);if(r.length===0)return t;const n=parseFloat(r[0]);return Number.isFinite(n)?n:t},ut=e=>{var S;if(!c)return;const t=T.get(e);if(!t||!t.overlay)return;const r=t.overlay,i=(S=(e&&typeof e.closest=="function"?e.closest(".preview-card-bg"):null)||c)==null?void 0:S.getBoundingClientRect(),a=e.getBoundingClientRect();if(i.width===0||i.height===0)return;const o=t.type==="text"?18:12,u=Math.max(o,a.width),d=Math.max(o,a.height);r.style.left=`${a.left-i.left}px`,r.style.top=`${a.top-i.top}px`,r.style.width=`${u}px`,r.style.height=`${d}px`},On=()=>{T.forEach((e,t)=>{ut(t)})},_e=()=>{T.size!==0&&(ge&&cancelAnimationFrame(ge),ge=window.requestAnimationFrame(()=>{ge=null,On()}))},rr=(e=3)=>{e<=0||requestAnimationFrame(()=>{_e(),rr(e-1)})};window.addEventListener("resize",_e),document.addEventListener("scroll",_e,!0),window.addEventListener("load",_e);const jr=(e,t)=>{const r=J||l;if(!r||typeof r.createSVGPoint!="function")return null;const n=r.createSVGPoint();n.x=e,n.y=t;const i=r.getScreenCTM();return i?n.matrixTransform(i.inverse()):null},Gn=(e,t,r)=>{const n=jr(r.clientX,r.clientY);if(!n)return null;const{node:i}=e,a=i.getBBox?i.getBBox():{x:0,y:0,width:0,height:0},o={data:e,overlay:e.overlay,node:i,type:e.type,handle:t,mode:t?"resize":"move",pointerId:r.pointerId,startPoint:n,startClient:{x:r.clientX,y:r.clientY},initialBBox:a,moved:!1};if(e.type==="text"){o.fontSize=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,o.x=Bt(i.getAttribute("x"),a.x);const u=a.y+a.height;o.y=Bt(i.getAttribute("y"),u)}else o.x=Bt(i.getAttribute("x"),a.x),o.y=Bt(i.getAttribute("y"),a.y),o.width=Bt(i.getAttribute("width"),Math.max(1,a.width)),o.height=Bt(i.getAttribute("height"),Math.max(1,a.height));return o},Vn=(e,t,r)=>{if(e.type==="text"){const n=e.x+t,i=e.y+r;Number.isFinite(n)&&e.node.setAttribute("x",n),Number.isFinite(i)&&e.node.setAttribute("y",i)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+r)},Xn=(e,t,r,n=!1)=>{if(e.type==="image"){let i=e.x,a=e.y,o=e.width,u=e.height;const d=["nw","ne","sw","se"].some(h=>e.handle===h),S=n||d,b=e.width/e.height;if(S&&d){const h=Math.abs(t),C=Math.abs(r);h>C?(e.handle.includes("e")?o=e.width+t:e.handle.includes("w")&&(o=e.width-t,i=e.x+t),u=o/b,e.handle.includes("n")&&(a=e.y+(e.height-u))):(e.handle.includes("s")?u=e.height+r:e.handle.includes("n")&&(u=e.height-r,a=e.y+r),o=u*b,e.handle.includes("w")&&(i=e.x+(e.width-o)))}else e.handle.includes("e")&&(o=e.width+t),e.handle.includes("w")&&(o=e.width-t,i=e.x+t),e.handle.includes("s")&&(u=e.height+r),e.handle.includes("n")&&(u=e.height-r,a=e.y+r);const f=4;o<f&&(i+=o-f,o=f),u<f&&(a+=u-f,u=f),e.node.setAttribute("x",i),e.node.setAttribute("y",a),e.node.setAttribute("width",o),e.node.setAttribute("height",u)}else if(e.type==="text"){const i=Math.max(1,e.initialBBox.width),a=Math.max(1,e.initialBBox.height);let o=0,u=0;e.handle.includes("e")?o=t:e.handle.includes("w")&&(o=-t),e.handle.includes("s")?u=r:e.handle.includes("n")&&(u=-r);const d=Math.max(4,i+o),S=Math.max(4,a+u),b=d/i,f=S/a,h=Math.max(b,f),C=Math.max(6,e.fontSize*h);e.node.setAttribute("font-size",C)}},Hr=e=>{if(!ke||e.pointerId!==ke.pointerId)return;const t=jr(e.clientX,e.clientY);if(!t)return;const r=t.x-ke.startPoint.x,n=t.y-ke.startPoint.y;!ke.moved&&(Math.abs(r)>.5||Math.abs(n)>.5)&&(ke.moved=!0),ke.mode==="move"?Vn(ke,r,n):Xn(ke,r,n),_e()},nr=e=>{if(!ke||e.pointerId!==ke.pointerId)return;try{ke.overlay.releasePointerCapture(ke.pointerId)}catch{}ke.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",Hr),document.removeEventListener("pointerup",nr),document.removeEventListener("pointercancel",nr);const t=ke;ke=null,_e(),t.moved?N==null||N.schedule("element-transform"):t.type==="text"?Ze(t.data.previewKey):t.type==="image"&&Ut(t.node)},Yn=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t||t.dataset.cropSessionActive==="true")return;const r=re.get(t);if(!r)return;r.type==="text"?wt(r.previewKey||null):r.type==="image"&&xt(r.previewKey||null);const n=Gn(r,e.target.dataset.handle||null,e);if(n){e.preventDefault(),ke=n,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",Hr),document.addEventListener("pointerup",nr),document.addEventListener("pointercancel",nr)}},lt=e=>{const t=e&&typeof e.closest=="function"?e.closest(".preview-card-bg"):null;let r=null;if(t?(r=te.get(t),(!r||!r.isConnected)&&(r=document.createElement("div"),r.className="canvas-overlay-layer",t.appendChild(r),te.set(t,r))):r=Hn(),!r)return null;let n=T.get(e);if(n)return n;const i=P(e)?"image":"text",a=e.getAttribute("data-preview-node")||"",o=document.createElement("div");return o.className=`editor-overlay editor-overlay--${i}`,o.dataset.previewNode=a,o.tabIndex=0,o.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(d=>{const S=document.createElement("div");S.className=`editor-overlay__handle editor-overlay__handle--${d}`,S.dataset.handle=d,o.appendChild(S)}),o.addEventListener("pointerdown",Yn),o.addEventListener("dblclick",()=>{i==="text"?Ze(a):i==="image"&&Ut(e)}),o.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),i==="text"?Ze(a):i==="image"&&Ut(e))}),r.appendChild(o),n={overlay:o,node:e,type:i,previewKey:a},T.set(e,n),re.set(o,n),e.dataset.locked==="true"&&(o.classList.add("editor-overlay--locked"),o.style.pointerEvents="none"),jt(),_e(),n},ir=(e,t,r={})=>{if(!c)return;const n=c.closest(".preview-canvas-wrapper"),i=Number(e),a=Number(t),o=r.persist===void 0?!0:!!r.persist,u=typeof r.unit=="string"&&r.unit?r.unit:(be==null?void 0:be.unit)??"px",d=typeof r.shape=="string"&&r.shape?r.shape:(be==null?void 0:be.shape)??null;if(!n||!Number.isFinite(i)||!Number.isFinite(a)||i<=0||a<=0)return;const S=Zt/i,b=_/a,f=Math.min(1,S,b),h=Math.max(1,Math.round(i*f)),C=Math.max(1,Math.round(a*f));n.style.setProperty("--canvas-width",`${h}px`),n.style.setProperty("--canvas-height",`${C}px`),n.dataset.sourceWidth=i.toString(),n.dataset.sourceHeight=a.toString(),n.dataset.displayScale=f.toString(),n.dataset.canvasWidth=i.toString(),n.dataset.canvasHeight=a.toString(),n.dataset.canvasUnit=u,d&&(n.dataset.canvasShape=d),c.dataset.canvasWidth=i.toString(),c.dataset.canvasHeight=a.toString(),c.dataset.canvasUnit=u,d&&(c.dataset.canvasShape=d),l&&(l.setAttribute("viewBox",`0 0 ${i} ${a}`),l.setAttribute("preserveAspectRatio","xMidYMid meet")),J&&!J.getAttribute("viewBox")&&(J.setAttribute("viewBox",`0 0 ${i} ${a}`),J.setAttribute("preserveAspectRatio","xMidYMid meet")),L&&L.style.setProperty("--stage-width",`${h+112}px`),o&&(be={width:i,height:a,unit:u,shape:d}),_e()},ar=(e,t,r,n=0)=>{le&&(Number.isFinite(e)?le.textContent=`${e.toFixed(n)}${r}`:le.textContent="â€”"),fe&&(Number.isFinite(t)?fe.textContent=`${t.toFixed(n)}${r}`:fe.textContent="â€”")};be&&(ir(be.width,be.height,{unit:be.unit,shape:be.shape}),ar(rt(be.width,be.unit),rt(be.height,be.unit),"in",2));const Or=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),r=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!r)return Number.NaN;const n=parseFloat(r[1]);if(!Number.isFinite(n))return Number.NaN;const i=t.match(/([a-z%]+)$/i);switch(i?i[1].toLowerCase():""){case"":case"px":return n;case"mm":return n*(96/25.4);case"cm":return n*(96/2.54);case"in":return n*96;case"pt":return n*(96/72);default:return n}},Kn=()=>!!(be&&Number.isFinite(be.width)&&be.width>0&&Number.isFinite(be.height)&&be.height>0),Jn=e=>{if(!e||Kn())return;if(z.has(e)){const r=z.get(e);if(r){const n=r.unit||"px";ir(r.width,r.height,{unit:n,shape:be==null?void 0:be.shape}),ar(rt(r.width,n),rt(r.height,n),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const r={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};z.set(e,r),ir(r.width,r.height,{unit:r.unit,shape:be==null?void 0:be.shape}),ar(rt(r.width,r.unit),rt(r.height,r.unit),"in",2),_e()},t.onerror=()=>{z.set(e,null)},t.src=e},kr={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")};window.addEventListener("inkwise:apply-background",e=>{try{const t=e&&e.detail?e.detail:{},r=t.side||"selection",n=t.color||null,i=t.image||null;if(!n&&!i)return;const a=r==="front"||r==="both",o=r==="back"||r==="both",u=async b=>{try{if(!b)return null;if(b.startsWith("data:"))return b;const f=await fetch(b);if(!f.ok)return null;const h=await f.blob();return await new Promise((C,g)=>{const I=new FileReader;I.onload=()=>C(I.result),I.onerror=g,I.readAsDataURL(h)})}catch{return null}},d=async(b,f,h)=>{if(!(!b||!f))try{const C=f&&f.startsWith("data:")?f:await u(f)||f,g=`inkwise-bg-image-${h}`;let I=b.querySelector(`#${g}`);if(I){try{I.setAttributeNS("http://www.w3.org/1999/xlink","href",C)}catch{}try{I.setAttribute("href",C)}catch{}}else{I=document.createElementNS("http://www.w3.org/2000/svg","image"),I.setAttribute("id",g),I.setAttribute("x","0"),I.setAttribute("y","0"),I.setAttribute("width","100%"),I.setAttribute("height","100%"),I.setAttribute("preserveAspectRatio","xMidYMid slice"),I.setAttribute("pointer-events","none");try{I.setAttributeNS("http://www.w3.org/1999/xlink","href",C)}catch{}try{I.setAttribute("href",C)}catch{}b.insertBefore(I,b.firstChild)}try{b.querySelectorAll("rect").forEach(we=>{try{we.style.display="none"}catch{}})}catch{}}catch(C){console.debug("[InkWise Studio] setSvgBackground failed",C)}},S=(b,f)=>{if(b)try{const h=`inkwise-bg-image-${f}`,C=b.querySelector(`#${h}`);C&&C.remove(),b.querySelectorAll("rect").forEach(I=>{try{I.style.display=""}catch{}})}catch{}};try{if(a){const b=document.getElementById("preview-front-bg")||document.querySelector(".preview-card-bg");b&&(i?(b.style.backgroundImage=`url('${i}')`,b.style.backgroundSize="cover",b.style.backgroundPosition="center",b.style.backgroundRepeat="no-repeat",b.style.backgroundColor=""):(b.style.backgroundImage="none",b.style.backgroundColor=n));const f=document.getElementById("template-editor-container-front");if(f)if(i){f.style.backgroundImage=`url('${i}')`,f.style.backgroundSize="cover",f.style.backgroundPosition="center",f.style.backgroundRepeat="no-repeat",f.style.backgroundColor="";try{f.dataset.backgroundImage=i}catch{}try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-front-svg");h&&d(h,i,"front")}catch{}}else{f.style.backgroundImage="none",f.style.backgroundColor=n;try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-front-svg");h&&S(h,"front")}catch{}}if(!i)try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-front-svg");if(h){const C=h.querySelector("radialGradient#inkwise-grad-1, linearGradient#inkwise-grad-1, #inkwise-grad-1");C&&C.querySelectorAll("stop").forEach(I=>I.setAttribute("stop-color",n))}}catch{}}if(o){const b=document.getElementById("preview-back-bg")||document.querySelectorAll(".preview-card-bg")[1]||document.querySelector(".preview-card-bg");b&&(i?(b.style.backgroundImage=`url('${i}')`,b.style.backgroundSize="cover",b.style.backgroundPosition="center",b.style.backgroundRepeat="no-repeat",b.style.backgroundColor=""):(b.style.backgroundImage="none",b.style.backgroundColor=n));const f=document.getElementById("template-editor-container-back");if(f)if(i){f.style.backgroundImage=`url('${i}')`,f.style.backgroundSize="cover",f.style.backgroundPosition="center",f.style.backgroundRepeat="no-repeat",f.style.backgroundColor="";try{f.dataset.backgroundImage=i}catch{}try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-back-svg");h&&d(h,i,"back")}catch{}}else{f.style.backgroundImage="none",f.style.backgroundColor=n;try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-back-svg");h&&S(h,"back")}catch{}}if(!i)try{const h=f&&f.querySelector&&f.querySelector("svg")||document.getElementById("preview-back-svg");if(h){h.querySelectorAll("radialGradient, linearGradient").forEach(g=>{try{g.querySelectorAll("stop").forEach(D=>D.setAttribute("stop-color",n))}catch{}});try{const g=h.getAttribute("viewBox");let I=null,D=null;if(g){const Z=g.split(/\s+/).map(Number);Z&&Z.length===4&&(I=Z[2],D=Z[3])}let we=null;const xe=h.querySelectorAll("rect");for(let Z=0;Z<xe.length;Z++){const Ae=xe[Z],ue=Ae.getAttribute("width"),G=Ae.getAttribute("height"),H=Ae.getAttribute("x")||"0",Re=Ae.getAttribute("y")||"0";if(ue==="100%"||G==="100%"||I&&D&&parseFloat(ue)===I&&parseFloat(G)===D&&(H==="0"||H===0)&&(Re==="0"||Re===0)){we=Ae;break}}if(!we&&xe.length>0&&(we=xe[0]),we){we.setAttribute("fill",n);try{we.style&&(we.style.fill=n)}catch{}}}catch{}}}catch{}}}catch(b){console.debug("[InkWise Studio] apply-background DOM update failed",b)}try{window.dispatchEvent(new CustomEvent("inkwise:background-changed",{detail:{side:r,color:n,image:i}}))}catch{}}catch(t){console.debug("[InkWise Studio] error handling inkwise:apply-background",t)}});const Zn=document.querySelectorAll("[data-modal-close]"),Gr=e=>{if(!e)return[];const t=new Map;let r=0;const n=(f,h,C="node")=>{let g=(f||"").toString().trim();g||(g=`${C}-${r+=1}`);let I=g,D=2;for(;t.has(I)&&t.get(I)!==h;)I=`${g}-${D}`,D+=1;return I},i=(f,h,C=null,g=null,I="node")=>{if(!f)return;const D=n(h,f,I);return f.setAttribute("data-preview-node",D),C&&!f.dataset.previewLabel&&(f.dataset.previewLabel=C),g&&!f.dataset.defaultText&&(f.dataset.defaultText=g),t.set(D,f),D};e.querySelectorAll("[data-preview-node]").forEach(f=>{var C,g;const h=f.getAttribute("data-preview-node");h&&i(f,h,((C=f.dataset)==null?void 0:C.previewLabel)||null,((g=f.dataset)==null?void 0:g.defaultText)||null,"node")});const o=[];e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(f=>{const h=f.getAttribute("data-layer-id");if(!h)return;const C=(f.getAttribute("aria-label")||h).replace(/\s+layer$/i,"")||h,g=f.querySelector(".canvas-layer__text");if(g){if(g.hasAttribute("data-preview-node")||g.setAttribute("data-preview-node",h),g.dataset.previewLabel||(g.dataset.previewLabel=C),!g.dataset.defaultText){const D=(g.textContent||"").trim();D&&(g.dataset.defaultText=D)}o.push(g)}const I=f.querySelector("img, image");if(I){const D=`${h}-image`;I.hasAttribute("data-preview-node")||I.setAttribute("data-preview-node",D),I.dataset.previewLabel||(I.dataset.previewLabel=C),o.push(I)}if(!g&&!I){if(f.hasAttribute("data-preview-node")||f.setAttribute("data-preview-node",h),f.dataset.previewLabel||(f.dataset.previewLabel=C),!f.dataset.defaultText){const D=(f.textContent||"").trim();D&&(f.dataset.defaultText=D)}o.push(f)}}),e.querySelectorAll("image, img").forEach((f,h)=>{var g;const C=f.getAttribute("data-preview-node")||`auto-image-${h+1}`;i(f,C,((g=f.dataset)==null?void 0:g.previewLabel)||null,null,"image")}),e.querySelectorAll("text, tspan").forEach((f,h)=>{var I,D;const C=(((I=f.dataset)==null?void 0:I.defaultText)||f.textContent||"").trim()||null,g=f.getAttribute("data-preview-node")||`auto-text-${h+1}`;i(f,g,((D=f.dataset)==null?void 0:D.previewLabel)||null,C,"text")}),o.length>0&&o.forEach((f,h)=>{var g,I;const C=f.getAttribute("data-preview-node")||`fallback-${h+1}`;i(f,C,((g=f.dataset)==null?void 0:g.previewLabel)||null,((I=f.dataset)==null?void 0:I.defaultText)||null,"node")});const b=[];return e.querySelectorAll("text[data-preview-node], tspan[data-preview-node]").forEach(f=>{const h=f.getAttribute("data-preview-node");if(h&&t.has(h)){const C=t.get(h);C&&!b.includes(C)&&b.push(C)}}),b.length>0?b:Array.from(t.values())},sr=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const r=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);r==null||r.classList.remove("active"),t==="background"&&st&&(st=!1,Wt(),Ht())}},Vr=()=>{Object.values(kr).forEach(e=>sr(e))},Xr=e=>{const t=kr[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const r=t.querySelector('input:not([type="hidden"])');if(r==null||r.focus({preventScroll:!0}),e==="background"&&di(),e==="graphics"){const n=document.querySelector('.graphics-category-button[data-category="image"]');n?Zr(n):(Cr(),Er())}};E.length&&E.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",r=kr[t],n=r==null?void 0:r.classList.contains("is-open");Vr(),E.forEach(i=>i.classList.remove("active")),n||(Xr(t),e.classList.add("active"))})}),Zn.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");sr(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&sr(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&sr(t)}});async function Qn(e){if(!e||!e.fullUrl){console.error("[InkWise Studio] Invalid graphic item:",e);return}const t=document.getElementById("background-modal");if(t&&t.classList.contains("is-open")&&st){try{const i=await fetch(e.fullUrl);if(!i.ok)throw new Error(`Failed to fetch background image: ${i.status}`);const a=await i.blob(),o=await Ai(a);ki(o),console.log("[InkWise Studio] Applied graphic as background image")}catch(i){console.error("[InkWise Studio] Failed to apply background graphic:",i),alert("Failed to apply background image. Please try again.")}return}const n=M(Xe);if(!n){console.error("[InkWise Studio] No SVG root found for side:",Xe);return}try{const a=`graphic-${`graphic-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}`;if(e.fullUrl.includes(".svg")||e.id.startsWith("iconify-")){const u=await fetch(e.fullUrl);if(!u.ok)throw new Error(`Failed to fetch SVG: ${u.status}`);const d=await u.text(),S=document.createElementNS("http://www.w3.org/2000/svg","g");S.setAttribute("data-preview-node",a),S.setAttribute("data-preview-label",e.alt||"Graphic"),S.setAttribute("class","inserted-graphic"),S.setAttribute("data-editable-image","true"),S.setAttribute("transform","translate(100, 100) scale(0.5)");const h=new DOMParser().parseFromString(d,"image/svg+xml").documentElement;for(;h.firstChild;)S.appendChild(h.firstChild);n.appendChild(S);const C=lt(S);C&&(S.style.cursor="pointer",S.addEventListener("click",g=>{g.stopPropagation(),ft();const I=Lr(C.overlay,S);I&&(ot=I)})),console.log("[InkWise Studio] Inserted SVG graphic:",a)}else{const u=document.createElementNS("http://www.w3.org/2000/svg","image");u.setAttribute("data-preview-node",a),u.setAttribute("data-preview-label",e.alt||"Graphic"),u.setAttribute("class","inserted-graphic"),u.setAttribute("data-editable-image","true"),u.setAttribute("x","100"),u.setAttribute("y","100"),u.setAttribute("width","200"),u.setAttribute("height","200"),u.setAttribute("preserveAspectRatio","xMidYMid meet"),u.setAttributeNS("http://www.w3.org/1999/xlink","href",e.fullUrl),n.appendChild(u);const d=lt(u);d&&(u.style.cursor="pointer",u.addEventListener("click",S=>{S.stopPropagation(),ft();const b=Lr(d.overlay,u);b&&(ot=b)})),console.log("[InkWise Studio] Inserted raster graphic:",a)}updatePreview(Xe),console.log("[InkWise Studio] Graphic inserted successfully")}catch(i){console.error("[InkWise Studio] Failed to insert graphic:",i),alert("Failed to insert graphic. Please try again.")}}const or=document.querySelector(".graphics-categories-labels"),V=document.getElementById("graphics-browser-samples"),Yr=document.querySelectorAll(".graphics-category-button"),bt=document.getElementById("graphics-search-form"),vt=document.getElementById("graphics-search-input"),Kr="53250708-d3f88461e75cb0c2c5366a181",ei={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:Kr,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:Kr,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},Jr=new Map;let Ar=0;function lr(e,t){const r=(t||"").trim();return r||e.query||e.defaultQuery||""}function Er(){V&&(V.innerHTML="",V.dataset.category="",V.dataset.page="0",V.dataset.loading="0",V.dataset.hasMore="0",V.dataset.searchTerm="",V.dataset.requestToken="")}function Cr(){if(!or||!V)return;or.querySelectorAll(".category-row").forEach(t=>{t.style.display="flex",t.dataset.expanded="0"}),Yr.forEach(t=>{t.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}),V.scrollTop=0,V.innerHTML="",V.dataset.category="",V.dataset.page="0",V.dataset.loading="0",V.dataset.hasMore="0",V.dataset.searchTerm="",V.dataset.requestToken="",bt&&(bt.classList.add("is-hidden"),bt.dataset.category=""),vt&&(vt.value="",vt.blur())}function Ir(e){return ei[e]||null}async function Zr(e){var f,h,C;const t=e.dataset.category;if(!t||!V||!or)return;if(e.getAttribute("aria-expanded")==="true"){Cr(),Er();return}const n=Ir(t);if(!n){console.warn(`[InkWise Studio] No graphics configuration found for category "${t}".`);return}Cr();const i=Jr.get(t)||"",a=n.label||"",o=(C=(h=(f=e.closest(".category-row"))==null?void 0:f.querySelector(".category-label"))==null?void 0:h.textContent)==null?void 0:C.trim(),u=a||o||t,d=n.searchPlaceholder||`Search ${u.toLowerCase()}`;bt&&(bt.classList.remove("is-hidden"),bt.dataset.category=t),vt&&(vt.placeholder=d,vt.value=i),e.setAttribute("aria-expanded","true"),e.classList.add("is-open"),or.querySelectorAll(".category-row").forEach(g=>{g.dataset.categoryRow===t?(g.style.display="flex",g.dataset.expanded="1"):g.style.display="none"}),V.innerHTML="",V.dataset.category=t,V.dataset.page="0",V.dataset.loading="0",V.dataset.hasMore="1",V.dataset.searchTerm=i,V.scrollTop=0;const b=String(++Ar);V.dataset.requestToken=b,Qr(),await Nr(t,1,i,b)}function Qr(){if(!V)return;const e=V.querySelector(".graphics-loading");if(e){e.style.display="flex";return}const t=document.createElement("div");t.className="graphics-loading",t.textContent="Loading assetsâ€¦",V.appendChild(t)}function en(){if(!V)return;const e=V.querySelector(".graphics-loading");e&&e.remove()}function tn(e){if(!V)return;V.innerHTML="";const t=document.createElement("div");t.className="graphics-error",t.textContent=e||"Unable to load assets at the moment.",V.appendChild(t)}function ti(e){if(!V||!Array.isArray(e))return;const t=document.createDocumentFragment();e.forEach(r=>{if(!r||!r.thumbUrl)return;const n=document.createElement("div");n.className="graphics-sample",n.title=r.alt||"Graphic sample";const i=document.createElement("img");if(i.src=r.thumbUrl,i.alt=r.alt||"Graphic sample",i.loading="lazy",n.appendChild(i),r.label){const a=document.createElement("span");a.className="sample-label",a.textContent=r.label,n.appendChild(a)}n.addEventListener("click",async()=>{console.log("Selected asset",r);try{await Qn(r)}catch(a){console.error("[InkWise Studio] Failed to insert graphic:",a)}}),t.appendChild(n)}),en(),V.appendChild(t)}async function Nr(e,t,r,n){if(!V)return;const i=Ir(e);if(!i)return;const a=V.dataset.requestToken||"",o=n||a||String(++Ar);if(!(V.dataset.loading==="1"&&o===a)){V.dataset.loading="1",Qr();try{const u=typeof r=="string"?r:V.dataset.searchTerm||"",d=await ri(i,t,u);if(V.dataset.requestToken!==o)return;if(V.dataset.loading="0",en(),!d.length&&t===1){tn("No assets found for this category right now. Try again in a moment."),V.dataset.hasMore="0";return}ti(d),V.dataset.page=String(t);const S=i.perPage||12;V.dataset.hasMore=d.length>=S?"1":"0"}catch(u){if(console.error("[InkWise Studio] Failed to load graphics assets:",u),V.dataset.requestToken!==o)return;V.dataset.loading="0",tn("We ran into a problem loading assets. Please try again."),V.dataset.hasMore="0"}}}async function ri(e,t,r){switch(e.provider){case"unsplash":return ni(e,t,r);case"pixabay":return ii(e,t,r);case"flaticon":return ai(e,t,r);case"iconify":return si(e,t,r);default:return console.warn("[InkWise Studio] Unknown graphics provider:",e.provider),[]}}async function ni(e,t,r){const n=e.perPage||12,i=lr(e,r),a=i?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",o=new URLSearchParams({per_page:String(n),page:String(t),client_id:e.apiKey});i&&(o.set("query",i),o.set("orientation","portrait"));const u=`${a}?${o.toString()}`,d=await fetch(u);if(!d.ok)throw new Error(`Unsplash API error: ${d.status}`);const S=await d.json();return(Array.isArray(S)?S:Array.isArray(S.results)?S.results:[]).map(f=>{const h=f.urls||{};return{id:`unsplash-${f.id}`,thumbUrl:h.small||h.thumb||h.regular||"",fullUrl:h.full||h.regular||h.raw||"",alt:f.alt_description||f.description||f.slug||"Unsplash image"}}).filter(f=>!!f.thumbUrl)}async function ii(e,t,r){const n=e.perPage||18,i=new URLSearchParams({key:e.apiKey,q:lr(e,r),per_page:String(n),page:String(t),safesearch:"true",order:"popular"});e.imageType&&i.set("image_type",e.imageType),e.category&&i.set("category",e.category);const a=await fetch(`https://pixabay.com/api/?${i.toString()}`);if(!a.ok)throw new Error(`Pixabay API error: ${a.status}`);const o=await a.json();return(Array.isArray(o==null?void 0:o.hits)?o.hits:[]).map(d=>({id:`pixabay-${d.id}`,thumbUrl:d.previewURL||d.webformatURL||"",fullUrl:d.largeImageURL||d.webformatURL||"",alt:d.tags||"Pixabay asset",label:d.user?`@${d.user}`:null})).filter(d=>!!d.thumbUrl)}async function ai(e,t,r){const n=e.perPage||48,i=new URLSearchParams({q:lr(e,r)||"icon",limit:String(n),page:String(t)});i.set("apikey",e.apiKey);const a=await fetch(`https://api.flaticon.com/v3/search/icons?${i.toString()}`,{headers:{Accept:"application/json",apikey:e.apiKey,Authorization:`Bearer ${e.apiKey}`}});if(!a.ok)throw new Error(`Flaticon API error: ${a.status}`);const o=await a.json();return(Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o==null?void 0:o.icons)?o.icons:Array.isArray(o==null?void 0:o.result)?o.result:[]).map(d=>{var g;const S=(d==null?void 0:d.images)||d,b=(S==null?void 0:S.png)||{},f=(S==null?void 0:S.svg)||(S==null?void 0:S.svg)||null,h=b[128]||b[256]||f||(S==null?void 0:S["64"])||null,C=b[512]||b[256]||f||h;return h?{id:`flaticon-${(d==null?void 0:d.id)||(d==null?void 0:d.icon_id)||(d==null?void 0:d.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:h,fullUrl:C,alt:(d==null?void 0:d.description)||(Array.isArray(d==null?void 0:d.tags)?d.tags.join(", "):"Icon asset"),label:((g=d==null?void 0:d.uploader)==null?void 0:g.name)||(d==null?void 0:d.category)||null}:null}).filter(Boolean)}async function si(e,t,r){const n=e.perPage||36,i=Math.max(0,(t-1)*n),a=new URLSearchParams({query:lr(e,r)||"shape",limit:String(n),offset:String(i)});e.prefix&&a.set("prefix",e.prefix);const o=(e.baseUrl||"https://api.iconify.design").replace(/\/$/,""),u=await fetch(`${o}/search?${a.toString()}`,{headers:{Accept:"application/json"}});if(!u.ok)throw new Error(`Iconify API error: ${u.status}`);const d=await u.json(),S=Array.isArray(d==null?void 0:d.icons)?d.icons:[],b=Array.isArray(d==null?void 0:d.prefixes)&&d.prefixes.length===1?d.prefixes[0]:(d==null?void 0:d.prefix)||e.prefix||"";return S.map(f=>{if(typeof f=="string"){const h=f.includes(":")?f:b?`${b}:${f}`:f;if(!h)return null;const C=h.split(":").map(I=>encodeURIComponent(I)).join(":"),g=h.split(":").pop()||h;return{id:`iconify-${h.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${o}/${C}.svg?height=120&width=120`,fullUrl:`${o}/${C}.svg`,alt:g.replace(/[-_]/g," "),label:g.replace(/[-_]/g," ")}}if(f&&typeof f=="object"){const h=f.name||f.icon||f.id||"";if(!h)return null;const C=f.prefix||b,g=C?`${C}:${h}`:h,I=g.split(":").map(we=>encodeURIComponent(we)).join(":"),D=f.label||h;return{id:`iconify-${g.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${o}/${I}.svg?height=120&width=120`,fullUrl:`${o}/${I}.svg`,alt:D.replace(/[-_]/g," "),label:D.replace(/[-_]/g," ")}}return null}).filter(f=>!!(f!=null&&f.thumbUrl))}async function oi(){if(!V)return;const e=V.dataset.category;if(!e||V.dataset.loading==="1"||V.dataset.hasMore==="0")return;if(V.scrollTop+V.clientHeight>=V.scrollHeight-180){const r=Number(V.dataset.page||"1")+1,n=V.dataset.searchTerm||"";await Nr(e,r,n)}}Yr.forEach(e=>{e.addEventListener("click",()=>Zr(e))}),V&&(V.addEventListener("scroll",()=>{oi().catch(e=>{console.error("[InkWise Studio] graphics scroll handler error:",e)})}),Er()),bt&&vt&&bt.addEventListener("submit",async e=>{if(e.preventDefault(),!V)return;const t=V.dataset.category;if(!t||!Ir(t))return;const r=vt.value.trim();Jr.set(t,r),V.scrollTop=0,V.innerHTML="",V.dataset.page="0",V.dataset.hasMore="1",V.dataset.searchTerm=r,V.dataset.loading="0";const n=String(++Ar);V.dataset.requestToken=n;try{await Nr(t,1,r,n)}catch(i){console.error("[InkWise Studio] graphics search failed:",i)}});const rn=e=>!e||!A?null:A.querySelector(`input[data-preview-target="${e}"]`),li=e=>!e||!x?null:x.querySelector(`[data-preview-node="${e}"]`),nn=(()=>{let e=!1;return()=>{if(e||typeof document>"u")return;const t=document.createElement("style");t.id="inkwise-crop-overlay-styles",t.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(t),e=!0}})(),ft=()=>{ot&&(ot.teardown(),ot=null)},Lr=(e,t)=>{if(!e||!t)return null;nn(),getComputedStyle(e).position==="static"&&(e.style.position="relative");const r=(m,F,pe)=>Math.min(Math.max(m,F),pe);(()=>{if(t.dataset.cropSourceWidth&&t.dataset.cropSourceHeight)return;let m=null;try{m=t.getBBox()}catch{m=null}const F=m&&Number.isFinite(m.width)&&m.width>0?m.width:parseFloat(t.getAttribute("width"))||0,pe=m&&Number.isFinite(m.height)&&m.height>0?m.height:parseFloat(t.getAttribute("height"))||0,j=m&&Number.isFinite(m.x)?m.x:parseFloat(t.getAttribute("x"))||0,Te=m&&Number.isFinite(m.y)?m.y:parseFloat(t.getAttribute("y"))||0;F>0&&pe>0&&(t.dataset.cropSourceWidth=F,t.dataset.cropSourceHeight=pe,t.dataset.cropSourceX=j,t.dataset.cropSourceY=Te)})();const i=document.createElement("div");i.className="crop-overlay";const a=(()=>{const m=typeof t.dataset.cropRect=="string"?t.dataset.cropRect:"",F=t.getAttribute("clip-path")||"",pe=t.style&&typeof t.style.clipPath=="string"?t.style.clipPath:"",j=t.style&&typeof t.style.webkitClipPath=="string"?t.style.webkitClipPath:"",Te=t.dataset.cropClipId||"",$e=(()=>{const Ce=F.match(/^url\(#(.+)\)$/);return Ce?Ce[1]:""})(),Me=Te||$e;let Ie=null;if(Me){const Ce=Ft(t.ownerSVGElement||null),ye=Ce==null?void 0:Ce.querySelector(`#${Me}`),ve=ye==null?void 0:ye.querySelector("rect");ve&&(Ie={x:ve.getAttribute("x")||"",y:ve.getAttribute("y")||"",width:ve.getAttribute("width")||"",height:ve.getAttribute("height")||""})}return{rectString:m,clipPathAttr:F,clipId:Me,clipRect:Ie,clipPathStyle:pe,webkitClipPathStyle:j}})(),o=[],u=document.createElement("div");u.className="crop-overlay__scrim crop-overlay__scrim--top";const d=document.createElement("div");d.className="crop-overlay__scrim crop-overlay__scrim--right";const S=document.createElement("div");S.className="crop-overlay__scrim crop-overlay__scrim--bottom";const b=document.createElement("div");b.className="crop-overlay__scrim crop-overlay__scrim--left",[u,d,S,b].forEach(m=>{m.style.pointerEvents="none",i.appendChild(m)});const h=document.createElement("div");h.className="crop-frame",i.appendChild(h);const C=document.createElement("div");C.className="crop-overlay__controls";const g=document.createElement("button");g.type="button",g.className="crop-overlay__button crop-overlay__button--cancel",g.textContent="Cancel";const I=document.createElement("button");I.type="button",I.className="crop-overlay__button crop-overlay__button--apply",I.textContent="Crop",C.appendChild(g),C.appendChild(I),i.appendChild(C);const D=["top-left","top-right","bottom-left","bottom-right"],we=[],xe={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};D.forEach(m=>{const F=document.createElement("div");F.className=`crop-frame__corner crop-frame__corner--${m}`,F.dataset.corner=m,F.style.pointerEvents="auto",F.style.cursor=xe[m]||"nwse-resize";const pe=document.createElement("span");pe.className="corner-arm corner-arm--horizontal",pe.style.pointerEvents="none";const j=document.createElement("span");j.className="corner-arm corner-arm--vertical",j.style.pointerEvents="none",F.appendChild(pe),F.appendChild(j),h.appendChild(F),we.push(F)});const Z=["top","right","bottom","left"],Ae=[];Z.forEach(m=>{const F=document.createElement("div");F.className=`crop-frame__edge-handle crop-frame__edge-handle--${m}`,F.dataset.edge=m,F.style.pointerEvents="auto",F.style.cursor=m==="top"||m==="bottom"?"ns-resize":"ew-resize",h.appendChild(F),Ae.push(F)}),e.appendChild(i);let ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth,H=ue.height||e.offsetHeight,Re=G,Ke=H;if(!G||!H)return i.remove(),null;T.forEach(m=>{!m||!m.overlay||m.overlay!==e&&(m.overlay.classList.contains("editor-overlay--hidden-for-crop")||(m.overlay.classList.add("editor-overlay--hidden-for-crop"),o.push(m.overlay)))}),e.classList.add("editor-overlay--crop-active"),e.dataset.cropSessionActive="true",_e(),i.style.pointerEvents="none",h.style.pointerEvents="auto";const Je=(()=>{const m=t.dataset.cropRect;if(!m)return null;const F=m.split(",").map(pe=>Number(pe));return F.length!==4||F.some(pe=>!Number.isFinite(pe))?null:{left:r(F[0],0,1),top:r(F[1],0,1),width:r(F[2],0,1),height:r(F[3],0,1)}})(),nt=parseFloat(t.dataset.cropSourceWidth)||0,ct=parseFloat(t.dataset.cropSourceHeight)||0;let Pe,Le;const kt=()=>{Le=Math.min(G,Math.max(48,G*.08)),Pe=Math.min(H,Math.max(48,H*.08))};kt();const $={left:0,top:0,width:0,height:0};if(Je&&Je.width>0&&Je.height>0){const m=Je.width*G,F=Je.height*H;$.width=r(m,Le,G),$.height=r(F,Pe,H),$.left=r(Je.left*G,0,G-$.width),$.top=r(Je.top*H,0,H-$.height)}else{const m=nt>0&&ct>0?nt/ct:G>0&&H>0?G/H:1;let F,pe;m>=1?(F=G*.85,pe=F/m):(pe=H*.85,F=pe*m),$.width=r(F,Le,G),$.height=r(pe,Pe,H),$.left=Math.max(0,(G-$.width)/2),$.top=Math.max(0,(H-$.height)/2)}$.width=r($.width,Le,G),$.height=r($.height,Pe,H),$.left=r($.left,0,G-$.width),$.top=r($.top,0,H-$.height);const ia=()=>{const m=$.left+$.width,F=$.top+$.height;u.style.top="0px",u.style.left="0px",u.style.width="100%",u.style.height=`${Math.max(0,$.top)}px`,u.style.display=$.top>0?"block":"none",S.style.top=`${F}px`,S.style.left="0px",S.style.width="100%",S.style.height=`${Math.max(0,H-F)}px`,S.style.display=F<H?"block":"none",b.style.top=`${$.top}px`,b.style.left="0px",b.style.width=`${Math.max(0,$.left)}px`,b.style.height=`${$.height}px`,b.style.display=$.left>0?"block":"none",d.style.top=`${$.top}px`,d.style.left=`${m}px`,d.style.width=`${Math.max(0,G-m)}px`,d.style.height=`${$.height}px`,d.style.display=m<G?"block":"none"},xn=(m,F,pe,j)=>{const Te=t.ownerSVGElement;if(!Te)return;const $e=parseFloat(t.dataset.cropSourceWidth)||0,Me=parseFloat(t.dataset.cropSourceHeight)||0,Ie=parseFloat(t.dataset.cropSourceX)||0,Ce=parseFloat(t.dataset.cropSourceY)||0;let ye=$e,ve=Me,tt=Ie,wr=Ce;if(!ye||!ve){let Ge=null;try{Ge=t.getBBox()}catch{Ge=null}ye=Ge&&Number.isFinite(Ge.width)&&Ge.width>0?Ge.width:parseFloat(t.getAttribute("width"))||0,ve=Ge&&Number.isFinite(Ge.height)&&Ge.height>0?Ge.height:parseFloat(t.getAttribute("height"))||0,tt=Ge&&Number.isFinite(Ge.x)?Ge.x:parseFloat(t.getAttribute("x"))||0,wr=Ge&&Number.isFinite(Ge.y)?Ge.y:parseFloat(t.getAttribute("y"))||0}if(!ye||!ve)return;if(t instanceof HTMLImageElement){const Ge=r(F,0,1)*100,$n=r(m,0,1)*100,ua=r(1-(F+j),0,1)*100,fa=r(1-(m+pe),0,1)*100,zr=`inset(${Ge}% ${fa}% ${ua}% ${$n}%)`;t.style.clipPath=zr,t.style.webkitClipPath=zr,delete t.dataset.cropClipId,t.dataset.cropCssClip=zr;return}const qt=Ft(Te);if(!qt)return;const gt=t.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let it=qt.querySelector(`#${gt}`);it||(it=document.createElementNS(W,"clipPath"),it.id=gt,it.setAttribute("clipPathUnits","userSpaceOnUse"),qt.appendChild(it));let at=it.querySelector("rect");at||(at=document.createElementNS(W,"rect"),it.appendChild(at));const oa=ye*pe,la=ve*j,ca=tt+ye*m,da=wr+ve*F;at.setAttribute("x",ca),at.setAttribute("y",da),at.setAttribute("width",oa),at.setAttribute("height",la),t.dataset.cropClipId=gt,t.setAttribute("clip-path",`url(#${gt})`),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip},aa=()=>{if(!G||!H)return;const m=t.dataset.cropRect||"",F=typeof t.getAttribute("clip-path")=="string"&&t.getAttribute("clip-path").length>0,pe=t.ownerSVGElement,j=$.left/G,Te=$.top/H,$e=$.width/G,Me=$.height/H,Ie=r(j,0,1),Ce=r(Te,0,1),ye=r($e,0,1-Ie),ve=r(Me,0,1-Ce),tt=Ie+ye,wr=Ce+ve;if(Ie<=.001&&Ce<=.001&&tt>=.999&&wr>=.999){const gt=t.dataset.cropClipId;if(gt){const it=Ft(pe),at=it==null?void 0:it.querySelector(`#${gt}`);at==null||at.remove(),delete t.dataset.cropClipId}t.removeAttribute("clip-path"),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip,delete t.dataset.cropRect,(m||F)&&(N==null||N.schedule("image-crop"),_e());return}const qt=[Ie,Ce,ye,ve].map(gt=>gt.toFixed(6)).join(",");t.dataset.cropRect=qt,xn(Ie,Ce,ye,ve),m!==qt&&(N==null||N.schedule("image-crop"),_e())},Sn=()=>{var Ce;const m=t.dataset.cropRect||"",F=t.getAttribute("clip-path")||"",pe=t.dataset.cropClipId||"",j=t.ownerSVGElement,Te=t.dataset.cropClipId;if(Te&&Te!==a.clipId){const ye=Ft(j);(Ce=ye==null?void 0:ye.querySelector(`#${Te}`))==null||Ce.remove()}if(a.rectString){t.dataset.cropRect=a.rectString,a.clipId?t.dataset.cropClipId=a.clipId:delete t.dataset.cropClipId;const ye=a.rectString.split(",").map(ve=>Number(ve));ye.length===4&&ye.every(ve=>Number.isFinite(ve))&&xn(ye[0],ye[1],ye[2],ye[3]),a.clipPathAttr?t.setAttribute("clip-path",a.clipPathAttr):t.removeAttribute("clip-path"),a.clipPathStyle?(t.style.clipPath=a.clipPathStyle,t.dataset.cropCssClip=a.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),a.webkitClipPathStyle?t.style.webkitClipPath=a.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}else{if(delete t.dataset.cropRect,a.clipId){if(t.dataset.cropClipId=a.clipId,a.clipRect){const ye=Ft(j);if(ye){let ve=ye.querySelector(`#${a.clipId}`);ve||(ve=document.createElementNS(W,"clipPath"),ve.id=a.clipId,ve.setAttribute("clipPathUnits","userSpaceOnUse"),ye.appendChild(ve));let tt=ve.querySelector("rect");tt||(tt=document.createElementNS(W,"rect"),ve.appendChild(tt)),tt.setAttribute("x",a.clipRect.x),tt.setAttribute("y",a.clipRect.y),tt.setAttribute("width",a.clipRect.width),tt.setAttribute("height",a.clipRect.height)}}a.clipPathAttr&&t.setAttribute("clip-path",a.clipPathAttr)}else delete t.dataset.cropClipId,a.clipPathAttr?t.setAttribute("clip-path",a.clipPathAttr):t.removeAttribute("clip-path");a.clipPathStyle?(t.style.clipPath=a.clipPathStyle,t.dataset.cropCssClip=a.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),a.webkitClipPathStyle?t.style.webkitClipPath=a.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}const $e=t.dataset.cropRect||"",Me=t.getAttribute("clip-path")||"",Ie=t.dataset.cropClipId||"";(m!==$e||F!==Me||pe!==Ie)&&(N==null||N.schedule("image-crop"),_e())},ht=()=>{h.style.left=`${$.left}px`,h.style.top=`${$.top}px`,h.style.width=`${$.width}px`,h.style.height=`${$.height}px`,ia(),aa()};ht();let Oe=null,Be=null;const Dr=()=>{const m=G||(ue==null?void 0:ue.width)||(c==null?void 0:c.clientWidth)||0,F=H||(ue==null?void 0:ue.height)||(c==null?void 0:c.clientHeight)||0,pe=Math.min(m,F);return Math.max(8,Math.round(pe*.02))},Dt=(m,F)=>{const pe=[],j=Math.round(m/Ur)*Ur;pe.push(j),Number.isFinite(F)&&F>0&&pe.push(F/2);let Te=m,$e=Number.POSITIVE_INFINITY;return pe.forEach(Me=>{const Ie=Math.abs(Me-m);Ie<$e&&Ie<=Dn&&(Te=Me,$e=Ie)}),Te},kn=m=>{if(m.button!==0||m.target!==h)return;m.preventDefault(),ue=e.getBoundingClientRect();const F=ue.width||G,pe=ue.height||H;Oe={pointerId:m.pointerId,startX:m.clientX,startY:m.clientY,widthLimit:F,heightLimit:pe,startLeft:$.left,startTop:$.top},h.setPointerCapture(m.pointerId)},An=m=>{if(!Oe||m.pointerId!==Oe.pointerId)return;m.preventDefault();const F=m.clientX-Oe.startX,pe=m.clientY-Oe.startY,j=Dr(),Te=Math.max(0,Oe.widthLimit-$.width-j*2),$e=Math.max(0,Oe.heightLimit-$.height-j*2),Me=Oe.startLeft+F,Ie=Oe.startTop+pe,Ce=Dt(Me,Oe.widthLimit),ye=Dt(Ie,Oe.heightLimit);$.left=r(Ce,j,j+Te),$.top=r(ye,j,j+$e),ht()},yr=m=>{if(!(!Oe||m.pointerId!==Oe.pointerId)){try{h.releasePointerCapture(m.pointerId)}catch{}Oe=null}};h.addEventListener("pointerdown",kn),h.addEventListener("pointermove",An),h.addEventListener("pointerup",yr),h.addEventListener("pointercancel",yr);const En=()=>{Oe=null};h.addEventListener("lostpointercapture",En);const Cn=m=>{m.button===0&&(m.preventDefault(),m.stopPropagation(),ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth||G,H=ue.height||e.offsetHeight||H,kt(),Be={pointerId:m.pointerId,mode:"edge",edge:m.currentTarget.dataset.edge,anchor:{left:$.left,top:$.top,right:$.left+$.width,bottom:$.top+$.height},target:m.currentTarget},m.currentTarget.setPointerCapture(m.pointerId))},In=m=>{if(!Be||m.pointerId!==Be.pointerId||Be.mode!=="edge")return;m.preventDefault(),ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth||G,H=ue.height||e.offsetHeight||H,kt();const F=m.clientX-ue.left,pe=m.clientY-ue.top,j=Be.anchor,Te=Dr();let $e=j.left,Me=j.top,Ie=r(j.right-j.left,Le,G),Ce=r(j.bottom-j.top,Pe,H);if(Be.edge==="top"){const ye=Math.min(j.bottom-Pe,H-Pe),ve=r(pe,0,Math.max(0,ye));Me=ve,Ce=Math.max(Pe,j.bottom-ve)}else if(Be.edge==="bottom"){const ye=j.top+Pe,ve=r(pe,ye,H);Me=j.top,Ce=Math.max(Pe,ve-j.top)}else if(Be.edge==="left"){const ye=Math.min(j.right-Le,G-Le),ve=r(F,0,Math.max(0,ye));$e=ve,Ie=Math.max(Le,j.right-ve)}else if(Be.edge==="right"){const ye=j.left+Le,ve=r(F,ye,G);$e=j.left,Ie=Math.max(Le,ve-j.left)}Ie=r(Ie,Le,G),Ce=r(Ce,Pe,H),$e=Dt(r($e,Te,G-Te-Ie),G),Me=Dt(r(Me,Te,H-Te-Ce),H),$.left=$e,$.top=Me,$.width=Ie,$.height=Ce,ht()},br=m=>{var F;if(!(!Be||m.pointerId!==Be.pointerId)){try{(F=Be.target)==null||F.releasePointerCapture(m.pointerId)}catch{}Be=null,ht()}},Nn=()=>{Be=null},Ln=m=>{m.button===0&&(m.preventDefault(),m.stopPropagation(),ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth||G,H=ue.height||e.offsetHeight||H,kt(),Be={pointerId:m.pointerId,mode:"corner",corner:m.currentTarget.dataset.corner,anchor:{left:$.left,top:$.top,right:$.left+$.width,bottom:$.top+$.height},target:m.currentTarget},m.currentTarget.setPointerCapture(m.pointerId))},Tn=m=>{if(!Be||m.pointerId!==Be.pointerId||Be.mode!=="corner")return;m.preventDefault(),ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth||G,H=ue.height||e.offsetHeight||H,kt();const F=m.clientX-ue.left,pe=m.clientY-ue.top,j=Be.anchor,Te=Dr();let $e=j.left,Me=j.top,Ie=r(j.right-j.left,Le,G),Ce=r(j.bottom-j.top,Pe,H);switch(Be.corner){case"top-left":{const ye=r(F,0,j.right-Le),ve=r(pe,0,j.bottom-Pe);$e=ye,Me=ve,Ie=Math.max(Le,j.right-ye),Ce=Math.max(Pe,j.bottom-ve);break}case"top-right":{const ye=r(F,j.left+Le,G),ve=r(pe,0,j.bottom-Pe);$e=j.left,Me=ve,Ie=Math.max(Le,ye-j.left),Ce=Math.max(Pe,j.bottom-ve);break}case"bottom-left":{const ye=r(F,0,j.right-Le),ve=r(pe,j.top+Pe,H);$e=ye,Me=j.top,Ie=Math.max(Le,j.right-ye),Ce=Math.max(Pe,ve-j.top);break}case"bottom-right":{const ye=r(F,j.left+Le,G),ve=r(pe,j.top+Pe,H);$e=j.left,Me=j.top,Ie=Math.max(Le,ye-j.left),Ce=Math.max(Pe,ve-j.top);break}default:return}Ie=r(Ie,Le,G),Ce=r(Ce,Pe,H),$e=Dt(r($e,Te,G-Te-Ie),G),Me=Dt(r(Me,Te,H-Te-Ce),H),$.left=$e,$.top=Me,$.width=Ie,$.height=Ce,ht()},vr=m=>{var F;if(!(!Be||m.pointerId!==Be.pointerId)){try{(F=Be.target)==null||F.releasePointerCapture(m.pointerId)}catch{}Be=null,ht()}},Fn=()=>{Be=null};Ae.forEach(m=>{m.addEventListener("pointerdown",Cn),m.addEventListener("pointermove",In),m.addEventListener("pointerup",br),m.addEventListener("pointercancel",br),m.addEventListener("lostpointercapture",Nn)}),we.forEach(m=>{m.addEventListener("pointerdown",Ln),m.addEventListener("pointermove",Tn),m.addEventListener("pointerup",vr),m.addEventListener("pointercancel",vr),m.addEventListener("lostpointercapture",Fn)});const _n=m=>{m.preventDefault(),m.stopPropagation(),Sn(),ft()},Bn=m=>{m.preventDefault(),m.stopPropagation(),ht()};g.addEventListener("click",_n),I.addEventListener("click",Bn);const Rn=m=>{m.key==="Escape"&&(m.preventDefault(),Sn(),ft()),m.key==="Enter"&&(m.metaKey||m.ctrlKey)&&(m.preventDefault(),ht(),ft())};document.addEventListener("keydown",Rn);const qr=()=>{if(ue=e.getBoundingClientRect(),G=ue.width||e.offsetWidth||G,H=ue.height||e.offsetHeight||H,!G||!H)return;kt();const m=t.dataset.cropRect||null;if(m){const F=m.split(",").map(pe=>Number(pe));if(F.length===4&&F.every(pe=>Number.isFinite(pe))){const pe=r(F[2]*G,Le,G),j=r(F[3]*H,Pe,H),Te=r(F[0]*G,0,G-pe),$e=r(F[1]*H,0,H-j);$.left=Te,$.top=$e,$.width=pe,$.height=j}}else{const F=Re?$.width/Re:1,pe=Ke?$.height/Ke:1,j=Re?$.left/Re:0,Te=Ke?$.top/Ke:0;$.width=r(F*G,Le,G),$.height=r(pe*H,Pe,H),$.left=r(j*G,0,G-$.width),$.top=r(Te*H,0,H-$.height)}Re=G,Ke=H,ht()};return window.addEventListener("resize",qr),{overlay:e,refresh:qr,teardown:()=>{var m;if(Oe&&typeof Oe.pointerId<"u"){try{h.releasePointerCapture(Oe.pointerId)}catch{}Oe=null}if(Be&&typeof Be.pointerId<"u"){try{(m=Be.target)==null||m.releasePointerCapture(Be.pointerId)}catch{}Be=null}window.removeEventListener("resize",qr),h.removeEventListener("pointerdown",kn),h.removeEventListener("pointermove",An),h.removeEventListener("pointerup",yr),h.removeEventListener("pointercancel",yr),h.removeEventListener("lostpointercapture",En),Ae.forEach(F=>{F.removeEventListener("pointerdown",Cn),F.removeEventListener("pointermove",In),F.removeEventListener("pointerup",br),F.removeEventListener("pointercancel",br),F.removeEventListener("lostpointercapture",Nn)}),we.forEach(F=>{F.removeEventListener("pointerdown",Ln),F.removeEventListener("pointermove",Tn),F.removeEventListener("pointerup",vr),F.removeEventListener("pointercancel",vr),F.removeEventListener("lostpointercapture",Fn)}),g.removeEventListener("click",_n),I.removeEventListener("click",Bn),document.removeEventListener("keydown",Rn),e.classList.remove("editor-overlay--crop-active"),delete e.dataset.cropSessionActive,o.forEach(F=>F.classList.remove("editor-overlay--hidden-for-crop")),o.length=0,_e(),i.parentNode===e?e.removeChild(i):i.remove()}}},Wt=()=>{je||He||st?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},jt=()=>{T.forEach(({overlay:e,type:t})=>{var a;if(!e)return;const r=((a=e.dataset)==null?void 0:a.previewNode)||"",n=!!je&&r===je&&t==="text",i=!!He&&r===He&&t==="image";e.classList.toggle("editor-overlay--selected",n||i)})},Qe=()=>st?"background":He?"image":je?"text":null,Tr=e=>{if(typeof e!="string")return null;const t=e.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!t)return null;const r=Number(t[1]),n=Number(t[2]),i=Number(t[3]);if([r,n,i].some(o=>Number.isNaN(o)||o<0||o>255))return null;const a=o=>o.toString(16).padStart(2,"0");return`#${a(r)}${a(n)}${a(i)}`.toUpperCase()};function ci(e){var t;try{if(e==="background"){if(!c)return null;const n=window.getComputedStyle(c).backgroundColor||c.style.backgroundColor||"";return Tt(n)||Tr(n)||null}if(e==="text"){const r=Rt();if(!r.length)return null;const n=r[0],i=n.getAttribute("fill")||n.style.fill||n.dataset.color||"";return Tt(i)||Tr(i)||null}if(e==="image"){const r=Nt();if(!r.length)return null;const i=((t=r[0].dataset)==null?void 0:t.tintColor)||"";return Tt(i)||null}}catch{return null}return null}const Ht=()=>{if(typeof window>"u")return;const e=Qe(),t=e==="text"?je:e==="image"?He:null,r=ci(e);try{const n=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t,color:r}});window.dispatchEvent(n)}catch{if(typeof document<"u"&&document.createEvent){const i=document.createEvent("CustomEvent");i.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t,color:r}),window.dispatchEvent(i)}}},wt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;je===t&&!He||(ft(),je=t,t&&(He=null,st=!1),jt(),Wt(),Ht())},xt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;He===t&&!je||(He!==t&&ft(),He=t,t&&(je=null,st=!1),jt(),Wt(),Ht())},di=()=>{st||(ft(),st=!0,je=null,He=null,jt(),Wt(),Ht())},Rt=()=>{if(!je)return[];const e=J||l||document;if(!e)return[];const t=`[data-preview-node="${je}"]`,r=new Set;return e.querySelectorAll(t).forEach(n=>{if(!n||P(n))return;const i=(n.tagName||"").toLowerCase();if(i==="tspan"||i==="g"){const a=n.closest("text");if(a){r.add(a);return}}r.add(n)}),Array.from(r)},Nt=()=>{if(!He)return[];const e=J||l||document;if(!e)return[];const t=`[data-preview-node="${He}"]`;let r=new Set;return e.querySelectorAll(t).forEach(n=>{const i=ce(n);i&&r.add(i)}),r.size===0&&e!==document&&document.querySelectorAll(t).forEach(n=>{const i=ce(n);i&&r.add(i)}),Array.from(r)},$t=()=>rn(je),Lt=(e,t,r)=>{const n=Number(e);return Number.isFinite(n)?Math.min(Math.max(n,t),r):t},Tt=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},cr=e=>{var a,o;if(!e||typeof e.getBBox!="function")return;const t=[],r=Number(((a=e.dataset)==null?void 0:a.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(r)&&r!==0)try{const u=e.getBBox(),d=u.x+u.width/2,S=u.y+u.height/2;t.push(`rotate(${r} ${d} ${S})`)}catch{t.push(`rotate(${r})`)}((o=e.dataset)==null?void 0:o.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const i=t.join(" ").trim();i?e.setAttribute("transform",i):e.removeAttribute("transform")},Ye=(e,t={})=>{const r=Rt();if(!r.length)return!1;if(r.forEach(n=>{try{e(n)}catch(i){console.warn("[InkWise Studio] Toolbar mutation failed.",i)}}),t.skipTransformUpdate||r.forEach(n=>{try{cr(n)}catch{}}),t.skipOverlaySync||_e(),t.autosaveReason!==!1){const n=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";N==null||N.schedule(n)}return!0},pt=(e,t={})=>{const r=Nt();if(!r.length)return!1;if(r.forEach(n=>{try{e(n)}catch(i){console.warn("[InkWise Studio] Image mutation failed.",i)}}),t.skipTransformUpdate||r.forEach(n=>{try{cr(n)}catch{}}),t.skipOverlaySync||_e(),t.autosaveReason!==!1){const n=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";N==null||N.schedule(n)}return!0},Ft=(e=null)=>{var n;let t=J;if(!t&&e&&(t=e),!t)return null;if(typeof t.tagName=="string"&&t.tagName.toLowerCase()!=="svg"){const i=(n=t.closest)==null?void 0:n.call(t,"svg");i?t=i:e&&e!==t&&(t=e)}if(!t)return null;let r=t.querySelector('defs[data-inkwise-runtime="true"]');return r||(r=document.createElementNS(W,"defs"),r.setAttribute("data-inkwise-runtime","true"),t.insertBefore(r,t.firstChild||null)),r},dr=e=>{const t=e.dataset.previewTarget;if(!t)return;const r=document.querySelector(`[data-preview-node="${t}"]`),n=r?r.dataset.defaultText||r.textContent:"",i=()=>{if(!r)return;const a=e.value.trim();r.textContent=a||n||"",_e()};e.dataset.defaultValue||(e.dataset.defaultValue=n||""),e.addEventListener("focus",()=>{wt(t)}),e.addEventListener("input",()=>{i(),N==null||N.schedule("text-change")}),i()};s.forEach(dr);const ui=(e,t="")=>{const r=normalizeSideKey(Xe),n=er(t),i=document.createElement("div");i.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",i.appendChild(a);const o=document.createElement("input");o.type="text",o.className="text-field-input",o.placeholder="Add your text",o.dataset.previewTarget=e,o.dataset.templateSide=r,o.value=n,o.dataset.defaultValue=n||"",setStoredTextValue(r,e,n),captureDefaultTextValue(r,e,n),i.appendChild(o);const u=document.createElement("button");if(u.type="button",u.className="text-field-delete",u.setAttribute("aria-label","Delete field"),u.innerHTML='<i class="fa-regular fa-trash-can"></i>',i.appendChild(u),A.appendChild(i),x){const d=document.createElement("div");d.className="pill",d.dataset.previewNode=e,d.dataset.defaultText=t||"CUSTOM TEXT",d.textContent=t||"CUSTOM TEXT",x.appendChild(d)}return dr(o),ur(i),N==null||N.schedule("add-text-field"),o},Ot=()=>{l&&(tr(),J=null,qe=null,l.innerHTML="",l.style.display="none")},fi=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},Fr=e=>{if(!e)return;const t=n=>{var a,o,u;let i=(n==null?void 0:n.parentNode)||null;for(;i;){const d=typeof i.getAttribute=="function"?i.getAttribute("fill"):null,S=(a=i.style)==null?void 0:a.fill,b=((o=i.dataset)==null?void 0:o.color)||((u=i.dataset)==null?void 0:u.defaultColor)||null,f=d||S||b;if(f&&f!=="none"&&f!=="transparent")return f;i=i.parentNode||null}return null};e.querySelectorAll("text, tspan").forEach(n=>{var h,C;n.removeAttribute("opacity"),n.style.opacity="1",n.style&&n.style.mixBlendMode&&(n.style.mixBlendMode="normal");const i=n.getAttribute("fill"),a=(h=n.style)==null?void 0:h.fill,o=(C=n.dataset)==null?void 0:C.color;let u=i&&i!=="none"?i:null;if((!u||u==="transparent")&&a&&a!=="none"&&(u=a),(!u||u==="transparent")&&o&&o!=="none"&&(u=o),(!u||u==="transparent")&&typeof window<"u"&&typeof window.getComputedStyle=="function")try{const g=window.getComputedStyle(n).fill;g&&g!=="none"&&g!=="transparent"&&(u=g)}catch{}if(!u||u==="transparent"||u==="none"){const g=t(n);g&&g!=="none"&&g!=="transparent"&&(u=g)}const d=Tt(u||"")||Tr(u||"")||(u&&u!=="none"&&u!=="transparent"?u:null),b=d||"#111111";n.setAttribute("fill",b),n.style&&(n.style.fill=b,n.style.fillOpacity="1",n.style.strokeOpacity="1"),n.dataset&&(n.dataset.color=b,d&&(n.dataset.defaultColor=d)),n.removeAttribute("fill-opacity"),n.removeAttribute("stroke-opacity"),n.getAttribute("stroke")||n.setAttribute("stroke","none"),n.getAttribute("paint-order")||n.setAttribute("paint-order","stroke fill");const f=n.getAttribute("font-family")||n.style.fontFamily;if(f){const g=f.toLowerCase().replace(/[^a-z]/g,"");g.includes("greatvibes")?n.setAttribute("font-family","Great Vibes"):g.includes("poppins")&&n.setAttribute("font-family","Poppins")}})},pi=async e=>{var t,r;if(!l||!e)return Ot(),!1;try{let n="";if(e.startsWith("data:image/svg+xml")){const g=e.indexOf(","),I=g>=0?e.slice(0,g):e,D=g>=0?e.slice(g+1):"";if(/;base64/i.test(I))try{const xe=D.replace(/\s+/g,"");n=typeof window<"u"&&typeof window.atob=="function"?window.atob(xe):atob(xe)}catch(xe){try{n=decodeURIComponent(D)}catch(Z){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",xe,Z),n=""}}else try{n=decodeURIComponent(D)}catch{n=D}}else{const g=await fetch(e,{cache:"no-store"});if(!g.ok)return console.warn("Failed to fetch SVG:",g.status),Ot(),!1;n=await g.text()}if(!n)return Ot(),!1;l.innerHTML=n,l.style.display="block";const i=document.getElementById("canvas-loading");i&&(i.style.display="none"),l.setAttribute("preserveAspectRatio","xMidYMid meet"),l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.style.width="100%",l.style.height="100%",l.style.maxWidth="100%",l.style.maxHeight="100%";const a=l.querySelector("svg");a?(a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",J=a):J=l,J&&(me(J),Fr(J)),J&&(J.setAttribute("data-svg-editor","true"),J.__inkwiseSvgTemplateEditor||(J.__inkwiseSvgTemplateEditor=new Kt(J)),qe=J.__inkwiseSvgTemplateEditor);const u=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;let d=Or(u==null?void 0:u.getAttribute("width")),S=Or(u==null?void 0:u.getAttribute("height"));if(!Number.isFinite(d)||!Number.isFinite(S)){const g=u==null?void 0:u.getAttribute("viewBox");if(g){const I=g.split(/[\s,]+/).map(Number),D=I[2],we=I[3];!Number.isNaN(D)&&!Number.isNaN(we)&&D>0&&we>0&&(d=D,S=we)}}let b=Number.isFinite(d)?d:Number.NaN,f=Number.isFinite(S)?S:Number.NaN;if(be&&Number.isFinite(be.width)&&Number.isFinite(be.height)){const g=be.width/be.height,I=Number.isFinite(b)&&Number.isFinite(f)?b/f:g,D=Math.abs(I-g)/g,we=Number.isFinite(b)?Math.abs(b-be.width)/be.width:Number.POSITIVE_INFINITY,xe=Number.isFinite(f)?Math.abs(f-be.height)/be.height:Number.POSITIVE_INFINITY;(!Number.isFinite(b)||!Number.isFinite(f)||D>.02||we>.05&&xe>.05)&&(b=be.width,f=be.height)}if(Number.isFinite(b)&&Number.isFinite(f)){const g=(be==null?void 0:be.unit)??"px";ir(b,f,{unit:g,shape:be==null?void 0:be.shape}),ar(rt(b,g),rt(f,g),"in",2)}const h=Gr(l);if(tr(),A){A.innerHTML="";const g=(D,we="",xe="")=>{const Z=document.createElement("div");Z.className="text-field-item";const Ae=document.createElement("span");Ae.className="text-field-label",Ae.textContent=xe||D,Z.appendChild(Ae);const ue=document.createElement("input");ue.type="text",ue.className="text-field-input",ue.dataset.previewTarget=D,ue.value=we||"",ue.dataset.defaultValue=we||"",Z.appendChild(ue);const G=document.createElement("button");return G.type="button",G.className="text-field-delete",G.setAttribute("aria-label","Delete field"),G.innerHTML='<i class="fa-regular fa-trash-can"></i>',Z.appendChild(G),A.appendChild(Z),dr(ue),ur(Z),ue},I=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([we,xe])=>g(we,"",xe))};if(h.length>0){let D=!1;const we=new Set,xe=new Set;h.forEach(Z=>{var H,Re;const Ae=Z.getAttribute("data-preview-node");if(!Ae||we.has(Ae))return;we.add(Ae);const ue=P(Z);if(Ee(Z)){D=!0;const Ke=((H=Z.dataset)==null?void 0:H.previewLabel)||Ae,Je=((Re=Z.dataset)==null?void 0:Re.defaultText)||K(Z)||"",nt=(Ke||"").toString().trim().toLowerCase(),ct=(Je||"").toString().trim().toLowerCase(),Pe=`${nt}|${ct}`;if(nt&&xe.has(Pe))return;nt&&xe.add(Pe),g(Ae,Je,Ke)}}),D||I()}else I()}const C=(r=(t=oe==null?void 0:oe.orderSummary)==null?void 0:t.metadata)==null?void 0:r.design;return C&&mt(C),h.forEach(g=>{const I=g.getAttribute("data-preview-node");if(!I)return;const D=P(g),we=Ee(g);D&&g.setAttribute("data-changeable","image"),lt(g)&&ut(g),we?(g.setAttribute("contenteditable","true"),g.style.cursor="text",g.style.userSelect="text",g.addEventListener("input",()=>{const Ae=document.querySelector(`#textFieldList input[data-preview-target="${I}"]`);Ae&&(Ae.value=K(g)),g.dataset.currentText=K(g)||"",_e(),N==null||N.schedule("text-edit")}),g.addEventListener("click",()=>{wt(I),fr(I)})):D&&(g.style.cursor="pointer",g.addEventListener("click",()=>{g.dataset.locked!=="true"&&(xt(I),Ut(g))}));const Z=document.querySelector(`#textFieldList input[data-preview-target="${I}"]`);Z&&we&&(Z.addEventListener("input",()=>{se(g,Z.value),N==null||N.schedule("text-change")}),Z.value&&Z.value.trim()!==""?se(g,Z.value):Z.value=K(g)||"")}),requestAnimationFrame(()=>_e()),rr(10),!0}catch(n){return console.warn("Could not load SVG for binding:",n),Ot(),!1}},an=async(e,t)=>{if(!e||!t)return!1;try{let r="";if(t.startsWith("data:image/svg+xml")){const o=t.indexOf(","),u=o>=0?t.slice(0,o):t,d=o>=0?t.slice(o+1):"";if(/;base64/i.test(u))try{const b=d.replace(/\s+/g,"");r=typeof window<"u"&&typeof window.atob=="function"?window.atob(b):atob(b)}catch(b){try{r=decodeURIComponent(d)}catch(f){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",b,f),r=""}}else try{r=decodeURIComponent(d)}catch{r=d}}else{const o=await fetch(t,{cache:"no-store"});if(!o.ok)return console.warn("Failed to fetch SVG:",o.status),!1;r=await o.text()}if(!r)return!1;e.innerHTML="";const a=new DOMParser().parseFromString(r,"image/svg+xml").documentElement;if(a&&a.tagName.toLowerCase()==="svg"){const o=a.getAttribute("viewBox");for(o&&e.setAttribute("viewBox",o);a.firstChild;)e.appendChild(a.firstChild);return e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.style.width="100%",e.style.height="100%",e.style.maxWidth="100%",e.style.maxHeight="100%",Fr(e),!0}return!1}catch(r){return console.warn("Could not populate SVG element:",r),!1}},hi=async(e={})=>{var Z,Ae,ue,G;const{scale:t=3,filename:r="inkwise-template.png",download:n=!0}=e,i=J||l;if(!i)throw new Error("No active canvas to export.");me(i);const o=new XMLSerializer().serializeToString(i),u=H=>{const Re=Number(H);return Number.isFinite(Re)?Re:null},d=(i.getAttribute("viewBox")||"").split(/[\s,]+/).map(u),S=d.length===4?d[2]:null,b=d.length===4?d[3]:null,f=u((Z=c==null?void 0:c.dataset)==null?void 0:Z.canvasWidth)||u((Ae=X==null?void 0:X.dataset)==null?void 0:Ae.canvasWidth)||S||1080,h=u((ue=c==null?void 0:c.dataset)==null?void 0:ue.canvasHeight)||u((G=X==null?void 0:X.dataset)==null?void 0:G.canvasHeight)||b||1527,C=Math.max(1,Math.round(f*Math.max(1,t))),g=Math.max(1,Math.round(h*Math.max(1,t))),I=new Image;I.crossOrigin="anonymous",I.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(o)}`,await new Promise((H,Re)=>{I.onload=H,I.onerror=Re});const D=document.createElement("canvas");D.width=C,D.height=g;const we=D.getContext("2d");we.fillStyle="#ffffff",we.fillRect(0,0,C,g),we.drawImage(I,0,0,C,g);const xe=D.toDataURL("image/png",1);if(n){const H=document.createElement("a");H.href=xe,H.download=r,H.click()}return{dataUrl:xe,width:C,height:g}};typeof window<"u"&&(window.inkwiseExportCurrentSide=(e={})=>hi(e));const ur=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),r=e.querySelector("input[data-preview-target]");if(!t||!r||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const i=r.dataset.previewTarget;if(e.remove(),x){const a=x.querySelector(`[data-preview-node="${i}"]`);a==null||a.remove()}if(J){const a=J.querySelector(`[data-preview-node="${i}"]`);a==null||a.remove()}deleteStoredTextValue(normalizeSideKey(Xe),i),N==null||N.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>ur(e));const fr=e=>{if(!e)return;Vr(),Xr("text"),E.forEach(r=>r.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const r=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(r){try{r.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const a=document.getElementById("textFieldList");a&&(a.scrollTop=r.offsetTop-12)}r.focus({preventScroll:!1});return}const n=document.querySelector("[data-add-text-field]");n==null||n.focus({preventScroll:!1})},60)};Ze=fr;const Mt=async e=>{if(!qn(e)||(Xe=e,!c))return;if(!l&&U&&O){const i=e==="front"?U:O;return i&&(J=i,J.__inkwiseSvgTemplateEditor||(J.__inkwiseSvgTemplateEditor=new Kt(J)),qe=J.__inkwiseSvgTemplateEditor,tr(),Gr(J).forEach(o=>{lt(o)&&ut(o)}),w.forEach(o=>{o.classList.toggle("active",o.dataset.cardView===e)}),p.forEach(o=>{const u=o.dataset.cardThumb===e;o.classList.toggle("active",u),o.setAttribute("aria-pressed",u?"true":"false")})),Promise.resolve()}let t="",r="";e==="front"&&Ct?(t=Ct,r=Ct):e==="back"&&yt?(t=yt,r=yt):(r=c.dataset[`${e}Svg`]||"",t=c.dataset[`${e}Image`]||"");let n=!1;if(r&&fi(r)&&await pi(r)&&(n=!0,c.style.backgroundImage="none",c.style.backgroundSize="",Fr(J)),!n){const i=t||c.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,i||"<empty>"),Ot(),c.style.backgroundImage=i?`url('${i}')`:"",c.style.backgroundSize=i?"cover":"",c.style.backgroundPosition=i?"center center":"",c.style.backgroundRepeat=i?"no-repeat":"",i&&Jn(i),tr(),J=null}w.forEach(i=>{i.classList.toggle("active",i.dataset.cardView===e)}),p.forEach(i=>{const a=i.dataset.cardThumb===e;i.classList.toggle("active",a),i.setAttribute("aria-pressed",a?"true":"false")})};w.forEach(e=>{e.addEventListener("click",()=>{Mt(e.dataset.cardView)})}),p.forEach(e=>{e.addEventListener("click",()=>{Mt(e.dataset.cardThumb)})});try{await Promise.all([Y,B])}catch(e){console.warn("[InkWise Studio] One or more grid SVGs failed to populate:",e)}const _r=Mt("front");_r&&typeof _r.then=="function"?_r.catch(()=>{}).then(()=>{rr(6),N==null||N.schedule("initial-load")}):(rr(6),N==null||N.schedule("initial-load"));const sn=document.querySelector(".preview-overlay")||document.querySelector(".preview-canvas-wrapper");sn&&sn.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const r=t.dataset.previewNode;r&&(P(t)?xt(r):(wt(r),fr(r)))}}),k&&A&&k.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${q}`;q+=1;const t=document.createElement("div");t.className="text-field-item";const r=document.createElement("span");r.className="text-field-label",r.textContent="Custom",t.appendChild(r);const n=document.createElement("input");n.type="text",n.className="text-field-input",n.placeholder="Add your text",n.dataset.previewTarget=e,t.appendChild(n);const i=document.createElement("button");if(i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(i),A.appendChild(t),x){const o=document.createElement("div");o.className="pill",o.dataset.previewNode=e,o.dataset.defaultText="CUSTOM TEXT",o.textContent="CUSTOM TEXT",x.appendChild(o)}let a=null;console.log("[InkWise Studio] currentSvgRoot:",J),J?(console.log("[InkWise Studio] Creating SVG text element"),a=document.createElementNS("http://www.w3.org/2000/svg","text"),a.setAttribute("id",e),a.setAttribute("data-preview-node",e),a.setAttribute("data-default-text","CUSTOM TEXT"),a.setAttribute("x","50%"),a.setAttribute("y","50%"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","middle"),a.setAttribute("font-family","Arial, sans-serif"),a.setAttribute("font-size","24"),a.setAttribute("fill","#000000"),a.textContent="CUSTOM TEXT",a.setAttribute("contenteditable","true"),a.style.cursor="text",a.style.userSelect="text",a.addEventListener("input",()=>{n&&(n.value=a.textContent),a.dataset.currentText=a.textContent||"",_e(),N==null||N.schedule("text-edit")}),a.addEventListener("click",()=>{wt(e),fr(e)}),J.appendChild(a),lt(a)&&ut(a),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),dr(n),n.addEventListener("input",()=>{a&&(a.textContent=n.value,a.dataset.currentText=n.value),N==null||N.schedule("text-change")}),wt(e),a&&a.textContent&&a.textContent.trim()!==""?n.value=a.textContent:(n.value="CUSTOM TEXT",a&&(a.textContent="CUSTOM TEXT")),ur(t),setTimeout(()=>{try{A.scrollHeight>A.clientHeight&&A.scrollTo({top:A.scrollHeight,behavior:"smooth"})}catch{A.scrollTop=A.scrollHeight}n.focus({preventScroll:!1})},60)}),Ct=null,yt=null,Xe="front";const Gt=document.getElementById("image-upload"),on=document.getElementById("upload-button"),ln=document.getElementById("quick-upload-button"),pr=document.getElementById("recentUploadsGrid"),hr=document.getElementById("quickRecentUploads"),Br="inkwise_recent_uploads",cn=12,Rr=()=>{try{const e=localStorage.getItem(Br);return e?JSON.parse(e):[]}catch{return[]}},gi=(e,t,r)=>{const n=Rr(),i={id:Date.now(),dataUrl:e,filename:t,side:r,timestamp:new Date().toISOString()},a=n.filter(u=>u.filename!==t);a.unshift(i);const o=a.slice(0,cn);try{localStorage.setItem(Br,JSON.stringify(o))}catch{const d=o.slice(0,Math.floor(cn/2));localStorage.setItem(Br,JSON.stringify(d))}un(),fn()},dn=(e,t,r="front")=>{var n;if(e&&(gi(e,t||`upload-${Date.now()}`,r),!(He&&pt(a=>{a.setAttribute("href",e),a.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},{autosaveReason:"image-upload"})))){if(J){const i=((n=J.tagName)==null?void 0:n.toLowerCase())==="svg"?J:J.closest("svg");if(i){const a=i.getAttribute("viewBox");let o=200,u=200,d=150;if(a){const h=a.split(/[\s,]+/).map(Number);h.length===4&&h.every(Number.isFinite)&&(o=h[0]+h[2]/2,u=h[1]+h[3]/2,d=Math.min(h[2],h[3])*.3)}const S=`uploaded_${Date.now()}`,b=document.createElementNS("http://www.w3.org/2000/svg","image");b.setAttribute("id",S),b.setAttribute("data-preview-node",S),b.setAttribute("href",e),b.setAttributeNS("http://www.w3.org/1999/xlink","href",e),b.setAttribute("x",String(o-d/2)),b.setAttribute("y",String(u-d/2)),b.setAttribute("width",String(d)),b.setAttribute("height",String(d)),b.setAttribute("preserveAspectRatio","xMidYMid meet"),i.appendChild(b),lt(b)&&ut(b),xt(S),N==null||N.schedule("image-upload");return}}r==="front"?Ct=e:r==="back"&&(yt=e),Xe===r&&Mt(r),N==null||N.schedule("image-upload")}},un=()=>{if(!pr)return;const e=Rr();if(e.length===0){pr.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(n=>`
            <div class="recent-upload-item" data-upload-id="${n.id}" data-image-url="${n.dataUrl}" data-side="${n.side}">
                <img src="${n.dataUrl}" alt="${n.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${n.filename}</span>
                </div>
            </div>
        `).join("");pr.innerHTML=t;const r=pr.querySelectorAll(".recent-upload-item");r.forEach(n=>{n.addEventListener("click",()=>{var o;const i=n.dataset.imageUrl;if(r.forEach(u=>u.classList.remove("selected")),n.classList.add("selected"),He&&pt(d=>{d.setAttribute("href",i),d.setAttributeNS("http://www.w3.org/1999/xlink","href",i)},{autosaveReason:"image-select"})){n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150);return}if(J){const u=((o=J.tagName)==null?void 0:o.toLowerCase())==="svg"?J:J.closest("svg");if(u){const d=u.getAttribute("viewBox");let S=200,b=200,f=150;if(d){const I=d.split(/[\s,]+/).map(Number);I.length===4&&I.every(Number.isFinite)&&(S=I[0]+I[2]/2,b=I[1]+I[3]/2,f=Math.min(I[2],I[3])*.3)}const h=`uploaded_${Date.now()}`,C=document.createElementNS("http://www.w3.org/2000/svg","image");C.setAttribute("id",h),C.setAttribute("data-preview-node",h),C.setAttribute("href",i),C.setAttributeNS("http://www.w3.org/1999/xlink","href",i),C.setAttribute("x",String(S-f/2)),C.setAttribute("y",String(b-f/2)),C.setAttribute("width",String(f)),C.setAttribute("height",String(f)),C.setAttribute("preserveAspectRatio","xMidYMid meet"),u.appendChild(C),lt(C)&&ut(C),xt(h),N==null||N.schedule("image-select"),n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150);return}}const a=n.dataset.side;a==="front"?Ct=i:yt=i,Xe===a&&Mt(a),n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150),N==null||N.schedule("image-select")})})},fn=()=>{if(!hr)return;const t=Rr().slice(0,5);if(t.length===0){hr.innerHTML="";return}const r=t.map(i=>`
            <div class="quick-recent-upload-item" data-upload-id="${i.id}" data-image-url="${i.dataUrl}" data-side="${i.side}" title="${i.filename}">
                <img src="${i.dataUrl}" alt="${i.filename}" loading="lazy">
            </div>
        `).join("");hr.innerHTML=r;const n=hr.querySelectorAll(".quick-recent-upload-item");n.forEach(i=>{i.addEventListener("click",()=>{var u;const a=i.dataset.imageUrl;if(n.forEach(d=>d.classList.remove("selected")),i.classList.add("selected"),He&&pt(S=>{S.setAttribute("href",a),S.setAttributeNS("http://www.w3.org/1999/xlink","href",a)},{autosaveReason:"image-select"})){i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150);return}if(J){const d=((u=J.tagName)==null?void 0:u.toLowerCase())==="svg"?J:J.closest("svg");if(d){const S=d.getAttribute("viewBox");let b=200,f=200,h=150;if(S){const D=S.split(/[\s,]+/).map(Number);D.length===4&&D.every(Number.isFinite)&&(b=D[0]+D[2]/2,f=D[1]+D[3]/2,h=Math.min(D[2],D[3])*.3)}const C=`uploaded_${Date.now()}`,g=document.createElementNS("http://www.w3.org/2000/svg","image");g.setAttribute("id",C),g.setAttribute("data-preview-node",C),g.setAttribute("href",a),g.setAttributeNS("http://www.w3.org/1999/xlink","href",a),g.setAttribute("x",String(b-h/2)),g.setAttribute("y",String(f-h/2)),g.setAttribute("width",String(h)),g.setAttribute("height",String(h)),g.setAttribute("preserveAspectRatio","xMidYMid meet"),d.appendChild(g),lt(g)&&ut(g),xt(C),N==null||N.schedule("image-select"),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150);return}}const o=i.dataset.side;o==="front"?Ct=a:yt=a,Xe===o&&Mt(o),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150),N==null||N.schedule("image-select")})})},mi=e=>{const t=e.files[0];if(!t)return;const r=new FileReader;r.onload=n=>{const i=n.target.result;dn(i,t.name,"front")},r.readAsDataURL(t)};Gt&&Gt.addEventListener("change",()=>mi(Gt)),on&&on.addEventListener("click",()=>{Gt.click()}),ln&&ln.addEventListener("click",()=>{Gt.click()});const yi=e=>{var r;const t=(r=e.clipboardData)==null?void 0:r.items;if(!(!t||t.length===0))for(const n of t){if(!n||typeof n.type!="string"||!n.type.startsWith("image/"))continue;const i=n.getAsFile();if(!i)continue;const a=new FileReader;a.onload=o=>{const u=o.target.result,d=i.name||`pasted-${Date.now()}.png`;dn(u,d,Xe||"front")},a.readAsDataURL(i),e.preventDefault();break}};un(),fn(),document.addEventListener("paste",yi);const $r=document.querySelectorAll(".pill-with-tooltip"),Mr=document.querySelector(".preview-canvas-wrapper"),Pr=document.querySelector(".preview-guides"),pn=(e,t)=>{e==="safety-pill"&&(Mr==null||Mr.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(Pr==null||Pr.classList.toggle("highlight-bleed",t))},gr=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),r=e==null?void 0:e.querySelector(".tooltip");!t||!r||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),r.setAttribute("aria-hidden","true"),pn(t.id,!1))};$r.forEach(e=>{const t=e.querySelector(".canvas-pill"),r=e.querySelector(".tooltip");!t||!r||(t.addEventListener("click",n=>{n.preventDefault();const i=!e.classList.contains("is-active");$r.forEach(a=>{a!==e&&gr(a)}),i?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),r.setAttribute("aria-hidden","false"),pn(t.id,!0)):gr(e)}),t.addEventListener("mouseenter",()=>{r.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{r.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||r.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&r.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",n=>{n.key==="Escape"&&(gr(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||$r.forEach(r=>gr(r))});const bi=e=>{if(!e)return!1;const t=Ye(r=>{r.setAttribute("font-family",e),r.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const r=$t();r&&(r.dataset.fontFamily=e)}return t},vi=e=>{const t=Lt(e,6,400),r=Ye(n=>{n.setAttribute("font-size",t),n.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(r){const n=$t();n&&(n.dataset.fontSize=String(t))}return r},wi=e=>{const t=Lt(e,8,400),r=39;return pt(n=>{const i=typeof n.getBBox=="function"?n.getBBox():null,a=parseFloat(n.getAttribute("width")),o=parseFloat(n.getAttribute("height")),u=Number(n.dataset.baseWidth)||(Number.isFinite(a)?a:(i==null?void 0:i.width)||1),d=Number(n.dataset.baseHeight)||(Number.isFinite(o)?o:(i==null?void 0:i.height)||1);n.dataset.baseWidth||(n.dataset.baseWidth=u),n.dataset.baseHeight||(n.dataset.baseHeight=d);const S=t/r,b=Math.max(1,u*S),f=Math.max(1,d*S);n.setAttribute("width",b),n.setAttribute("height",f)},{autosaveReason:"image-scale"})},xi=e=>{const t=Tt(e);if(!t)return!1;const r=Ye(n=>{n.setAttribute("fill",t),n.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(r){const n=$t();n&&(n.dataset.color=t)}return r},Si=e=>{const t=Tt(e);if(!t||!c)return!1;try{return c.style.backgroundColor=t,c.dataset.backgroundColor=t,N==null||N.schedule("background-color"),!0}catch(r){return console.warn("[InkWise Studio] Failed to apply background color",r),!1}},ki=e=>{if(!e||!c)return!1;try{return c.style.backgroundImage=`url(${e})`,c.style.backgroundSize="cover",c.style.backgroundPosition="center",c.style.backgroundRepeat="no-repeat",c.dataset.backgroundImage=e,N==null||N.schedule("background-image"),!0}catch(t){return console.warn("[InkWise Studio] Failed to apply background image",t),!1}},Ai=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)}),Ei=e=>{const t=Tt(e);return t?pt(r=>{if(t==="#FFFFFF"){const h=r.dataset.tintFilterId;if(h){const C=Ft(r.ownerSVGElement||null),g=C==null?void 0:C.querySelector(`#${h}`);g==null||g.remove(),delete r.dataset.tintFilterId}r.removeAttribute("filter");try{delete r.dataset.tintColor}catch{}return}const n=Ft(r.ownerSVGElement||null);if(!n)return;const i=r.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,a=parseInt(t.slice(1,3),16)/255,o=parseInt(t.slice(3,5),16)/255,u=parseInt(t.slice(5,7),16)/255;let d=n.querySelector(`#${i}`);if(!d){d=document.createElementNS(W,"filter"),d.id=i,d.setAttribute("color-interpolation-filters","sRGB");const h=document.createElementNS(W,"feColorMatrix");h.setAttribute("type","matrix"),h.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),d.appendChild(h);const C=document.createElementNS(W,"feComponentTransfer"),g=document.createElementNS(W,"feFuncR");g.setAttribute("type","linear"),C.appendChild(g);const I=document.createElementNS(W,"feFuncG");I.setAttribute("type","linear"),C.appendChild(I);const D=document.createElementNS(W,"feFuncB");D.setAttribute("type","linear"),C.appendChild(D);const we=document.createElementNS(W,"feFuncA");we.setAttribute("type","identity"),C.appendChild(we),d.appendChild(C),n.appendChild(d)}const S=d.querySelector("feFuncR"),b=d.querySelector("feFuncG"),f=d.querySelector("feFuncB");S&&S.setAttribute("slope",a.toString()),b&&b.setAttribute("slope",o.toString()),f&&f.setAttribute("slope",u.toString()),r.dataset.tintFilterId=i,r.setAttribute("filter",`url(#${i})`);try{r.dataset.tintColor=t}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},Ci=()=>Ye(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",r=Number(t);t==="bold"||r>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ii=()=>Ye(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),hn=e=>Ye(t=>{const n=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),i=new Set(n);i.has(e)?i.delete(e):i.add(e);const a=Array.from(i).join(" ");a?(t.style.textDecoration=a,t.setAttribute("text-decoration",a)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ni=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},r={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},n=t[e]||"start",i=r[e]||"left",a=Ye(o=>{o.setAttribute("text-anchor",n);const u=o.getAttribute("x");u&&o.querySelectorAll("tspan").forEach(d=>d.setAttribute("x",u)),o.style.textAlign=i},{autosaveReason:"text-align",skipTransformUpdate:!0});if(a){const o=$t();o&&(o.dataset.align=i)}return a},Li=e=>{let t=null;const r=Ye(n=>{const i=n.textContent||"";let a=i;e==="uppercase"?a=i.toUpperCase():e==="lowercase"&&(a=i.toLowerCase()),n.textContent=a,n.dataset.currentText=a,t=a},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(r){const n=$t();n&&t!==null&&(n.value=t)}return r},Ti=()=>{const e=$t();return Ye(t=>{const n=(t.textContent||"").split(/\r?\n/),i=t.dataset.listType==="bullet"||n.every(o=>o.trim().startsWith("â€¢")),a=i?n.map(o=>o.replace(/^\s*â€¢\s*/u,"")).join(`
`):n.map(o=>{const u=o.trim();return u?`â€¢ ${u}`:"â€¢"}).join(`
`);i?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=a,t.dataset.currentText=a,e&&e.dataset.previewTarget===je&&(e.value=a)},{autosaveReason:"text-list",skipTransformUpdate:!0})},Fi=e=>{const t=Lt(e,.5,5);return Ye(r=>{r.dataset.lineHeight=t,r.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},_i=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?Ye(r=>{if(Math.abs(t)<1e-4)r.style.letterSpacing="",r.removeAttribute("letter-spacing"),delete r.dataset.letterSpacing;else{const n=`${t.toFixed(2)}em`;r.style.letterSpacing=n,r.setAttribute("letter-spacing",n),r.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},Bi=e=>{const t=typeof e=="string"?e:"none";return Ye(r=>{switch(t){case"shadow":r.dataset.effectStyle="shadow",r.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;case"highlight":r.dataset.effectStyle="highlight",r.style.filter="none",r.style.paintOrder="stroke fill",r.style.stroke="rgba(253, 224, 71, 0.85)",r.style.strokeWidth=6;break;case"glitch":r.dataset.effectStyle="glitch",r.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;case"echo":r.dataset.effectStyle="echo",r.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;default:delete r.dataset.effectStyle,r.style.filter="",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},Ri=e=>{const t=e==="curve"?"curve":"none";return Ye(r=>{t==="curve"?r.dataset.effectShape="curve":delete r.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},$i=e=>{const t=Lt(e,0,100)/100;return Ye(r=>{r.style.opacity=t,r.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},Mi=e=>{const t=Lt(e,0,100)/100;return pt(r=>{r.style.opacity=t,r.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},Pi=e=>{const t=Lt(e,-180,180);return Ye(r=>{Math.abs(t)<1e-4?(delete r.dataset.rotation,r.removeAttribute("data-rotation")):(r.dataset.rotation=t,r.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},Di=e=>{const t=Lt(e,-180,180);return pt(r=>{Math.abs(t)<1e-4?(delete r.dataset.rotation,r.removeAttribute("data-rotation")):(r.dataset.rotation=t,r.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},gn=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let r=`${t}_${Date.now()}`,n=1;for(;document.querySelector(`[data-preview-node="${r}"]`);)r=`${t}_${Date.now()}_${n}`,n+=1;return r},qi=()=>{const e=Rt();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const r=gn(je||"text"),n=t.cloneNode(!0);n.setAttribute("data-preview-node",r),n.dataset.previewNode=r,n.id=r,n.dataset.defaultText=n.dataset.defaultText||n.textContent||"",t.parentNode.appendChild(n),cr(n),lt(n)&&ut(n);const a=ui(r,n.textContent||"");return a&&(a.value=n.textContent||"",setTimeout(()=>{try{a.focus({preventScroll:!1})}catch{}},0)),wt(r),_e(),N==null||N.schedule("duplicate-text-node"),!0},zi=()=>{const e=Rt();if(!e.length)return!1;const t=je;if(e.forEach(r=>{var i;const n=(i=T.get(r))==null?void 0:i.overlay;n&&(n.remove(),re.delete(n)),T.delete(r),r.remove()}),t){const r=rn(t),n=r==null?void 0:r.closest(".text-field-item");n&&n.remove();const i=li(t);i==null||i.remove()}return wt(null),_e(),N==null||N.schedule("remove-text-node"),!0},Ui=()=>{const e=Nt();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const r=gn(He||"image"),n=t.cloneNode(!0);n.setAttribute("data-preview-node",r),n.dataset.previewNode=r,n.id=r;const i=parseFloat(t.getAttribute("x"))||0,a=parseFloat(t.getAttribute("y"))||0;return n.setAttribute("x",i+10),n.setAttribute("y",a+10),n.dataset.tintFilterId&&(delete n.dataset.tintFilterId,n.removeAttribute("filter")),t.parentNode.appendChild(n),cr(n),lt(n)&&ut(n),xt(r),_e(),N==null||N.schedule("duplicate-image-node"),!0},Wi=()=>{const e=Nt();return e.length?(e.forEach(t=>{var n;const r=(n=T.get(t))==null?void 0:n.overlay;r&&(r.remove(),re.delete(r)),T.delete(t),t.remove()}),xt(null),_e(),N==null||N.schedule("remove-image-node"),!0):!1},ji=()=>{const e=Qe();if(e==="text"){const t=Ye(r=>{var o;const i=!(r.dataset.locked==="true");i?r.dataset.locked="true":delete r.dataset.locked;const a=(o=T.get(r))==null?void 0:o.overlay;a&&(a.classList.toggle("editor-overlay--locked",i),a.style.pointerEvents=i?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&_e(),t}if(e==="image"){const t=pt(r=>{var o;const i=!(r.dataset.locked==="true");i?r.dataset.locked="true":delete r.dataset.locked;const a=(o=T.get(r))==null?void 0:o.overlay;a&&(a.classList.toggle("editor-overlay--locked",i),a.style.pointerEvents=i?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&_e(),t}return!1},Hi=()=>{var r;const e=Rt();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((r=navigator==null?void 0:navigator.clipboard)!=null&&r.writeText)return navigator.clipboard.writeText(t).catch(n=>{console.warn("[InkWise Studio] Clipboard write failed.",n)}),!0;try{const n=document.createElement("textarea");return n.value=t,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),n.remove(),!0}catch(n){return console.warn("[InkWise Studio] Clipboard fallback failed.",n),!1}},Oi=()=>{var n;const e=Nt();if(!e.length)return!1;const t=e[0],r=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!r)return!1;if((n=navigator==null?void 0:navigator.clipboard)!=null&&n.writeText)return navigator.clipboard.writeText(r).catch(i=>{console.warn("[InkWise Studio] Clipboard write failed for image.",i)}),!0;try{const i=document.createElement("textarea");return i.value=r,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),i.remove(),!0}catch(i){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",i),!1}},Gi=()=>{const e=Qe();return e==="text"?Hi():e==="image"?Oi():!1},Vi=()=>{const e=Qe();return e==="text"?qi():e==="image"?Ui():!1},Xi=()=>{const e=Qe();return e==="text"?zi():e==="image"?Wi():!1},Yi=e=>{const t=Qe();return t==="text"?ea(e):t==="image"?ta(e):!1},Ki=e=>{const t=Qe();return t==="text"?$i(e):t==="image"?Mi(e):!1},Ji=e=>{const t=Qe();return t==="text"?Pi(e):t==="image"?Di(e):!1},Zi=e=>{const t=Qe();return t==="text"?xi(e):t==="image"?Ei(e):t==="background"?Si(e):!1},Qi=e=>{const t=Qe();return t==="text"?vi(e):t==="image"?wi(e):!1},ea=e=>{const t=Rt();if(!t.length)return!1;const r=t[0],n=r.parentNode;if(!n)return!1;const i=Array.from(n.children),a=i.indexOf(r);if(a===-1)return!1;if(e==="bring-to-front")n.appendChild(r);else if(e==="send-to-back")n.insertBefore(r,i[0]);else if(e==="bring-forward"){const o=Math.min(i.length-1,a+1);if(o!==a){const u=i[o+1]||null;n.insertBefore(r,u)}}else if(e==="send-backward"){const o=Math.max(0,a-1);if(o!==a){const u=i[o];n.insertBefore(r,u)}}else return!1;return _e(),N==null||N.schedule("text-layer"),!0},ta=e=>{const t=Nt();if(!t.length)return!1;const r=t[0],n=r.parentNode;if(!n)return!1;const i=Array.from(n.children),a=i.indexOf(r);if(a===-1)return!1;if(e==="bring-to-front")n.appendChild(r);else if(e==="send-to-back")n.insertBefore(r,i[0]);else if(e==="bring-forward"){const o=Math.min(i.length-1,a+1);if(o!==a){const u=i[o+1]||null;n.insertBefore(r,u)}}else if(e==="send-backward"){const o=Math.max(0,a-1);if(o!==a){const u=i[o];n.insertBefore(r,u)}}else return!1;return _e(),N==null||N.schedule("image-layer"),!0},ra={setFontFamily:e=>Qe()!=="text"?!1:bi(e),setFontSize:e=>Qi(e),setColor:e=>Zi(e),getActiveKey:()=>je,getSelection:()=>{const e=Qe();return{type:e,key:e==="text"?je:e==="image"?He:null,textKey:je,imageKey:He}},dispatch(e,t){const r=Qe();switch(e){case"bold":r==="text"&&Ci();break;case"italic":r==="text"&&Ii();break;case"underline":r==="text"&&hn("underline");break;case"strikethrough":r==="text"&&hn("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":r==="text"&&Ni(e);break;case"list-bullets":r==="text"&&Ti();break;case"line-spacing":r==="text"&&Fi(t);break;case"letter-spacing":r==="text"&&_i(t);break;case"uppercase":case"lowercase":r==="text"&&Li(e);break;case"effect-style":r==="text"&&Bi(t);break;case"effect-shape":r==="text"&&Ri(t);break;case"opacity":Ki(t);break;case"rotation":Ji(t);break;case"layer":Yi(t);break;case"more":t==="duplicate"?Vi():t==="delete"?Xi():t==="lock"?ji():t==="copy"&&Gi();break;case"replace-image":const n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=i=>{const a=i.target.files[0];if(a){const o=new FileReader;o.onload=u=>{const d=u.target.result;pt(S=>{S.setAttribute("href",d),S.setAttributeNS("http://www.w3.org/1999/xlink","href",d)}),N==null||N.schedule("image-replace")},o.readAsDataURL(a)}},n.click();break;case"crop":{const i=Nt();if(!i.length)break;const a=T.get(i[0]),o=a==null?void 0:a.overlay;if(!o)break;if(nn(),(ot==null?void 0:ot.overlay)===o)ot.refresh();else{ft();const u=Lr(o,i[0]);u&&(ot=u)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=ra);const Pt=document.getElementById("canvas-zoom-select"),mn=document.getElementById("canvas-zoom-display"),na=document.querySelectorAll("[data-zoom-step]"),yn=document.querySelector(".preview-canvas-wrapper"),mr=L,St=[.25,.5,.75,1,1.5,2,3];if(Pt&&yn&&mr){const e=r=>{mr.style.setProperty("--canvas-scale",r.toString()),yn.style.removeProperty("transform"),Pt.value=r.toString(),mn&&(mn.textContent=`${Math.round(r*100)}%`),_e()},t=r=>{const n=parseFloat(Pt.value)||1,i=St.indexOf(n);if(i===-1)return;let a=i;r==="up"&&i<St.length-1&&(a=i+1),r==="down"&&i>0&&(a=i-1),a!==i&&e(St[a])};Pt.addEventListener("change",r=>{const n=parseFloat(r.target.value)||1;e(n)}),na.forEach(r=>{r.addEventListener("click",()=>{const n=r.dataset.zoomStep;n&&t(n==="up"?"up":"down")})}),mr&&mr.addEventListener("wheel",r=>{r.preventDefault();const n=parseFloat(Pt.value)||1;let i=n;if(r.deltaY>0){const a=St.indexOf(n);a>0&&(i=St[a-1])}else{const a=St.indexOf(n);a<St.length-1&&(i=St[a+1])}i!==n&&e(i)},{passive:!1}),e(parseFloat(Pt.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement,r=t&&typeof t.matches=="function"&&t.matches("#textFieldList input"),n=t&&typeof t.closest=="function"&&t.closest(".studio-react-widgets");!r&&!n&&(je||He||st?Wt():document.body.classList.remove("text-toolbar-visible"))},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae,{once:!0}):ae()}function xa({bootstrap:ae={}}){const s=Ne.useRef(null),c=Ne.useRef(null),l=Ne.useRef(null),p=Ne.useRef(null),[w,x]=Ne.useState({front:"idle",back:"idle"}),[A,k]=Ne.useState({front:{width:null,height:null,unit:"px"},back:{width:null,height:null,unit:"px"}}),E=(L,W)=>{if(!L)return"";const le=parseFloat(L);return Number.isFinite(le)?W==="px"||W==="PX"||W==="Px"?`${(le/96).toFixed(2)} in`:W==="in"||W==="IN"||W==="In"?`${le} in`:`${L}${W||""}`:`${L}${W||""}`};return Ne.useEffect(()=>{var De,Ue;try{const v=typeof document<"u"?((De=document.getElementById("template-editor-root"))==null?void 0:De.dataset)||{}:{},R=v.frontCanvasWidth||v.frontCanvaswidth||null,Q=v.frontCanvasHeight||v.frontCanvasheight||null,P=v.frontCanvasUnit||v.frontCanvasunit||"px",Ee=v.backCanvasWidth||v.backCanvaswidth||null,K=v.backCanvasHeight||v.backCanvasheight||null,se=v.backCanvasUnit||v.backCanvasunit||"px";k({front:{width:R,height:Q,unit:P},back:{width:Ee,height:K,unit:se}});var L=v.hasBack==="true"||v.hasBack===!0||v.hasback==="true"}catch{}const W=(v,R)=>{if(!v)return null;const Q=parseFloat(v);return Number.isFinite(Q)?R.toLowerCase()==="px"?Q:R.toLowerCase()==="in"?Math.round(Q*96):Q:null},le=typeof window<"u"?window.SvgTemplateEditor:null;if(!le){console.warn("[TemplateEditor] SvgTemplateEditor not found on window");return}let fe=!0;async function X(v,R,Q){var se,ce;if(!v||!fe)return;const P=ae.template||{};let Ee=R==="front"?P.svg_path||P.front_svg_path||P.front_svg:P.back_svg_path||P.back_svg;if(!Ee){const ie=R==="front"?"data-front-svg":"data-back-svg";Ee=v.getAttribute(ie)}if(Ee&&v.innerHTML.trim()==="")try{const ie=await fetch(Ee,{credentials:"same-origin"});if(ie.ok){const me=await ie.text();v.innerHTML=me}}catch(ie){console.warn("[TemplateEditor] failed to fetch svg:",ie)}const K=v.tagName&&v.tagName.toLowerCase()==="svg"?v:v.querySelector("svg");if(K){try{const ie=typeof document<"u"?((se=document.getElementById("template-editor-root"))==null?void 0:se.dataset)||{}:{},me=R==="front"?ie.frontCanvasWidth:ie.backCanvasWidth,oe=R==="front"?ie.frontCanvasHeight:ie.backCanvasHeight,de=R==="front"?ie.frontCanvasUnit||"px":ie.backCanvasUnit||"px",Se=W(me,de),Fe=W(oe,de);if(Se&&Fe){try{v.style.width=`${Se}px`,v.style.height=`${Fe}px`,v.style.maxWidth="none"}catch{}try{K.setAttribute("width",`${Se}`),K.setAttribute("height",`${Fe}`),K.style.width=`${Se}px`,K.style.height=`${Fe}px`}catch{}}}catch{}try{const ie=typeof document<"u"?((ce=document.getElementById("template-editor-root"))==null?void 0:ce.dataset)||{}:{},me=R==="front"?ie.frontCanvasWidth:ie.backCanvasWidth,oe=R==="front"?ie.frontCanvasHeight:ie.backCanvasHeight;me&&oe&&!K.getAttribute("viewBox")&&K.setAttribute("viewBox",`0 0 ${me} ${oe}`)}catch{}try{Q.current=new le(K,{onImageChange:()=>{x(oe=>({...oe,[R]:"dirty"})),typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:R}}))},onTextChange:()=>{x(oe=>({...oe,[R]:"dirty"})),typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:R}}))}});try{const oe=Q.current;Array.from(K.querySelectorAll("text")).forEach(Se=>{try{const Fe=typeof oe.createBoundingBox=="function"?oe.createBoundingBox(Se):null,he=Fe||Se;if(Fe&&(Se._boundingBox=Fe,Fe._targetElement=Se,Fe.querySelectorAll(".resize-handle").forEach(We=>oe.makeResizable(Se,We))),he&&typeof oe.makeDraggable=="function"){oe.makeDraggable(he);try{if(he.style){he.style.cursor="move",he.style.touchAction="none";try{he.style.pointerEvents="all"}catch{}}if(he.setAttribute){he.setAttribute("data-inkwise-draggable","true");try{he.setAttribute("pointer-events","all")}catch{}}if(he.classList)try{he.classList.add("inkwise-draggable")}catch{}}catch{}}}catch{}})}catch{}const ie=R==="front"?"frontTextFieldList":"backTextFieldList",me=document.getElementById(ie);me&&(me.innerHTML="",Array.from(K.querySelectorAll("text")).forEach((de,Se)=>{const Fe=document.createElement("li");Fe.className="text-field-item";const he=document.createElement("label");he.textContent=`${R==="front"?"Front":"Back"} Text ${Se+1}`;const ze=document.createElement("input");ze.type="text",ze.value=de.textContent||"",ze.addEventListener("input",We=>{de.textContent=We.target.value,Q.current&&typeof Q.current.options.onTextChange=="function"&&Q.current.options.onTextChange()}),ze.addEventListener("focus",()=>{if(typeof window<"u"){const We=new CustomEvent("inkwise:active-element",{detail:{type:"text"}});window.dispatchEvent(We)}}),ze.addEventListener("blur",()=>{if(typeof window<"u"){const We=new CustomEvent("inkwise:active-element",{detail:{type:null}});window.dispatchEvent(We)}}),Fe.appendChild(he),Fe.appendChild(ze),me.appendChild(Fe)}))}catch(ie){console.error("[TemplateEditor] failed to create SvgTemplateEditor",ie)}}}X(s.current,"front",l),(typeof L<"u"?L:((Ue=ae.template)==null?void 0:Ue.has_back)??!1)&&X(c.current,"back",p);const q=v=>v?!!(v.nodeName&&v.nodeName.toLowerCase()==="text"||v.classList&&v.classList.contains("canvas-layer__text")||v.closest&&v.closest(".canvas-layer__text, [data-inkwise-text]")):!1,U=v=>v?!!(v.nodeName&&(v.nodeName.toLowerCase()==="image"||v.nodeName.toLowerCase()==="img")||v.classList&&(v.classList.contains("canvas-layer__image")||v.classList.contains("svg-changeable-image")||v.classList.contains("changeable-image"))||v.closest&&v.closest(".canvas-layer__image, .svg-changeable-image, .changeable-image")):!1,O=v=>{const R=/translate\(([-0-9.]+)[ ,]([-0-9.]+)\)/.exec(v||"");return R?{x:parseFloat(R[1]),y:parseFloat(R[2])}:{x:0,y:0}},Y=(v,R,Q)=>{try{const Ee=(v.getAttribute("transform")||"").replace(/translate\([^)]*\)/,"").trim(),se=(`translate(${R} ${Q})`+" "+Ee).trim();v.setAttribute("transform",se)}catch{try{v.style.transform=`translate(${R}px, ${Q}px)`}catch{}}},B=v=>{if(!v)return null;let R=null;const Q=K=>{if(!R)return;K.preventDefault();const se=K.clientX-R.startX,ce=K.clientY-R.startY,ie=R.startTx+se,me=R.startTy+ce;R.moved=R.moved||Math.abs(se)>2||Math.abs(ce)>2,Y(R.targetEl,ie,me)},P=K=>{if(R){try{if(!R.moved&&U(R.targetEl)){const se={node:R.targetEl,side:v===s.current?"front":"back"},ce=new CustomEvent("inkwise-image-clicked",{detail:se});window.dispatchEvent(ce)}}catch{}window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",P),R=null}},Ee=K=>{const se=K.target&&K.target.closest&&K.target.closest("g, text, image, img, [data-canvas-layer]")||K.target;if(se&&(q(se)||U(se))){K.preventDefault();const ce=se.getAttribute&&se.getAttribute("transform")||"",ie=O(ce);if(R={pointerId:K.pointerId,startX:K.clientX,startY:K.clientY,startTx:ie.x,startTy:ie.y,targetEl:se,moved:!1},q(se)){const me={node:se,side:v===s.current?"front":"back"},oe=new CustomEvent("inkwise-text-selected",{detail:me});window.dispatchEvent(oe)}window.addEventListener("pointermove",Q,{passive:!1}),window.addEventListener("pointerup",P,{passive:!1})}};return v.addEventListener("pointerdown",Ee),()=>{v.removeEventListener("pointerdown",Ee),window.removeEventListener("pointermove",Q),window.removeEventListener("pointerup",P)}},M=B(s.current),ne=B(c.current);return()=>{fe=!1,[l.current,p.current].forEach(v=>{if(v)try{typeof v.destroy=="function"&&v.destroy()}catch{}}),M&&M(),ne&&ne()}},[ae]),Ne.useEffect(()=>{try{Array.from(document.querySelectorAll('#template-editor-root svg, [data-svg-editor="true"]')).forEach(le=>applySizingToSvg(le))}catch{}},[A]),Ne.useEffect(()=>{const L=()=>{var le,fe,X,q;try{const U=s.current,O=c.current,Y=(le=U==null?void 0:U.parentElement)==null?void 0:le.querySelector(".ruler-vertical"),B=(fe=O==null?void 0:O.parentElement)==null?void 0:fe.querySelector(".ruler-vertical");Y&&U&&(Y.style.height=`${U.clientHeight}px`),B&&O&&(B.style.height=`${O.clientHeight}px`);const M=(X=U==null?void 0:U.parentElement)==null?void 0:X.querySelector(".ruler-horizontal"),ne=(q=O==null?void 0:O.parentElement)==null?void 0:q.querySelector(".ruler-horizontal");M&&U&&(M.style.width=`${U.clientWidth}px`),ne&&O&&(ne.style.width=`${O.clientWidth}px`)}catch{}};L(),window.addEventListener("resize",L);const W=new ResizeObserver(L);return s.current&&W.observe(s.current),c.current&&W.observe(c.current),()=>{window.removeEventListener("resize",L);try{W.disconnect()}catch{}}},[]),Ne.useEffect(()=>{const L="inkwise_recent_uploads",le=document.getElementById("upload-button"),fe=document.getElementById("image-upload"),X=document.getElementById("recentUploadsGrid"),q=document.getElementById("uploadsDropZone"),U=document.getElementById("upload-side-select"),O=_=>{try{const z=document.getElementById("upload-side-front"),ee=document.getElementById("upload-side-back");if(z&&ee)return ee.getAttribute("aria-pressed")==="true"?"back":"front";if(U)return U.value==="back"?"back":"front"}catch{}return"front"},Y=_=>{try{const z=document.getElementById("upload-side-front"),ee=document.getElementById("upload-side-back");z&&ee&&(z.classList.toggle("active",_==="front"),ee.classList.toggle("active",_==="back"),z.setAttribute("aria-pressed",_==="front"?"true":"false"),ee.setAttribute("aria-pressed",_==="back"?"true":"false")),U&&(U.value=_==="back"?"back":"front");try{const te=s.current&&s.current.closest(".template-canvas-column"),T=c.current&&c.current.closest(".template-canvas-column");te&&te.classList.toggle("upload-selected",_==="front"),T&&T.classList.toggle("upload-selected",_==="back")}catch{}}catch{}};let B=null,M=null,ne=null,De=null,Ue=null,v=null,R=null;try{B=document.getElementById("upload-side-front"),M=document.getElementById("upload-side-back"),ne=ee=>{const te=ee&&ee.currentTarget&&ee.currentTarget.dataset&&ee.currentTarget.dataset.side?ee.currentTarget.dataset.side:ee.currentTarget&&ee.currentTarget.id==="upload-side-back"?"back":"front";Y(te)},B&&B.addEventListener("click",ne),M&&M.addEventListener("click",ne);const _=s.current&&s.current.closest(".template-canvas-column"),z=c.current&&c.current.closest(".template-canvas-column");De=_&&_.querySelector(".canvas-header"),Ue=z&&z.querySelector(".canvas-header"),v=()=>Y("front"),R=()=>Y("back"),De&&De.addEventListener("click",v),Ue&&Ue.addEventListener("click",R),Y(O())}catch{}const Q=()=>{try{const _=localStorage.getItem(L);return _?JSON.parse(_):[]}catch{return[]}},P=(_,z,ee="front")=>{const te=Q(),T={id:Date.now(),dataUrl:_,filename:z,side:ee,timestamp:new Date().toISOString()},re=te.filter(ke=>ke.filename!==z||ke.dataUrl!==_);re.unshift(T);const ge=re.slice(0,12);try{localStorage.setItem(L,JSON.stringify(ge))}catch{try{localStorage.setItem(L,JSON.stringify(ge.slice(0,Math.floor(12/2))))}catch{}}We()},Ee=_=>{try{const z=Q().filter(ee=>String(ee.id)!==String(_));localStorage.setItem(L,JSON.stringify(z)),We()}catch{}},K=_=>{const z=_==="back"?c.current:s.current;return z?z.tagName&&z.tagName.toLowerCase()==="svg"?z:z.querySelector("svg"):null},se=(_,z,ee)=>{try{if(!_)return null;const te=_.createSVGPoint();te.x=z,te.y=ee;const T=_.getScreenCTM&&_.getScreenCTM();if(T&&typeof T.inverse=="function"){const Ze=T.inverse(),Xe=te.matrixTransform(Ze);return{x:Xe.x,y:Xe.y}}const re=_.getBoundingClientRect(),ge=parseFloat(_.getAttribute("width"))||re.width,ke=parseFloat(_.getAttribute("height"))||re.height,J=(z-re.left)*(ge/re.width),qe=(ee-re.top)*(ke/re.height);return{x:J,y:qe}}catch{return null}},ce=(_,z,ee="front",te=null)=>{if(!_)return null;let T=_.querySelector("image");if(!T){const ge=_.getAttribute("viewBox");let ke=150;if(ge){const qe=ge.split(/[ ,\s]+/).map(Number);qe.length===4&&qe.every(Number.isFinite)&&(qe[0]+qe[2]/2,qe[1]+qe[3]/2,ke=Math.min(qe[2],qe[3])*.3)}else{const qe=parseFloat(_.getAttribute("width"))||_.clientWidth||400,Ze=parseFloat(_.getAttribute("height"))||_.clientHeight||400;ke=Math.min(qe,Ze)*.3}const J=`uploaded_${Date.now()}`;T=document.createElementNS("http://www.w3.org/2000/svg","image"),T.setAttribute("id",J),T.setAttribute("data-preview-node",J),T.setAttribute("width",String(ke)),T.setAttribute("height",String(ke)),T.setAttribute("preserveAspectRatio","xMidYMid meet"),_.appendChild(T)}if(T.setAttribute("href",z),T.setAttributeNS("http://www.w3.org/1999/xlink","href",z),te&&typeof te.x=="number"&&typeof te.y=="number"){const ge=parseFloat(T.getAttribute("width"))||150,ke=te.x-ge/2,J=te.y-ge/2;T.setAttribute("x",String(ke)),T.setAttribute("y",String(J))}const re=ee==="back"?p.current:l.current;try{if(re&&typeof re.createBoundingBox=="function"){T._boundingBox&&T._boundingBox.parentNode&&T._boundingBox.parentNode.removeChild(T._boundingBox);const ge=re.createBoundingBox(T);if(ge){T._boundingBox=ge,ge._targetElement=T,ge.querySelectorAll(".resize-handle").forEach(J=>{try{re.makeResizable(T,J)}catch{}});try{re.makeDraggable(ge)}catch{try{re.makeDraggable(T)}catch{}}}else try{re.makeDraggable(T)}catch{}}}catch{}try{typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:ee}})),x(ee==="back"?ge=>({...ge,back:"dirty"}):ge=>({...ge,front:"dirty"}))}catch{}return T},ie=(_,z,ee="front",te=null)=>{if(!_)return null;P(_,z||`upload-${Date.now()}`,ee);const T=K(ee);let re=null;if(T)re=ce(T,_,ee,te);else{const ge=K("front");ge&&(re=ce(ge,_,"front",te))}try{re&&re.id&&ze(ee,z,re.id)}catch{}return re},me=(_,z=O(),ee=null)=>{if(!_)return;if(!_.type||!_.type.startsWith("image/")){alert("Only image files are supported.");return}const te=new FileReader;te.onload=T=>{var ge;const re=(ge=T==null?void 0:T.target)==null?void 0:ge.result;re&&ie(re,_.name,z,ee)},te.readAsDataURL(_)},oe=(_,z=O(),ee=null)=>{if(!_)return;Array.from(_).forEach((T,re)=>me(T,z,re===0?ee:null))};let de=null;const Se=()=>de||(de=document.createElement("div"),de.id="upload-preview",de.setAttribute("aria-hidden","true"),de.style.position="fixed",de.style.pointerEvents="none",de.style.zIndex="5000",de.style.display="none",de.style.transition="opacity 120ms ease",de.style.opacity="0",de.innerHTML='<img alt="Preview" style="display:block;max-width:320px;max-height:320px;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.25)" />',document.body.appendChild(de),de),Fe=(_,z,ee)=>{try{const te=Se(),T=te.querySelector("img");T.src=_,te.style.display="block";const re=Math.min(window.innerWidth-340,z+12),ge=Math.min(window.innerHeight-340,ee+12);te.style.left=`${re}px`,te.style.top=`${ge}px`,requestAnimationFrame(()=>{te.style.opacity="1"})}catch{}},he=()=>{try{if(!de)return;de.style.opacity="0",setTimeout(()=>{de&&(de.style.display="none")},150)}catch{}},ze=(_,z,ee)=>{try{const te=`upload-confirm-${Date.now()}`,T=document.createElement("div");T.className="upload-confirmation",T.id=te,T.style.position="fixed",T.style.right="16px",T.style.bottom="16px",T.style.background="#111827",T.style.color="#fff",T.style.padding="10px 12px",T.style.borderRadius="8px",T.style.boxShadow="0 8px 30px rgba(2,6,23,0.4)",T.style.zIndex="6000",T.style.display="flex",T.style.alignItems="center",T.style.gap="10px";const re=document.createElement("span");if(re.textContent=`Inserted image to ${_==="back"?"Back":"Front"}`+(z?` â€” ${z}`:""),re.style.fontSize="13px",T.appendChild(re),ee){const ge=document.createElement("button");ge.textContent="Undo",ge.style.background="transparent",ge.style.border="1px solid rgba(255,255,255,0.12)",ge.style.color="#fff",ge.style.padding="6px 8px",ge.style.borderRadius="6px",ge.style.cursor="pointer",ge.addEventListener("click",()=>{try{const ke=document.getElementById(ee);ke&&ke.parentNode&&ke.parentNode.removeChild(ke)}catch{}try{T&&T.parentNode&&T.parentNode.removeChild(T)}catch{}}),T.appendChild(ge)}document.body.appendChild(T),setTimeout(()=>{try{T&&T.parentNode&&T.parentNode.removeChild(T)}catch{}},4e3)}catch{}},We=()=>{if(!X)return;const _=Q();if(!_||_.length===0){X.innerHTML=`
          <div class="no-recent-uploads">
            <p>No recent uploads found. Upload some images above to see them here.</p>
          </div>
        `;return}X.innerHTML="",_.forEach(z=>{const ee=document.createElement("div");ee.className="recent-upload-item",ee.dataset.uploadId=z.id,ee.dataset.imageUrl=z.dataUrl,ee.dataset.side=z.side||"front";const te=document.createElement("img");te.src=z.dataUrl,te.alt=z.filename||"",te.loading="lazy",te.style.width="64px",te.style.height="64px",te.style.objectFit="cover",te.style.cursor="pointer",te.title="Insert image to canvas",te.setAttribute("tabindex","0"),te.setAttribute("aria-label","Insert image to canvas"),te.addEventListener("click",()=>{ie(z.dataUrl,z.filename,z.side||"front")}),te.addEventListener("keydown",re=>{(re.key==="Enter"||re.key===" ")&&(re.preventDefault(),ie(z.dataUrl,z.filename,z.side||"front"))}),te.addEventListener("mouseenter",re=>{try{Fe(z.dataUrl,re.clientX,re.clientY)}catch{}}),te.addEventListener("mousemove",re=>{try{Fe(z.dataUrl,re.clientX,re.clientY)}catch{}}),te.addEventListener("mouseleave",()=>{he()});const T=document.createElement("button");T.className="recent-upload-remove",T.title="Remove upload",T.textContent="âœ•",T.style.marginLeft="6px",T.addEventListener("click",()=>{Ee(z.id)}),ee.appendChild(te),ee.appendChild(T),X.appendChild(ee)})},Ve=()=>{fe&&fe.click()},et=_=>{const z=_.target&&_.target.files?_.target.files:null;z&&z.length&&(oe(z,O()),_.target.value="")},mt="uploads-dropzone--active",At=_=>{_.preventDefault(),_.stopPropagation();try{q&&q.classList.remove(mt)}catch{}const z=_.dataTransfer&&_.dataTransfer.files?_.dataTransfer.files:null;if(z&&z.length){oe(z,O());return}try{const ee=_.dataTransfer&&(_.dataTransfer.getData("text/uri-list")||_.dataTransfer.getData("text/plain"));ee&&fetch(ee).then(te=>te.blob()).then(te=>{const T=new File([te],ee.split("/").pop()||"remote-image",{type:te.type});me(T,O())}).catch(()=>{})}catch{}},Et=_=>{_.preventDefault(),_.stopPropagation();try{q&&q.classList.add(mt)}catch{}},_t=_=>{try{q&&q.classList.remove(mt)}catch{}};q&&(q.addEventListener("dragover",Et),q.addEventListener("dragenter",Et),q.addEventListener("dragleave",_t),q.addEventListener("drop",At));const rt=(_,z)=>{const ee=re=>{re.preventDefault(),re.dataTransfer.dropEffect="copy",_.style.outline="2px dashed #2563eb"},te=re=>{try{_.style.outline=""}catch{}},T=re=>{re.preventDefault();try{_.style.outline=""}catch{}const ge=re.dataTransfer&&re.dataTransfer.files?re.dataTransfer.files:null,ke=K(z);let J=null;if(ke&&(J=se(ke,re.clientX,re.clientY)),ge&&ge.length){oe(ge,z,J);return}try{const qe=re.dataTransfer&&(re.dataTransfer.getData("text/uri-list")||re.dataTransfer.getData("text/plain"));qe&&ke&&fetch(qe).then(Ze=>Ze.blob()).then(Ze=>{const Xe=new File([Ze],qe.split("/").pop()||"remote-image",{type:Ze.type});me(Xe,z,J)}).catch(()=>{})}catch{}};return _.addEventListener("dragover",ee),_.addEventListener("dragleave",te),_.addEventListener("drop",T),()=>{_.removeEventListener("dragover",ee),_.removeEventListener("dragleave",te),_.removeEventListener("drop",T)}},Jt=s.current,xr=c.current,be=Jt?rt(Jt,"front"):null,Zt=xr?rt(xr,"back"):null;return le&&le.addEventListener("click",Ve),fe&&fe.addEventListener("change",et),We(),()=>{le&&le.removeEventListener("click",Ve),fe&&fe.removeEventListener("change",et),q&&(q.removeEventListener("dragover",Et),q.removeEventListener("dragenter",Et),q.removeEventListener("dragleave",_t),q.removeEventListener("drop",At)),be&&be(),Zt&&Zt();try{const _=document.getElementById("upload-side-front"),z=document.getElementById("upload-side-back");_&&typeof ne=="function"&&_.removeEventListener("click",ne),z&&typeof ne=="function"&&z.removeEventListener("click",ne),De&&typeof v=="function"&&De.removeEventListener("click",v),Ue&&typeof R=="function"&&Ue.removeEventListener("click",R)}catch{}try{de&&de.parentNode&&de.parentNode.removeChild(de),de=null}catch{}}},[]),y.jsxs("div",{className:"template-editor two-column",children:[y.jsxs("div",{className:"template-canvas-column",children:[y.jsx("div",{className:"canvas-header",children:"Front Canvas"}),y.jsxs("div",{className:"canvas-with-ruler",children:[y.jsxs("div",{className:"ruler-vertical","aria-hidden":"true",children:[y.jsx("div",{className:"ruler-line"}),y.jsx("div",{className:"ruler-label",children:A.front.height?E(A.front.height,A.front.unit):""})]}),y.jsx("div",{className:"guide-vertical","aria-hidden":"true"}),y.jsxs("div",{className:"canvas-body",children:[y.jsx("div",{className:"canvas-stage",id:"template-editor-container-front",ref:s}),y.jsxs("div",{className:"ruler-horizontal","aria-hidden":"true",children:[y.jsx("div",{className:"ruler-line-horizontal"}),y.jsx("div",{className:"ruler-label-horizontal",children:E(A.front.width,A.front.unit)})]})]})]})]}),y.jsxs("div",{className:"template-canvas-column",children:[y.jsx("div",{className:"canvas-header",children:"Back Canvas"}),y.jsxs("div",{className:"canvas-with-ruler",children:[y.jsxs("div",{className:"ruler-vertical","aria-hidden":"true",children:[y.jsx("div",{className:"ruler-line"}),y.jsx("div",{className:"ruler-label",children:A.back.height?E(A.back.height,A.back.unit):""})]}),y.jsx("div",{className:"guide-vertical","aria-hidden":"true"}),y.jsxs("div",{className:"canvas-body",children:[y.jsx("div",{className:"canvas-stage",id:"template-editor-container-back",ref:c}),y.jsxs("div",{className:"ruler-horizontal","aria-hidden":"true",children:[y.jsx("div",{className:"ruler-line-horizontal"}),y.jsx("div",{className:"ruler-label-horizontal",children:E(A.back.width,A.back.unit)})]})]})]})]})]})}const Sa=[{label:"Warm Neutrals",colors:[{name:"Ivory Cream",hex:"#FFF6E5"},{name:"Champagne Beige",hex:"#F3E9DC"},{name:"Blush Pink",hex:"#F6C1CC"},{name:"Dusty Rose",hex:"#D8A7B1"},{name:"Light Lavender",hex:"#E8DFF5"},{name:"Pearl Gray",hex:"#F2F2F2"}]},{label:"Roses & Warm Accents",colors:[{name:"Burgundy Wine",hex:"#7A1F2B"},{name:"Mauve Plum",hex:"#8E5A7C"},{name:"Rose Gold",hex:"#E6B7A9"},{name:"Soft Peach",hex:"#FFD6C9"},{name:"Warm Taupe",hex:"#C4B6A6"}]},{label:"Greens & Blues",colors:[{name:"Sage Green",hex:"#A8C3A0"},{name:"Olive Mist",hex:"#C7D3BF"},{name:"Mint Cream",hex:"#E6F4EA"},{name:"Sky Blue",hex:"#DDEEFF"},{name:"Soft Teal",hex:"#B7DED9"},{name:"Navy Blue",hex:"#1F2A44"},{name:"Emerald Green",hex:"#1F7A5B"},{name:"Royal Purple",hex:"#4B2E83"},{name:"Charcoal",hex:"#2E2E2E"},{name:"Midnight Blue",hex:"#0F172A"}]},{label:"Extra Pastels",colors:[{name:"White",hex:"#FFFFFF"},{name:"Cream",hex:"#FFF3D6"},{name:"Light Pink",hex:"#FADADD"},{name:"Baby Blue",hex:"#E6F0FF"},{name:"Mint Green",hex:"#E9F7EF"},{name:"Lavender",hex:"#EFE6FF"},{name:"Soft Yellow",hex:"#FFF9C4"},{name:"Light Gray",hex:"#F2F2F2"},{name:"Peach",hex:"#FFE0CC"},{name:"Sky Blue",hex:"#DFF2FF"}]},{label:"Basic Colors",colors:[{name:"Red",hex:"#FF0000"},{name:"Blue",hex:"#0000FF"},{name:"Yellow",hex:"#FFFF00"},{name:"Green",hex:"#00FF00"},{name:"Orange",hex:"#FFA500"},{name:"Purple",hex:"#800080"},{name:"Pink",hex:"#FFC0CB"},{name:"Brown",hex:"#8B4513"},{name:"Black",hex:"#000000"},{name:"White",hex:"#FFFFFF"}]}];function ka({bootstrap:ae={}}){const[s,c]=Ne.useState("#000000"),[l,p]=Ne.useState([]),[w,x]=Ne.useState("selection");Ne.useEffect(()=>{try{const E=localStorage.getItem("inkwise:recentColors");E&&p(JSON.parse(E))}catch{}},[]);const A=E=>{try{const L=[E,...l.filter(W=>W!==E)].slice(0,12);p(L),localStorage.setItem("inkwise:recentColors",JSON.stringify(L))}catch{}},k=(E,L="selection")=>{if(!E)return;c(E),A(E);const W=typeof window<"u"?window.inkwiseToolbar:null;if(L==="selection"){if(W&&typeof W.setColor=="function")try{W.setColor(E)}catch{}try{window.dispatchEvent(new CustomEvent("inkwise:color-selected",{detail:{color:E}})),window.dispatchEvent(new CustomEvent("inkwise:text-style-changed",{detail:{attribute:"fill",value:E}}))}catch{}}else{try{window.dispatchEvent(new CustomEvent("inkwise:color-selected",{detail:{color:E}}))}catch{}if(L==="front"||L==="back"||L==="both")try{window.dispatchEvent(new CustomEvent("inkwise:apply-background",{detail:{side:L,color:E}}))}catch{}}try{if(L==="front"||L==="back"||L==="both"){const le=document.getElementById("colors-modal");if(le){le.setAttribute("aria-hidden","true"),le.classList.remove("is-open");const fe=document.querySelector('.sidenav-btn[data-nav="colors"]');fe&&fe.classList.remove("active")}}}catch{}};return y.jsx("div",{className:"colors-panel-react",style:{fontFamily:"system-ui, sans-serif",padding:10},children:y.jsxs("div",{className:"colors-panel-inner",style:{display:"grid",gap:12},children:[y.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:y.jsx("div",{style:{fontWeight:600},children:"Choose a color"})}),y.jsxs("div",{className:"colors-custom",style:{display:"flex",flexDirection:"column",gap:8},children:[y.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[y.jsx("label",{htmlFor:"colors-panel-custom",style:{fontSize:13},children:"Custom"}),y.jsx("input",{id:"colors-panel-custom",type:"color",value:s,onChange:E=>{c(E.target.value),k(E.target.value,w)},style:{width:44,height:32,padding:0,border:"none",background:"transparent"}}),y.jsx("input",{type:"text",value:s,onChange:E=>c(E.target.value),onKeyDown:E=>{E.key==="Enter"&&k(E.currentTarget.value||s,w)},onBlur:E=>k(E.currentTarget.value||s,w),style:{marginLeft:6,width:110}})]}),y.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[y.jsx("input",{type:"radio",name:"applyTarget",value:"selection",checked:w==="selection",onChange:()=>x("selection")}),y.jsx("span",{style:{fontSize:13},children:"Selection"})]}),y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[y.jsx("input",{type:"radio",name:"applyTarget",value:"front",checked:w==="front",onChange:()=>x("front")}),y.jsx("span",{style:{fontSize:13},children:"Front background"})]}),y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[y.jsx("input",{type:"radio",name:"applyTarget",value:"back",checked:w==="back",onChange:()=>x("back")}),y.jsx("span",{style:{fontSize:13},children:"Back background"})]}),y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[y.jsx("input",{type:"radio",name:"applyTarget",value:"both",checked:w==="both",onChange:()=>x("both")}),y.jsx("span",{style:{fontSize:13},children:"Both"})]})]})]}),Sa.map(E=>y.jsxs("div",{style:{display:"block"},children:[y.jsx("div",{style:{marginBottom:6,fontSize:12,color:"#444"},children:E.label}),y.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:8,marginBottom:10},children:E.colors.map(({name:L,hex:W})=>y.jsx("button",{type:"button","aria-label":`${L} ${W}`,className:"color-swatch",title:`${L} â€” ${W}`,style:{background:W,width:"100%",height:36,borderRadius:6,border:s.toLowerCase()===W.toLowerCase()?"2px solid #000":"1px solid rgba(0,0,0,0.06)"},onClick:()=>k(W,w)},W))})]},E.label)),l.length>0&&y.jsxs("div",{children:[y.jsx("div",{style:{marginBottom:6,fontSize:12,color:"#444"},children:"Recent"}),y.jsx("div",{className:"recent-grid",style:{display:"flex",gap:8,flexWrap:"wrap"},children:l.map(E=>y.jsx("button",{type:"button","aria-label":`Recent ${E}`,className:"color-swatch",style:{background:E,width:36,height:36,borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"},onClick:()=>k(E,w)},E))})]})]})})}function Aa({bootstrap:ae={}}){const[s,c]=Ne.useState([]),[l,p]=Ne.useState([]),[w,x]=Ne.useState(!1),[A,k]=Ne.useState(!1),[E,L]=Ne.useState(null),[W,le]=Ne.useState(null),[fe,X]=Ne.useState({}),q=Ne.useRef(null),U=["Arial, sans-serif","Helvetica, sans-serif","Times New Roman, serif","Georgia, serif","Verdana, sans-serif","Courier New, monospace","Impact, sans-serif","Comic Sans MS, cursive","Poppins, sans-serif","Montserrat, sans-serif","Playfair Display, serif","Lora, serif","Raleway, sans-serif","Great Vibes, cursive","Pacifico, cursive","Cormorant Garamond, serif","Open Sans, sans-serif","Bebas Neue, cursive","Allura, cursive","Alex Brush, cursive","Dancing Script, cursive","Cinzel, serif","Abril Fatface, cursive","Cormorant SC, serif","Libre Baskerville, serif","Crimson Text, serif","Josefin Sans, sans-serif","Tangerine, cursive"],O=[8,10,12,14,16,18,20,24,28,32,36,48,60,72];Ne.useEffect(()=>{const v=de=>{const Se=(de==null?void 0:de.detail)||{};Se.type==="text"&&Se.key?L(Se.key):L(null)};window.addEventListener("inkwise:active-element",v),Y();const R=document.getElementById("template-editor-container-front"),Q=document.getElementById("template-editor-container-back"),P={childList:!0,subtree:!0},Ee=de=>{let Se=!1;de.forEach(Fe=>{Fe.type==="childList"&&Fe.addedNodes.forEach(he=>{(he.nodeName==="svg"||he.querySelector&&he.querySelector("svg"))&&(Se=!0)})}),Se&&setTimeout(Y,100)},K=new MutationObserver(Ee),se=new MutationObserver(Ee);R&&K.observe(R,P),Q&&se.observe(Q,P);const ce=setInterval(()=>{const de=document.querySelector("#template-editor-container-front svg"),Se=document.querySelector("#template-editor-container-back svg"),Fe=de?de.querySelectorAll("text").length:0,he=Se?Se.querySelectorAll("text").length:0;(Fe!==s.length||he!==l.length)&&Y()},1e3),ie=()=>{setTimeout(Y,50)};window.addEventListener("inkwise:text-changed",ie);const me=()=>{setTimeout(Y,100)};document.addEventListener("show.bs.modal",me);const oe=de=>{q.current&&!q.current.contains(de.target)&&le(null)};return document.addEventListener("mousedown",oe),()=>{window.removeEventListener("inkwise:active-element",v),window.removeEventListener("inkwise:text-changed",ie),document.removeEventListener("show.bs.modal",me),document.removeEventListener("mousedown",oe),K.disconnect(),se.disconnect(),clearInterval(ce)}},[s.length,l.length]);const Y=()=>{const v=document.querySelector("#template-editor-container-front svg"),R=document.querySelector("#template-editor-container-back svg"),Q=v?Array.from(v.querySelectorAll("text")):[],P=R?Array.from(R.querySelectorAll("text")):[],Ee=Q.map((ce,ie)=>({key:ce.getAttribute("data-preview-node")||ce.id||`front-text-${ie}`,label:ce.getAttribute("data-preview-label")||`Front Text ${ie+1}`,value:ce.textContent||"",element:ce})),K=P.map((ce,ie)=>({key:ce.getAttribute("data-preview-node")||ce.id||`back-text-${ie}`,label:ce.getAttribute("data-preview-label")||`Back Text ${ie+1}`,value:ce.textContent||"",element:ce})),se={};Ee.forEach((ce,ie)=>{const me=`front-${ie}`;se[me]={"font-weight":ce.element.getAttribute("font-weight")||"normal","font-style":ce.element.getAttribute("font-style")||"normal"}}),K.forEach((ce,ie)=>{const me=`back-${ie}`;se[me]={"font-weight":ce.element.getAttribute("font-weight")||"normal","font-style":ce.element.getAttribute("font-style")||"normal"}}),X(se),c(Ee),p(K)},B=(v,R,Q)=>{const P=v==="front"?[...s]:[...l];P[R].value=Q,P[R].element.textContent=Q,v==="front"?c(P):p(P),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{key:P[R].key,value:Q}}))},M=(v,R,Q,P)=>{const Ee=v==="front"?[...s]:[...l],K=Ee[R].element;K&&(Q==="font-family"?(K.setAttribute("font-family",P),K.style.fontFamily=P):Q==="font-size"?(K.setAttribute("font-size",P),K.style.fontSize=`${P}px`):Q==="fill"?(K.setAttribute("fill",P),K.style.fill=P):Q==="font-weight"?(K.setAttribute("font-weight",P),K.style.fontWeight=P):Q==="font-style"?(K.setAttribute("font-style",P),K.style.fontStyle=P):Q==="text-anchor"&&K.setAttribute("text-anchor",P)),window.dispatchEvent(new CustomEvent("inkwise:text-style-changed",{detail:{attribute:Q,value:P,key:Ee[R].key}}));const se=`${v}-${R}`;X(ce=>({...ce,[se]:{...ce[se],[Q]:P}}))},ne=(v,R)=>{const P=(v==="front"?[...s]:[...l])[R];P&&P.element&&(P.element.remove(),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{action:"delete",key:P.key}})),setTimeout(Y,10))},De=v=>{const R=v==="front"?"template-editor-container-front":"template-editor-container-back",Q=document.querySelector(`#${R} svg`);if(!Q){console.warn(`[TextFieldsPanel] No SVG root found for ${v} side`);return}const P=Date.now(),Ee=Math.random().toString(36).slice(2,5),K=`custom_${P}_${Ee}`,se=document.createElementNS("http://www.w3.org/2000/svg","text");se.setAttribute("id",K),se.setAttribute("data-preview-node",K),se.setAttribute("data-default-text","NEW TEXT"),se.setAttribute("x","50%"),se.setAttribute("y","50%"),se.setAttribute("text-anchor","middle"),se.setAttribute("dominant-baseline","middle"),se.setAttribute("font-family","Arial, sans-serif"),se.setAttribute("font-size","24"),se.setAttribute("fill","#000000"),se.textContent="NEW TEXT",se.addEventListener("input",()=>{se.dataset.currentText=se.textContent||"",window.inkwiseToolbar&&typeof window.inkwiseToolbar.scheduleOverlaySync=="function"&&window.inkwiseToolbar.scheduleOverlaySync()}),se.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text",key:K}}))}),Q.appendChild(se);const ce={key:K,label:"Custom",value:"NEW TEXT",element:se};v==="front"?c(ie=>[...ie,ce]):p(ie=>[...ie,ce]),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{key:K,value:"NEW TEXT"}})),setTimeout(Y,50),window.inkwiseToolbar&&typeof window.inkwiseToolbar.scheduleOverlaySync=="function"&&window.inkwiseToolbar.scheduleOverlaySync()},Ue=({side:v,field:R,index:Q})=>{const P=R.element,Ee=`${v}-${Q}`,K=fe[Ee]||{},se=(P==null?void 0:P.getAttribute("font-family"))||"Arial, sans-serif",ce=parseInt((P==null?void 0:P.getAttribute("font-size"))||"24"),ie=(P==null?void 0:P.getAttribute("fill"))||"#000000",me=K["font-weight"]||(P==null?void 0:P.getAttribute("font-weight"))||"normal",oe=K["font-style"]||(P==null?void 0:P.getAttribute("font-style"))||"normal",de=(P==null?void 0:P.getAttribute("text-anchor"))||"middle",Se=W&&W.side===v&&W.index===Q,Fe=he=>{M(v,Q,"font-family",he),le(null)};return y.jsxs("div",{className:"controls-row",children:[y.jsx("select",{value:ce,onChange:he=>M(v,Q,"font-size",he.target.value),className:"size-select",children:O.map(he=>y.jsx("option",{value:he,children:he},he))}),y.jsx("input",{type:"color",value:ie,onChange:he=>M(v,Q,"fill",he.target.value),className:"color-picker"}),y.jsx("button",{onClick:()=>M(v,Q,"font-weight",me==="bold"?"normal":"bold"),className:`style-btn bold-toggle-btn ${me==="bold"?"active":""}`,title:me==="bold"?"Remove bold formatting":"Make text bold",children:"B"}),y.jsx("button",{onClick:()=>M(v,Q,"font-style",oe==="italic"?"normal":"italic"),className:`style-btn italic-btn ${oe==="italic"?"active":""}`,title:"Toggle italic",children:"I"}),y.jsx("div",{className:"align-group",children:[{value:"start",label:"L"},{value:"middle",label:"C"},{value:"end",label:"R"}].map(he=>y.jsx("button",{onClick:()=>M(v,Q,"text-anchor",he.value),className:`align-btn ${de===he.value?"active":""}`,children:he.label},he.value))}),y.jsxs("div",{className:"font-selector-container",children:[y.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>le(Se?null:{side:v,index:Q}),"aria-label":"Choose font family","aria-haspopup":"listbox","aria-expanded":Se,children:[y.jsx("span",{style:{fontFamily:se},children:se.split(",")[0]}),y.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),Se&&y.jsx("div",{className:"font-modal",ref:q,children:y.jsx("div",{className:"font-modal-content",children:U.map(he=>y.jsx("button",{type:"button",className:"font-option",onClick:()=>Fe(he),style:{fontFamily:he},children:he.split(",")[0]},he))})})]})]})};return y.jsxs("div",{className:"text-fields-panel-react",children:[y.jsxs("div",{className:"text-section",style:{marginBottom:20},children:[y.jsxs("button",{onClick:()=>x(!w),className:"section-toggle-btn",children:["Front Text Fields",y.jsx("span",{children:w?"â–¶":"â–¼"})]}),!w&&y.jsxs("div",{className:"section-content",children:[s.map((v,R)=>y.jsxs("div",{className:`field-card ${E===v.key?"active":""}`,children:[y.jsxs("div",{className:"field-header",children:[y.jsx("div",{className:"field-label",children:v.label}),y.jsx("button",{onClick:()=>ne("front",R),className:"delete-field-btn",title:"Delete this text field",children:"Ã—"})]}),y.jsx("input",{type:"text",value:v.value,onChange:Q=>B("front",R,Q.target.value),onFocus:()=>L(v.key),onBlur:()=>L(null),className:"text-input"}),y.jsx(Ue,{side:"front",field:v,index:R})]},v.key)),y.jsxs("button",{onClick:()=>De("front"),className:"add-section-field-btn",children:[y.jsx("span",{children:"+"}),"New Front Text Field"]})]})]}),y.jsxs("div",{className:"text-section",style:{marginBottom:20},children:[y.jsxs("button",{onClick:()=>k(!A),className:"section-toggle-btn",children:["Back Text Fields",y.jsx("span",{children:A?"â–¶":"â–¼"})]}),!A&&y.jsxs("div",{className:"section-content",children:[l.map((v,R)=>y.jsxs("div",{className:`field-card ${E===v.key?"active":""}`,children:[y.jsxs("div",{className:"field-header",children:[y.jsx("div",{className:"field-label",children:v.label}),y.jsx("button",{onClick:()=>ne("back",R),className:"delete-field-btn",title:"Delete this text field",children:"Ã—"})]}),y.jsx("input",{type:"text",value:v.value,onChange:Q=>B("back",R,Q.target.value),onFocus:()=>L(v.key),onBlur:()=>L(null),className:"text-input"}),y.jsx(Ue,{side:"back",field:v,index:R})]},v.key)),y.jsxs("button",{onClick:()=>De("back"),className:"add-section-field-btn",children:[y.jsx("span",{children:"+"}),"New Back Text Field"]})]})]})]})}const Ea=["1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png","9.png","10.png","e.png","f.png","h.png","r.png"];function Ca({bootstrap:ae={}}){const[s,c]=Ne.useState(null),[l,p]=Ne.useState("front"),w=x=>{c(x);const A=`/customerVideo/studio/${x}`;window.dispatchEvent(new CustomEvent("inkwise:graphic-selected",{detail:{category:"studio-images",item:{id:x,name:x,thumbnail:A,full:A,type:"image",source:"studio"},side:l}})),window.dispatchEvent(new CustomEvent("inkwise:apply-background",{detail:{side:l,image:A,type:"image"}}))};return y.jsxs("div",{className:"graphics-panel-react",children:[y.jsxs("div",{className:"graphics-header",children:[y.jsx("h3",{children:"Graphics Library"}),y.jsxs("div",{className:"graphics-side-toggle",children:[y.jsx("button",{className:`side-toggle-btn ${l==="front"?"active":""}`,onClick:()=>p("front"),children:"Front"}),y.jsx("button",{className:`side-toggle-btn ${l==="back"?"active":""}`,onClick:()=>p("back"),children:"Back"})]})]}),y.jsx("div",{className:"graphics-content-scroll",children:y.jsx("div",{className:"graphics-items-grid",children:Ea.map(x=>y.jsxs("div",{className:`graphics-item-card ${s===x?"selected":""}`,onClick:()=>w(x),children:[y.jsxs("div",{className:"item-preview",children:[y.jsx("img",{src:`/customerVideo/studio/${x}`,alt:x,loading:"lazy",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),y.jsx("div",{className:"item-fallback-icon",style:{display:"none"},children:y.jsx("i",{className:"fa-solid fa-image"})})]}),y.jsx("div",{className:"item-action",children:y.jsx("i",{className:"fa-solid fa-plus"})}),y.jsx("div",{className:"item-name",children:x})]},x))})})]})}function Yt(){const ae=document.getElementById("inkwise-customer-studio-bootstrap");if(ae)try{const s=JSON.parse(ae.textContent||"{}");if(s&&typeof s=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=s),s}catch(s){console.error("[InkWise Studio] Failed to parse bootstrap payload.",s)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Ia({template:ae}){if(!ae)return y.jsx("span",{className:"studio-status__message",children:"Template data unavailable"});const s=ae.updated_at?new Date(ae.updated_at):null,c=s&&!Number.isNaN(s.getTime())?s.toLocaleString():"Not yet saved";return y.jsxs("div",{className:"studio-status__summary",children:[y.jsx("span",{className:"studio-status__template-name",title:ae.name||"Untitled Template",children:ae.name||"Untitled Template"}),ae.svg_path&&y.jsx("span",{className:"studio-status__badge studio-status__badge--svg",children:"SVG ready"}),ae.preview&&y.jsx("span",{className:"studio-status__badge studio-status__badge--preview",children:"Preview loaded"}),y.jsxs("span",{className:"studio-status__meta",children:["Updated: ",c]})]})}function Na({bootstrap:ae,status:s}){const c=(ae==null?void 0:ae.template)??null,l=(ae==null?void 0:ae.product)??null,p=s==="ready"?"Design canvas ready":s==="initializing"?"Preparing editorâ€¦":s;return y.jsxs("div",{className:"studio-status",role:"status","aria-live":"polite",children:[y.jsxs("div",{className:"studio-status__header",children:[y.jsx("span",{className:"studio-status__dot","data-state":s}),y.jsx("span",{className:"studio-status__label",children:p})]}),y.jsx(Ia,{template:c}),l&&y.jsxs("div",{className:"studio-status__product",children:["Editing: ",l.name||`Product #${l.id}`]})]})}function La(){const ae=Ne.useMemo(()=>Yt(),[]),[s,c]=Ne.useState("initializing"),[l,p]=Ne.useState(null);Ne.useEffect(()=>{if(typeof document>"u")return;const x=l==="text"||l==="image";return document.body.classList.toggle("text-toolbar-visible",!!x),()=>{document.body.classList.remove("text-toolbar-visible")}},[l]),Ne.useEffect(()=>{wa(),c("ready")},[]),Ne.useEffect(()=>{if(typeof window>"u")return;const x=k=>{const E=(k==null?void 0:k.detail)||{};p(E.type||null)};window.addEventListener("inkwise:active-element",x);const A=window.inkwiseToolbar;if(A&&typeof A.getSelection=="function")try{const k=A.getSelection();k&&k.type&&p(k.type)}catch(k){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",k)}return()=>{window.removeEventListener("inkwise:active-element",x)}},[]),Ne.useEffect(()=>{if(typeof window>"u")return;const x=A=>{const{category:k,item:E,side:L}=A.detail||{};!E||!L||w(E,L,k)};return window.addEventListener("inkwise:graphic-selected",x),()=>{window.removeEventListener("inkwise:graphic-selected",x)}},[]);const w=(x,A,k)=>{var E,L,W,le;try{const fe=document.querySelector(`#template-editor-container-${A}`);if(!fe){console.warn(`Canvas container for ${A} not found`);return}const X=fe.querySelector("svg");if(!X){console.warn(`SVG element for ${A} not found`);return}let q;if(k==="shapes"&&x.svg){const Y=new DOMParser().parseFromString(x.svg,"image/svg+xml").documentElement;for(q=document.createElementNS("http://www.w3.org/2000/svg","g"),q.setAttribute("class","inkwise-graphic inkwise-shape"),q.setAttribute("data-graphic-type","shape"),q.setAttribute("data-graphic-source",x.source);Y.firstChild;)q.appendChild(Y.firstChild);const B=q.getBBox(),ne=`translate(50, 50) scale(${Math.min(100/Math.max(B.width,B.height),1)})`;q.setAttribute("transform",ne)}else if(x.thumbnail||x.full){const U=document.createElementNS("http://www.w3.org/2000/svg","g");U.setAttribute("class",`inkwise-graphic inkwise-${k.slice(0,-1)} inkwise-graphic-group`),U.setAttribute("data-graphic-type",k.slice(0,-1)),U.setAttribute("data-graphic-source",x.source);const O=document.createElementNS("http://www.w3.org/2000/svg","image");O.setAttribute("class","inkwise-graphic-image");const Y=x.full||x.thumbnail;O.setAttributeNS("http://www.w3.org/1999/xlink","href",Y);const B=((L=(E=X.viewBox)==null?void 0:E.baseVal)==null?void 0:L.width)||X.clientWidth||400,M=((le=(W=X.viewBox)==null?void 0:W.baseVal)==null?void 0:le.height)||X.clientHeight||300,ne=Math.min(B,M)*.3,De=(B-ne)/2,Ue=(M-ne)/2;O.setAttribute("x",0),O.setAttribute("y",0),O.setAttribute("width",ne),O.setAttribute("height",ne),O.setAttribute("preserveAspectRatio","xMidYMid meet");const v=document.createElementNS("http://www.w3.org/2000/svg","rect");v.setAttribute("class","inkwise-bounding-box"),v.setAttribute("x",0),v.setAttribute("y",0),v.setAttribute("width",ne),v.setAttribute("height",ne),v.setAttribute("fill","none"),v.setAttribute("stroke","#3b82f6"),v.setAttribute("stroke-width","2"),v.setAttribute("stroke-dasharray","5,5"),v.setAttribute("opacity","0"),v.setAttribute("pointer-events","none");const R=[];[{x:0,y:0,cursor:"nw-resize"},{x:ne,y:0,cursor:"ne-resize"},{x:ne,y:ne,cursor:"se-resize"},{x:0,y:ne,cursor:"sw-resize"}].forEach((ce,ie)=>{const me=document.createElementNS("http://www.w3.org/2000/svg","circle");me.setAttribute("class","inkwise-resize-handle"),me.setAttribute("cx",ce.x),me.setAttribute("cy",ce.y),me.setAttribute("r","6"),me.setAttribute("fill","#3b82f6"),me.setAttribute("stroke","white"),me.setAttribute("stroke-width","2"),me.setAttribute("style",`cursor: ${ce.cursor}; opacity: 0; pointer-events: none;`),me.setAttribute("data-handle-index",ie),R.push(me)}),U.addEventListener("click",ce=>{ce.stopPropagation(),document.querySelectorAll(".inkwise-graphic-group").forEach(ie=>{ie.classList.remove("selected")}),U.classList.add("selected")});let P=!1,Ee,K,se;U.addEventListener("mousedown",ce=>{if(ce.target.classList.contains("inkwise-resize-handle"))return;P=!0,Ee=ce.clientX,K=ce.clientY;const me=(U.getAttribute("transform")||"translate(0,0)").match(/translate\(([^,]+),\s*([^)]+)\)/);me?se={x:parseFloat(me[1]),y:parseFloat(me[2])}:se={x:0,y:0},ce.preventDefault()}),document.addEventListener("mousemove",ce=>{if(!P)return;const ie=ce.clientX-Ee,me=ce.clientY-K,oe=se.x+ie,de=se.y+me;U.setAttribute("transform",`translate(${oe}, ${de})`)}),document.addEventListener("mouseup",()=>{P=!1}),R.forEach((ce,ie)=>{let me=!1,oe,de,Se,Fe;ce.addEventListener("mousedown",he=>{me=!0,oe=he.clientX,de=he.clientY;const We=(U.getAttribute("transform")||"translate(0,0)").match(/translate\(([^,]+),\s*([^)]+)\)/);Fe=We?{x:parseFloat(We[1]),y:parseFloat(We[2])}:{x:0,y:0},Se=parseFloat(v.getAttribute("width")),he.preventDefault(),he.stopPropagation()}),document.addEventListener("mousemove",he=>{if(!me)return;const ze=he.clientX-oe,We=he.clientY-de;let Ve=Se;switch(ie){case 0:Ve=Math.max(20,Se-Math.max(ze,We));break;case 1:Ve=Math.max(20,Se+ze);break;case 2:Ve=Math.max(20,Se+Math.max(ze,We));break;case 3:Ve=Math.max(20,Se+We);break}v.setAttribute("width",Ve),v.setAttribute("height",Ve),O.setAttribute("width",Ve),O.setAttribute("height",Ve);const et=[{x:0,y:0},{x:Ve,y:0},{x:Ve,y:Ve},{x:0,y:Ve}];R.forEach((mt,At)=>{mt.setAttribute("cx",et[At].x),mt.setAttribute("cy",et[At].y)})}),document.addEventListener("mouseup",()=>{me=!1})}),q=U}if(q){if(X.appendChild(q),window.inkwiseEditors&&window.inkwiseEditors[A]){const U=window.inkwiseEditors[A];U&&typeof U.refreshInteractiveElements=="function"&&U.refreshInteractiveElements()}window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:A,action:"graphic-added",element:q}})),console.log(`Added ${k} graphic to ${A} canvas:`,x.name)}}catch(fe){console.error("Error adding graphic to canvas:",fe)}};return!ae||Object.keys(ae).length===0?null:y.jsx("div",{className:"studio-status-wrapper",children:y.jsx(Na,{bootstrap:ae,status:s})})}function Ta(){const ae=()=>{const s=document.getElementById("inkwise-customer-studio-root");if(!s)return;Vt.createRoot(s).render(y.jsx(Xt.StrictMode,{children:y.jsx(La,{})}));try{const l=document.getElementById("template-editor-root");if(l){const p=Yt();Vt.createRoot(l).render(y.jsx(Xt.StrictMode,{children:y.jsx(xa,{bootstrap:p})}))}}catch(l){console.debug("[InkWise Studio] Failed to mount TemplateEditor",l)}try{const l=document.getElementById("colors-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(y.jsx(Xt.StrictMode,{children:y.jsx(ka,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount ColorsPanel",l)}try{const l=document.getElementById("text-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(y.jsx(Xt.StrictMode,{children:y.jsx(Aa,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount TextFieldsPanel",l)}try{const l=document.getElementById("graphics-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(y.jsx(Xt.StrictMode,{children:y.jsx(Ca,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount GraphicsPanel",l)}};if(document.readyState==="complete"||document.readyState==="interactive"){ae();return}document.addEventListener("DOMContentLoaded",ae,{once:!0})}Ta();
