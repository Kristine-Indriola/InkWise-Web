import{r as Ie,j as b,c as Vt,R as Xt}from"./client-Cv0X-2PX.js";const qt="http://www.w3.org/2000/svg",Mn="http://www.w3.org/1999/xlink";class Kt{constructor(s,u={}){console.log("SvgTemplateEditor: Constructor called for SVG element:",s),this.svg=s,this.options={onImageChange:u.onImageChange||null,onTextChange:u.onTextChange||null,...u};const l=document&&document.body&&document.body.dataset?document.body.dataset:{},p=(l.imageReplacementMode||"").toLowerCase();let w="full";p==="panel-only"||p==="disabled"?w=p:l.allowImageReplacement==="false"&&(w="disabled"),this.imageReplacementMode=w,this.allowCanvasImageTools=w!=="disabled",this.changeableImages=[],this.textElements=[],this.imageClassTokens=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),this.init()}init(){console.log("SvgTemplateEditor: Initializing..."),this.parseSvgData(),this.setupImageHandlers(),this.setupTextHandlers(),this.addCssStyles(),typeof window<"u"&&window.addEventListener("inkwise:text-style-changed",s=>{try{const u=s&&s.detail?s.detail:{},{attribute:l,value:p,key:w}=u;if(!l)return;const x=this._currentInlineEditor||null;if(x&&x.element){const S=x.element.getAttribute("data-preview-node")||x.element.id||null;if(w&&S&&w!==S)return;const k=x.editable;if(!k)return;if(l==="font-family")x.element.setAttribute("font-family",String(p)),x.element.style&&(x.element.style.fontFamily=String(p)),k.style.fontFamily=String(p)||k.style.fontFamily;else if(l==="font-size"){const C=Number(p);Number.isFinite(C)&&(x.element.setAttribute("font-size",String(C)),x.element.style&&(x.element.style.fontSize=`${C}px`),k.style.fontSize=`${C}px`)}else(l==="fill"||l==="color")&&(x.element.setAttribute("fill",String(p)),x.element.style&&(x.element.style.fill=String(p)),k.style.color=String(p)||k.style.color);x.element._boundingBox&&x.element._boundingBox.classList.add("svg-bounding-box--active");return}let A=[];if(w&&typeof w=="string")try{const S=typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(w):w;A=Array.from(this.svg.querySelectorAll(`[data-preview-node="${S}"]`))}catch{A=Array.from(this.svg.querySelectorAll(`[data-preview-node="${w}"]`))}if(!A.length){const S=this.svg.querySelector(".svg-text-focus");S&&A.push(S)}A.forEach(S=>{if(S){if(l==="font-family"){S.setAttribute("font-family",String(p)),S.style&&(S.style.fontFamily=String(p));try{const k=S.getAttribute("style")||"";S.setAttribute("style",`font-family: '${String(p)}', system-ui, sans-serif; ${k}`)}catch{}}else if(l==="font-size"){const k=Number(p);Number.isFinite(k)&&(S.setAttribute("font-size",String(k)),S.style&&(S.style.fontSize=`${k}px`))}else(l==="fill"||l==="color")&&(S.setAttribute("fill",String(p)),S.style&&(S.style.fill=String(p)));try{this.updateBoundingBox(S)}catch{}try{S._boundingBox&&S._boundingBox.classList.add("svg-bounding-box--active")}catch{}}})}catch(u){console.warn("SvgTemplateEditor: failed to apply toolbar style change to inline editor or SVG nodes",u)}}),console.log("SvgTemplateEditor: Initialization complete")}parseSvgData(){const s=this.svg.dataset.svgData;if(s)try{const u=JSON.parse(s);this.changeableImages=u.changeable_images||[],this.textElements=u.text_elements||[],this.textElements.forEach(l=>{const p=this.svg.querySelector(`[data-element-id="${l.id}"]`)||this.svg.querySelector(`#${l.id}`);p&&p.setAttribute("data-editable","true")})}catch(u){console.warn("SvgTemplateEditor: Failed to parse data-svg-data payload",u),this.fallbackParseSvg()}else this.fallbackParseSvg()}fallbackParseSvg(){console.log("SvgTemplateEditor: Using fallback SVG parsing"),this.changeableImages=[],this.textElements=[],this.svg.querySelectorAll("text").forEach((l,p)=>{const w=`fallback-text-${p}`;l.setAttribute("data-element-id",w),l.setAttribute("data-editable","true"),this.textElements.push({id:w,text:l.textContent||"",fontFamily:l.getAttribute("font-family")||"Arial",fontSize:parseFloat(l.getAttribute("font-size"))||16,fill:l.getAttribute("fill")||"#000000",x:parseFloat(l.getAttribute("x"))||0,y:parseFloat(l.getAttribute("y"))||0})}),this.svg.querySelectorAll("image, img").forEach((l,p)=>{const w=`fallback-image-${p}`;l.setAttribute("data-element-id",w),l.setAttribute("data-changeable","image"),this.changeableImages.push({id:w,src:l.getAttribute("href")||l.getAttribute("src")||"",x:parseFloat(l.getAttribute("x"))||0,y:parseFloat(l.getAttribute("y"))||0,width:parseFloat(l.getAttribute("width"))||100,height:parseFloat(l.getAttribute("height"))||100})}),console.log("SvgTemplateEditor: Fallback parsed",this.textElements.length,"text elements,",this.changeableImages.length,"images")}readDatasetTokens(s){return!s||!s.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(l=>s.dataset[l]).filter(l=>typeof l=="string"&&l.trim()!=="").map(l=>l.trim().toLowerCase())}findImageContentNode(s){return!s||typeof s.querySelector!="function"?null:s.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image')}nodeRepresentsImage(s){if(!s)return!1;const u=typeof s.tagName=="string"?s.tagName.toLowerCase():"";if(u==="image"||u==="img"||this.readDatasetTokens(s).some(p=>p==="image"||p==="photo"||p==="graphic")||typeof s.hasAttribute=="function"&&(s.hasAttribute("data-editable-image")||s.hasAttribute("data-changeable-image")))return!0;if(s.classList){for(const p of this.imageClassTokens)if(s.classList.contains(p))return!0}return u==="foreignobject"?!!this.findImageContentNode(s):!1}resolveImageNode(s){if(!s)return null;if(this.nodeRepresentsImage(s))return s;if(typeof s.closest=="function"){const u=s.closest("[data-preview-node]");if(u&&u!==s&&this.nodeRepresentsImage(u))return u}return this.findImageContentNode(s)}resolveImageHandleNodes(s){const u=this.resolveImageNode(s);return u?{interactionNode:typeof u.closest=="function"&&u.closest("foreignObject")||u,contentNode:u}:null}applyImageSourceToNode(s,u){if(!s||!u)return null;const l=typeof s.tagName=="string"?s.tagName.toLowerCase():"";if(l==="image")return s.setAttributeNS(Mn,"href",u),s.setAttribute("href",u),s.dataset&&(s.dataset.src=u),s;if(l==="img")return s.setAttribute("src",u),s.dataset&&(s.dataset.src=u),s;if(l==="foreignobject"){const p=this.findImageContentNode(s);return p&&p!==s?this.applyImageSourceToNode(p,u):null}return l==="rect"?this.convertRectToImage(s,u):(s.style&&typeof s.style.setProperty=="function"&&(s.style.backgroundImage=`url('${u}')`),s.dataset&&(s.dataset.src=u,s.dataset.replacedImage="true"),s)}convertRectToImage(s,u){if(!s||!s.parentNode)return null;const l=document.createElementNS(qt,"image");return["x","y","width","height","transform","preserveAspectRatio"].forEach(w=>{s.hasAttribute&&s.hasAttribute(w)&&l.setAttribute(w,s.getAttribute(w))}),Array.from(s.attributes||[]).forEach(w=>{(w.name==="id"||w.name.startsWith("data-"))&&l.setAttribute(w.name,w.value)}),s.classList&&s.classList.length&&s.classList.forEach(w=>l.classList.add(w)),l.setAttribute("href",u),l.setAttributeNS(Mn,"href",u),l.hasAttribute("preserveAspectRatio")||l.setAttribute("preserveAspectRatio","xMidYMid slice"),s.parentNode.replaceChild(l,s),l}escapeSelector(s){return typeof s!="string"||!s.length?"":typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(s):s.replace(/([^a-zA-Z0-9_-])/g,"\\$1")}resolveNodeFromMetadata(s){if(!s||typeof s!="object")return null;const u=s.id||s.element_id||s.node_id;if(u){const p=`#${this.escapeSelector(u)}`,w=this.svg.querySelector(p);if(w)return w}const l=s.selector||s.css_selector;if(l)try{const p=this.svg.querySelector(l);if(p)return p}catch(p){console.warn("SvgTemplateEditor: Invalid selector in changeable image metadata",l,p)}return null}collectImageCandidates(){const s=new Set;return this.changeableImages.forEach(l=>{const p=this.resolveNodeFromMetadata(l);p&&s.add(p)}),this.svg.querySelectorAll('[data-changeable="image"], [data-editable-image], .changeable-image, .canvas-layer__image, image, img, foreignObject').forEach(l=>{s.add(l)}),Array.from(s)}getBBoxSafe(s){if(!s||typeof s.getBBox!="function")return null;try{return s.getBBox()}catch(u){return console.warn("SvgTemplateEditor: Unable to compute bounding box for element",u,s),null}}toSvgPoint(s,u){if(!this.svg||typeof this.svg.createSVGPoint!="function")return null;const l=this.svg.createSVGPoint();l.x=s,l.y=u;const p=this.svg.getScreenCTM();return p?l.matrixTransform(p.inverse()):null}setupImageHandlers(){const s=this.collectImageCandidates();if(console.log("SvgTemplateEditor: Found",s.length,"changeable image elements"),!this.allowCanvasImageTools){s.forEach(u=>{const l=this.resolveImageHandleNodes(u);if(!l)return;const{interactionNode:p}=l;if(p.style.cursor="default",p.classList.remove("svg-changeable-image"),p.classList.remove("changeable-image-hover"),p._boundingBox){try{p._boundingBox.remove()}catch{}p._boundingBox=null}});return}setTimeout(()=>{s.forEach((u,l)=>{const p=this.resolveImageHandleNodes(u);if(!p)return;const{interactionNode:w,contentNode:x}=p;if(!w||w.__inkwiseSvgImageBound)return;console.log("SvgTemplateEditor: Setting up element",l,w),w.__inkwiseSvgImageBound=!0,w.__inkwiseImageContent=x||w,w.style.cursor="pointer",w.classList.add("svg-changeable-image"),w.classList.add("changeable-image-hover"),w.addEventListener("mouseenter",()=>{w.classList.add("changeable-image-active")}),w.addEventListener("mouseleave",()=>{w.classList.remove("changeable-image-active")}),w.addEventListener("click",S=>{S.preventDefault(),this.showImageUploadDialog(w)});const A=this.createBoundingBox(w);A&&(w._boundingBox=A),this.makeDraggable(w)})},200)}createBoundingBox(s){const u=this.getBBoxSafe(s);if(!u)return null;const l=document.createElementNS(qt,"g");l.classList.add("svg-bounding-box");const p=document.createElementNS(qt,"rect");return p.classList.add("svg-bounding-box__rect"),p.setAttribute("fill","transparent"),p.setAttribute("stroke","#007cba"),p.setAttribute("stroke-width","2"),p.setAttribute("stroke-dasharray","5,5"),p.setAttribute("rx","3"),p.style.pointerEvents="all",l.appendChild(p),this.createResizeHandles().forEach(x=>l.appendChild(x)),l.style.pointerEvents="all",l.style.cursor="pointer",l.addEventListener("click",x=>{try{x.preventDefault(),x.stopPropagation();const A=l._targetElement||s,k=(this.resolveImageHandleNodes(A)||{interactionNode:A}).interactionNode||A;this.focusElement(k)}catch(A){console.warn("SvgTemplateEditor: bbox click handler error",A)}}),this.svg.appendChild(l),this.positionBoundingElements(l,u),l}createResizeHandles(){const s=[];return[{name:"nw",x:0,y:0},{name:"ne",x:1,y:0},{name:"sw",x:0,y:1},{name:"se",x:1,y:1}].forEach(l=>{const p=document.createElementNS(qt,"circle");p.setAttribute("r","4"),p.setAttribute("fill","#007cba"),p.setAttribute("stroke","#ffffff"),p.setAttribute("stroke-width","1"),p.classList.add("resize-handle",`handle-${l.name}`),p.style.pointerEvents="all",p.style.cursor=`${l.name}-resize`,s.push(p)}),s}positionBoundingElements(s,u){if(!s||!u)return;const l=s.querySelector(".svg-bounding-box__rect");if(!l)return;const p=5,w=u.x-p,x=u.y-p,A=u.width+p*2,S=u.height+p*2;l.setAttribute("x",w),l.setAttribute("y",x),l.setAttribute("width",Math.max(A,0)),l.setAttribute("height",Math.max(S,0)),s.querySelectorAll(".resize-handle").forEach(C=>{C.classList.contains("handle-nw")?(C.setAttribute("cx",w),C.setAttribute("cy",x)):C.classList.contains("handle-ne")?(C.setAttribute("cx",w+A),C.setAttribute("cy",x)):C.classList.contains("handle-sw")?(C.setAttribute("cx",w),C.setAttribute("cy",x+S)):C.classList.contains("handle-se")?(C.setAttribute("cx",w+A),C.setAttribute("cy",x+S)):C.classList.contains("handle-n")?(C.setAttribute("cx",w+A/2),C.setAttribute("cy",x)):C.classList.contains("handle-s")?(C.setAttribute("cx",w+A/2),C.setAttribute("cy",x+S)):C.classList.contains("handle-e")?(C.setAttribute("cx",w+A),C.setAttribute("cy",x+S/2)):C.classList.contains("handle-w")&&(C.setAttribute("cx",w),C.setAttribute("cy",x+S/2))})}updateBoundingBox(s){if(!s||!s._boundingBox)return;const u=this.getBBoxSafe(s);this.positionBoundingElements(s._boundingBox,u)}focusElementById(s){if(!s||!this.svg)return!1;const u=`#${this.escapeSelector(s)}`;let l=null;try{l=this.svg.querySelector(u)}catch(p){return console.warn("SvgTemplateEditor: Invalid selector generated for element id",s,p),!1}return l||(l=this.svg.querySelector(`[data-element-id="${s}"]`)),l?this.focusElement(l):!1}focusElement(s){const l=(this.resolveImageHandleNodes(s)||{interactionNode:s}).interactionNode||s;if(!this.getBBoxSafe(l))return!1;if(l._boundingBox||(l._boundingBox=this.createBoundingBox(l),l._boundingBox&&(l._boundingBox._targetElement=l,l._boundingBox.querySelectorAll(".resize-handle").forEach(x=>this.makeResizable(l,x)),this.makeDraggable(l._boundingBox))),this.updateBoundingBox(l),l._boundingBox&&(l._boundingBox.classList.add("svg-bounding-box--pulse"),setTimeout(()=>{l._boundingBox&&l._boundingBox.classList.remove("svg-bounding-box--pulse")},1e3)),typeof l.scrollIntoView=="function"&&l.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),l.classList.add("changeable-image-active"),setTimeout(()=>l.classList.remove("changeable-image-active"),1200),l.tagName&&l.tagName.toLowerCase()==="text"){const w=l.getAttribute("data-preview-node")||l.id||null;try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text",key:w}}))}catch{if(typeof document<"u"&&document.createEvent){const A=document.createEvent("CustomEvent");A.initCustomEvent("inkwise:active-element",!0,!0,{type:"text",key:w}),window.dispatchEvent(A)}}this.showTextEditDialog(l)}return!0}makeDraggable(s){let u=!1,l=0,p=0,w=0,x=0,A=0,S=0;const k=s._targetElement||s,C=pe=>{if(pe.target.closest(".resize-handle"))return;const G=this.toSvgPoint(pe.clientX,pe.clientY);if(!G)return;const z=this.getBBoxSafe(k);if(!z)return;const U=typeof k.getAttribute=="function",H=typeof k.setAttribute=="function";l=U?parseFloat(k.getAttribute("x")):z.x,p=U?parseFloat(k.getAttribute("y")):z.y,Number.isNaN(l)&&(l=z.x,H&&k.setAttribute("x",l)),Number.isNaN(p)&&(p=z.y,H&&k.setAttribute("y",p)),w=G.x-l,x=G.y-p,A=l,S=p,u=!0,s.style.cursor="grabbing",this.svg.style.cursor="grabbing",document.body.style.userSelect="none",pe.preventDefault()},j=pe=>{if(!u)return;const G=this.toSvgPoint(pe.clientX,pe.clientY);G&&(A=G.x-w,S=G.y-x,typeof k.removeAttribute=="function"&&k.removeAttribute("transform"),typeof k.setAttribute=="function"&&(k.setAttribute("x",A),k.setAttribute("y",S)),this.updateBoundingBox(k),pe.preventDefault())},ce=pe=>{if(!u)return;u=!1,s.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="",this.updateBoundingBox(k);const G=new CustomEvent("svgImageMoved",{detail:{element:k,x:A,y:S}});this.svg.dispatchEvent(G),pe.preventDefault()};s.addEventListener("mousedown",C),document.addEventListener("mousemove",j),document.addEventListener("mouseup",ce),s._boundingBox&&s._boundingBox.querySelectorAll(".resize-handle").forEach(G=>{this.makeResizable(s,G)})}makeResizable(s,u){let l=!1,p=null,w=0,x=0,A=0,S=0,k="",C=0;const j=G=>{const z=this.toSvgPoint(G.clientX,G.clientY);if(!z)return;const U=this.getBBoxSafe(s);if(!U)return;w=U.width,x=U.height;const H=typeof s.getAttribute=="function",X=typeof s.setAttribute=="function";A=H?parseFloat(s.getAttribute("x")):U.x,S=H?parseFloat(s.getAttribute("y")):U.y,Number.isNaN(A)&&(A=U.x,X&&s.setAttribute("x",A)),Number.isNaN(S)&&(S=U.y,X&&s.setAttribute("y",S)),C=parseFloat(s.getAttribute("font-size"))||parseFloat(window.getComputedStyle(s).fontSize)||16,p=z,k=Array.from(u.classList).find(_=>_.startsWith("handle-"))||"",l=!0,s.style.cursor=u.style.cursor,this.svg.style.cursor=u.style.cursor,document.body.style.userSelect="none",G.preventDefault(),G.stopPropagation()},ce=G=>{if(!l)return;const z=this.toSvgPoint(G.clientX,G.clientY);if(!z)return;const U=z.x-p.x,H=z.y-p.y;let X=w,_=x,P=A,re=S;switch(k){case"handle-se":X=w+U,_=x+H;break;case"handle-sw":X=w-U,_=x+H,P=A+U;break;case"handle-ne":X=w+U,_=x-H,re=S+H;break;case"handle-nw":X=w-U,_=x-H,P=A+U,re=S+H;break}X=Math.max(20,X),_=Math.max(20,_);const De=s.tagName.toLowerCase();if((De==="image"||De==="rect")&&typeof s.setAttribute=="function")s.setAttribute("width",X),s.setAttribute("height",_),s.setAttribute("x",P),s.setAttribute("y",re);else{const Ue=Math.max(1,w),v=Math.max(1,x),$=X/Ue,Z=_/v,D=Math.max($,Z),Ee=Math.max(6,C*D);typeof s.setAttribute=="function"&&s.setAttribute("font-size",Ee)}this.updateBoundingBox(s),G.preventDefault(),G.stopPropagation()},pe=G=>{if(!l)return;l=!1,s.style.cursor="pointer",this.svg.style.cursor="default",document.body.style.userSelect="";const z={element:s,width:parseFloat(s.getAttribute?s.getAttribute("width"):"")||w,height:parseFloat(s.getAttribute?s.getAttribute("height"):"")||x,x:parseFloat(s.getAttribute?s.getAttribute("x"):"")||A,y:parseFloat(s.getAttribute?s.getAttribute("y"):"")||S},U=new CustomEvent("svgImageResized",{detail:z});this.svg.dispatchEvent(U),G.preventDefault(),G.stopPropagation()};u.addEventListener("mousedown",j),document.addEventListener("mousemove",ce),document.addEventListener("mouseup",pe)}setupTextHandlers(){const s=this;this.svg.querySelectorAll('[data-editable="true"]').forEach(l=>{l.style.cursor="pointer",l.classList.add("svg-editable-text"),l.addEventListener("click",function(p){p.preventDefault(),s.focusElement(l)}),l.addEventListener("mouseenter",function(){l.classList.add("editable-text-hover")}),l.addEventListener("mouseleave",function(){l.classList.remove("editable-text-hover")})})}showImageUploadDialog(s){const u=this,l=document.createElement("input");l.type="file",l.accept="image/*",l.style.display="none",l.addEventListener("change",function(p){const w=p.target.files[0];w&&u.handleImageUpload(w,s),l.parentNode&&l.parentNode.removeChild(l)}),document.body.appendChild(l),l.click()}async handleImageUpload(s,u){var C;const l=this,p=u&&u.__inkwiseImageContent?u.__inkwiseImageContent:u,w=((C=document.querySelector('meta[name="csrf-token"]'))==null?void 0:C.getAttribute("content"))||null,x=new FormData;x.append("image",s),w&&x.append("_token",w);let A=null;try{const j=await fetch("/design/upload-image",{method:"POST",body:x,credentials:"same-origin"});if(!j.ok){const pe=await j.text().catch(()=>"");throw new Error(`Upload failed (${j.status}): ${pe}`)}const ce=await j.json();A=ce.url||ce.path||null}catch(j){console.error("SvgTemplateEditor: Failed to upload image",j),alert("We could not upload your image. Please try again.");const ce=new CustomEvent("svgImageUploadFailed",{detail:{error:j,file:s}});l.svg.dispatchEvent(ce);return}if(!A){alert("Upload did not return a usable image URL.");return}const S=l.applyImageSourceToNode(p,A)||p;u&&S&&u.__inkwiseImageContent!==S&&(u.__inkwiseImageContent=S);const k=new CustomEvent("svgImageChanged",{detail:{element:S,imageUrl:A,file:s}});l.svg.dispatchEvent(k),l.options.onImageChange&&l.options.onImageChange(S,A,s),l.updateBoundingBox(u||S)}showTextEditDialog(s){const u=this,l=s.textContent||"",p=this.getBBoxSafe(s);if(!p)return;const w=2,x=document.createElementNS(qt,"foreignObject");x.setAttribute("x",p.x-w),x.setAttribute("y",p.y-w),x.setAttribute("width",Math.max(p.width+w*2,40)),x.setAttribute("height",Math.max(p.height+w*2,20)),x.classList.add("svg-text-foreignobject"),x.style.pointerEvents="all";const A="http://www.w3.org/1999/xhtml",S=document.createElementNS(A,"div");S.setAttribute("xmlns",A),S.contentEditable="true",S.className="svg-text-editor-fo";const k=window.getComputedStyle(s);S.style.fontSize=k.fontSize||"16px",S.style.fontFamily=k.fontFamily||"sans-serif",S.style.lineHeight=k.lineHeight||"1";const C=s.getAttribute("fill")||k.color||"#000";S.style.color=C,S.style.width="100%",S.style.height="100%",S.style.background="transparent",S.style.padding="2px",S.style.outline="none",S.style.overflow="hidden",S.style.resize="none",S.style.whiteSpace="pre",S.style.textAlign=s.getAttribute("text-anchor")==="middle"?"center":"left",S.style.caretColor="#007cba",S.textContent=l,s.style.visibility="hidden";const j=function(X=!0){try{pe&&(G&&pe.removeEventListener("mousedown",G),z&&pe.removeEventListener("mouseup",z))}catch{}const _=S.textContent||"";if(s.style.visibility="visible",x.parentNode&&x.parentNode.removeChild(x),X){for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(document.createTextNode(_));const P=new CustomEvent("svgTextChanged",{detail:{element:s,oldText:l,newText:_}});u.svg.dispatchEvent(P),u.options.onTextChange&&u.options.onTextChange(s,l,_)}s._boundingBox&&s._boundingBox.classList.remove("svg-bounding-box--active");try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:null}}))}catch{if(typeof document<"u"&&document.createEvent){const re=document.createEvent("CustomEvent");re.initCustomEvent("inkwise:active-element",!0,!0,{type:null}),window.dispatchEvent(re)}}},ce=function(){try{pe&&(G&&pe.removeEventListener("mousedown",G),z&&pe.removeEventListener("mouseup",z))}catch{}s.style.visibility="visible",x.parentNode&&x.parentNode.removeChild(x),s._boundingBox&&s._boundingBox.classList.remove("svg-bounding-box--active");try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:null}}))}catch{if(typeof document<"u"&&document.createEvent){const _=document.createEvent("CustomEvent");_.initCustomEvent("inkwise:active-element",!0,!0,{type:null}),window.dispatchEvent(_)}}},pe=typeof document<"u"?document.querySelector(".studio-react-widgets"):null;let G=null,z=null,U=!1;pe&&(G=function(){U=!0},z=function(){setTimeout(()=>{U=!1;try{S.focus()}catch{}},0)},pe.addEventListener("mousedown",G),pe.addEventListener("mouseup",z)),S.addEventListener("focus",function(){try{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text"}}))}catch{if(typeof document<"u"&&document.createEvent){const _=document.createEvent("CustomEvent");_.initCustomEvent("inkwise:active-element",!0,!0,{type:"text"}),window.dispatchEvent(_)}}}),S.addEventListener("blur",function(){U||j(!0)}),S.addEventListener("keydown",function(X){X.key==="Enter"?(X.preventDefault(),j(!0)):X.key==="Escape"&&(X.preventDefault(),ce())}),x.appendChild(S),this.svg.appendChild(x),s._boundingBox&&s._boundingBox.classList.add("svg-bounding-box--active"),S.focus();const H=window.getSelection();try{const X=document.createRange();X.selectNodeContents(S),H.removeAllRanges(),H.addRange(X)}catch{}}addCssStyles(){if(document.getElementById("svg-editor-styles"))return;const s=document.createElement("style");s.id="svg-editor-styles",s.textContent=`
            .svg-changeable-image {
                transition: all 0.2s ease;
            }

            .changeable-image-hover:hover {
                filter: brightness(0.8);
                stroke: #007cba !important;
                stroke-width: 2px !important;
            }

            .changeable-image-active {
                filter: brightness(0.7);
                stroke: #007cba !important;
                stroke-width: 3px !important;
            }

            .svg-bounding-box {
                transition: all 0.2s ease;
            }

            .svg-bounding-box__rect {
                pointer-events: none;
            }

            .resize-handle {
                transition: all 0.2s ease;
                pointer-events: all !important;
            }

            .resize-handle:hover {
                fill: #005a87;
                r: 6px;
            }

            .svg-editable-text {
                transition: all 0.2s ease;
            }

            .editable-text-hover:hover {
                fill: #007cba !important;
                text-decoration: underline;
            }

            .uploaded-image {
                transition: all 0.2s ease;
            }

            .svg-text-editor {
                box-sizing: border-box;
                outline: none;
            }

            .svg-text-editor:focus {
                box-shadow: 0 0 5px rgba(0, 124, 186, 0.5);
            }

            /* foreignObject inline editor styles */
            .svg-text-foreignobject { pointer-events: all; }
            .svg-text-editor-fo {
                width: 100%;
                height: 100%;
                box-sizing: border-box;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                padding: 2px;
                white-space: pre;
                overflow: hidden;
                outline: none;
            }

            .svg-bounding-box--active .svg-bounding-box__rect {
                stroke: #007cba;
                stroke-width: 3;
                opacity: 1;
            }
                .svg-bounding-box--pulse .svg-bounding-box__rect {
                    animation: svgBoundingBoxPulse 1s ease-out;
                }

                @keyframes svgBoundingBoxPulse {
                    0% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                    50% {
                        stroke-width: 4;
                        opacity: 0.4;
                    }
                    100% {
                        stroke-width: 2;
                        opacity: 1;
                    }
                }
        `,document.head.appendChild(s)}getSvgString(){const s=this.svg.cloneNode(!0);s.querySelectorAll('.svg-bounding-box, .inkwise-editor-marker, [data-editor-only="true"]').forEach(p=>{var w;(w=p.parentNode)==null||w.removeChild(p)}),s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),s.style.width="",s.style.height="",s.style.maxWidth="",s.style.maxHeight="",s.removeAttribute("preserveAspectRatio");const u=document.createElementNS(qt,"style");return u.id="inkwise-export-styles",u.textContent=`
            @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            text { white-space: pre; }
        `,s.insertBefore(u,s.firstChild),new XMLSerializer().serializeToString(s)}getSvgDataUrl(){const s=this.getSvgString();return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)))}async saveSvg(s,u="front"){const l=this.getSvgString();try{const p=await fetch(`/staff/templates/${s}/save-svg`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({svg_content:l,side:u})});if(!p.ok){const x=await p.text().catch(()=>"");throw new Error(x||`Request failed with status ${p.status}`)}let w;try{w=await p.json()}catch(x){console.warn("SvgTemplateEditor: Failed to parse save response",x),w={success:!1,error:"Invalid response from server"}}return w}catch(p){return console.error("Failed to save SVG:",p),{success:!1,error:p.message}}}}function fa(){const ie=()=>{const s=document.querySelectorAll("svg[data-svg-editor]");console.log("SvgTemplateEditor: Found",s.length,"SVGs with data-svg-editor attribute"),s.forEach((u,l)=>{u.__inkwiseSvgTemplateEditor||(console.log("SvgTemplateEditor: Initializing editor",l,"for SVG:",u),u.__inkwiseSvgTemplateEditor=new Kt(u))})};if(document.readyState==="complete"||document.readyState==="interactive"?ie():document.addEventListener("DOMContentLoaded",ie,{once:!0}),!window.__inkwiseSvgTemplateEditorObserver){const s=new MutationObserver(u=>{u.forEach(l=>{l.addedNodes.forEach(p=>{p.nodeType===1&&p.matches&&p.matches("svg[data-svg-editor]")&&(p.__inkwiseSvgTemplateEditor||(p.__inkwiseSvgTemplateEditor=new Kt(p)))})})});s.observe(document.body,{childList:!0,subtree:!0}),window.__inkwiseSvgTemplateEditorObserver=s}}typeof window<"u"&&(window.SvgTemplateEditor=Kt,window.__inkwiseSvgTemplateEditorAutoInit||(window.__inkwiseSvgTemplateEditorAutoInit=!0,fa()));function ga(ie={}){const{collectSnapshot:s,routes:u={},statusLabel:l=null,statusDot:p=null,csrfToken:w=null,debounce:x=1200,onAfterSave:A=null}=ie;if(typeof s!="function")throw new Error("createAutosaveController requires a collectSnapshot function");let S=null,k=null,C=null,j=null;const ce=(H,X={})=>{if(p instanceof HTMLElement&&p.setAttribute("data-state",H),l instanceof HTMLElement)switch(H){case"saving":l.textContent="Savingâ€¦";break;case"dirty":l.textContent="Unsaved changes";break;case"error":l.textContent="Save failed";break;case"saved":{const P=(X.timestamp instanceof Date?X.timestamp:new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});l.textContent=`Saved ${P}`;break}default:l.textContent="Saved";break}},pe=async H=>{const X=u.autosave;if(!X)return console.warn("[InkWise Studio] Autosave endpoint is not configured."),null;const _=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest",...w?{"X-CSRF-TOKEN":w}:{}},credentials:"same-origin",body:JSON.stringify(H)});if(!_.ok){const P=new Error(`Autosave responded with ${_.status}`);throw P.status=_.status,P.responseText=await _.text().catch(()=>null),P}try{return await _.json()}catch{return{}}},G=async H=>{if(console.log("[Autosave] Saving",H),C)try{await C}catch{}k=null,ce("saving");let X;try{X=await s(H)}catch(_){throw console.error("[InkWise Studio] Failed to collect autosave snapshot.",_),ce("error"),_}if(!X||typeof X!="object")return ce("saved",{timestamp:new Date}),null;C=pe(X);try{const _=await C;if(j=new Date,ce("saved",{timestamp:j}),typeof A=="function")try{A(_,X)}catch(P){console.warn("[InkWise Studio] Autosave onAfterSave callback failed.",P)}return _}catch(_){throw console.error("[InkWise Studio] Autosave request failed.",_),ce("error"),_}finally{C=null}};return{schedule:(H="change")=>{console.log("[Autosave] Scheduling",H),k=H,S&&clearTimeout(S),ce("dirty"),S=window.setTimeout(()=>{S=null,G(k).catch(()=>{})},Math.max(250,x))},flush:async(H="flush")=>(S&&(clearTimeout(S),S=null),C&&await C,k!==null?G(H):null),isSaving:()=>!!C,getLastSavedAt:()=>j,notifyError:()=>ce("error"),markDirty:()=>ce("dirty")}}const ha=100*1024,ma=3;function ya(ie){const s=/^data:([^;]+);base64,(.*)$/s.exec(ie.replace(/\s+/g,""));if(!s)return null;const u=s[1],l=atob(s[2]);let p=l.length;const w=new Uint8Array(p);for(;p--;)w[p]=l.charCodeAt(p);return new Blob([w],{type:u})}async function ba(ie,s,u){const l=new FormData;l.append("image",ie,`upload-${Date.now()}.png`);const p=await fetch(s,{method:"POST",body:l,credentials:"same-origin",headers:u?{"X-CSRF-TOKEN":u}:{}});if(!p.ok){const w=await p.text().catch(()=>null),x=new Error(`Upload failed: ${p.status}`);throw x.status=p.status,x.responseText=w,x}return p.json()}const va=/data:([a-zA-Z0-9/+-.]+\/[a-zA-Z0-9.+-]+);base64,[A-Za-z0-9+/=\n]+/g;async function Pn(ie,s={}){var H,X;const{routes:u={},csrfToken:l=null,imageSizeThreshold:p=ha,maxParallelUploads:w=ma}=s;if(!ie||typeof ie!="object")return ie;const x=u.uploadImage||"/design/upload-image",A=[];try{const _=((H=ie==null?void 0:ie.design)==null?void 0:H.sides)||{};Object.keys(_).forEach(P=>{const re=_[P];re&&(typeof re.svg=="string"&&(re.svg.match(va)||[]).forEach(Ue=>A.push({type:"svg",dataUrl:Ue})),typeof re.preview=="string"&&re.preview.startsWith("data:")&&A.push({type:"preview",dataUrl:re.preview}))}),ie!=null&&ie.preview&&Array.isArray(ie.preview.images)&&ie.preview.images.forEach(P=>{typeof P=="string"&&P.startsWith("data:")&&A.push({type:"preview",dataUrl:P})}),ie!=null&&ie.design&&Array.isArray(ie.design.images)&&ie.design.images.forEach(P=>{typeof P=="string"&&P.startsWith("data:")?A.push({type:"image",dataUrl:P}):P&&(P.dataUrl||P.src)&&(P.dataUrl||P.src).startsWith("data:")&&A.push({type:"image",dataUrl:P.dataUrl||P.src})})}catch(_){console.warn("[imageUploadHelpers] Error scanning snapshot",_)}const S=[],k=new Set;for(const _ of A)k.has(_.dataUrl)||(k.add(_.dataUrl),S.push(_));const C=S.filter(_=>_.dataUrl&&_.dataUrl.length>p);if(!C.length)return ie;const j=new Map,ce=C.slice();async function pe(){for(;ce.length;){const _=ce.shift();try{const P=ya(_.dataUrl);if(!P)throw new Error("Invalid data URL");const re=await ba(P,x,l);re&&re.url?j.set(_.dataUrl,re.url):re&&re.path&&j.set(_.dataUrl,re.path)}catch(P){console.warn("[imageUploadHelpers] upload failed for one candidate",P)}}}const G=[];for(let _=0;_<Math.min(w,C.length);_++)G.push(pe());await Promise.all(G);const z=JSON.parse(JSON.stringify(ie)),U=_=>{if(typeof _!="string")return _;let P=_;return j.forEach((re,De)=>{P=P.split(De).join(re)}),P};try{const _=((X=z==null?void 0:z.design)==null?void 0:X.sides)||{};Object.keys(_).forEach(P=>{const re=_[P];re&&(typeof re.svg=="string"&&(re.svg=U(re.svg)),typeof re.preview=="string"&&(re.preview=U(re.preview)))}),z.preview&&Array.isArray(z.preview.images)&&(z.preview.images=z.preview.images.map(U)),z.design&&Array.isArray(z.design.images)&&(z.design.images=z.design.images.map(P=>typeof P=="string"?U(P):(P&&P.dataUrl&&(P.dataUrl=U(P.dataUrl)),P&&P.src&&(P.src=U(P.src)),P)))}catch(_){console.warn("[imageUploadHelpers] Replacement failed",_)}return z}function wa(){if(typeof window<"u"){if(window.__inkwiseCustomerStudioInitialized)return;window.__inkwiseCustomerStudioInitialized=!0}const ie=async()=>{var bn,vn,wn;const s=document.querySelectorAll("[data-preview-target]"),u=document.querySelector(".preview-card-bg"),l=document.getElementById("preview-svg"),p=document.querySelectorAll("[data-card-thumb]"),w=document.querySelectorAll("[data-card-view]"),x=document.getElementById("extraPreviewContainer"),A=document.getElementById("textFieldList"),S=document.querySelector("[data-add-text-field]"),k=document.querySelectorAll(".sidenav-btn"),C=document.querySelector(".canvas-stage"),j="http://www.w3.org/2000/svg",ce=document.querySelector(".canvas-measure-horizontal .measure-value"),pe=document.querySelector(".canvas-measure-vertical .measure-value"),G=document.querySelector(".preview-canvas-wrapper");let z=1,U,H;U=document.getElementById("preview-svg-front"),H=document.getElementById("preview-svg-back");let X=Promise.resolve(),_=Promise.resolve();if(U&&H&&u){const e=u.dataset.frontSvg,t=u.dataset.backSvg;e&&(X=an(U,e)),t&&(_=an(H,t))}const P=e=>{const t=e==="front"?"cardFront":"cardBack",r=document.getElementById(t);return r?r.querySelector("svg"):null},re=e=>{try{const t=document.querySelector(`#template-editor-container-${e} svg`),r=document.getElementById(`preview-${e}-svg`),n=document.getElementById(`preview-${e}-card`)||document.getElementById(`preview-${e}-card`);if(!t||!r)return!1;const i=t.cloneNode(!0);for(;r.firstChild;)r.removeChild(r.firstChild);try{for(let a=0;a<i.attributes.length;a++){const o=i.attributes[a];o&&o.name&&o.value&&r.setAttribute(o.name,o.value)}}catch{}Array.from(i.childNodes).forEach(a=>r.appendChild(a.cloneNode(!0)));try{const a=document.getElementById("preview-front-card"),o=document.getElementById("preview-back-card");a&&o&&(e==="front"?(a.classList.add("active"),o.classList.remove("active")):(o.classList.add("active"),a.classList.remove("active")))}catch{}return!0}catch(t){return console.warn("[Preview] failed to update preview from canvas for",e,t),!1}},De=document.getElementById("preview-show-front"),Ue=document.getElementById("preview-show-back");De&&De.addEventListener("click",e=>{e.preventDefault(),re("front"),De.setAttribute("aria-pressed","true"),Ue&&Ue.setAttribute("aria-pressed","false");const t=document.getElementById("preview-modal");t&&t.getAttribute("aria-hidden")==="true"&&t.setAttribute("aria-hidden","false")}),Ue&&Ue.addEventListener("click",e=>{e.preventDefault(),re("back"),Ue.setAttribute("aria-pressed","true"),De&&De.setAttribute("aria-pressed","false");const t=document.getElementById("preview-modal");t&&t.getAttribute("aria-hidden")==="true"&&t.setAttribute("aria-hidden","false")}),window.addEventListener("inkwise:canvas-changed",e=>{var t;try{const r=(t=e==null?void 0:e.detail)==null?void 0:t.side,n=document.getElementById("preview-modal");if(!r)return;n&&n.getAttribute("aria-hidden")==="false"&&re(r)}catch{}});const v=new Set(["canvas-layer__image","changeable-image","svg-changeable-image","inkwise-image"]),$=e=>!e||!e.dataset?[]:["changeable","editableType","elementType","layerType","previewType","fieldType"].map(r=>e.dataset[r]).filter(r=>typeof r=="string"&&r.trim()!=="").map(r=>r.trim().toLowerCase()),Z=e=>!e||typeof e.querySelector!="function"?null:e.querySelector('[data-changeable="image"], [data-editable-image], .canvas-layer__image, img, image'),D=e=>{if(!e)return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="image"||t==="img"||$(e).some(n=>n==="image"||n==="photo"||n==="graphic")||typeof e.hasAttribute=="function"&&(e.hasAttribute("data-editable-image")||e.hasAttribute("data-changeable-image")))return!0;if(e.classList){for(const n of v)if(e.classList.contains(n))return!0}return!!(t==="foreignobject"&&Z(e))},Ee=e=>{if(!e||D(e))return!1;const t=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(t==="style"||t==="script"||t==="defs"||t==="title"||t==="metadata")return!1;if(t==="text"||t==="tspan"||$(e).some(a=>a.includes("text")||a==="names"||a==="heading"))return!0;const n=(e.textContent||"").trim();return!(!n||/\{[^}]*\}|;/.test(n)&&n.length>80)},Y=e=>{if(!e)return"";const t=e.querySelectorAll("tspan");return t&&t.length>0?er(Array.from(t).map(r=>r.textContent||"").join(`
`)):er(e.textContent||"")},ae=(e,t)=>{if(!e)return;const r=er(t),n=e.querySelectorAll("tspan");if(n&&n.length>0){const i=String(r??"").split(/\r?\n/);n.forEach((a,o)=>{a.textContent=i[o]??""})}else e.textContent=r??"";e.dataset&&(e.dataset.currentText=r??"")},de=e=>{if(!e)return null;if(D(e))return e;if(typeof e.closest=="function"){const r=e.closest("[data-preview-node]");if(r&&r!==e&&D(r))return r}const t=Z(e);return t||null},ne=(e,t)=>{if(!e||!t)return!1;const r=typeof e.tagName=="string"?e.tagName.toLowerCase():"";if(r==="image")return e.setAttributeNS("http://www.w3.org/1999/xlink","href",t),e.setAttribute("href",t),e.dataset.src=t,!0;if(r==="img")return e.setAttribute("src",t),e.dataset.src=t,!0;if(r==="foreignobject"){const n=Z(e);return n&&n!==e?ne(n,t):!1}return e.style&&(e.style.backgroundImage=`url('${t}')`),e.dataset&&(e.dataset.src=t,e.dataset.replacedImage="true"),!0},me=e=>{if(!e||typeof e.insertBefore!="function"||e.querySelector('[data-inkwise-bg="true"]'))return;const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("fill","#ffffff"),r.setAttribute("data-inkwise-bg","true"),e.insertBefore(r,e.firstChild)},oe=typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{};console.log("[InkWise Studio] Bootstrap payload:",oe);const ue=(oe==null?void 0:oe.routes)??{};console.log("[InkWise Studio] Routes:",ue);const Se=((bn=document.querySelector('meta[name="csrf-token"]'))==null?void 0:bn.getAttribute("content"))||((vn=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:vn.getAttribute("content"))||null,Fe=document.querySelector(".topbar-status-label"),ge=document.querySelector(".topbar-status-dot"),qe=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?t:null},je=e=>{if(!e||typeof e!="string")return null;try{const t=e.startsWith("<?xml")?e:`<?xml version="1.0" encoding="UTF-8"?>${e}`;return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(t)))}`}catch(t){return console.warn("[InkWise Studio] Failed to encode SVG preview.",t),null}},Ve=async(e,t=1080,r=1527)=>{if(!e||typeof e!="string")return null;try{const n=new Image;n.crossOrigin="anonymous",n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`,await new Promise((o,d)=>{n.onload=o,n.onerror=d});const i=document.createElement("canvas");i.width=t,i.height=r;const a=i.getContext("2d");return a.fillStyle="#ffffff",a.fillRect(0,0,t,r),a.drawImage(n,0,0,t,r),i.toDataURL("image/png",1)}catch(n){return console.warn("[InkWise Studio] Failed to convert SVG to PNG preview.",n),null}},et=e=>{var a,o;if(!u)return null;const t=window.getComputedStyle(u),n=((t==null?void 0:t.backgroundImage)||"").match(/url\((['"]?)(.*?)\1\)/i);if(n&&n[2])return n[2];const i=e?`${e}Image`:null;return i&&((a=u.dataset)!=null&&a[i])?u.dataset[i]:((o=u.dataset)==null?void 0:o.frontImage)||null},mt=e=>{!e||!K||(e.texts&&Array.isArray(e.texts)&&e.texts.forEach(t=>{const{key:r,value:n,fontFamily:i,fontSize:a,color:o}=t,d=K.querySelector(`[data-preview-node="${r}"]`);if(d){if(n!==void 0){ae(d,n);const c=document.querySelector(`input[data-preview-target="${r}"]`);c&&(c.value=n)}if(i){d.setAttribute("font-family",i),d.style.fontFamily=i;try{d.dataset.fontFamily=i}catch{}}if(a){d.setAttribute("font-size",a),d.style.fontSize=a;try{d.dataset.fontSize=a}catch{}}if(o){d.setAttribute("fill",o),d.style.fill=o;try{d.dataset.color=o}catch{}}}}),e.images&&Array.isArray(e.images)&&e.images.forEach(t=>{const{key:r,href:n,x:i,y:a,width:o,height:d}=t,c=K.querySelector(`[data-preview-node="${r}"]`);c&&(n&&(c.setAttribute("href",n),c.setAttribute("xlink:href",n)),i!==void 0&&c.setAttribute("x",i),a!==void 0&&c.setAttribute("y",a),o!==void 0&&c.setAttribute("width",o),d!==void 0&&c.setAttribute("height",d))}))},kt=()=>A?Array.from(A.querySelectorAll("input[data-preview-target]")).map(e=>{var c,y;const t=e.closest(".text-field-item"),r=((y=(c=t==null?void 0:t.querySelector(".text-field-label"))==null?void 0:c.textContent)==null?void 0:y.trim())||e.dataset.previewTarget||"",n=e.dataset.previewTarget||"",i=K==null?void 0:K.querySelector(`[data-preview-node="${n}"]`);let a=null,o=null,d=null;return i&&(a=i.getAttribute("font-family")||i.style.fontFamily||i.dataset.fontFamily,o=i.getAttribute("font-size")||i.style.fontSize||i.dataset.fontSize,d=i.getAttribute("fill")||i.style.fill||i.dataset.color),{key:n,label:r,value:e.value||"",defaultValue:e.dataset.defaultValue||"",fontFamily:a,fontSize:o,color:d}}):[],Et=e=>{if(typeof e=="number")return Number.isFinite(e)?e:Number.NaN;if(typeof e=="string"){const t=e.trim();if(!t)return Number.NaN;const r=t.match(/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);return r?parseFloat(r[0]):Number.NaN}return Number.NaN},_t=e=>{if(!e)return null;if(typeof e=="string"){const c=e.trim();if(!c)return null;try{const y=JSON.parse(c);return _t(y)}catch{return null}}if(typeof e!="object")return null;const t=Array.isArray(e)?e.reduce((c,y)=>y&&typeof y=="object"?Object.assign(c,y):c,{}):Object.assign({},e),r=t.width??t.Width??t.canvasWidth??t.w??t.maxWidth??t.naturalWidth,n=t.height??t.Height??t.canvasHeight??t.h??t.maxHeight??t.naturalHeight,i=Et(r),a=Et(n);if(!Number.isFinite(i)||i<=0||!Number.isFinite(a)||a<=0)return null;const o=t.shape??t.Shape??t.canvasShape??null,d=t.unit??t.Unit??t.canvasUnit??null;return{width:i,height:a,shape:typeof o=="string"&&o.trim()!==""?o.trim():null,unit:typeof d=="string"&&d.trim()!==""?d.trim():"px"}},rt=(e,t="px")=>{if(!Number.isFinite(e))return Number.NaN;switch((t||"px").toString().toLowerCase()){case"in":case"inch":case"inches":return e;case"mm":return e/25.4;case"cm":return e/2.54;case"pt":return e/72;default:return e/96}},Jt=_t(G==null?void 0:G.dataset);let ve=_t(((wn=oe==null?void 0:oe.template)==null?void 0:wn.canvas)??null)||Jt||null;const Zt=720,F=920,q=new Map;let Q=null;const ee=new Map,L=new Map,te=new Map;let he=null,Ae=null,K=null,ze=null,Ze=()=>{},Xe="front",Ct=null,yt=null,E=null,Qt=null,We=null,He=null,st=!1,ot=null;const Ur=8,Dn=4,er=e=>{const r=(e||"").toString().trim();return/::before|\{[^}]*\}|;/.test(r)&&r.length>120?"":r},zn=e=>{if(!e||e==="front"||e!=="back")return!0;if(!u)return!1;if(yt)return!0;const t=u.dataset||{};return t.hasBack==="true"?!0:!!(t.backImage||t.backSvg)},qn=async e=>{if(!e||typeof e!="string")return null;if(e.startsWith("data:"))return e;try{const t=new Image;if(t.crossOrigin="anonymous",await new Promise(n=>{t.onload=()=>n(!0),t.onerror=()=>n(!1);const i=e.includes("?")?"&":"?";t.src=e+i+"_t="+Date.now()})&&t.naturalWidth>0&&t.naturalHeight>0){const n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0);try{const a=n.toDataURL("image/png");if(a&&a!=="data:,")return a}catch{console.warn("[InkWise Studio] Canvas tainted, trying fetch approach:",e)}}}catch(t){console.warn("[InkWise Studio] Canvas approach failed:",e,t)}try{const t=await fetch(e,{credentials:"include",mode:"cors"});if(!t.ok)return console.warn("[InkWise Studio] Failed to fetch image for base64 conversion:",e,t.status),null;const r=await t.blob();return new Promise(n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=()=>n(null),i.readAsDataURL(r)})}catch(t){console.warn("[InkWise Studio] Fetch approach also failed:",e,t)}try{const r=await(await fetch(e,{mode:"no-cors"})).blob();if(r.size>0)return new Promise(n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=()=>n(null),i.readAsDataURL(r)})}catch(t){console.warn("[InkWise Studio] No-cors fetch also failed:",e,t)}return null},Un=async e=>{[".svg-bounding-box",".resize-handle",".selection-indicator",".inkwise-selection",".inkwise-overlay",'[data-ui-element="true"]','[data-temp-element="true"]',"g.svg-bounding-box"].forEach(a=>{e.querySelectorAll(a).forEach(o=>o.remove())}),e.querySelectorAll("text").forEach(a=>{a.removeAttribute("contenteditable"),a.style.cursor="",a.style.userSelect=""}),e.querySelectorAll("image").forEach(a=>{a.style.cursor="",a.style.pointerEvents=""});const r=a=>{if(!a||a.startsWith("data:"))return a;try{const o=new URL(a,window.location.origin),d=[/\/InkWise-Web\/ink-wise\/public\/storage\//gi,/\/ink-wise\/public\/storage\//gi,/\/public\/storage\//gi];let c=o.pathname;for(const y of d)if(y.test(c)){c=c.replace(y,"/storage/");break}return o.pathname=c,(o.hostname==="localhost"||o.hostname==="127.0.0.1")&&(o.hostname=window.location.hostname,o.port=window.location.port,o.protocol=window.location.protocol),o.href}catch{return a}},n=e.querySelectorAll("image");console.log("[InkWise Studio] Found",n.length,"image elements to convert");const i=Array.from(n).map(async a=>{let o=a.getAttribute("href")||a.getAttribute("xlink:href")||a.getAttributeNS("http://www.w3.org/1999/xlink","href");if(console.log("[InkWise Studio] Processing image with href:",o),!o||o.startsWith("data:")){console.log("[InkWise Studio] Image already embedded or no href, skipping");return}const d=r(o);console.log("[InkWise Studio] Normalized URL:",d);const c=await qn(d);c?(console.log("[InkWise Studio] Successfully converted image to base64, length:",c.length),a.removeAttribute("href"),a.removeAttribute("xlink:href"),a.removeAttributeNS("http://www.w3.org/1999/xlink","href"),a.removeAttribute("data-src"),a.setAttribute("href",c),a.setAttribute("xlink:href",c),a.setAttributeNS("http://www.w3.org/1999/xlink","href",c),console.log("[InkWise Studio] Image href attributes updated to base64")):console.warn("[InkWise Studio] Failed to embed image, keeping original URL:",d)});await Promise.all(i),console.log("[InkWise Studio] All image conversions completed")},Sr=async()=>{var ye;if(!u)return null;const e=new Date,t=Xe||"front";let r=null;const n={},i=[],a=async(xe,se)=>{var ke,le,J,V;if(!xe)return{svg:null,preview:et(se)};try{const Pe=xe.cloneNode(!0),Ke=se==="front"?cardFront:cardBack,Je=((ke=Ke==null?void 0:Ke.dataset)==null?void 0:ke.canvasWidth)||((le=u==null?void 0:u.dataset)==null?void 0:le.canvasWidth),nt=((J=Ke==null?void 0:Ke.dataset)==null?void 0:J.canvasHeight)||((V=u==null?void 0:u.dataset)==null?void 0:V.canvasHeight);Je&&nt&&(Pe.setAttribute("width",Je),Pe.setAttribute("height",nt),Pe.style.width=Je+"px",Pe.style.height=nt+"px"),Pe.setAttribute("preserveAspectRatio","xMidYMid meet"),await Un(Pe);let ct=Pe.querySelector("style#inkwise-export-styles");ct||(ct=document.createElementNS(j,"style"),ct.id="inkwise-export-styles",Pe.insertBefore(ct,Pe.firstChild)),ct.textContent="@import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap'); text { white-space: pre; }";let Le=new XMLSerializer().serializeToString(Pe);Le&&!/xmlns=/i.test(Le)&&(Le=Le.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"'));const At=await Ve(Le,Je||1080,nt||1527);return{svg:Le,preview:At||je(Le)||et(se)}}catch(Pe){return console.warn("[InkWise Studio] Unable to serialize "+se+" SVG.",Pe),{svg:null,preview:et(se)}}},o=P("front"),d=P("back"),c=await a(o,"front"),y=await a(d,"back");c.svg?(n.front={svg:c.svg,preview:c.preview},i.push(c.preview),r=r||c.svg):t==="front"&&(r=r||null),y.svg&&(n.back={svg:y.svg,preview:y.preview},i.push(y.preview),!r&&t==="back"&&(r=y.svg)),i.length?i[0]:et(t);const N=kt(),h=N.filter(xe=>{const se=(xe.value||"").trim(),ke=(xe.defaultValue||"").trim();return se===""||ke!==""&&se===ke}).map(xe=>xe.label||xe.key).map(xe=>(xe||"").trim()).filter((xe,se,ke)=>xe!==""&&ke.indexOf(xe)===se),m=[],I=new Set;[o,d].forEach(xe=>{xe&&xe.querySelectorAll('image,img,[data-changeable="image"]').forEach(se=>{const ke=se.getAttribute("href")||se.getAttribute("xlink:href")||se.getAttributeNS("http://www.w3.org/1999/xlink","href")||se.getAttribute("data-src");if(!ke)return;const le=se.getAttribute("data-preview-node")||se.id||`image-${m.length+1}`;I.has(le)||(I.add(le),m.push({key:le,href:ke,x:se.getAttribute("x")||null,y:se.getAttribute("y")||null,width:se.getAttribute("width")||null,height:se.getAttribute("height")||null}))})});const f=u?{width:qe(u.dataset.canvasWidth),height:qe(u.dataset.canvasHeight),unit:u.dataset.canvasUnit||null,shape:u.dataset.canvasShape||null}:null,B=i.filter(Boolean),R=B[0]||et(t);return{design:{updated_at:e.toISOString(),sides:Object.keys(n).length?n:{[t]:{svg:r,preview:R}},texts:N,images:m,canvas:f,placeholders:h},preview:{image:R,images:B},svg_markup:r,placeholders:h,product_id:((ye=oe==null?void 0:oe.product)==null?void 0:ye.id)??null}},jr=(e={},t={})=>{var c,y;const r=e&&e.summary?e.summary:{},n=Array.isArray(r.previewImages)?r.previewImages.filter(Boolean):Array.isArray(r.preview_images)?r.preview_images.filter(Boolean):[],i=Array.isArray((c=t==null?void 0:t.preview)==null?void 0:c.images)?t.preview.images.filter(Boolean):[],a=n.length?n:i,o=r.previewImage||r.preview_image||r.preview||((y=t==null?void 0:t.preview)==null?void 0:y.image)||a[0]||null;if(!o&&!a.length)return;const d={templateName:r.productName||r.templateName||document.title||"Saved template",previewImage:o||"",previewImages:a.length?a:o?[o]:[],metadata:{template:{name:r.productName||r.templateName||"Saved template"}}};try{window.sessionStorage.setItem("inkwise-finalstep",JSON.stringify(d))}catch{}try{const N={id:null,name:d.templateName,preview:d.previewImage};window.sessionStorage.setItem("inkwise-saved-template",JSON.stringify(N)),window.savedCustomerTemplate=N}catch{}},jn=async(...e)=>{const t=await Sr(...e);try{jr({},t)}catch{}return t};try{E=ga({collectSnapshot:jn,routes:ue,csrfToken:Se,statusLabel:Fe,statusDot:ge,debounce:0,onAfterSave:(n,i)=>{try{jr(n,i)}catch{}}}),console.log("[InkWise Studio] Autosave initialized",E);const e=n=>{if(E)try{E.flush(n)}catch(i){console.debug("[InkWise Studio] Autosave flush skipped.",i)}},t=()=>{document.visibilityState==="hidden"&&e("visibility-hidden")},r=()=>{e("page-hide")};document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",r),window.addEventListener("beforeunload",r),Qt=window.setInterval(()=>{e("heartbeat")},6e4),window.addEventListener("unload",()=>{Qt&&(window.clearInterval(Qt),Qt=null),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",r),window.removeEventListener("beforeunload",r)}),setInterval(()=>{E&&(console.log("[InkWise Studio] Periodic autosave trigger"),E.schedule("periodic"))},1e4)}catch(e){console.warn("[InkWise Studio] Autosave controller failed to initialize.",e),E=null}const Wn=async()=>{var h,m,I,f,B,R,ye,xe;const e=await Sr(),t=(e==null?void 0:e.design)||{},r=t.sides||{},n=JSON.parse(JSON.stringify(t||{})),i=((h=r.front)==null?void 0:h.svg)||(e==null?void 0:e.svg_markup)||null,a=((m=r.front)==null?void 0:m.preview)||((I=e==null?void 0:e.preview)==null?void 0:I.image)||et("front")||null,o=(Array.isArray((f=e==null?void 0:e.preview)==null?void 0:f.images)?e.preview.images:[]).filter(se=>typeof se=="string"&&se.trim()!==""),d=n.canvas||{},c=d.width??(u?qe(u.dataset.canvasWidth):null),y=d.height??(u?qe(u.dataset.canvasHeight):null),N=(()=>{var se,ke;try{if(!u)return null;const le=window.getComputedStyle(u);return(le==null?void 0:le.backgroundColor)||((se=u.dataset)==null?void 0:se.backgroundColor)||((ke=u.style)==null?void 0:ke.backgroundColor)||null}catch{return null}})();return{design_svg:i,design_json:n,preview_image:a,preview_images:o,canvas_width:c,canvas_height:y,background_color:N,template_id:((B=oe==null?void 0:oe.template)==null?void 0:B.id)??(oe==null?void 0:oe.template_id)??null,order_item_id:((R=oe==null?void 0:oe.orderSummary)==null?void 0:R.order_item_id)??((ye=oe==null?void 0:oe.orderSummary)==null?void 0:ye.orderItemId)??((xe=oe==null?void 0:oe.orderSummary)==null?void 0:xe.item_id)??null}},dt=document.querySelector('[data-action="proceed-review"]');if(dt){const e=dt.dataset.destination||ue.review||dt.getAttribute("href")||window.location.href,t=ue.saveReview||ue.reviewSave||ue.review_design||ue.reviewDesign||null;dt.addEventListener("click",async r=>{if(r.preventDefault(),dt.dataset.navigating==="1")return;dt.dataset.navigating="1",dt.disabled=!0;const n=()=>{window.location.href=e},i=()=>{dt.disabled=!1,dt.dataset.navigating="0"};try{E&&await E.flush("navigate");let a=await Wn();try{const c=await Pn(a,{routes:ue,csrfToken:Se});c&&(a=c)}catch(c){console.warn("[InkWise Studio] Pre-save image upload failed; proceeding with original payload",c)}if(!a.template_id)throw new Error("Missing template identifier.");if(!t)throw new Error("Save endpoint unavailable.");const o={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};Se&&(o["X-CSRF-TOKEN"]=Se);const d=await fetch(t,{method:"POST",headers:o,credentials:"same-origin",body:JSON.stringify(a)});if(!d.ok){const c=await d.text().catch(()=>"");throw new Error(`Save failed (${d.status}): ${c}`)}n()}catch(a){console.error("[InkWise Studio] Unable to save before navigating.",a),E&&E.notifyError(),alert("We could not save your latest design. Please try again before continuing."),i()}})}const Nt=document.getElementById("save-template-btn");Nt&&Nt.addEventListener("click",async e=>{if(e.preventDefault(),Nt.disabled)return;const t=prompt("Enter a name for your template:");if(!(!t||t.trim()==="")){Nt.disabled=!0,Nt.textContent="Savingâ€¦";try{E&&await E.flush("save-template");const r=await Sr("save-template"),n=Object.assign({},r&&r.design?r.design:{}),i=r&&Array.isArray(r.placeholders)?r.placeholders:[];n.placeholders=i,r&&r.product_id&&(n.product_id=r.product_id);const a=r&&r.preview&&r.preview.image||null,o=r&&r.preview&&Array.isArray(r.preview.images)?r.preview.images.filter(Boolean):[],d={template_name:t.trim(),design:n,preview_image:a,preview_images:o,placeholders:i,svg_markup:r.svg_markup};let c=d;try{const m=await Pn(d,{routes:ue,csrfToken:Se});m&&(c=m)}catch(m){console.warn("[InkWise Studio] Pre-save image upload failed for template save; proceeding with original payload",m)}const y={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};Se&&(y["X-CSRF-TOKEN"]=Se);const N=await fetch(ue.saveTemplate,{method:"POST",headers:y,credentials:"same-origin",body:JSON.stringify(c)});if(!N.ok)throw new Error(`Server responded with ${N.status}`);const h=await N.json();alert(`Template "${h.template_name}" saved successfully!`)}catch(r){console.error("[InkWise Studio] Failed to save template.",r),alert("Failed to save template. Please try again.")}finally{Nt.disabled=!1,Nt.textContent="Save Template"}}});const Ut=e=>{const t=de(e);if(!t)return;const r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=n=>{const i=n.target.files&&n.target.files[0];if(!i)return;const a=new FileReader;a.onload=o=>{var y;const d=(y=o.target)==null?void 0:y.result;if(!d)return;ne(t,d)&&(_e(),E==null||E.schedule("image-replace"))},a.readAsDataURL(i)},r.click()};window.addEventListener("inkwise-image-clicked",e=>{var t;try{const r=(t=e==null?void 0:e.detail)==null?void 0:t.node;if(!r)return;Ut(r)}catch(r){console.warn("[Preview] image click handler failed",r)}});const Hn=()=>u?((!Q||!Q.isConnected)&&(Q=document.createElement("div"),Q.className="canvas-overlay-layer",u.appendChild(Q)),Q):null,tr=()=>{L.forEach(({overlay:e})=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),L.clear(),te.clear(),Q&&(Q.innerHTML=""),ee.forEach(e=>{e&&e.isConnected&&(e.innerHTML="")}),ee.clear(),We=null,He=null,Wt(),document.body.classList.remove("text-toolbar-visible"),Ht()},Bt=(e,t)=>{if(e==null)return t;const r=e.toString().split(/[\s,]+/).filter(Boolean);if(r.length===0)return t;const n=parseFloat(r[0]);return Number.isFinite(n)?n:t},ut=e=>{var y;if(!u)return;const t=L.get(e);if(!t||!t.overlay)return;const r=t.overlay,i=(y=(e&&typeof e.closest=="function"?e.closest(".preview-card-bg"):null)||u)==null?void 0:y.getBoundingClientRect(),a=e.getBoundingClientRect();if(i.width===0||i.height===0)return;const o=t.type==="text"?18:12,d=Math.max(o,a.width),c=Math.max(o,a.height);r.style.left=`${a.left-i.left}px`,r.style.top=`${a.top-i.top}px`,r.style.width=`${d}px`,r.style.height=`${c}px`},On=()=>{L.forEach((e,t)=>{ut(t)})},_e=()=>{L.size!==0&&(he&&cancelAnimationFrame(he),he=window.requestAnimationFrame(()=>{he=null,On()}))},rr=(e=3)=>{e<=0||requestAnimationFrame(()=>{_e(),rr(e-1)})};window.addEventListener("resize",_e),document.addEventListener("scroll",_e,!0),window.addEventListener("load",_e);const Wr=(e,t)=>{const r=K||l;if(!r||typeof r.createSVGPoint!="function")return null;const n=r.createSVGPoint();n.x=e,n.y=t;const i=r.getScreenCTM();return i?n.matrixTransform(i.inverse()):null},Gn=(e,t,r)=>{const n=Wr(r.clientX,r.clientY);if(!n)return null;const{node:i}=e,a=i.getBBox?i.getBBox():{x:0,y:0,width:0,height:0},o={data:e,overlay:e.overlay,node:i,type:e.type,handle:t,mode:t?"resize":"move",pointerId:r.pointerId,startPoint:n,startClient:{x:r.clientX,y:r.clientY},initialBBox:a,moved:!1};if(e.type==="text"){o.fontSize=parseFloat(i.getAttribute("font-size"))||parseFloat(window.getComputedStyle(i).fontSize)||16,o.x=Bt(i.getAttribute("x"),a.x);const d=a.y+a.height;o.y=Bt(i.getAttribute("y"),d)}else o.x=Bt(i.getAttribute("x"),a.x),o.y=Bt(i.getAttribute("y"),a.y),o.width=Bt(i.getAttribute("width"),Math.max(1,a.width)),o.height=Bt(i.getAttribute("height"),Math.max(1,a.height));return o},Vn=(e,t,r)=>{if(e.type==="text"){const n=e.x+t,i=e.y+r;Number.isFinite(n)&&e.node.setAttribute("x",n),Number.isFinite(i)&&e.node.setAttribute("y",i)}else e.node.setAttribute("x",e.x+t),e.node.setAttribute("y",e.y+r)},Xn=(e,t,r,n=!1)=>{if(e.type==="image"){let i=e.x,a=e.y,o=e.width,d=e.height;const c=["nw","ne","sw","se"].some(m=>e.handle===m),y=n||c,N=e.width/e.height;if(y&&c){const m=Math.abs(t),I=Math.abs(r);m>I?(e.handle.includes("e")?o=e.width+t:e.handle.includes("w")&&(o=e.width-t,i=e.x+t),d=o/N,e.handle.includes("n")&&(a=e.y+(e.height-d))):(e.handle.includes("s")?d=e.height+r:e.handle.includes("n")&&(d=e.height-r,a=e.y+r),o=d*N,e.handle.includes("w")&&(i=e.x+(e.width-o)))}else e.handle.includes("e")&&(o=e.width+t),e.handle.includes("w")&&(o=e.width-t,i=e.x+t),e.handle.includes("s")&&(d=e.height+r),e.handle.includes("n")&&(d=e.height-r,a=e.y+r);const h=4;o<h&&(i+=o-h,o=h),d<h&&(a+=d-h,d=h),e.node.setAttribute("x",i),e.node.setAttribute("y",a),e.node.setAttribute("width",o),e.node.setAttribute("height",d)}else if(e.type==="text"){const i=Math.max(1,e.initialBBox.width),a=Math.max(1,e.initialBBox.height);let o=0,d=0;e.handle.includes("e")?o=t:e.handle.includes("w")&&(o=-t),e.handle.includes("s")?d=r:e.handle.includes("n")&&(d=-r);const c=Math.max(4,i+o),y=Math.max(4,a+d),N=c/i,h=y/a,m=Math.max(N,h),I=Math.max(6,e.fontSize*m);e.node.setAttribute("font-size",I)}},Hr=e=>{if(!Ae||e.pointerId!==Ae.pointerId)return;const t=Wr(e.clientX,e.clientY);if(!t)return;const r=t.x-Ae.startPoint.x,n=t.y-Ae.startPoint.y;!Ae.moved&&(Math.abs(r)>.5||Math.abs(n)>.5)&&(Ae.moved=!0),Ae.mode==="move"?Vn(Ae,r,n):Xn(Ae,r,n),_e()},nr=e=>{if(!Ae||e.pointerId!==Ae.pointerId)return;try{Ae.overlay.releasePointerCapture(Ae.pointerId)}catch{}Ae.overlay.classList.remove("editor-overlay--active"),document.removeEventListener("pointermove",Hr),document.removeEventListener("pointerup",nr),document.removeEventListener("pointercancel",nr);const t=Ae;Ae=null,_e(),t.moved?E==null||E.schedule("element-transform"):t.type==="text"?Ze(t.data.previewKey):t.type==="image"&&Ut(t.node)},Yn=e=>{if(!e.isPrimary||e.button!==0)return;const t=e.target.closest(".editor-overlay");if(!t||t.dataset.cropSessionActive==="true")return;const r=te.get(t);if(!r)return;r.type==="text"?wt(r.previewKey||null):r.type==="image"&&xt(r.previewKey||null);const n=Gn(r,e.target.dataset.handle||null,e);if(n){e.preventDefault(),Ae=n,t.classList.add("editor-overlay--active");try{t.setPointerCapture(e.pointerId)}catch{}document.addEventListener("pointermove",Hr),document.addEventListener("pointerup",nr),document.addEventListener("pointercancel",nr)}},lt=e=>{const t=e&&typeof e.closest=="function"?e.closest(".preview-card-bg"):null;let r=null;if(t?(r=ee.get(t),(!r||!r.isConnected)&&(r=document.createElement("div"),r.className="canvas-overlay-layer",t.appendChild(r),ee.set(t,r))):r=Hn(),!r)return null;let n=L.get(e);if(n)return n;const i=D(e)?"image":"text",a=e.getAttribute("data-preview-node")||"",o=document.createElement("div");return o.className=`editor-overlay editor-overlay--${i}`,o.dataset.previewNode=a,o.tabIndex=0,o.style.touchAction="none",["nw","n","ne","e","se","s","sw","w"].forEach(c=>{const y=document.createElement("div");y.className=`editor-overlay__handle editor-overlay__handle--${c}`,y.dataset.handle=c,o.appendChild(y)}),o.addEventListener("pointerdown",Yn),o.addEventListener("dblclick",()=>{i==="text"?Ze(a):i==="image"&&Ut(e)}),o.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),i==="text"?Ze(a):i==="image"&&Ut(e))}),r.appendChild(o),n={overlay:o,node:e,type:i,previewKey:a},L.set(e,n),te.set(o,n),e.dataset.locked==="true"&&(o.classList.add("editor-overlay--locked"),o.style.pointerEvents="none"),Wt(),_e(),n},ir=(e,t,r={})=>{if(!u)return;const n=u.closest(".preview-canvas-wrapper"),i=Number(e),a=Number(t),o=r.persist===void 0?!0:!!r.persist,d=typeof r.unit=="string"&&r.unit?r.unit:(ve==null?void 0:ve.unit)??"px",c=typeof r.shape=="string"&&r.shape?r.shape:(ve==null?void 0:ve.shape)??null;if(!n||!Number.isFinite(i)||!Number.isFinite(a)||i<=0||a<=0)return;const y=Zt/i,N=F/a,h=Math.min(1,y,N),m=Math.max(1,Math.round(i*h)),I=Math.max(1,Math.round(a*h));n.style.setProperty("--canvas-width",`${m}px`),n.style.setProperty("--canvas-height",`${I}px`),n.dataset.sourceWidth=i.toString(),n.dataset.sourceHeight=a.toString(),n.dataset.displayScale=h.toString(),n.dataset.canvasWidth=i.toString(),n.dataset.canvasHeight=a.toString(),n.dataset.canvasUnit=d,c&&(n.dataset.canvasShape=c),u.dataset.canvasWidth=i.toString(),u.dataset.canvasHeight=a.toString(),u.dataset.canvasUnit=d,c&&(u.dataset.canvasShape=c),l&&(l.setAttribute("viewBox",`0 0 ${i} ${a}`),l.setAttribute("preserveAspectRatio","xMidYMid meet")),K&&!K.getAttribute("viewBox")&&(K.setAttribute("viewBox",`0 0 ${i} ${a}`),K.setAttribute("preserveAspectRatio","xMidYMid meet")),C&&C.style.setProperty("--stage-width",`${m+112}px`),o&&(ve={width:i,height:a,unit:d,shape:c}),_e()},ar=(e,t,r,n=0)=>{ce&&(Number.isFinite(e)?ce.textContent=`${e.toFixed(n)}${r}`:ce.textContent="â€”"),pe&&(Number.isFinite(t)?pe.textContent=`${t.toFixed(n)}${r}`:pe.textContent="â€”")};ve&&(ir(ve.width,ve.height,{unit:ve.unit,shape:ve.shape}),ar(rt(ve.width,ve.unit),rt(ve.height,ve.unit),"in",2));const Or=e=>{if(typeof e!="string"||!e.trim())return Number.NaN;const t=e.trim(),r=t.match(/^([-+]?[0-9]*\.?[0-9]+)/);if(!r)return Number.NaN;const n=parseFloat(r[1]);if(!Number.isFinite(n))return Number.NaN;const i=t.match(/([a-z%]+)$/i);switch(i?i[1].toLowerCase():""){case"":case"px":return n;case"mm":return n*(96/25.4);case"cm":return n*(96/2.54);case"in":return n*96;case"pt":return n*(96/72);default:return n}},Kn=()=>!!(ve&&Number.isFinite(ve.width)&&ve.width>0&&Number.isFinite(ve.height)&&ve.height>0),Jn=e=>{if(!e||Kn())return;if(q.has(e)){const r=q.get(e);if(r){const n=r.unit||"px";ir(r.width,r.height,{unit:n,shape:ve==null?void 0:ve.shape}),ar(rt(r.width,n),rt(r.height,n),"in",2)}return}const t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const r={width:t.naturalWidth,height:t.naturalHeight,unit:"px"};q.set(e,r),ir(r.width,r.height,{unit:r.unit,shape:ve==null?void 0:ve.shape}),ar(rt(r.width,r.unit),rt(r.height,r.unit),"in",2),_e()},t.onerror=()=>{q.set(e,null)},t.src=e},Ar={text:document.getElementById("text-modal"),uploads:document.getElementById("uploads-modal"),graphics:document.getElementById("graphics-modal"),template:document.getElementById("template-modal"),color:document.getElementById("color-modal"),qr:document.getElementById("qr-modal"),background:document.getElementById("background-modal"),product:document.getElementById("product-modal"),tables:document.getElementById("tables-modal")};window.addEventListener("inkwise:apply-background",e=>{try{const t=e&&e.detail?e.detail:{},r=t.side||"selection",n=t.color||null,i=t.image||null;if(!n&&!i)return;const a=r==="front"||r==="both",o=r==="back"||r==="both";try{if(a){const d=document.getElementById("preview-front-bg")||document.querySelector(".preview-card-bg");d&&(i?(d.style.backgroundImage=`url('${i}')`,d.style.backgroundSize="cover",d.style.backgroundPosition="center",d.style.backgroundRepeat="no-repeat",d.style.backgroundColor=""):(d.style.backgroundImage="none",d.style.backgroundColor=n));const c=document.getElementById("template-editor-container-front");if(c)if(i){c.style.backgroundImage=`url('${i}')`,c.style.backgroundSize="cover",c.style.backgroundPosition="center",c.style.backgroundRepeat="no-repeat",c.style.backgroundColor="";try{c.dataset.backgroundImage=i}catch{}}else c.style.backgroundImage="none",c.style.backgroundColor=n;if(n)try{const y=c&&c.querySelector&&c.querySelector("svg")||document.getElementById("preview-front-svg");if(y){const N=y.querySelector("radialGradient#inkwise-grad-1, linearGradient#inkwise-grad-1, #inkwise-grad-1");N&&N.querySelectorAll("stop").forEach(m=>m.setAttribute("stop-color",n));try{const h=y.getAttribute("viewBox");let m=null,I=null;if(h){const R=h.split(/\s+/).map(Number);R&&R.length===4&&(m=R[2],I=R[3])}let f=null;const B=y.querySelectorAll("rect");for(let R=0;R<B.length;R++){const ye=B[R],xe=ye.getAttribute("width"),se=ye.getAttribute("height"),ke=ye.getAttribute("x")||"0",le=ye.getAttribute("y")||"0";if(xe==="100%"||se==="100%"||m&&I&&parseFloat(xe)===m&&parseFloat(se)===I&&(ke==="0"||ke===0)&&(le==="0"||le===0)){f=ye;break}}if(!f&&B.length>0&&(f=B[0]),f){f.setAttribute("fill",n);try{f.style&&(f.style.fill=n)}catch{}}}catch{}}}catch{}}if(o){const d=document.getElementById("preview-back-bg")||document.querySelectorAll(".preview-card-bg")[1]||document.querySelector(".preview-card-bg");d&&(i?(d.style.backgroundImage=`url('${i}')`,d.style.backgroundSize="cover",d.style.backgroundPosition="center",d.style.backgroundRepeat="no-repeat",d.style.backgroundColor=""):(d.style.backgroundImage="none",d.style.backgroundColor=n));const c=document.getElementById("template-editor-container-back");if(c)if(i){c.style.backgroundImage=`url('${i}')`,c.style.backgroundSize="cover",c.style.backgroundPosition="center",c.style.backgroundRepeat="no-repeat",c.style.backgroundColor="";try{c.dataset.backgroundImage=i}catch{}}else c.style.backgroundImage="none",c.style.backgroundColor=n;if(n)try{const y=c&&c.querySelector&&c.querySelector("svg")||document.getElementById("preview-back-svg");if(y){y.querySelectorAll("radialGradient, linearGradient").forEach(h=>{try{h.querySelectorAll("stop").forEach(I=>I.setAttribute("stop-color",n))}catch{}});try{const h=y.getAttribute("viewBox");let m=null,I=null;if(h){const R=h.split(/\s+/).map(Number);R&&R.length===4&&(m=R[2],I=R[3])}let f=null;const B=y.querySelectorAll("rect");for(let R=0;R<B.length;R++){const ye=B[R],xe=ye.getAttribute("width"),se=ye.getAttribute("height"),ke=ye.getAttribute("x")||"0",le=ye.getAttribute("y")||"0";if(xe==="100%"||se==="100%"||m&&I&&parseFloat(xe)===m&&parseFloat(se)===I&&(ke==="0"||ke===0)&&(le==="0"||le===0)){f=ye;break}}if(!f&&B.length>0&&(f=B[0]),f){f.setAttribute("fill",n);try{f.style&&(f.style.fill=n)}catch{}}}catch{}}}catch{}}}catch(d){console.debug("[InkWise Studio] apply-background DOM update failed",d)}try{window.dispatchEvent(new CustomEvent("inkwise:background-changed",{detail:{side:r,color:n,image:i}}))}catch{}}catch(t){console.debug("[InkWise Studio] error handling inkwise:apply-background",t)}});const Zn=document.querySelectorAll("[data-modal-close]"),Gr=e=>{if(!e)return[];const t=new Map;let r=0;const n=(h,m,I="node")=>{let f=(h||"").toString().trim();f||(f=`${I}-${r+=1}`);let B=f,R=2;for(;t.has(B)&&t.get(B)!==m;)B=`${f}-${R}`,R+=1;return B},i=(h,m,I=null,f=null,B="node")=>{if(!h)return;const R=n(m,h,B);return h.setAttribute("data-preview-node",R),I&&!h.dataset.previewLabel&&(h.dataset.previewLabel=I),f&&!h.dataset.defaultText&&(h.dataset.defaultText=f),t.set(R,h),R};e.querySelectorAll("[data-preview-node]").forEach(h=>{var I,f;const m=h.getAttribute("data-preview-node");m&&i(h,m,((I=h.dataset)==null?void 0:I.previewLabel)||null,((f=h.dataset)==null?void 0:f.defaultText)||null,"node")});const o=[];e.querySelectorAll(".canvas-layer[data-layer-id]").forEach(h=>{const m=h.getAttribute("data-layer-id");if(!m)return;const I=(h.getAttribute("aria-label")||m).replace(/\s+layer$/i,"")||m,f=h.querySelector(".canvas-layer__text");if(f){if(f.hasAttribute("data-preview-node")||f.setAttribute("data-preview-node",m),f.dataset.previewLabel||(f.dataset.previewLabel=I),!f.dataset.defaultText){const R=(f.textContent||"").trim();R&&(f.dataset.defaultText=R)}o.push(f)}const B=h.querySelector("img, image");if(B){const R=`${m}-image`;B.hasAttribute("data-preview-node")||B.setAttribute("data-preview-node",R),B.dataset.previewLabel||(B.dataset.previewLabel=I),o.push(B)}if(!f&&!B){if(h.hasAttribute("data-preview-node")||h.setAttribute("data-preview-node",m),h.dataset.previewLabel||(h.dataset.previewLabel=I),!h.dataset.defaultText){const R=(h.textContent||"").trim();R&&(h.dataset.defaultText=R)}o.push(h)}}),e.querySelectorAll("image, img").forEach((h,m)=>{var f;const I=h.getAttribute("data-preview-node")||`auto-image-${m+1}`;i(h,I,((f=h.dataset)==null?void 0:f.previewLabel)||null,null,"image")}),e.querySelectorAll("text, tspan").forEach((h,m)=>{var B,R;const I=(((B=h.dataset)==null?void 0:B.defaultText)||h.textContent||"").trim()||null,f=h.getAttribute("data-preview-node")||`auto-text-${m+1}`;i(h,f,((R=h.dataset)==null?void 0:R.previewLabel)||null,I,"text")}),o.length>0&&o.forEach((h,m)=>{var f,B;const I=h.getAttribute("data-preview-node")||`fallback-${m+1}`;i(h,I,((f=h.dataset)==null?void 0:f.previewLabel)||null,((B=h.dataset)==null?void 0:B.defaultText)||null,"node")});const N=[];return e.querySelectorAll("text[data-preview-node], tspan[data-preview-node]").forEach(h=>{const m=h.getAttribute("data-preview-node");if(m&&t.has(m)){const I=t.get(m);I&&!N.includes(I)&&N.push(I)}}),N.length>0?N:Array.from(t.values())},sr=e=>{if(!e)return;e.classList.remove("is-open"),e.setAttribute("aria-hidden","true");const t=e.dataset.section;if(t){const r=document.querySelector(`.sidenav-btn[data-nav="${t}"]`);r==null||r.classList.remove("active"),t==="background"&&st&&(st=!1,jt(),Ht())}},Vr=()=>{Object.values(Ar).forEach(e=>sr(e))},Xr=e=>{const t=Ar[e];if(!t)return;t.classList.add("is-open"),t.setAttribute("aria-hidden","false");const r=t.querySelector('input:not([type="hidden"])');if(r==null||r.focus({preventScroll:!0}),e==="background"&&di(),e==="graphics"){const n=document.querySelector('.graphics-category-button[data-category="image"]');n?Zr(n):(Cr(),Er())}};k.length&&k.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.nav||"text",r=Ar[t],n=r==null?void 0:r.classList.contains("is-open");Vr(),k.forEach(i=>i.classList.remove("active")),n||(Xr(t),e.classList.add("active"))})}),Zn.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");sr(t)})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.contains("is-open")&&sr(e.target)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal.is-open");t&&sr(t)}});async function Qn(e){if(!e||!e.fullUrl){console.error("[InkWise Studio] Invalid graphic item:",e);return}const t=document.getElementById("background-modal");if(t&&t.classList.contains("is-open")&&st){try{const i=await fetch(e.fullUrl);if(!i.ok)throw new Error(`Failed to fetch background image: ${i.status}`);const a=await i.blob(),o=await ki(a);Ai(o),console.log("[InkWise Studio] Applied graphic as background image")}catch(i){console.error("[InkWise Studio] Failed to apply background graphic:",i),alert("Failed to apply background image. Please try again.")}return}const n=P(Xe);if(!n){console.error("[InkWise Studio] No SVG root found for side:",Xe);return}try{const a=`graphic-${`graphic-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}`;if(e.fullUrl.includes(".svg")||e.id.startsWith("iconify-")){const d=await fetch(e.fullUrl);if(!d.ok)throw new Error(`Failed to fetch SVG: ${d.status}`);const c=await d.text(),y=document.createElementNS("http://www.w3.org/2000/svg","g");y.setAttribute("data-preview-node",a),y.setAttribute("data-preview-label",e.alt||"Graphic"),y.setAttribute("class","inserted-graphic"),y.setAttribute("data-editable-image","true"),y.setAttribute("transform","translate(100, 100) scale(0.5)");const m=new DOMParser().parseFromString(c,"image/svg+xml").documentElement;for(;m.firstChild;)y.appendChild(m.firstChild);n.appendChild(y);const I=lt(y);I&&(y.style.cursor="pointer",y.addEventListener("click",f=>{f.stopPropagation(),pt();const B=Lr(I.overlay,y);B&&(ot=B)})),console.log("[InkWise Studio] Inserted SVG graphic:",a)}else{const d=document.createElementNS("http://www.w3.org/2000/svg","image");d.setAttribute("data-preview-node",a),d.setAttribute("data-preview-label",e.alt||"Graphic"),d.setAttribute("class","inserted-graphic"),d.setAttribute("data-editable-image","true"),d.setAttribute("x","100"),d.setAttribute("y","100"),d.setAttribute("width","200"),d.setAttribute("height","200"),d.setAttribute("preserveAspectRatio","xMidYMid meet"),d.setAttributeNS("http://www.w3.org/1999/xlink","href",e.fullUrl),n.appendChild(d);const c=lt(d);c&&(d.style.cursor="pointer",d.addEventListener("click",y=>{y.stopPropagation(),pt();const N=Lr(c.overlay,d);N&&(ot=N)})),console.log("[InkWise Studio] Inserted raster graphic:",a)}updatePreview(Xe),console.log("[InkWise Studio] Graphic inserted successfully")}catch(i){console.error("[InkWise Studio] Failed to insert graphic:",i),alert("Failed to insert graphic. Please try again.")}}const or=document.querySelector(".graphics-categories-labels"),O=document.getElementById("graphics-browser-samples"),Yr=document.querySelectorAll(".graphics-category-button"),bt=document.getElementById("graphics-search-form"),vt=document.getElementById("graphics-search-input"),Kr="53250708-d3f88461e75cb0c2c5366a181",ei={shapes:{provider:"iconify",baseUrl:"https://api.iconify.design",perPage:36,query:"circle",prefix:"",label:"Shapes",searchPlaceholder:"Search shapes"},image:{provider:"unsplash",apiKey:"iFpUZ_6aTnLGz0Voz0MYlprq9i_RBl83ux9DzV6EMOs",perPage:12,query:"wedding invitation design",label:"Images",searchPlaceholder:"Search images"},icons:{provider:"flaticon",apiKey:"FPSX2c99579cb6ea5314189561ca375a1648",perPage:48,query:"wedding icon",label:"Icons",searchPlaceholder:"Search icons"},illustrations:{provider:"pixabay",apiKey:Kr,perPage:18,query:"wedding illustration",imageType:"illustration",label:"Illustrations",searchPlaceholder:"Search illustrations"},patterns:{provider:"pixabay",apiKey:Kr,perPage:18,query:"seamless pattern",imageType:"vector",label:"Patterns",searchPlaceholder:"Search patterns"}},Jr=new Map;let kr=0;function lr(e,t){const r=(t||"").trim();return r||e.query||e.defaultQuery||""}function Er(){O&&(O.innerHTML="",O.dataset.category="",O.dataset.page="0",O.dataset.loading="0",O.dataset.hasMore="0",O.dataset.searchTerm="",O.dataset.requestToken="")}function Cr(){if(!or||!O)return;or.querySelectorAll(".category-row").forEach(t=>{t.style.display="flex",t.dataset.expanded="0"}),Yr.forEach(t=>{t.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}),O.scrollTop=0,O.innerHTML="",O.dataset.category="",O.dataset.page="0",O.dataset.loading="0",O.dataset.hasMore="0",O.dataset.searchTerm="",O.dataset.requestToken="",bt&&(bt.classList.add("is-hidden"),bt.dataset.category=""),vt&&(vt.value="",vt.blur())}function Nr(e){return ei[e]||null}async function Zr(e){var h,m,I;const t=e.dataset.category;if(!t||!O||!or)return;if(e.getAttribute("aria-expanded")==="true"){Cr(),Er();return}const n=Nr(t);if(!n){console.warn(`[InkWise Studio] No graphics configuration found for category "${t}".`);return}Cr();const i=Jr.get(t)||"",a=n.label||"",o=(I=(m=(h=e.closest(".category-row"))==null?void 0:h.querySelector(".category-label"))==null?void 0:m.textContent)==null?void 0:I.trim(),d=a||o||t,c=n.searchPlaceholder||`Search ${d.toLowerCase()}`;bt&&(bt.classList.remove("is-hidden"),bt.dataset.category=t),vt&&(vt.placeholder=c,vt.value=i),e.setAttribute("aria-expanded","true"),e.classList.add("is-open"),or.querySelectorAll(".category-row").forEach(f=>{f.dataset.categoryRow===t?(f.style.display="flex",f.dataset.expanded="1"):f.style.display="none"}),O.innerHTML="",O.dataset.category=t,O.dataset.page="0",O.dataset.loading="0",O.dataset.hasMore="1",O.dataset.searchTerm=i,O.scrollTop=0;const N=String(++kr);O.dataset.requestToken=N,Qr(),await Ir(t,1,i,N)}function Qr(){if(!O)return;const e=O.querySelector(".graphics-loading");if(e){e.style.display="flex";return}const t=document.createElement("div");t.className="graphics-loading",t.textContent="Loading assetsâ€¦",O.appendChild(t)}function en(){if(!O)return;const e=O.querySelector(".graphics-loading");e&&e.remove()}function tn(e){if(!O)return;O.innerHTML="";const t=document.createElement("div");t.className="graphics-error",t.textContent=e||"Unable to load assets at the moment.",O.appendChild(t)}function ti(e){if(!O||!Array.isArray(e))return;const t=document.createDocumentFragment();e.forEach(r=>{if(!r||!r.thumbUrl)return;const n=document.createElement("div");n.className="graphics-sample",n.title=r.alt||"Graphic sample";const i=document.createElement("img");if(i.src=r.thumbUrl,i.alt=r.alt||"Graphic sample",i.loading="lazy",n.appendChild(i),r.label){const a=document.createElement("span");a.className="sample-label",a.textContent=r.label,n.appendChild(a)}n.addEventListener("click",async()=>{console.log("Selected asset",r);try{await Qn(r)}catch(a){console.error("[InkWise Studio] Failed to insert graphic:",a)}}),t.appendChild(n)}),en(),O.appendChild(t)}async function Ir(e,t,r,n){if(!O)return;const i=Nr(e);if(!i)return;const a=O.dataset.requestToken||"",o=n||a||String(++kr);if(!(O.dataset.loading==="1"&&o===a)){O.dataset.loading="1",Qr();try{const d=typeof r=="string"?r:O.dataset.searchTerm||"",c=await ri(i,t,d);if(O.dataset.requestToken!==o)return;if(O.dataset.loading="0",en(),!c.length&&t===1){tn("No assets found for this category right now. Try again in a moment."),O.dataset.hasMore="0";return}ti(c),O.dataset.page=String(t);const y=i.perPage||12;O.dataset.hasMore=c.length>=y?"1":"0"}catch(d){if(console.error("[InkWise Studio] Failed to load graphics assets:",d),O.dataset.requestToken!==o)return;O.dataset.loading="0",tn("We ran into a problem loading assets. Please try again."),O.dataset.hasMore="0"}}}async function ri(e,t,r){switch(e.provider){case"unsplash":return ni(e,t,r);case"pixabay":return ii(e,t,r);case"flaticon":return ai(e,t,r);case"iconify":return si(e,t,r);default:return console.warn("[InkWise Studio] Unknown graphics provider:",e.provider),[]}}async function ni(e,t,r){const n=e.perPage||12,i=lr(e,r),a=i?"https://api.unsplash.com/search/photos":"https://api.unsplash.com/photos",o=new URLSearchParams({per_page:String(n),page:String(t),client_id:e.apiKey});i&&(o.set("query",i),o.set("orientation","portrait"));const d=`${a}?${o.toString()}`,c=await fetch(d);if(!c.ok)throw new Error(`Unsplash API error: ${c.status}`);const y=await c.json();return(Array.isArray(y)?y:Array.isArray(y.results)?y.results:[]).map(h=>{const m=h.urls||{};return{id:`unsplash-${h.id}`,thumbUrl:m.small||m.thumb||m.regular||"",fullUrl:m.full||m.regular||m.raw||"",alt:h.alt_description||h.description||h.slug||"Unsplash image"}}).filter(h=>!!h.thumbUrl)}async function ii(e,t,r){const n=e.perPage||18,i=new URLSearchParams({key:e.apiKey,q:lr(e,r),per_page:String(n),page:String(t),safesearch:"true",order:"popular"});e.imageType&&i.set("image_type",e.imageType),e.category&&i.set("category",e.category);const a=await fetch(`https://pixabay.com/api/?${i.toString()}`);if(!a.ok)throw new Error(`Pixabay API error: ${a.status}`);const o=await a.json();return(Array.isArray(o==null?void 0:o.hits)?o.hits:[]).map(c=>({id:`pixabay-${c.id}`,thumbUrl:c.previewURL||c.webformatURL||"",fullUrl:c.largeImageURL||c.webformatURL||"",alt:c.tags||"Pixabay asset",label:c.user?`@${c.user}`:null})).filter(c=>!!c.thumbUrl)}async function ai(e,t,r){const n=e.perPage||48,i=new URLSearchParams({q:lr(e,r)||"icon",limit:String(n),page:String(t)});i.set("apikey",e.apiKey);const a=await fetch(`https://api.flaticon.com/v3/search/icons?${i.toString()}`,{headers:{Accept:"application/json",apikey:e.apiKey,Authorization:`Bearer ${e.apiKey}`}});if(!a.ok)throw new Error(`Flaticon API error: ${a.status}`);const o=await a.json();return(Array.isArray(o==null?void 0:o.data)?o.data:Array.isArray(o==null?void 0:o.icons)?o.icons:Array.isArray(o==null?void 0:o.result)?o.result:[]).map(c=>{var f;const y=(c==null?void 0:c.images)||c,N=(y==null?void 0:y.png)||{},h=(y==null?void 0:y.svg)||(y==null?void 0:y.svg)||null,m=N[128]||N[256]||h||(y==null?void 0:y["64"])||null,I=N[512]||N[256]||h||m;return m?{id:`flaticon-${(c==null?void 0:c.id)||(c==null?void 0:c.icon_id)||(c==null?void 0:c.id_icon)||Math.random().toString(36).slice(2)}`,thumbUrl:m,fullUrl:I,alt:(c==null?void 0:c.description)||(Array.isArray(c==null?void 0:c.tags)?c.tags.join(", "):"Icon asset"),label:((f=c==null?void 0:c.uploader)==null?void 0:f.name)||(c==null?void 0:c.category)||null}:null}).filter(Boolean)}async function si(e,t,r){const n=e.perPage||36,i=Math.max(0,(t-1)*n),a=new URLSearchParams({query:lr(e,r)||"shape",limit:String(n),offset:String(i)});e.prefix&&a.set("prefix",e.prefix);const o=(e.baseUrl||"https://api.iconify.design").replace(/\/$/,""),d=await fetch(`${o}/search?${a.toString()}`,{headers:{Accept:"application/json"}});if(!d.ok)throw new Error(`Iconify API error: ${d.status}`);const c=await d.json(),y=Array.isArray(c==null?void 0:c.icons)?c.icons:[],N=Array.isArray(c==null?void 0:c.prefixes)&&c.prefixes.length===1?c.prefixes[0]:(c==null?void 0:c.prefix)||e.prefix||"";return y.map(h=>{if(typeof h=="string"){const m=h.includes(":")?h:N?`${N}:${h}`:h;if(!m)return null;const I=m.split(":").map(B=>encodeURIComponent(B)).join(":"),f=m.split(":").pop()||m;return{id:`iconify-${m.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${o}/${I}.svg?height=120&width=120`,fullUrl:`${o}/${I}.svg`,alt:f.replace(/[-_]/g," "),label:f.replace(/[-_]/g," ")}}if(h&&typeof h=="object"){const m=h.name||h.icon||h.id||"";if(!m)return null;const I=h.prefix||N,f=I?`${I}:${m}`:m,B=f.split(":").map(ye=>encodeURIComponent(ye)).join(":"),R=h.label||m;return{id:`iconify-${f.replace(/[^a-zA-Z0-9:]/g,"-")}-${t}`,thumbUrl:`${o}/${B}.svg?height=120&width=120`,fullUrl:`${o}/${B}.svg`,alt:R.replace(/[-_]/g," "),label:R.replace(/[-_]/g," ")}}return null}).filter(h=>!!(h!=null&&h.thumbUrl))}async function oi(){if(!O)return;const e=O.dataset.category;if(!e||O.dataset.loading==="1"||O.dataset.hasMore==="0")return;if(O.scrollTop+O.clientHeight>=O.scrollHeight-180){const r=Number(O.dataset.page||"1")+1,n=O.dataset.searchTerm||"";await Ir(e,r,n)}}Yr.forEach(e=>{e.addEventListener("click",()=>Zr(e))}),O&&(O.addEventListener("scroll",()=>{oi().catch(e=>{console.error("[InkWise Studio] graphics scroll handler error:",e)})}),Er()),bt&&vt&&bt.addEventListener("submit",async e=>{if(e.preventDefault(),!O)return;const t=O.dataset.category;if(!t||!Nr(t))return;const r=vt.value.trim();Jr.set(t,r),O.scrollTop=0,O.innerHTML="",O.dataset.page="0",O.dataset.hasMore="1",O.dataset.searchTerm=r,O.dataset.loading="0";const n=String(++kr);O.dataset.requestToken=n;try{await Ir(t,1,r,n)}catch(i){console.error("[InkWise Studio] graphics search failed:",i)}});const rn=e=>!e||!A?null:A.querySelector(`input[data-preview-target="${e}"]`),li=e=>!e||!x?null:x.querySelector(`[data-preview-node="${e}"]`),nn=(()=>{let e=!1;return()=>{if(e||typeof document>"u")return;const t=document.createElement("style");t.id="inkwise-crop-overlay-styles",t.textContent=`
.crop-overlay {
  position: absolute;
  inset: 0;
  z-index: 12;
}

.crop-overlay__scrim {
  position: absolute;
  background: rgba(15, 23, 42, 0.35);
  backdrop-filter: blur(10px);
  pointer-events: none;
  transition: transform 0.18s ease, opacity 0.18s ease;
}

.crop-frame {
  position: absolute;
  border-radius: 18px;
  border: 1.5px solid rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 36px rgba(15, 23, 42, 0.3);
  pointer-events: auto;
  cursor: grab;
  background: rgba(15, 23, 42, 0.08);
  transition: box-shadow 0.24s ease, border-color 0.24s ease;
}

.crop-frame:active {
  cursor: grabbing;
  box-shadow: 0 24px 48px rgba(15, 23, 42, 0.34);
}

.crop-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255, 255, 255, 0.45);
  border-radius: inherit;
  pointer-events: none;
  mix-blend-mode: screen;
}

.crop-frame__corner {
  position: absolute;
  width: 28px;
  height: 28px;
  pointer-events: auto;
}

.crop-frame__corner .corner-arm {
  position: absolute;
  background: rgba(255, 255, 255, 0.98);
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.28);
  border-radius: 999px;
  pointer-events: none;
}

.crop-frame__corner .corner-arm--horizontal {
  width: 18px;
  height: 3px;
}

.crop-frame__corner .corner-arm--vertical {
  width: 3px;
  height: 18px;
}

.crop-frame__corner--top-left {
  top: -4px;
  left: -4px;
}

.crop-frame__corner--top-right {
  top: -4px;
  right: -4px;
}

.crop-frame__corner--bottom-left {
  bottom: -4px;
  left: -4px;
}

.crop-frame__corner--bottom-right {
  bottom: -4px;
  right: -4px;
}

.crop-frame__corner--top-left .corner-arm--horizontal,
.crop-frame__corner--bottom-left .corner-arm--horizontal {
  top: 0;
  left: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--top-right .corner-arm--vertical {
  top: 0;
}

.crop-frame__corner--top-right .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  top: 0;
  right: 0;
}

.crop-frame__corner--bottom-left .corner-arm--horizontal,
.crop-frame__corner--bottom-right .corner-arm--horizontal {
  bottom: 0;
}

.crop-frame__corner--bottom-left .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  bottom: 0;
}

.crop-frame__corner--top-right .corner-arm--vertical,
.crop-frame__corner--bottom-right .corner-arm--vertical {
  right: 0;
}

.crop-frame__corner--top-left .corner-arm--vertical,
.crop-frame__corner--bottom-left .corner-arm--vertical {
  left: 0;
}

.crop-frame__edge-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 2px solid rgba(255, 255, 255, 0.92);
  background: rgba(15, 23, 42, 0.55);
  box-shadow: 0 8px 20px rgba(15, 23, 42, 0.32);
  pointer-events: none;
}

.crop-frame__edge-handle--top {
  top: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--right {
  right: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.crop-frame__edge-handle--bottom {
  bottom: -10px;
  left: 50%;
  transform: translate(-50%, 0);
}

.crop-frame__edge-handle--left {
  left: -10px;
  top: 50%;
  transform: translate(0, -50%);
}

.editor-overlay--crop-active {
  border-color: transparent !important;
  box-shadow: none !important;
  background: transparent !important;
}

.editor-overlay--crop-active .editor-overlay__handle {
  display: none !important;
}

.editor-overlay--crop-active::after {
  display: none !important;
}

.editor-overlay--hidden-for-crop {
  opacity: 0;
  pointer-events: none;
}

.crop-overlay__controls {
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  display: flex;
  gap: 12px;
  pointer-events: auto;
  z-index: 5;
}

.crop-overlay__button {
  border: none;
  border-radius: 999px;
  padding: 9px 20px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: #ffffff;
  cursor: pointer;
  background: rgba(15, 23, 42, 0.82);
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.35);
  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.crop-overlay__button:hover {
  background: rgba(15, 23, 42, 0.92);
  transform: translateY(-1px);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
}

.crop-overlay__button:active {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(15, 23, 42, 0.34);
}

.crop-overlay__button:focus-visible {
  outline: 2px solid rgba(96, 165, 250, 0.95);
  outline-offset: 2px;
}

.crop-overlay__button--cancel {
  background: rgba(148, 163, 184, 0.74);
  color: rgba(15, 23, 42, 0.92);
}

.crop-overlay__button--cancel:hover {
  background: rgba(226, 232, 240, 0.92);
  color: rgba(15, 23, 42, 0.95);
}

.crop-overlay__button--apply {
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.92), rgba(59, 130, 246, 0.9));
}

.crop-overlay__button--apply:hover {
  background: linear-gradient(135deg, rgba(14, 165, 233, 1), rgba(37, 99, 235, 0.98));
}

@media (prefers-reduced-motion: reduce) {
  .crop-overlay__scrim,
  .crop-frame {
    transition: none;
  }
}
        `,document.head.appendChild(t),e=!0}})(),pt=()=>{ot&&(ot.teardown(),ot=null)},Lr=(e,t)=>{if(!e||!t)return null;nn(),getComputedStyle(e).position==="static"&&(e.style.position="relative");const r=(g,T,fe)=>Math.min(Math.max(g,T),fe);(()=>{if(t.dataset.cropSourceWidth&&t.dataset.cropSourceHeight)return;let g=null;try{g=t.getBBox()}catch{g=null}const T=g&&Number.isFinite(g.width)&&g.width>0?g.width:parseFloat(t.getAttribute("width"))||0,fe=g&&Number.isFinite(g.height)&&g.height>0?g.height:parseFloat(t.getAttribute("height"))||0,W=g&&Number.isFinite(g.x)?g.x:parseFloat(t.getAttribute("x"))||0,Te=g&&Number.isFinite(g.y)?g.y:parseFloat(t.getAttribute("y"))||0;T>0&&fe>0&&(t.dataset.cropSourceWidth=T,t.dataset.cropSourceHeight=fe,t.dataset.cropSourceX=W,t.dataset.cropSourceY=Te)})();const i=document.createElement("div");i.className="crop-overlay";const a=(()=>{const g=typeof t.dataset.cropRect=="string"?t.dataset.cropRect:"",T=t.getAttribute("clip-path")||"",fe=t.style&&typeof t.style.clipPath=="string"?t.style.clipPath:"",W=t.style&&typeof t.style.webkitClipPath=="string"?t.style.webkitClipPath:"",Te=t.dataset.cropClipId||"",Re=(()=>{const Ce=T.match(/^url\(#(.+)\)$/);return Ce?Ce[1]:""})(),$e=Te||Re;let Ne=null;if($e){const Ce=Ft(t.ownerSVGElement||null),be=Ce==null?void 0:Ce.querySelector(`#${$e}`),we=be==null?void 0:be.querySelector("rect");we&&(Ne={x:we.getAttribute("x")||"",y:we.getAttribute("y")||"",width:we.getAttribute("width")||"",height:we.getAttribute("height")||""})}return{rectString:g,clipPathAttr:T,clipId:$e,clipRect:Ne,clipPathStyle:fe,webkitClipPathStyle:W}})(),o=[],d=document.createElement("div");d.className="crop-overlay__scrim crop-overlay__scrim--top";const c=document.createElement("div");c.className="crop-overlay__scrim crop-overlay__scrim--right";const y=document.createElement("div");y.className="crop-overlay__scrim crop-overlay__scrim--bottom";const N=document.createElement("div");N.className="crop-overlay__scrim crop-overlay__scrim--left",[d,c,y,N].forEach(g=>{g.style.pointerEvents="none",i.appendChild(g)});const m=document.createElement("div");m.className="crop-frame",i.appendChild(m);const I=document.createElement("div");I.className="crop-overlay__controls";const f=document.createElement("button");f.type="button",f.className="crop-overlay__button crop-overlay__button--cancel",f.textContent="Cancel";const B=document.createElement("button");B.type="button",B.className="crop-overlay__button crop-overlay__button--apply",B.textContent="Crop",I.appendChild(f),I.appendChild(B),i.appendChild(I);const R=["top-left","top-right","bottom-left","bottom-right"],ye=[],xe={"top-left":"nwse-resize","bottom-right":"nwse-resize","top-right":"nesw-resize","bottom-left":"nesw-resize"};R.forEach(g=>{const T=document.createElement("div");T.className=`crop-frame__corner crop-frame__corner--${g}`,T.dataset.corner=g,T.style.pointerEvents="auto",T.style.cursor=xe[g]||"nwse-resize";const fe=document.createElement("span");fe.className="corner-arm corner-arm--horizontal",fe.style.pointerEvents="none";const W=document.createElement("span");W.className="corner-arm corner-arm--vertical",W.style.pointerEvents="none",T.appendChild(fe),T.appendChild(W),m.appendChild(T),ye.push(T)});const se=["top","right","bottom","left"],ke=[];se.forEach(g=>{const T=document.createElement("div");T.className=`crop-frame__edge-handle crop-frame__edge-handle--${g}`,T.dataset.edge=g,T.style.pointerEvents="auto",T.style.cursor=g==="top"||g==="bottom"?"ns-resize":"ew-resize",m.appendChild(T),ke.push(T)}),e.appendChild(i);let le=e.getBoundingClientRect(),J=le.width||e.offsetWidth,V=le.height||e.offsetHeight,Pe=J,Ke=V;if(!J||!V)return i.remove(),null;L.forEach(g=>{!g||!g.overlay||g.overlay!==e&&(g.overlay.classList.contains("editor-overlay--hidden-for-crop")||(g.overlay.classList.add("editor-overlay--hidden-for-crop"),o.push(g.overlay)))}),e.classList.add("editor-overlay--crop-active"),e.dataset.cropSessionActive="true",_e(),i.style.pointerEvents="none",m.style.pointerEvents="auto";const Je=(()=>{const g=t.dataset.cropRect;if(!g)return null;const T=g.split(",").map(fe=>Number(fe));return T.length!==4||T.some(fe=>!Number.isFinite(fe))?null:{left:r(T[0],0,1),top:r(T[1],0,1),width:r(T[2],0,1),height:r(T[3],0,1)}})(),nt=parseFloat(t.dataset.cropSourceWidth)||0,ct=parseFloat(t.dataset.cropSourceHeight)||0;let Me,Le;const At=()=>{Le=Math.min(J,Math.max(48,J*.08)),Me=Math.min(V,Math.max(48,V*.08))};At();const M={left:0,top:0,width:0,height:0};if(Je&&Je.width>0&&Je.height>0){const g=Je.width*J,T=Je.height*V;M.width=r(g,Le,J),M.height=r(T,Me,V),M.left=r(Je.left*J,0,J-M.width),M.top=r(Je.top*V,0,V-M.height)}else{const g=nt>0&&ct>0?nt/ct:J>0&&V>0?J/V:1;let T,fe;g>=1?(T=J*.85,fe=T/g):(fe=V*.85,T=fe*g),M.width=r(T,Le,J),M.height=r(fe,Me,V),M.left=Math.max(0,(J-M.width)/2),M.top=Math.max(0,(V-M.height)/2)}M.width=r(M.width,Le,J),M.height=r(M.height,Me,V),M.left=r(M.left,0,J-M.width),M.top=r(M.top,0,V-M.height);const ia=()=>{const g=M.left+M.width,T=M.top+M.height;d.style.top="0px",d.style.left="0px",d.style.width="100%",d.style.height=`${Math.max(0,M.top)}px`,d.style.display=M.top>0?"block":"none",y.style.top=`${T}px`,y.style.left="0px",y.style.width="100%",y.style.height=`${Math.max(0,V-T)}px`,y.style.display=T<V?"block":"none",N.style.top=`${M.top}px`,N.style.left="0px",N.style.width=`${Math.max(0,M.left)}px`,N.style.height=`${M.height}px`,N.style.display=M.left>0?"block":"none",c.style.top=`${M.top}px`,c.style.left=`${g}px`,c.style.width=`${Math.max(0,J-g)}px`,c.style.height=`${M.height}px`,c.style.display=g<J?"block":"none"},xn=(g,T,fe,W)=>{const Te=t.ownerSVGElement;if(!Te)return;const Re=parseFloat(t.dataset.cropSourceWidth)||0,$e=parseFloat(t.dataset.cropSourceHeight)||0,Ne=parseFloat(t.dataset.cropSourceX)||0,Ce=parseFloat(t.dataset.cropSourceY)||0;let be=Re,we=$e,tt=Ne,wr=Ce;if(!be||!we){let Ge=null;try{Ge=t.getBBox()}catch{Ge=null}be=Ge&&Number.isFinite(Ge.width)&&Ge.width>0?Ge.width:parseFloat(t.getAttribute("width"))||0,we=Ge&&Number.isFinite(Ge.height)&&Ge.height>0?Ge.height:parseFloat(t.getAttribute("height"))||0,tt=Ge&&Number.isFinite(Ge.x)?Ge.x:parseFloat(t.getAttribute("x"))||0,wr=Ge&&Number.isFinite(Ge.y)?Ge.y:parseFloat(t.getAttribute("y"))||0}if(!be||!we)return;if(t instanceof HTMLImageElement){const Ge=r(T,0,1)*100,$n=r(g,0,1)*100,ua=r(1-(T+W),0,1)*100,pa=r(1-(g+fe),0,1)*100,qr=`inset(${Ge}% ${pa}% ${ua}% ${$n}%)`;t.style.clipPath=qr,t.style.webkitClipPath=qr,delete t.dataset.cropClipId,t.dataset.cropCssClip=qr;return}const zt=Ft(Te);if(!zt)return;const ht=t.dataset.cropClipId||`inkwiseCrop_${Date.now()}_${Math.floor(Math.random()*1e3)}`;let it=zt.querySelector(`#${ht}`);it||(it=document.createElementNS(j,"clipPath"),it.id=ht,it.setAttribute("clipPathUnits","userSpaceOnUse"),zt.appendChild(it));let at=it.querySelector("rect");at||(at=document.createElementNS(j,"rect"),it.appendChild(at));const oa=be*fe,la=we*W,ca=tt+be*g,da=wr+we*T;at.setAttribute("x",ca),at.setAttribute("y",da),at.setAttribute("width",oa),at.setAttribute("height",la),t.dataset.cropClipId=ht,t.setAttribute("clip-path",`url(#${ht})`),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip},aa=()=>{if(!J||!V)return;const g=t.dataset.cropRect||"",T=typeof t.getAttribute("clip-path")=="string"&&t.getAttribute("clip-path").length>0,fe=t.ownerSVGElement,W=M.left/J,Te=M.top/V,Re=M.width/J,$e=M.height/V,Ne=r(W,0,1),Ce=r(Te,0,1),be=r(Re,0,1-Ne),we=r($e,0,1-Ce),tt=Ne+be,wr=Ce+we;if(Ne<=.001&&Ce<=.001&&tt>=.999&&wr>=.999){const ht=t.dataset.cropClipId;if(ht){const it=Ft(fe),at=it==null?void 0:it.querySelector(`#${ht}`);at==null||at.remove(),delete t.dataset.cropClipId}t.removeAttribute("clip-path"),t.style.removeProperty("clip-path"),t.style.removeProperty("-webkit-clip-path"),delete t.dataset.cropCssClip,delete t.dataset.cropRect,(g||T)&&(E==null||E.schedule("image-crop"),_e());return}const zt=[Ne,Ce,be,we].map(ht=>ht.toFixed(6)).join(",");t.dataset.cropRect=zt,xn(Ne,Ce,be,we),g!==zt&&(E==null||E.schedule("image-crop"),_e())},Sn=()=>{var Ce;const g=t.dataset.cropRect||"",T=t.getAttribute("clip-path")||"",fe=t.dataset.cropClipId||"",W=t.ownerSVGElement,Te=t.dataset.cropClipId;if(Te&&Te!==a.clipId){const be=Ft(W);(Ce=be==null?void 0:be.querySelector(`#${Te}`))==null||Ce.remove()}if(a.rectString){t.dataset.cropRect=a.rectString,a.clipId?t.dataset.cropClipId=a.clipId:delete t.dataset.cropClipId;const be=a.rectString.split(",").map(we=>Number(we));be.length===4&&be.every(we=>Number.isFinite(we))&&xn(be[0],be[1],be[2],be[3]),a.clipPathAttr?t.setAttribute("clip-path",a.clipPathAttr):t.removeAttribute("clip-path"),a.clipPathStyle?(t.style.clipPath=a.clipPathStyle,t.dataset.cropCssClip=a.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),a.webkitClipPathStyle?t.style.webkitClipPath=a.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}else{if(delete t.dataset.cropRect,a.clipId){if(t.dataset.cropClipId=a.clipId,a.clipRect){const be=Ft(W);if(be){let we=be.querySelector(`#${a.clipId}`);we||(we=document.createElementNS(j,"clipPath"),we.id=a.clipId,we.setAttribute("clipPathUnits","userSpaceOnUse"),be.appendChild(we));let tt=we.querySelector("rect");tt||(tt=document.createElementNS(j,"rect"),we.appendChild(tt)),tt.setAttribute("x",a.clipRect.x),tt.setAttribute("y",a.clipRect.y),tt.setAttribute("width",a.clipRect.width),tt.setAttribute("height",a.clipRect.height)}}a.clipPathAttr&&t.setAttribute("clip-path",a.clipPathAttr)}else delete t.dataset.cropClipId,a.clipPathAttr?t.setAttribute("clip-path",a.clipPathAttr):t.removeAttribute("clip-path");a.clipPathStyle?(t.style.clipPath=a.clipPathStyle,t.dataset.cropCssClip=a.clipPathStyle):(t.style.removeProperty("clip-path"),delete t.dataset.cropCssClip),a.webkitClipPathStyle?t.style.webkitClipPath=a.webkitClipPathStyle:t.style.removeProperty("-webkit-clip-path")}const Re=t.dataset.cropRect||"",$e=t.getAttribute("clip-path")||"",Ne=t.dataset.cropClipId||"";(g!==Re||T!==$e||fe!==Ne)&&(E==null||E.schedule("image-crop"),_e())},gt=()=>{m.style.left=`${M.left}px`,m.style.top=`${M.top}px`,m.style.width=`${M.width}px`,m.style.height=`${M.height}px`,ia(),aa()};gt();let Oe=null,Be=null;const Dr=()=>{const g=J||(le==null?void 0:le.width)||(u==null?void 0:u.clientWidth)||0,T=V||(le==null?void 0:le.height)||(u==null?void 0:u.clientHeight)||0,fe=Math.min(g,T);return Math.max(8,Math.round(fe*.02))},Dt=(g,T)=>{const fe=[],W=Math.round(g/Ur)*Ur;fe.push(W),Number.isFinite(T)&&T>0&&fe.push(T/2);let Te=g,Re=Number.POSITIVE_INFINITY;return fe.forEach($e=>{const Ne=Math.abs($e-g);Ne<Re&&Ne<=Dn&&(Te=$e,Re=Ne)}),Te},An=g=>{if(g.button!==0||g.target!==m)return;g.preventDefault(),le=e.getBoundingClientRect();const T=le.width||J,fe=le.height||V;Oe={pointerId:g.pointerId,startX:g.clientX,startY:g.clientY,widthLimit:T,heightLimit:fe,startLeft:M.left,startTop:M.top},m.setPointerCapture(g.pointerId)},kn=g=>{if(!Oe||g.pointerId!==Oe.pointerId)return;g.preventDefault();const T=g.clientX-Oe.startX,fe=g.clientY-Oe.startY,W=Dr(),Te=Math.max(0,Oe.widthLimit-M.width-W*2),Re=Math.max(0,Oe.heightLimit-M.height-W*2),$e=Oe.startLeft+T,Ne=Oe.startTop+fe,Ce=Dt($e,Oe.widthLimit),be=Dt(Ne,Oe.heightLimit);M.left=r(Ce,W,W+Te),M.top=r(be,W,W+Re),gt()},yr=g=>{if(!(!Oe||g.pointerId!==Oe.pointerId)){try{m.releasePointerCapture(g.pointerId)}catch{}Oe=null}};m.addEventListener("pointerdown",An),m.addEventListener("pointermove",kn),m.addEventListener("pointerup",yr),m.addEventListener("pointercancel",yr);const En=()=>{Oe=null};m.addEventListener("lostpointercapture",En);const Cn=g=>{g.button===0&&(g.preventDefault(),g.stopPropagation(),le=e.getBoundingClientRect(),J=le.width||e.offsetWidth||J,V=le.height||e.offsetHeight||V,At(),Be={pointerId:g.pointerId,mode:"edge",edge:g.currentTarget.dataset.edge,anchor:{left:M.left,top:M.top,right:M.left+M.width,bottom:M.top+M.height},target:g.currentTarget},g.currentTarget.setPointerCapture(g.pointerId))},Nn=g=>{if(!Be||g.pointerId!==Be.pointerId||Be.mode!=="edge")return;g.preventDefault(),le=e.getBoundingClientRect(),J=le.width||e.offsetWidth||J,V=le.height||e.offsetHeight||V,At();const T=g.clientX-le.left,fe=g.clientY-le.top,W=Be.anchor,Te=Dr();let Re=W.left,$e=W.top,Ne=r(W.right-W.left,Le,J),Ce=r(W.bottom-W.top,Me,V);if(Be.edge==="top"){const be=Math.min(W.bottom-Me,V-Me),we=r(fe,0,Math.max(0,be));$e=we,Ce=Math.max(Me,W.bottom-we)}else if(Be.edge==="bottom"){const be=W.top+Me,we=r(fe,be,V);$e=W.top,Ce=Math.max(Me,we-W.top)}else if(Be.edge==="left"){const be=Math.min(W.right-Le,J-Le),we=r(T,0,Math.max(0,be));Re=we,Ne=Math.max(Le,W.right-we)}else if(Be.edge==="right"){const be=W.left+Le,we=r(T,be,J);Re=W.left,Ne=Math.max(Le,we-W.left)}Ne=r(Ne,Le,J),Ce=r(Ce,Me,V),Re=Dt(r(Re,Te,J-Te-Ne),J),$e=Dt(r($e,Te,V-Te-Ce),V),M.left=Re,M.top=$e,M.width=Ne,M.height=Ce,gt()},br=g=>{var T;if(!(!Be||g.pointerId!==Be.pointerId)){try{(T=Be.target)==null||T.releasePointerCapture(g.pointerId)}catch{}Be=null,gt()}},In=()=>{Be=null},Ln=g=>{g.button===0&&(g.preventDefault(),g.stopPropagation(),le=e.getBoundingClientRect(),J=le.width||e.offsetWidth||J,V=le.height||e.offsetHeight||V,At(),Be={pointerId:g.pointerId,mode:"corner",corner:g.currentTarget.dataset.corner,anchor:{left:M.left,top:M.top,right:M.left+M.width,bottom:M.top+M.height},target:g.currentTarget},g.currentTarget.setPointerCapture(g.pointerId))},Tn=g=>{if(!Be||g.pointerId!==Be.pointerId||Be.mode!=="corner")return;g.preventDefault(),le=e.getBoundingClientRect(),J=le.width||e.offsetWidth||J,V=le.height||e.offsetHeight||V,At();const T=g.clientX-le.left,fe=g.clientY-le.top,W=Be.anchor,Te=Dr();let Re=W.left,$e=W.top,Ne=r(W.right-W.left,Le,J),Ce=r(W.bottom-W.top,Me,V);switch(Be.corner){case"top-left":{const be=r(T,0,W.right-Le),we=r(fe,0,W.bottom-Me);Re=be,$e=we,Ne=Math.max(Le,W.right-be),Ce=Math.max(Me,W.bottom-we);break}case"top-right":{const be=r(T,W.left+Le,J),we=r(fe,0,W.bottom-Me);Re=W.left,$e=we,Ne=Math.max(Le,be-W.left),Ce=Math.max(Me,W.bottom-we);break}case"bottom-left":{const be=r(T,0,W.right-Le),we=r(fe,W.top+Me,V);Re=be,$e=W.top,Ne=Math.max(Le,W.right-be),Ce=Math.max(Me,we-W.top);break}case"bottom-right":{const be=r(T,W.left+Le,J),we=r(fe,W.top+Me,V);Re=W.left,$e=W.top,Ne=Math.max(Le,be-W.left),Ce=Math.max(Me,we-W.top);break}default:return}Ne=r(Ne,Le,J),Ce=r(Ce,Me,V),Re=Dt(r(Re,Te,J-Te-Ne),J),$e=Dt(r($e,Te,V-Te-Ce),V),M.left=Re,M.top=$e,M.width=Ne,M.height=Ce,gt()},vr=g=>{var T;if(!(!Be||g.pointerId!==Be.pointerId)){try{(T=Be.target)==null||T.releasePointerCapture(g.pointerId)}catch{}Be=null,gt()}},Fn=()=>{Be=null};ke.forEach(g=>{g.addEventListener("pointerdown",Cn),g.addEventListener("pointermove",Nn),g.addEventListener("pointerup",br),g.addEventListener("pointercancel",br),g.addEventListener("lostpointercapture",In)}),ye.forEach(g=>{g.addEventListener("pointerdown",Ln),g.addEventListener("pointermove",Tn),g.addEventListener("pointerup",vr),g.addEventListener("pointercancel",vr),g.addEventListener("lostpointercapture",Fn)});const _n=g=>{g.preventDefault(),g.stopPropagation(),Sn(),pt()},Bn=g=>{g.preventDefault(),g.stopPropagation(),gt()};f.addEventListener("click",_n),B.addEventListener("click",Bn);const Rn=g=>{g.key==="Escape"&&(g.preventDefault(),Sn(),pt()),g.key==="Enter"&&(g.metaKey||g.ctrlKey)&&(g.preventDefault(),gt(),pt())};document.addEventListener("keydown",Rn);const zr=()=>{if(le=e.getBoundingClientRect(),J=le.width||e.offsetWidth||J,V=le.height||e.offsetHeight||V,!J||!V)return;At();const g=t.dataset.cropRect||null;if(g){const T=g.split(",").map(fe=>Number(fe));if(T.length===4&&T.every(fe=>Number.isFinite(fe))){const fe=r(T[2]*J,Le,J),W=r(T[3]*V,Me,V),Te=r(T[0]*J,0,J-fe),Re=r(T[1]*V,0,V-W);M.left=Te,M.top=Re,M.width=fe,M.height=W}}else{const T=Pe?M.width/Pe:1,fe=Ke?M.height/Ke:1,W=Pe?M.left/Pe:0,Te=Ke?M.top/Ke:0;M.width=r(T*J,Le,J),M.height=r(fe*V,Me,V),M.left=r(W*J,0,J-M.width),M.top=r(Te*V,0,V-M.height)}Pe=J,Ke=V,gt()};return window.addEventListener("resize",zr),{overlay:e,refresh:zr,teardown:()=>{var g;if(Oe&&typeof Oe.pointerId<"u"){try{m.releasePointerCapture(Oe.pointerId)}catch{}Oe=null}if(Be&&typeof Be.pointerId<"u"){try{(g=Be.target)==null||g.releasePointerCapture(Be.pointerId)}catch{}Be=null}window.removeEventListener("resize",zr),m.removeEventListener("pointerdown",An),m.removeEventListener("pointermove",kn),m.removeEventListener("pointerup",yr),m.removeEventListener("pointercancel",yr),m.removeEventListener("lostpointercapture",En),ke.forEach(T=>{T.removeEventListener("pointerdown",Cn),T.removeEventListener("pointermove",Nn),T.removeEventListener("pointerup",br),T.removeEventListener("pointercancel",br),T.removeEventListener("lostpointercapture",In)}),ye.forEach(T=>{T.removeEventListener("pointerdown",Ln),T.removeEventListener("pointermove",Tn),T.removeEventListener("pointerup",vr),T.removeEventListener("pointercancel",vr),T.removeEventListener("lostpointercapture",Fn)}),f.removeEventListener("click",_n),B.removeEventListener("click",Bn),document.removeEventListener("keydown",Rn),e.classList.remove("editor-overlay--crop-active"),delete e.dataset.cropSessionActive,o.forEach(T=>T.classList.remove("editor-overlay--hidden-for-crop")),o.length=0,_e(),i.parentNode===e?e.removeChild(i):i.remove()}}},jt=()=>{We||He||st?document.body.classList.add("text-toolbar-visible"):document.body.classList.remove("text-toolbar-visible")},Wt=()=>{L.forEach(({overlay:e,type:t})=>{var a;if(!e)return;const r=((a=e.dataset)==null?void 0:a.previewNode)||"",n=!!We&&r===We&&t==="text",i=!!He&&r===He&&t==="image";e.classList.toggle("editor-overlay--selected",n||i)})},Qe=()=>st?"background":He?"image":We?"text":null,Tr=e=>{if(typeof e!="string")return null;const t=e.match(/rgba?\s*\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i);if(!t)return null;const r=Number(t[1]),n=Number(t[2]),i=Number(t[3]);if([r,n,i].some(o=>Number.isNaN(o)||o<0||o>255))return null;const a=o=>o.toString(16).padStart(2,"0");return`#${a(r)}${a(n)}${a(i)}`.toUpperCase()};function ci(e){var t;try{if(e==="background"){if(!u)return null;const n=window.getComputedStyle(u).backgroundColor||u.style.backgroundColor||"";return Tt(n)||Tr(n)||null}if(e==="text"){const r=Rt();if(!r.length)return null;const n=r[0],i=n.getAttribute("fill")||n.style.fill||n.dataset.color||"";return Tt(i)||Tr(i)||null}if(e==="image"){const r=It();if(!r.length)return null;const i=((t=r[0].dataset)==null?void 0:t.tintColor)||"";return Tt(i)||null}}catch{return null}return null}const Ht=()=>{if(typeof window>"u")return;const e=Qe(),t=e==="text"?We:e==="image"?He:null,r=ci(e);try{const n=new CustomEvent("inkwise:active-element",{detail:{type:e,key:t,color:r}});window.dispatchEvent(n)}catch{if(typeof document<"u"&&document.createEvent){const i=document.createEvent("CustomEvent");i.initCustomEvent("inkwise:active-element",!0,!0,{type:e,key:t,color:r}),window.dispatchEvent(i)}}},wt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;We===t&&!He||(pt(),We=t,t&&(He=null,st=!1),Wt(),jt(),Ht())},xt=e=>{const t=typeof e=="string"&&e.trim()!==""?e.trim():null;He===t&&!We||(He!==t&&pt(),He=t,t&&(We=null,st=!1),Wt(),jt(),Ht())},di=()=>{st||(pt(),st=!0,We=null,He=null,Wt(),jt(),Ht())},Rt=()=>{if(!We)return[];const e=K||l||document;if(!e)return[];const t=`[data-preview-node="${We}"]`,r=new Set;return e.querySelectorAll(t).forEach(n=>{if(!n||D(n))return;const i=(n.tagName||"").toLowerCase();if(i==="tspan"||i==="g"){const a=n.closest("text");if(a){r.add(a);return}}r.add(n)}),Array.from(r)},It=()=>{if(!He)return[];const e=K||l||document;if(!e)return[];const t=`[data-preview-node="${He}"]`;let r=new Set;return e.querySelectorAll(t).forEach(n=>{const i=de(n);i&&r.add(i)}),r.size===0&&e!==document&&document.querySelectorAll(t).forEach(n=>{const i=de(n);i&&r.add(i)}),Array.from(r)},$t=()=>rn(We),Lt=(e,t,r)=>{const n=Number(e);return Number.isFinite(n)?Math.min(Math.max(n,t),r):t},Tt=e=>{if(typeof e!="string")return null;let t=e.trim();return!t||(t.startsWith("#")||(t=`#${t}`),/^#([0-9a-f]{3})$/i.test(t)&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`),!/^#([0-9a-f]{6})$/i.test(t))?null:t.toUpperCase()},cr=e=>{var a,o;if(!e||typeof e.getBBox!="function")return;const t=[],r=Number(((a=e.dataset)==null?void 0:a.rotation)||e.getAttribute("data-rotation")||0);if(Number.isFinite(r)&&r!==0)try{const d=e.getBBox(),c=d.x+d.width/2,y=d.y+d.height/2;t.push(`rotate(${r} ${c} ${y})`)}catch{t.push(`rotate(${r})`)}((o=e.dataset)==null?void 0:o.effectShape)==="curve"&&t.push("skewX(-8) skewY(4)");const i=t.join(" ").trim();i?e.setAttribute("transform",i):e.removeAttribute("transform")},Ye=(e,t={})=>{const r=Rt();if(!r.length)return!1;if(r.forEach(n=>{try{e(n)}catch(i){console.warn("[InkWise Studio] Toolbar mutation failed.",i)}}),t.skipTransformUpdate||r.forEach(n=>{try{cr(n)}catch{}}),t.skipOverlaySync||_e(),t.autosaveReason!==!1){const n=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"text-style";E==null||E.schedule(n)}return!0},ft=(e,t={})=>{const r=It();if(!r.length)return!1;if(r.forEach(n=>{try{e(n)}catch(i){console.warn("[InkWise Studio] Image mutation failed.",i)}}),t.skipTransformUpdate||r.forEach(n=>{try{cr(n)}catch{}}),t.skipOverlaySync||_e(),t.autosaveReason!==!1){const n=typeof t.autosaveReason=="string"&&t.autosaveReason.trim()!==""?t.autosaveReason:"image-style";E==null||E.schedule(n)}return!0},Ft=(e=null)=>{var n;let t=K;if(!t&&e&&(t=e),!t)return null;if(typeof t.tagName=="string"&&t.tagName.toLowerCase()!=="svg"){const i=(n=t.closest)==null?void 0:n.call(t,"svg");i?t=i:e&&e!==t&&(t=e)}if(!t)return null;let r=t.querySelector('defs[data-inkwise-runtime="true"]');return r||(r=document.createElementNS(j,"defs"),r.setAttribute("data-inkwise-runtime","true"),t.insertBefore(r,t.firstChild||null)),r},dr=e=>{const t=e.dataset.previewTarget;if(!t)return;const r=document.querySelector(`[data-preview-node="${t}"]`),n=r?r.dataset.defaultText||r.textContent:"",i=()=>{if(!r)return;const a=e.value.trim();r.textContent=a||n||"",_e()};e.dataset.defaultValue||(e.dataset.defaultValue=n||""),e.addEventListener("focus",()=>{wt(t)}),e.addEventListener("input",()=>{i(),E==null||E.schedule("text-change")}),i()};s.forEach(dr);const ui=(e,t="")=>{const r=normalizeSideKey(Xe),n=er(t),i=document.createElement("div");i.className="text-field-item";const a=document.createElement("span");a.className="text-field-label",a.textContent="Custom",i.appendChild(a);const o=document.createElement("input");o.type="text",o.className="text-field-input",o.placeholder="Add your text",o.dataset.previewTarget=e,o.dataset.templateSide=r,o.value=n,o.dataset.defaultValue=n||"",setStoredTextValue(r,e,n),captureDefaultTextValue(r,e,n),i.appendChild(o);const d=document.createElement("button");if(d.type="button",d.className="text-field-delete",d.setAttribute("aria-label","Delete field"),d.innerHTML='<i class="fa-regular fa-trash-can"></i>',i.appendChild(d),A.appendChild(i),x){const c=document.createElement("div");c.className="pill",c.dataset.previewNode=e,c.dataset.defaultText=t||"CUSTOM TEXT",c.textContent=t||"CUSTOM TEXT",x.appendChild(c)}return dr(o),ur(i),E==null||E.schedule("add-text-field"),o},Ot=()=>{l&&(tr(),K=null,ze=null,l.innerHTML="",l.style.display="none")},pi=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?t.startsWith("data:image/svg+xml")?!0:/\.svg($|\?)/i.test(t):!1},Fr=e=>{if(!e)return;const t=n=>{var a,o,d;let i=(n==null?void 0:n.parentNode)||null;for(;i;){const c=typeof i.getAttribute=="function"?i.getAttribute("fill"):null,y=(a=i.style)==null?void 0:a.fill,N=((o=i.dataset)==null?void 0:o.color)||((d=i.dataset)==null?void 0:d.defaultColor)||null,h=c||y||N;if(h&&h!=="none"&&h!=="transparent")return h;i=i.parentNode||null}return null};e.querySelectorAll("text, tspan").forEach(n=>{var m,I;n.removeAttribute("opacity"),n.style.opacity="1",n.style&&n.style.mixBlendMode&&(n.style.mixBlendMode="normal");const i=n.getAttribute("fill"),a=(m=n.style)==null?void 0:m.fill,o=(I=n.dataset)==null?void 0:I.color;let d=i&&i!=="none"?i:null;if((!d||d==="transparent")&&a&&a!=="none"&&(d=a),(!d||d==="transparent")&&o&&o!=="none"&&(d=o),(!d||d==="transparent")&&typeof window<"u"&&typeof window.getComputedStyle=="function")try{const f=window.getComputedStyle(n).fill;f&&f!=="none"&&f!=="transparent"&&(d=f)}catch{}if(!d||d==="transparent"||d==="none"){const f=t(n);f&&f!=="none"&&f!=="transparent"&&(d=f)}const c=Tt(d||"")||Tr(d||"")||(d&&d!=="none"&&d!=="transparent"?d:null),N=c||"#111111";n.setAttribute("fill",N),n.style&&(n.style.fill=N,n.style.fillOpacity="1",n.style.strokeOpacity="1"),n.dataset&&(n.dataset.color=N,c&&(n.dataset.defaultColor=c)),n.removeAttribute("fill-opacity"),n.removeAttribute("stroke-opacity"),n.getAttribute("stroke")||n.setAttribute("stroke","none"),n.getAttribute("paint-order")||n.setAttribute("paint-order","stroke fill");const h=n.getAttribute("font-family")||n.style.fontFamily;if(h){const f=h.toLowerCase().replace(/[^a-z]/g,"");f.includes("greatvibes")?n.setAttribute("font-family","Great Vibes"):f.includes("poppins")&&n.setAttribute("font-family","Poppins")}})},fi=async e=>{var t,r;if(!l||!e)return Ot(),!1;try{let n="";if(e.startsWith("data:image/svg+xml")){const f=e.indexOf(","),B=f>=0?e.slice(0,f):e,R=f>=0?e.slice(f+1):"";if(/;base64/i.test(B))try{const xe=R.replace(/\s+/g,"");n=typeof window<"u"&&typeof window.atob=="function"?window.atob(xe):atob(xe)}catch(xe){try{n=decodeURIComponent(R)}catch(se){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",xe,se),n=""}}else try{n=decodeURIComponent(R)}catch{n=R}}else{const f=await fetch(e,{cache:"no-store"});if(!f.ok)return console.warn("Failed to fetch SVG:",f.status),Ot(),!1;n=await f.text()}if(!n)return Ot(),!1;l.innerHTML=n,l.style.display="block";const i=document.getElementById("canvas-loading");i&&(i.style.display="none"),l.setAttribute("preserveAspectRatio","xMidYMid meet"),l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.style.width="100%",l.style.height="100%",l.style.maxWidth="100%",l.style.maxHeight="100%";const a=l.querySelector("svg");a?(a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.style.width="100%",a.style.height="100%",a.style.maxWidth="100%",a.style.maxHeight="100%",K=a):K=l,K&&(me(K),Fr(K)),K&&(K.setAttribute("data-svg-editor","true"),K.__inkwiseSvgTemplateEditor||(K.__inkwiseSvgTemplateEditor=new Kt(K)),ze=K.__inkwiseSvgTemplateEditor);const d=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;let c=Or(d==null?void 0:d.getAttribute("width")),y=Or(d==null?void 0:d.getAttribute("height"));if(!Number.isFinite(c)||!Number.isFinite(y)){const f=d==null?void 0:d.getAttribute("viewBox");if(f){const B=f.split(/[\s,]+/).map(Number),R=B[2],ye=B[3];!Number.isNaN(R)&&!Number.isNaN(ye)&&R>0&&ye>0&&(c=R,y=ye)}}let N=Number.isFinite(c)?c:Number.NaN,h=Number.isFinite(y)?y:Number.NaN;if(ve&&Number.isFinite(ve.width)&&Number.isFinite(ve.height)){const f=ve.width/ve.height,B=Number.isFinite(N)&&Number.isFinite(h)?N/h:f,R=Math.abs(B-f)/f,ye=Number.isFinite(N)?Math.abs(N-ve.width)/ve.width:Number.POSITIVE_INFINITY,xe=Number.isFinite(h)?Math.abs(h-ve.height)/ve.height:Number.POSITIVE_INFINITY;(!Number.isFinite(N)||!Number.isFinite(h)||R>.02||ye>.05&&xe>.05)&&(N=ve.width,h=ve.height)}if(Number.isFinite(N)&&Number.isFinite(h)){const f=(ve==null?void 0:ve.unit)??"px";ir(N,h,{unit:f,shape:ve==null?void 0:ve.shape}),ar(rt(N,f),rt(h,f),"in",2)}const m=Gr(l);if(tr(),A){A.innerHTML="";const f=(R,ye="",xe="")=>{const se=document.createElement("div");se.className="text-field-item";const ke=document.createElement("span");ke.className="text-field-label",ke.textContent=xe||R,se.appendChild(ke);const le=document.createElement("input");le.type="text",le.className="text-field-input",le.dataset.previewTarget=R,le.value=ye||"",le.dataset.defaultValue=ye||"",se.appendChild(le);const J=document.createElement("button");return J.type="button",J.className="text-field-delete",J.setAttribute("aria-label","Delete field"),J.innerHTML='<i class="fa-regular fa-trash-can"></i>',se.appendChild(J),A.appendChild(se),dr(le),ur(se),le},B=()=>{[["date","Date"],["heading","Heading"],["accent","Accent"],["subheading","Subheading"],["names","Names"],["location","Location"]].forEach(([ye,xe])=>f(ye,"",xe))};if(m.length>0){let R=!1;const ye=new Set,xe=new Set;m.forEach(se=>{var V,Pe;const ke=se.getAttribute("data-preview-node");if(!ke||ye.has(ke))return;ye.add(ke);const le=D(se);if(Ee(se)){R=!0;const Ke=((V=se.dataset)==null?void 0:V.previewLabel)||ke,Je=((Pe=se.dataset)==null?void 0:Pe.defaultText)||Y(se)||"",nt=(Ke||"").toString().trim().toLowerCase(),ct=(Je||"").toString().trim().toLowerCase(),Me=`${nt}|${ct}`;if(nt&&xe.has(Me))return;nt&&xe.add(Me),f(ke,Je,Ke)}}),R||B()}else B()}const I=(r=(t=oe==null?void 0:oe.orderSummary)==null?void 0:t.metadata)==null?void 0:r.design;return I&&mt(I),m.forEach(f=>{const B=f.getAttribute("data-preview-node");if(!B)return;const R=D(f),ye=Ee(f);R&&f.setAttribute("data-changeable","image"),lt(f)&&ut(f),ye?(f.setAttribute("contenteditable","true"),f.style.cursor="text",f.style.userSelect="text",f.addEventListener("input",()=>{const ke=document.querySelector(`#textFieldList input[data-preview-target="${B}"]`);ke&&(ke.value=Y(f)),f.dataset.currentText=Y(f)||"",_e(),E==null||E.schedule("text-edit")}),f.addEventListener("click",()=>{wt(B),pr(B)})):R&&(f.style.cursor="pointer",f.addEventListener("click",()=>{f.dataset.locked!=="true"&&(xt(B),Ut(f))}));const se=document.querySelector(`#textFieldList input[data-preview-target="${B}"]`);se&&ye&&(se.addEventListener("input",()=>{ae(f,se.value),E==null||E.schedule("text-change")}),se.value&&se.value.trim()!==""?ae(f,se.value):se.value=Y(f)||"")}),requestAnimationFrame(()=>_e()),rr(10),!0}catch(n){return console.warn("Could not load SVG for binding:",n),Ot(),!1}},an=async(e,t)=>{if(!e||!t)return!1;try{let r="";if(t.startsWith("data:image/svg+xml")){const o=t.indexOf(","),d=o>=0?t.slice(0,o):t,c=o>=0?t.slice(o+1):"";if(/;base64/i.test(d))try{const N=c.replace(/\s+/g,"");r=typeof window<"u"&&typeof window.atob=="function"?window.atob(N):atob(N)}catch(N){try{r=decodeURIComponent(c)}catch(h){console.warn("[InkWise Studio] Failed to decode inline SVG data URI.",N,h),r=""}}else try{r=decodeURIComponent(c)}catch{r=c}}else{const o=await fetch(t,{cache:"no-store"});if(!o.ok)return console.warn("Failed to fetch SVG:",o.status),!1;r=await o.text()}if(!r)return!1;e.innerHTML="";const a=new DOMParser().parseFromString(r,"image/svg+xml").documentElement;if(a&&a.tagName.toLowerCase()==="svg"){const o=a.getAttribute("viewBox");for(o&&e.setAttribute("viewBox",o);a.firstChild;)e.appendChild(a.firstChild);return e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.style.width="100%",e.style.height="100%",e.style.maxWidth="100%",e.style.maxHeight="100%",Fr(e),!0}return!1}catch(r){return console.warn("Could not populate SVG element:",r),!1}},gi=async(e={})=>{var se,ke,le,J;const{scale:t=3,filename:r="inkwise-template.png",download:n=!0}=e,i=K||l;if(!i)throw new Error("No active canvas to export.");me(i);const o=new XMLSerializer().serializeToString(i),d=V=>{const Pe=Number(V);return Number.isFinite(Pe)?Pe:null},c=(i.getAttribute("viewBox")||"").split(/[\s,]+/).map(d),y=c.length===4?c[2]:null,N=c.length===4?c[3]:null,h=d((se=u==null?void 0:u.dataset)==null?void 0:se.canvasWidth)||d((ke=G==null?void 0:G.dataset)==null?void 0:ke.canvasWidth)||y||1080,m=d((le=u==null?void 0:u.dataset)==null?void 0:le.canvasHeight)||d((J=G==null?void 0:G.dataset)==null?void 0:J.canvasHeight)||N||1527,I=Math.max(1,Math.round(h*Math.max(1,t))),f=Math.max(1,Math.round(m*Math.max(1,t))),B=new Image;B.crossOrigin="anonymous",B.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(o)}`,await new Promise((V,Pe)=>{B.onload=V,B.onerror=Pe});const R=document.createElement("canvas");R.width=I,R.height=f;const ye=R.getContext("2d");ye.fillStyle="#ffffff",ye.fillRect(0,0,I,f),ye.drawImage(B,0,0,I,f);const xe=R.toDataURL("image/png",1);if(n){const V=document.createElement("a");V.href=xe,V.download=r,V.click()}return{dataUrl:xe,width:I,height:f}};typeof window<"u"&&(window.inkwiseExportCurrentSide=(e={})=>gi(e));const ur=e=>{if(!e)return;const t=e.querySelector(".text-field-delete"),r=e.querySelector("input[data-preview-target]");if(!t||!r||t.disabled||t.getAttribute("aria-disabled")==="true")return;t.replaceWith(t.cloneNode(!0)),e.querySelector(".text-field-delete").addEventListener("click",()=>{const i=r.dataset.previewTarget;if(e.remove(),x){const a=x.querySelector(`[data-preview-node="${i}"]`);a==null||a.remove()}if(K){const a=K.querySelector(`[data-preview-node="${i}"]`);a==null||a.remove()}deleteStoredTextValue(normalizeSideKey(Xe),i),E==null||E.schedule("remove-text-field")})};document.querySelectorAll("#textFieldList .text-field-item").forEach(e=>ur(e));const pr=e=>{if(!e)return;Vr(),Xr("text"),k.forEach(r=>r.classList.remove("active"));const t=document.querySelector('.sidenav-btn[data-nav="text"]');t==null||t.classList.add("active"),setTimeout(()=>{const r=document.querySelector(`#textFieldList input[data-preview-target="${e}"]`);if(r){try{r.scrollIntoView({behavior:"smooth",block:"nearest"})}catch{const a=document.getElementById("textFieldList");a&&(a.scrollTop=r.offsetTop-12)}r.focus({preventScroll:!1});return}const n=document.querySelector("[data-add-text-field]");n==null||n.focus({preventScroll:!1})},60)};Ze=pr;const Mt=async e=>{if(!zn(e)||(Xe=e,!u))return;if(!l&&U&&H){const i=e==="front"?U:H;return i&&(K=i,K.__inkwiseSvgTemplateEditor||(K.__inkwiseSvgTemplateEditor=new Kt(K)),ze=K.__inkwiseSvgTemplateEditor,tr(),Gr(K).forEach(o=>{lt(o)&&ut(o)}),w.forEach(o=>{o.classList.toggle("active",o.dataset.cardView===e)}),p.forEach(o=>{const d=o.dataset.cardThumb===e;o.classList.toggle("active",d),o.setAttribute("aria-pressed",d?"true":"false")})),Promise.resolve()}let t="",r="";e==="front"&&Ct?(t=Ct,r=Ct):e==="back"&&yt?(t=yt,r=yt):(r=u.dataset[`${e}Svg`]||"",t=u.dataset[`${e}Image`]||"");let n=!1;if(r&&pi(r)&&await fi(r)&&(n=!0,u.style.backgroundImage="none",u.style.backgroundSize="",Fr(K)),!n){const i=t||u.dataset[`${e}Image`]||"";window!=null&&window.console&&console.debug("[InkWise Studio] Using raster preview for",e,i||"<empty>"),Ot(),u.style.backgroundImage=i?`url('${i}')`:"",u.style.backgroundSize=i?"cover":"",u.style.backgroundPosition=i?"center center":"",u.style.backgroundRepeat=i?"no-repeat":"",i&&Jn(i),tr(),K=null}w.forEach(i=>{i.classList.toggle("active",i.dataset.cardView===e)}),p.forEach(i=>{const a=i.dataset.cardThumb===e;i.classList.toggle("active",a),i.setAttribute("aria-pressed",a?"true":"false")})};w.forEach(e=>{e.addEventListener("click",()=>{Mt(e.dataset.cardView)})}),p.forEach(e=>{e.addEventListener("click",()=>{Mt(e.dataset.cardThumb)})});try{await Promise.all([X,_])}catch(e){console.warn("[InkWise Studio] One or more grid SVGs failed to populate:",e)}const _r=Mt("front");_r&&typeof _r.then=="function"?_r.catch(()=>{}).then(()=>{rr(6),E==null||E.schedule("initial-load")}):(rr(6),E==null||E.schedule("initial-load"));const sn=document.querySelector(".preview-overlay")||document.querySelector(".preview-canvas-wrapper");sn&&sn.addEventListener("click",e=>{const t=e.target.closest("[data-preview-node]");if(t){e.stopPropagation();const r=t.dataset.previewNode;r&&(D(t)?xt(r):(wt(r),pr(r)))}}),S&&A&&S.addEventListener("click",()=>{console.log("[InkWise Studio] New Text Field button clicked");const e=`custom_${Date.now()}_${z}`;z+=1;const t=document.createElement("div");t.className="text-field-item";const r=document.createElement("span");r.className="text-field-label",r.textContent="Custom",t.appendChild(r);const n=document.createElement("input");n.type="text",n.className="text-field-input",n.placeholder="Add your text",n.dataset.previewTarget=e,t.appendChild(n);const i=document.createElement("button");if(i.type="button",i.className="text-field-delete",i.setAttribute("aria-label","Delete field"),i.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.appendChild(i),A.appendChild(t),x){const o=document.createElement("div");o.className="pill",o.dataset.previewNode=e,o.dataset.defaultText="CUSTOM TEXT",o.textContent="CUSTOM TEXT",x.appendChild(o)}let a=null;console.log("[InkWise Studio] currentSvgRoot:",K),K?(console.log("[InkWise Studio] Creating SVG text element"),a=document.createElementNS("http://www.w3.org/2000/svg","text"),a.setAttribute("id",e),a.setAttribute("data-preview-node",e),a.setAttribute("data-default-text","CUSTOM TEXT"),a.setAttribute("x","50%"),a.setAttribute("y","50%"),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","middle"),a.setAttribute("font-family","Arial, sans-serif"),a.setAttribute("font-size","24"),a.setAttribute("fill","#000000"),a.textContent="CUSTOM TEXT",a.setAttribute("contenteditable","true"),a.style.cursor="text",a.style.userSelect="text",a.addEventListener("input",()=>{n&&(n.value=a.textContent),a.dataset.currentText=a.textContent||"",_e(),E==null||E.schedule("text-edit")}),a.addEventListener("click",()=>{wt(e),pr(e)}),K.appendChild(a),lt(a)&&ut(a),console.log("[InkWise Studio] SVG text element created and appended")):console.log("[InkWise Studio] No currentSvgRoot found, skipping SVG text creation"),dr(n),n.addEventListener("input",()=>{a&&(a.textContent=n.value,a.dataset.currentText=n.value),E==null||E.schedule("text-change")}),wt(e),a&&a.textContent&&a.textContent.trim()!==""?n.value=a.textContent:(n.value="CUSTOM TEXT",a&&(a.textContent="CUSTOM TEXT")),ur(t),setTimeout(()=>{try{A.scrollHeight>A.clientHeight&&A.scrollTo({top:A.scrollHeight,behavior:"smooth"})}catch{A.scrollTop=A.scrollHeight}n.focus({preventScroll:!1})},60)}),Ct=null,yt=null,Xe="front";const Gt=document.getElementById("image-upload"),on=document.getElementById("upload-button"),ln=document.getElementById("quick-upload-button"),fr=document.getElementById("recentUploadsGrid"),gr=document.getElementById("quickRecentUploads"),Br="inkwise_recent_uploads",cn=12,Rr=()=>{try{const e=localStorage.getItem(Br);return e?JSON.parse(e):[]}catch{return[]}},hi=(e,t,r)=>{const n=Rr(),i={id:Date.now(),dataUrl:e,filename:t,side:r,timestamp:new Date().toISOString()},a=n.filter(d=>d.filename!==t);a.unshift(i);const o=a.slice(0,cn);try{localStorage.setItem(Br,JSON.stringify(o))}catch{const c=o.slice(0,Math.floor(cn/2));localStorage.setItem(Br,JSON.stringify(c))}un(),pn()},dn=(e,t,r="front")=>{var n;if(e&&(hi(e,t||`upload-${Date.now()}`,r),!(He&&ft(a=>{a.setAttribute("href",e),a.setAttributeNS("http://www.w3.org/1999/xlink","href",e)},{autosaveReason:"image-upload"})))){if(K){const i=((n=K.tagName)==null?void 0:n.toLowerCase())==="svg"?K:K.closest("svg");if(i){const a=i.getAttribute("viewBox");let o=200,d=200,c=150;if(a){const m=a.split(/[\s,]+/).map(Number);m.length===4&&m.every(Number.isFinite)&&(o=m[0]+m[2]/2,d=m[1]+m[3]/2,c=Math.min(m[2],m[3])*.3)}const y=`uploaded_${Date.now()}`,N=document.createElementNS("http://www.w3.org/2000/svg","image");N.setAttribute("id",y),N.setAttribute("data-preview-node",y),N.setAttribute("href",e),N.setAttributeNS("http://www.w3.org/1999/xlink","href",e),N.setAttribute("x",String(o-c/2)),N.setAttribute("y",String(d-c/2)),N.setAttribute("width",String(c)),N.setAttribute("height",String(c)),N.setAttribute("preserveAspectRatio","xMidYMid meet"),i.appendChild(N),lt(N)&&ut(N),xt(y),E==null||E.schedule("image-upload");return}}r==="front"?Ct=e:r==="back"&&(yt=e),Xe===r&&Mt(r),E==null||E.schedule("image-upload")}},un=()=>{if(!fr)return;const e=Rr();if(e.length===0){fr.innerHTML=`
                <div class="no-recent-uploads">
                    <p>No recent uploads found. Upload some images above to see them here.</p>
                </div>
            `;return}const t=e.map(n=>`
            <div class="recent-upload-item" data-upload-id="${n.id}" data-image-url="${n.dataUrl}" data-side="${n.side}">
                <img src="${n.dataUrl}" alt="${n.filename}" loading="lazy">
                <div class="upload-info">
                    <span>${n.filename}</span>
                </div>
            </div>
        `).join("");fr.innerHTML=t;const r=fr.querySelectorAll(".recent-upload-item");r.forEach(n=>{n.addEventListener("click",()=>{var o;const i=n.dataset.imageUrl;if(r.forEach(d=>d.classList.remove("selected")),n.classList.add("selected"),He&&ft(c=>{c.setAttribute("href",i),c.setAttributeNS("http://www.w3.org/1999/xlink","href",i)},{autosaveReason:"image-select"})){n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150);return}if(K){const d=((o=K.tagName)==null?void 0:o.toLowerCase())==="svg"?K:K.closest("svg");if(d){const c=d.getAttribute("viewBox");let y=200,N=200,h=150;if(c){const B=c.split(/[\s,]+/).map(Number);B.length===4&&B.every(Number.isFinite)&&(y=B[0]+B[2]/2,N=B[1]+B[3]/2,h=Math.min(B[2],B[3])*.3)}const m=`uploaded_${Date.now()}`,I=document.createElementNS("http://www.w3.org/2000/svg","image");I.setAttribute("id",m),I.setAttribute("data-preview-node",m),I.setAttribute("href",i),I.setAttributeNS("http://www.w3.org/1999/xlink","href",i),I.setAttribute("x",String(y-h/2)),I.setAttribute("y",String(N-h/2)),I.setAttribute("width",String(h)),I.setAttribute("height",String(h)),I.setAttribute("preserveAspectRatio","xMidYMid meet"),d.appendChild(I),lt(I)&&ut(I),xt(m),E==null||E.schedule("image-select"),n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150);return}}const a=n.dataset.side;a==="front"?Ct=i:yt=i,Xe===a&&Mt(a),n.style.transform="scale(0.95)",setTimeout(()=>{n.style.transform=""},150),E==null||E.schedule("image-select")})})},pn=()=>{if(!gr)return;const t=Rr().slice(0,5);if(t.length===0){gr.innerHTML="";return}const r=t.map(i=>`
            <div class="quick-recent-upload-item" data-upload-id="${i.id}" data-image-url="${i.dataUrl}" data-side="${i.side}" title="${i.filename}">
                <img src="${i.dataUrl}" alt="${i.filename}" loading="lazy">
            </div>
        `).join("");gr.innerHTML=r;const n=gr.querySelectorAll(".quick-recent-upload-item");n.forEach(i=>{i.addEventListener("click",()=>{var d;const a=i.dataset.imageUrl;if(n.forEach(c=>c.classList.remove("selected")),i.classList.add("selected"),He&&ft(y=>{y.setAttribute("href",a),y.setAttributeNS("http://www.w3.org/1999/xlink","href",a)},{autosaveReason:"image-select"})){i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150);return}if(K){const c=((d=K.tagName)==null?void 0:d.toLowerCase())==="svg"?K:K.closest("svg");if(c){const y=c.getAttribute("viewBox");let N=200,h=200,m=150;if(y){const R=y.split(/[\s,]+/).map(Number);R.length===4&&R.every(Number.isFinite)&&(N=R[0]+R[2]/2,h=R[1]+R[3]/2,m=Math.min(R[2],R[3])*.3)}const I=`uploaded_${Date.now()}`,f=document.createElementNS("http://www.w3.org/2000/svg","image");f.setAttribute("id",I),f.setAttribute("data-preview-node",I),f.setAttribute("href",a),f.setAttributeNS("http://www.w3.org/1999/xlink","href",a),f.setAttribute("x",String(N-m/2)),f.setAttribute("y",String(h-m/2)),f.setAttribute("width",String(m)),f.setAttribute("height",String(m)),f.setAttribute("preserveAspectRatio","xMidYMid meet"),c.appendChild(f),lt(f)&&ut(f),xt(I),E==null||E.schedule("image-select"),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150);return}}const o=i.dataset.side;o==="front"?Ct=a:yt=a,Xe===o&&Mt(o),i.style.transform="scale(0.9)",setTimeout(()=>{i.style.transform=""},150),E==null||E.schedule("image-select")})})},mi=e=>{const t=e.files[0];if(!t)return;const r=new FileReader;r.onload=n=>{const i=n.target.result;dn(i,t.name,"front")},r.readAsDataURL(t)};Gt&&Gt.addEventListener("change",()=>mi(Gt)),on&&on.addEventListener("click",()=>{Gt.click()}),ln&&ln.addEventListener("click",()=>{Gt.click()});const yi=e=>{var r;const t=(r=e.clipboardData)==null?void 0:r.items;if(!(!t||t.length===0))for(const n of t){if(!n||typeof n.type!="string"||!n.type.startsWith("image/"))continue;const i=n.getAsFile();if(!i)continue;const a=new FileReader;a.onload=o=>{const d=o.target.result,c=i.name||`pasted-${Date.now()}.png`;dn(d,c,Xe||"front")},a.readAsDataURL(i),e.preventDefault();break}};un(),pn(),document.addEventListener("paste",yi);const $r=document.querySelectorAll(".pill-with-tooltip"),Mr=document.querySelector(".preview-canvas-wrapper"),Pr=document.querySelector(".preview-guides"),fn=(e,t)=>{e==="safety-pill"&&(Mr==null||Mr.classList.toggle("highlight-safety",t)),e==="bleed-pill"&&(Pr==null||Pr.classList.toggle("highlight-bleed",t))},hr=e=>{const t=e==null?void 0:e.querySelector(".canvas-pill"),r=e==null?void 0:e.querySelector(".tooltip");!t||!r||(e.classList.remove("is-active"),t.setAttribute("aria-expanded","false"),r.setAttribute("aria-hidden","true"),fn(t.id,!1))};$r.forEach(e=>{const t=e.querySelector(".canvas-pill"),r=e.querySelector(".tooltip");!t||!r||(t.addEventListener("click",n=>{n.preventDefault();const i=!e.classList.contains("is-active");$r.forEach(a=>{a!==e&&hr(a)}),i?(e.classList.add("is-active"),t.setAttribute("aria-expanded","true"),r.setAttribute("aria-hidden","false"),fn(t.id,!0)):hr(e)}),t.addEventListener("mouseenter",()=>{r.setAttribute("aria-hidden","false")}),t.addEventListener("focus",()=>{r.setAttribute("aria-hidden","false")}),e.addEventListener("mouseleave",()=>{e.classList.contains("is-active")||r.setAttribute("aria-hidden","true")}),t.addEventListener("blur",()=>{!e.contains(document.activeElement)&&!e.classList.contains("is-active")&&r.setAttribute("aria-hidden","true")}),t.addEventListener("keydown",n=>{n.key==="Escape"&&(hr(e),t.blur())}))}),document.addEventListener("click",e=>{e.target.closest(".pill-with-tooltip")||$r.forEach(r=>hr(r))});const bi=e=>{if(!e)return!1;const t=Ye(r=>{r.setAttribute("font-family",e),r.style.fontFamily=e},{autosaveReason:"text-font",skipTransformUpdate:!0});if(t){const r=$t();r&&(r.dataset.fontFamily=e)}return t},vi=e=>{const t=Lt(e,6,400),r=Ye(n=>{n.setAttribute("font-size",t),n.style.fontSize=`${t}px`},{autosaveReason:"text-size"});if(r){const n=$t();n&&(n.dataset.fontSize=String(t))}return r},wi=e=>{const t=Lt(e,8,400),r=39;return ft(n=>{const i=typeof n.getBBox=="function"?n.getBBox():null,a=parseFloat(n.getAttribute("width")),o=parseFloat(n.getAttribute("height")),d=Number(n.dataset.baseWidth)||(Number.isFinite(a)?a:(i==null?void 0:i.width)||1),c=Number(n.dataset.baseHeight)||(Number.isFinite(o)?o:(i==null?void 0:i.height)||1);n.dataset.baseWidth||(n.dataset.baseWidth=d),n.dataset.baseHeight||(n.dataset.baseHeight=c);const y=t/r,N=Math.max(1,d*y),h=Math.max(1,c*y);n.setAttribute("width",N),n.setAttribute("height",h)},{autosaveReason:"image-scale"})},xi=e=>{const t=Tt(e);if(!t)return!1;const r=Ye(n=>{n.setAttribute("fill",t),n.style.fill=t},{autosaveReason:"text-color",skipTransformUpdate:!0});if(r){const n=$t();n&&(n.dataset.color=t)}return r},Si=e=>{const t=Tt(e);if(!t||!u)return!1;try{return u.style.backgroundColor=t,u.dataset.backgroundColor=t,E==null||E.schedule("background-color"),!0}catch(r){return console.warn("[InkWise Studio] Failed to apply background color",r),!1}},Ai=e=>{if(!e||!u)return!1;try{return u.style.backgroundImage=`url(${e})`,u.style.backgroundSize="cover",u.style.backgroundPosition="center",u.style.backgroundRepeat="no-repeat",u.dataset.backgroundImage=e,E==null||E.schedule("background-image"),!0}catch(t){return console.warn("[InkWise Studio] Failed to apply background image",t),!1}},ki=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)}),Ei=e=>{const t=Tt(e);return t?ft(r=>{if(t==="#FFFFFF"){const m=r.dataset.tintFilterId;if(m){const I=Ft(r.ownerSVGElement||null),f=I==null?void 0:I.querySelector(`#${m}`);f==null||f.remove(),delete r.dataset.tintFilterId}r.removeAttribute("filter");try{delete r.dataset.tintColor}catch{}return}const n=Ft(r.ownerSVGElement||null);if(!n)return;const i=r.dataset.tintFilterId||`inkwiseImageTint_${Date.now()}_${Math.floor(Math.random()*1e3)}`,a=parseInt(t.slice(1,3),16)/255,o=parseInt(t.slice(3,5),16)/255,d=parseInt(t.slice(5,7),16)/255;let c=n.querySelector(`#${i}`);if(!c){c=document.createElementNS(j,"filter"),c.id=i,c.setAttribute("color-interpolation-filters","sRGB");const m=document.createElementNS(j,"feColorMatrix");m.setAttribute("type","matrix"),m.setAttribute("values","0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0.2126 0.7152 0.0722 0 0  0 0 0 1 0"),c.appendChild(m);const I=document.createElementNS(j,"feComponentTransfer"),f=document.createElementNS(j,"feFuncR");f.setAttribute("type","linear"),I.appendChild(f);const B=document.createElementNS(j,"feFuncG");B.setAttribute("type","linear"),I.appendChild(B);const R=document.createElementNS(j,"feFuncB");R.setAttribute("type","linear"),I.appendChild(R);const ye=document.createElementNS(j,"feFuncA");ye.setAttribute("type","identity"),I.appendChild(ye),c.appendChild(I),n.appendChild(c)}const y=c.querySelector("feFuncR"),N=c.querySelector("feFuncG"),h=c.querySelector("feFuncB");y&&y.setAttribute("slope",a.toString()),N&&N.setAttribute("slope",o.toString()),h&&h.setAttribute("slope",d.toString()),r.dataset.tintFilterId=i,r.setAttribute("filter",`url(#${i})`);try{r.dataset.tintColor=t}catch{}},{autosaveReason:"image-color",skipTransformUpdate:!0}):!1},Ci=()=>Ye(e=>{const t=e.getAttribute("font-weight")||e.style.fontWeight||"",r=Number(t);t==="bold"||r>=600?(e.setAttribute("font-weight","400"),e.style.fontWeight="400"):(e.setAttribute("font-weight","700"),e.style.fontWeight="700")},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ni=()=>Ye(e=>{const t=e.getAttribute("font-style")||e.style.fontStyle||"normal";t==="italic"||t==="oblique"?(e.setAttribute("font-style","normal"),e.style.fontStyle="normal"):(e.setAttribute("font-style","italic"),e.style.fontStyle="italic")},{autosaveReason:"text-style",skipTransformUpdate:!0}),gn=e=>Ye(t=>{const n=(t.style.textDecoration||t.getAttribute("text-decoration")||"").split(/\s+/).filter(Boolean),i=new Set(n);i.has(e)?i.delete(e):i.add(e);const a=Array.from(i).join(" ");a?(t.style.textDecoration=a,t.setAttribute("text-decoration",a)):(t.style.textDecoration="",t.removeAttribute("text-decoration"))},{autosaveReason:"text-style",skipTransformUpdate:!0}),Ii=e=>{const t={"align-left":"start","align-center":"middle","align-right":"end","align-justify":"start"},r={"align-left":"left","align-center":"center","align-right":"right","align-justify":"justify"},n=t[e]||"start",i=r[e]||"left",a=Ye(o=>{o.setAttribute("text-anchor",n);const d=o.getAttribute("x");d&&o.querySelectorAll("tspan").forEach(c=>c.setAttribute("x",d)),o.style.textAlign=i},{autosaveReason:"text-align",skipTransformUpdate:!0});if(a){const o=$t();o&&(o.dataset.align=i)}return a},Li=e=>{let t=null;const r=Ye(n=>{const i=n.textContent||"";let a=i;e==="uppercase"?a=i.toUpperCase():e==="lowercase"&&(a=i.toLowerCase()),n.textContent=a,n.dataset.currentText=a,t=a},{autosaveReason:"text-transform",skipTransformUpdate:!0});if(r){const n=$t();n&&t!==null&&(n.value=t)}return r},Ti=()=>{const e=$t();return Ye(t=>{const n=(t.textContent||"").split(/\r?\n/),i=t.dataset.listType==="bullet"||n.every(o=>o.trim().startsWith("â€¢")),a=i?n.map(o=>o.replace(/^\s*â€¢\s*/u,"")).join(`
`):n.map(o=>{const d=o.trim();return d?`â€¢ ${d}`:"â€¢"}).join(`
`);i?delete t.dataset.listType:t.dataset.listType="bullet",t.textContent=a,t.dataset.currentText=a,e&&e.dataset.previewTarget===We&&(e.value=a)},{autosaveReason:"text-list",skipTransformUpdate:!0})},Fi=e=>{const t=Lt(e,.5,5);return Ye(r=>{r.dataset.lineHeight=t,r.style.lineHeight=t},{autosaveReason:"text-spacing",skipTransformUpdate:!0})},_i=e=>{if(e==null)return!1;const t=Number(e);return Number.isFinite(t)?Ye(r=>{if(Math.abs(t)<1e-4)r.style.letterSpacing="",r.removeAttribute("letter-spacing"),delete r.dataset.letterSpacing;else{const n=`${t.toFixed(2)}em`;r.style.letterSpacing=n,r.setAttribute("letter-spacing",n),r.dataset.letterSpacing=t.toFixed(2)}},{autosaveReason:"text-spacing",skipTransformUpdate:!0}):!1},Bi=e=>{const t=typeof e=="string"?e:"none";return Ye(r=>{switch(t){case"shadow":r.dataset.effectStyle="shadow",r.style.filter="drop-shadow(2px 4px 8px rgba(15, 23, 42, 0.35))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;case"highlight":r.dataset.effectStyle="highlight",r.style.filter="none",r.style.paintOrder="stroke fill",r.style.stroke="rgba(253, 224, 71, 0.85)",r.style.strokeWidth=6;break;case"glitch":r.dataset.effectStyle="glitch",r.style.filter="drop-shadow(-2px 0 rgba(236, 72, 153, 0.5)) drop-shadow(2px 0 rgba(56, 189, 248, 0.5))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;case"echo":r.dataset.effectStyle="echo",r.style.filter="drop-shadow(3px 3px rgba(15, 23, 42, 0.4))",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break;default:delete r.dataset.effectStyle,r.style.filter="",r.style.stroke="",r.style.strokeWidth="",r.style.paintOrder="";break}},{autosaveReason:"text-effect",skipTransformUpdate:!0})},Ri=e=>{const t=e==="curve"?"curve":"none";return Ye(r=>{t==="curve"?r.dataset.effectShape="curve":delete r.dataset.effectShape},{autosaveReason:"text-effect",skipTransformUpdate:!1})},$i=e=>{const t=Lt(e,0,100)/100;return Ye(r=>{r.style.opacity=t,r.setAttribute("opacity",t)},{autosaveReason:"text-opacity",skipTransformUpdate:!0})},Mi=e=>{const t=Lt(e,0,100)/100;return ft(r=>{r.style.opacity=t,r.setAttribute("opacity",t)},{autosaveReason:"image-opacity",skipTransformUpdate:!0})},Pi=e=>{const t=Lt(e,-180,180);return Ye(r=>{Math.abs(t)<1e-4?(delete r.dataset.rotation,r.removeAttribute("data-rotation")):(r.dataset.rotation=t,r.setAttribute("data-rotation",t))},{autosaveReason:"text-rotation",skipTransformUpdate:!1})},Di=e=>{const t=Lt(e,-180,180);return ft(r=>{Math.abs(t)<1e-4?(delete r.dataset.rotation,r.removeAttribute("data-rotation")):(r.dataset.rotation=t,r.setAttribute("data-rotation",t))},{autosaveReason:"image-rotation",skipTransformUpdate:!1})},hn=(e="text")=>{const t=e.replace(/[^a-z0-9_-]+/gi,"")||"text";let r=`${t}_${Date.now()}`,n=1;for(;document.querySelector(`[data-preview-node="${r}"]`);)r=`${t}_${Date.now()}_${n}`,n+=1;return r},zi=()=>{const e=Rt();if(e.length===0)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const r=hn(We||"text"),n=t.cloneNode(!0);n.setAttribute("data-preview-node",r),n.dataset.previewNode=r,n.id=r,n.dataset.defaultText=n.dataset.defaultText||n.textContent||"",t.parentNode.appendChild(n),cr(n),lt(n)&&ut(n);const a=ui(r,n.textContent||"");return a&&(a.value=n.textContent||"",setTimeout(()=>{try{a.focus({preventScroll:!1})}catch{}},0)),wt(r),_e(),E==null||E.schedule("duplicate-text-node"),!0},qi=()=>{const e=Rt();if(!e.length)return!1;const t=We;if(e.forEach(r=>{var i;const n=(i=L.get(r))==null?void 0:i.overlay;n&&(n.remove(),te.delete(n)),L.delete(r),r.remove()}),t){const r=rn(t),n=r==null?void 0:r.closest(".text-field-item");n&&n.remove();const i=li(t);i==null||i.remove()}return wt(null),_e(),E==null||E.schedule("remove-text-node"),!0},Ui=()=>{const e=It();if(!e.length)return!1;const t=e[0];if(!t||!t.parentNode)return!1;const r=hn(He||"image"),n=t.cloneNode(!0);n.setAttribute("data-preview-node",r),n.dataset.previewNode=r,n.id=r;const i=parseFloat(t.getAttribute("x"))||0,a=parseFloat(t.getAttribute("y"))||0;return n.setAttribute("x",i+10),n.setAttribute("y",a+10),n.dataset.tintFilterId&&(delete n.dataset.tintFilterId,n.removeAttribute("filter")),t.parentNode.appendChild(n),cr(n),lt(n)&&ut(n),xt(r),_e(),E==null||E.schedule("duplicate-image-node"),!0},ji=()=>{const e=It();return e.length?(e.forEach(t=>{var n;const r=(n=L.get(t))==null?void 0:n.overlay;r&&(r.remove(),te.delete(r)),L.delete(t),t.remove()}),xt(null),_e(),E==null||E.schedule("remove-image-node"),!0):!1},Wi=()=>{const e=Qe();if(e==="text"){const t=Ye(r=>{var o;const i=!(r.dataset.locked==="true");i?r.dataset.locked="true":delete r.dataset.locked;const a=(o=L.get(r))==null?void 0:o.overlay;a&&(a.classList.toggle("editor-overlay--locked",i),a.style.pointerEvents=i?"none":"")},{autosaveReason:"text-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&_e(),t}if(e==="image"){const t=ft(r=>{var o;const i=!(r.dataset.locked==="true");i?r.dataset.locked="true":delete r.dataset.locked;const a=(o=L.get(r))==null?void 0:o.overlay;a&&(a.classList.toggle("editor-overlay--locked",i),a.style.pointerEvents=i?"none":"")},{autosaveReason:"image-lock",skipTransformUpdate:!0,skipOverlaySync:!0});return t&&_e(),t}return!1},Hi=()=>{var r;const e=Rt();if(!e.length)return!1;const t=e[0].textContent||"";if(!t)return!1;if((r=navigator==null?void 0:navigator.clipboard)!=null&&r.writeText)return navigator.clipboard.writeText(t).catch(n=>{console.warn("[InkWise Studio] Clipboard write failed.",n)}),!0;try{const n=document.createElement("textarea");return n.value=t,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),n.remove(),!0}catch(n){return console.warn("[InkWise Studio] Clipboard fallback failed.",n),!1}},Oi=()=>{var n;const e=It();if(!e.length)return!1;const t=e[0],r=t.getAttribute("href")||t.getAttribute("xlink:href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.dataset.src||"";if(!r)return!1;if((n=navigator==null?void 0:navigator.clipboard)!=null&&n.writeText)return navigator.clipboard.writeText(r).catch(i=>{console.warn("[InkWise Studio] Clipboard write failed for image.",i)}),!0;try{const i=document.createElement("textarea");return i.value=r,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),i.remove(),!0}catch(i){return console.warn("[InkWise Studio] Clipboard fallback failed for image.",i),!1}},Gi=()=>{const e=Qe();return e==="text"?Hi():e==="image"?Oi():!1},Vi=()=>{const e=Qe();return e==="text"?zi():e==="image"?Ui():!1},Xi=()=>{const e=Qe();return e==="text"?qi():e==="image"?ji():!1},Yi=e=>{const t=Qe();return t==="text"?ea(e):t==="image"?ta(e):!1},Ki=e=>{const t=Qe();return t==="text"?$i(e):t==="image"?Mi(e):!1},Ji=e=>{const t=Qe();return t==="text"?Pi(e):t==="image"?Di(e):!1},Zi=e=>{const t=Qe();return t==="text"?xi(e):t==="image"?Ei(e):t==="background"?Si(e):!1},Qi=e=>{const t=Qe();return t==="text"?vi(e):t==="image"?wi(e):!1},ea=e=>{const t=Rt();if(!t.length)return!1;const r=t[0],n=r.parentNode;if(!n)return!1;const i=Array.from(n.children),a=i.indexOf(r);if(a===-1)return!1;if(e==="bring-to-front")n.appendChild(r);else if(e==="send-to-back")n.insertBefore(r,i[0]);else if(e==="bring-forward"){const o=Math.min(i.length-1,a+1);if(o!==a){const d=i[o+1]||null;n.insertBefore(r,d)}}else if(e==="send-backward"){const o=Math.max(0,a-1);if(o!==a){const d=i[o];n.insertBefore(r,d)}}else return!1;return _e(),E==null||E.schedule("text-layer"),!0},ta=e=>{const t=It();if(!t.length)return!1;const r=t[0],n=r.parentNode;if(!n)return!1;const i=Array.from(n.children),a=i.indexOf(r);if(a===-1)return!1;if(e==="bring-to-front")n.appendChild(r);else if(e==="send-to-back")n.insertBefore(r,i[0]);else if(e==="bring-forward"){const o=Math.min(i.length-1,a+1);if(o!==a){const d=i[o+1]||null;n.insertBefore(r,d)}}else if(e==="send-backward"){const o=Math.max(0,a-1);if(o!==a){const d=i[o];n.insertBefore(r,d)}}else return!1;return _e(),E==null||E.schedule("image-layer"),!0},ra={setFontFamily:e=>Qe()!=="text"?!1:bi(e),setFontSize:e=>Qi(e),setColor:e=>Zi(e),getActiveKey:()=>We,getSelection:()=>{const e=Qe();return{type:e,key:e==="text"?We:e==="image"?He:null,textKey:We,imageKey:He}},dispatch(e,t){const r=Qe();switch(e){case"bold":r==="text"&&Ci();break;case"italic":r==="text"&&Ni();break;case"underline":r==="text"&&gn("underline");break;case"strikethrough":r==="text"&&gn("line-through");break;case"align-left":case"align-center":case"align-right":case"align-justify":r==="text"&&Ii(e);break;case"list-bullets":r==="text"&&Ti();break;case"line-spacing":r==="text"&&Fi(t);break;case"letter-spacing":r==="text"&&_i(t);break;case"uppercase":case"lowercase":r==="text"&&Li(e);break;case"effect-style":r==="text"&&Bi(t);break;case"effect-shape":r==="text"&&Ri(t);break;case"opacity":Ki(t);break;case"rotation":Ji(t);break;case"layer":Yi(t);break;case"more":t==="duplicate"?Vi():t==="delete"?Xi():t==="lock"?Wi():t==="copy"&&Gi();break;case"replace-image":const n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=i=>{const a=i.target.files[0];if(a){const o=new FileReader;o.onload=d=>{const c=d.target.result;ft(y=>{y.setAttribute("href",c),y.setAttributeNS("http://www.w3.org/1999/xlink","href",c)}),E==null||E.schedule("image-replace")},o.readAsDataURL(a)}},n.click();break;case"crop":{const i=It();if(!i.length)break;const a=L.get(i[0]),o=a==null?void 0:a.overlay;if(!o)break;if(nn(),(ot==null?void 0:ot.overlay)===o)ot.refresh();else{pt();const d=Lr(o,i[0]);d&&(ot=d)}break}default:console.debug("[InkWise Studio] Unhandled toolbar action",e,t);break}}};typeof window<"u"&&(window.inkwiseToolbar=ra);const Pt=document.getElementById("canvas-zoom-select"),mn=document.getElementById("canvas-zoom-display"),na=document.querySelectorAll("[data-zoom-step]"),yn=document.querySelector(".preview-canvas-wrapper"),mr=C,St=[.25,.5,.75,1,1.5,2,3];if(Pt&&yn&&mr){const e=r=>{mr.style.setProperty("--canvas-scale",r.toString()),yn.style.removeProperty("transform"),Pt.value=r.toString(),mn&&(mn.textContent=`${Math.round(r*100)}%`),_e()},t=r=>{const n=parseFloat(Pt.value)||1,i=St.indexOf(n);if(i===-1)return;let a=i;r==="up"&&i<St.length-1&&(a=i+1),r==="down"&&i>0&&(a=i-1),a!==i&&e(St[a])};Pt.addEventListener("change",r=>{const n=parseFloat(r.target.value)||1;e(n)}),na.forEach(r=>{r.addEventListener("click",()=>{const n=r.dataset.zoomStep;n&&t(n==="up"?"up":"down")})}),mr&&mr.addEventListener("wheel",r=>{r.preventDefault();const n=parseFloat(Pt.value)||1;let i=n;if(r.deltaY>0){const a=St.indexOf(n);a>0&&(i=St[a-1])}else{const a=St.indexOf(n);a<St.length-1&&(i=St[a+1])}i!==n&&e(i)},{passive:!1}),e(parseFloat(Pt.value)||1)}document.addEventListener("focusin",e=>{e.target.matches("#textFieldList input")&&document.body.classList.add("text-toolbar-visible")}),document.addEventListener("focusout",e=>{e.target.matches("#textFieldList input")&&setTimeout(()=>{const t=document.activeElement,r=t&&typeof t.matches=="function"&&t.matches("#textFieldList input"),n=t&&typeof t.closest=="function"&&t.closest(".studio-react-widgets");!r&&!n&&(We||He||st?jt():document.body.classList.remove("text-toolbar-visible"))},100)})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie,{once:!0}):ie()}function xa({bootstrap:ie={}}){const s=Ie.useRef(null),u=Ie.useRef(null),l=Ie.useRef(null),p=Ie.useRef(null),[w,x]=Ie.useState({front:"idle",back:"idle"}),[A,S]=Ie.useState({front:{width:null,height:null,unit:"px"},back:{width:null,height:null,unit:"px"}}),k=(C,j)=>{if(!C)return"";const ce=parseFloat(C);return Number.isFinite(ce)?j==="px"||j==="PX"||j==="Px"?`${(ce/96).toFixed(2)} in`:j==="in"||j==="IN"||j==="In"?`${ce} in`:`${C}${j||""}`:`${C}${j||""}`};return Ie.useEffect(()=>{var De,Ue;try{const v=typeof document<"u"?((De=document.getElementById("template-editor-root"))==null?void 0:De.dataset)||{}:{},$=v.frontCanvasWidth||v.frontCanvaswidth||null,Z=v.frontCanvasHeight||v.frontCanvasheight||null,D=v.frontCanvasUnit||v.frontCanvasunit||"px",Ee=v.backCanvasWidth||v.backCanvaswidth||null,Y=v.backCanvasHeight||v.backCanvasheight||null,ae=v.backCanvasUnit||v.backCanvasunit||"px";S({front:{width:$,height:Z,unit:D},back:{width:Ee,height:Y,unit:ae}});var C=v.hasBack==="true"||v.hasBack===!0||v.hasback==="true"}catch{}const j=(v,$)=>{if(!v)return null;const Z=parseFloat(v);return Number.isFinite(Z)?$.toLowerCase()==="px"?Z:$.toLowerCase()==="in"?Math.round(Z*96):Z:null},ce=typeof window<"u"?window.SvgTemplateEditor:null;if(!ce){console.warn("[TemplateEditor] SvgTemplateEditor not found on window");return}let pe=!0;async function G(v,$,Z){var ae,de;if(!v||!pe)return;const D=ie.template||{};let Ee=$==="front"?D.svg_path||D.front_svg_path||D.front_svg:D.back_svg_path||D.back_svg;if(!Ee){const ne=$==="front"?"data-front-svg":"data-back-svg";Ee=v.getAttribute(ne)}if(Ee&&v.innerHTML.trim()==="")try{const ne=await fetch(Ee,{credentials:"same-origin"});if(ne.ok){const me=await ne.text();v.innerHTML=me}}catch(ne){console.warn("[TemplateEditor] failed to fetch svg:",ne)}const Y=v.tagName&&v.tagName.toLowerCase()==="svg"?v:v.querySelector("svg");if(Y){try{const ne=typeof document<"u"?((ae=document.getElementById("template-editor-root"))==null?void 0:ae.dataset)||{}:{},me=$==="front"?ne.frontCanvasWidth:ne.backCanvasWidth,oe=$==="front"?ne.frontCanvasHeight:ne.backCanvasHeight,ue=$==="front"?ne.frontCanvasUnit||"px":ne.backCanvasUnit||"px",Se=j(me,ue),Fe=j(oe,ue);if(Se&&Fe){try{v.style.width=`${Se}px`,v.style.height=`${Fe}px`,v.style.maxWidth="none"}catch{}try{Y.setAttribute("width",`${Se}`),Y.setAttribute("height",`${Fe}`),Y.style.width=`${Se}px`,Y.style.height=`${Fe}px`}catch{}}}catch{}try{const ne=typeof document<"u"?((de=document.getElementById("template-editor-root"))==null?void 0:de.dataset)||{}:{},me=$==="front"?ne.frontCanvasWidth:ne.backCanvasWidth,oe=$==="front"?ne.frontCanvasHeight:ne.backCanvasHeight;me&&oe&&!Y.getAttribute("viewBox")&&Y.setAttribute("viewBox",`0 0 ${me} ${oe}`)}catch{}try{Z.current=new ce(Y,{onImageChange:()=>{x(oe=>({...oe,[$]:"dirty"})),typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:$}}))},onTextChange:()=>{x(oe=>({...oe,[$]:"dirty"})),typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:$}}))}});try{const oe=Z.current;Array.from(Y.querySelectorAll("text")).forEach(Se=>{try{const Fe=typeof oe.createBoundingBox=="function"?oe.createBoundingBox(Se):null,ge=Fe||Se;if(Fe&&(Se._boundingBox=Fe,Fe._targetElement=Se,Fe.querySelectorAll(".resize-handle").forEach(je=>oe.makeResizable(Se,je))),ge&&typeof oe.makeDraggable=="function"){oe.makeDraggable(ge);try{if(ge.style){ge.style.cursor="move",ge.style.touchAction="none";try{ge.style.pointerEvents="all"}catch{}}if(ge.setAttribute){ge.setAttribute("data-inkwise-draggable","true");try{ge.setAttribute("pointer-events","all")}catch{}}if(ge.classList)try{ge.classList.add("inkwise-draggable")}catch{}}catch{}}}catch{}})}catch{}const ne=$==="front"?"frontTextFieldList":"backTextFieldList",me=document.getElementById(ne);me&&(me.innerHTML="",Array.from(Y.querySelectorAll("text")).forEach((ue,Se)=>{const Fe=document.createElement("li");Fe.className="text-field-item";const ge=document.createElement("label");ge.textContent=`${$==="front"?"Front":"Back"} Text ${Se+1}`;const qe=document.createElement("input");qe.type="text",qe.value=ue.textContent||"",qe.addEventListener("input",je=>{ue.textContent=je.target.value,Z.current&&typeof Z.current.options.onTextChange=="function"&&Z.current.options.onTextChange()}),qe.addEventListener("focus",()=>{if(typeof window<"u"){const je=new CustomEvent("inkwise:active-element",{detail:{type:"text"}});window.dispatchEvent(je)}}),qe.addEventListener("blur",()=>{if(typeof window<"u"){const je=new CustomEvent("inkwise:active-element",{detail:{type:null}});window.dispatchEvent(je)}}),Fe.appendChild(ge),Fe.appendChild(qe),me.appendChild(Fe)}))}catch(ne){console.error("[TemplateEditor] failed to create SvgTemplateEditor",ne)}}}G(s.current,"front",l),(typeof C<"u"?C:((Ue=ie.template)==null?void 0:Ue.has_back)??!1)&&G(u.current,"back",p);const z=v=>v?!!(v.nodeName&&v.nodeName.toLowerCase()==="text"||v.classList&&v.classList.contains("canvas-layer__text")||v.closest&&v.closest(".canvas-layer__text, [data-inkwise-text]")):!1,U=v=>v?!!(v.nodeName&&(v.nodeName.toLowerCase()==="image"||v.nodeName.toLowerCase()==="img")||v.classList&&(v.classList.contains("canvas-layer__image")||v.classList.contains("svg-changeable-image")||v.classList.contains("changeable-image"))||v.closest&&v.closest(".canvas-layer__image, .svg-changeable-image, .changeable-image")):!1,H=v=>{const $=/translate\(([-0-9.]+)[ ,]([-0-9.]+)\)/.exec(v||"");return $?{x:parseFloat($[1]),y:parseFloat($[2])}:{x:0,y:0}},X=(v,$,Z)=>{try{const Ee=(v.getAttribute("transform")||"").replace(/translate\([^)]*\)/,"").trim(),ae=(`translate(${$} ${Z})`+" "+Ee).trim();v.setAttribute("transform",ae)}catch{try{v.style.transform=`translate(${$}px, ${Z}px)`}catch{}}},_=v=>{if(!v)return null;let $=null;const Z=Y=>{if(!$)return;Y.preventDefault();const ae=Y.clientX-$.startX,de=Y.clientY-$.startY,ne=$.startTx+ae,me=$.startTy+de;$.moved=$.moved||Math.abs(ae)>2||Math.abs(de)>2,X($.targetEl,ne,me)},D=Y=>{if($){try{if(!$.moved&&U($.targetEl)){const ae={node:$.targetEl,side:v===s.current?"front":"back"},de=new CustomEvent("inkwise-image-clicked",{detail:ae});window.dispatchEvent(de)}}catch{}window.removeEventListener("pointermove",Z),window.removeEventListener("pointerup",D),$=null}},Ee=Y=>{const ae=Y.target&&Y.target.closest&&Y.target.closest("g, text, image, img, [data-canvas-layer]")||Y.target;if(ae&&(z(ae)||U(ae))){Y.preventDefault();const de=ae.getAttribute&&ae.getAttribute("transform")||"",ne=H(de);if($={pointerId:Y.pointerId,startX:Y.clientX,startY:Y.clientY,startTx:ne.x,startTy:ne.y,targetEl:ae,moved:!1},z(ae)){const me={node:ae,side:v===s.current?"front":"back"},oe=new CustomEvent("inkwise-text-selected",{detail:me});window.dispatchEvent(oe)}window.addEventListener("pointermove",Z,{passive:!1}),window.addEventListener("pointerup",D,{passive:!1})}};return v.addEventListener("pointerdown",Ee),()=>{v.removeEventListener("pointerdown",Ee),window.removeEventListener("pointermove",Z),window.removeEventListener("pointerup",D)}},P=_(s.current),re=_(u.current);return()=>{pe=!1,[l.current,p.current].forEach(v=>{if(v)try{typeof v.destroy=="function"&&v.destroy()}catch{}}),P&&P(),re&&re()}},[ie]),Ie.useEffect(()=>{try{Array.from(document.querySelectorAll('#template-editor-root svg, [data-svg-editor="true"]')).forEach(ce=>applySizingToSvg(ce))}catch{}},[A]),Ie.useEffect(()=>{const C=()=>{var ce,pe,G,z;try{const U=s.current,H=u.current,X=(ce=U==null?void 0:U.parentElement)==null?void 0:ce.querySelector(".ruler-vertical"),_=(pe=H==null?void 0:H.parentElement)==null?void 0:pe.querySelector(".ruler-vertical");X&&U&&(X.style.height=`${U.clientHeight}px`),_&&H&&(_.style.height=`${H.clientHeight}px`);const P=(G=U==null?void 0:U.parentElement)==null?void 0:G.querySelector(".ruler-horizontal"),re=(z=H==null?void 0:H.parentElement)==null?void 0:z.querySelector(".ruler-horizontal");P&&U&&(P.style.width=`${U.clientWidth}px`),re&&H&&(re.style.width=`${H.clientWidth}px`)}catch{}};C(),window.addEventListener("resize",C);const j=new ResizeObserver(C);return s.current&&j.observe(s.current),u.current&&j.observe(u.current),()=>{window.removeEventListener("resize",C);try{j.disconnect()}catch{}}},[]),Ie.useEffect(()=>{const C="inkwise_recent_uploads",ce=document.getElementById("upload-button"),pe=document.getElementById("image-upload"),G=document.getElementById("recentUploadsGrid"),z=document.getElementById("uploadsDropZone"),U=document.getElementById("upload-side-select"),H=F=>{try{const q=document.getElementById("upload-side-front"),Q=document.getElementById("upload-side-back");if(q&&Q)return Q.getAttribute("aria-pressed")==="true"?"back":"front";if(U)return U.value==="back"?"back":"front"}catch{}return"front"},X=F=>{try{const q=document.getElementById("upload-side-front"),Q=document.getElementById("upload-side-back");q&&Q&&(q.classList.toggle("active",F==="front"),Q.classList.toggle("active",F==="back"),q.setAttribute("aria-pressed",F==="front"?"true":"false"),Q.setAttribute("aria-pressed",F==="back"?"true":"false")),U&&(U.value=F==="back"?"back":"front");try{const ee=s.current&&s.current.closest(".template-canvas-column"),L=u.current&&u.current.closest(".template-canvas-column");ee&&ee.classList.toggle("upload-selected",F==="front"),L&&L.classList.toggle("upload-selected",F==="back")}catch{}}catch{}};let _=null,P=null,re=null,De=null,Ue=null,v=null,$=null;try{_=document.getElementById("upload-side-front"),P=document.getElementById("upload-side-back"),re=Q=>{const ee=Q&&Q.currentTarget&&Q.currentTarget.dataset&&Q.currentTarget.dataset.side?Q.currentTarget.dataset.side:Q.currentTarget&&Q.currentTarget.id==="upload-side-back"?"back":"front";X(ee)},_&&_.addEventListener("click",re),P&&P.addEventListener("click",re);const F=s.current&&s.current.closest(".template-canvas-column"),q=u.current&&u.current.closest(".template-canvas-column");De=F&&F.querySelector(".canvas-header"),Ue=q&&q.querySelector(".canvas-header"),v=()=>X("front"),$=()=>X("back"),De&&De.addEventListener("click",v),Ue&&Ue.addEventListener("click",$),X(H())}catch{}const Z=()=>{try{const F=localStorage.getItem(C);return F?JSON.parse(F):[]}catch{return[]}},D=(F,q,Q="front")=>{const ee=Z(),L={id:Date.now(),dataUrl:F,filename:q,side:Q,timestamp:new Date().toISOString()},te=ee.filter(Ae=>Ae.filename!==q||Ae.dataUrl!==F);te.unshift(L);const he=te.slice(0,12);try{localStorage.setItem(C,JSON.stringify(he))}catch{try{localStorage.setItem(C,JSON.stringify(he.slice(0,Math.floor(12/2))))}catch{}}je()},Ee=F=>{try{const q=Z().filter(Q=>String(Q.id)!==String(F));localStorage.setItem(C,JSON.stringify(q)),je()}catch{}},Y=F=>{const q=F==="back"?u.current:s.current;return q?q.tagName&&q.tagName.toLowerCase()==="svg"?q:q.querySelector("svg"):null},ae=(F,q,Q)=>{try{if(!F)return null;const ee=F.createSVGPoint();ee.x=q,ee.y=Q;const L=F.getScreenCTM&&F.getScreenCTM();if(L&&typeof L.inverse=="function"){const Ze=L.inverse(),Xe=ee.matrixTransform(Ze);return{x:Xe.x,y:Xe.y}}const te=F.getBoundingClientRect(),he=parseFloat(F.getAttribute("width"))||te.width,Ae=parseFloat(F.getAttribute("height"))||te.height,K=(q-te.left)*(he/te.width),ze=(Q-te.top)*(Ae/te.height);return{x:K,y:ze}}catch{return null}},de=(F,q,Q="front",ee=null)=>{if(!F)return null;let L=F.querySelector("image");if(!L){const he=F.getAttribute("viewBox");let Ae=150;if(he){const ze=he.split(/[ ,\s]+/).map(Number);ze.length===4&&ze.every(Number.isFinite)&&(ze[0]+ze[2]/2,ze[1]+ze[3]/2,Ae=Math.min(ze[2],ze[3])*.3)}else{const ze=parseFloat(F.getAttribute("width"))||F.clientWidth||400,Ze=parseFloat(F.getAttribute("height"))||F.clientHeight||400;Ae=Math.min(ze,Ze)*.3}const K=`uploaded_${Date.now()}`;L=document.createElementNS("http://www.w3.org/2000/svg","image"),L.setAttribute("id",K),L.setAttribute("data-preview-node",K),L.setAttribute("width",String(Ae)),L.setAttribute("height",String(Ae)),L.setAttribute("preserveAspectRatio","xMidYMid meet"),F.appendChild(L)}if(L.setAttribute("href",q),L.setAttributeNS("http://www.w3.org/1999/xlink","href",q),ee&&typeof ee.x=="number"&&typeof ee.y=="number"){const he=parseFloat(L.getAttribute("width"))||150,Ae=ee.x-he/2,K=ee.y-he/2;L.setAttribute("x",String(Ae)),L.setAttribute("y",String(K))}const te=Q==="back"?p.current:l.current;try{if(te&&typeof te.createBoundingBox=="function"){L._boundingBox&&L._boundingBox.parentNode&&L._boundingBox.parentNode.removeChild(L._boundingBox);const he=te.createBoundingBox(L);if(he){L._boundingBox=he,he._targetElement=L,he.querySelectorAll(".resize-handle").forEach(K=>{try{te.makeResizable(L,K)}catch{}});try{te.makeDraggable(he)}catch{try{te.makeDraggable(L)}catch{}}}else try{te.makeDraggable(L)}catch{}}}catch{}try{typeof window<"u"&&window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:Q}})),x(Q==="back"?he=>({...he,back:"dirty"}):he=>({...he,front:"dirty"}))}catch{}return L},ne=(F,q,Q="front",ee=null)=>{if(!F)return null;D(F,q||`upload-${Date.now()}`,Q);const L=Y(Q);let te=null;if(L)te=de(L,F,Q,ee);else{const he=Y("front");he&&(te=de(he,F,"front",ee))}try{te&&te.id&&qe(Q,q,te.id)}catch{}return te},me=(F,q=H(),Q=null)=>{if(!F)return;if(!F.type||!F.type.startsWith("image/")){alert("Only image files are supported.");return}const ee=new FileReader;ee.onload=L=>{var he;const te=(he=L==null?void 0:L.target)==null?void 0:he.result;te&&ne(te,F.name,q,Q)},ee.readAsDataURL(F)},oe=(F,q=H(),Q=null)=>{if(!F)return;Array.from(F).forEach((L,te)=>me(L,q,te===0?Q:null))};let ue=null;const Se=()=>ue||(ue=document.createElement("div"),ue.id="upload-preview",ue.setAttribute("aria-hidden","true"),ue.style.position="fixed",ue.style.pointerEvents="none",ue.style.zIndex="5000",ue.style.display="none",ue.style.transition="opacity 120ms ease",ue.style.opacity="0",ue.innerHTML='<img alt="Preview" style="display:block;max-width:320px;max-height:320px;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.25)" />',document.body.appendChild(ue),ue),Fe=(F,q,Q)=>{try{const ee=Se(),L=ee.querySelector("img");L.src=F,ee.style.display="block";const te=Math.min(window.innerWidth-340,q+12),he=Math.min(window.innerHeight-340,Q+12);ee.style.left=`${te}px`,ee.style.top=`${he}px`,requestAnimationFrame(()=>{ee.style.opacity="1"})}catch{}},ge=()=>{try{if(!ue)return;ue.style.opacity="0",setTimeout(()=>{ue&&(ue.style.display="none")},150)}catch{}},qe=(F,q,Q)=>{try{const ee=`upload-confirm-${Date.now()}`,L=document.createElement("div");L.className="upload-confirmation",L.id=ee,L.style.position="fixed",L.style.right="16px",L.style.bottom="16px",L.style.background="#111827",L.style.color="#fff",L.style.padding="10px 12px",L.style.borderRadius="8px",L.style.boxShadow="0 8px 30px rgba(2,6,23,0.4)",L.style.zIndex="6000",L.style.display="flex",L.style.alignItems="center",L.style.gap="10px";const te=document.createElement("span");if(te.textContent=`Inserted image to ${F==="back"?"Back":"Front"}`+(q?` â€” ${q}`:""),te.style.fontSize="13px",L.appendChild(te),Q){const he=document.createElement("button");he.textContent="Undo",he.style.background="transparent",he.style.border="1px solid rgba(255,255,255,0.12)",he.style.color="#fff",he.style.padding="6px 8px",he.style.borderRadius="6px",he.style.cursor="pointer",he.addEventListener("click",()=>{try{const Ae=document.getElementById(Q);Ae&&Ae.parentNode&&Ae.parentNode.removeChild(Ae)}catch{}try{L&&L.parentNode&&L.parentNode.removeChild(L)}catch{}}),L.appendChild(he)}document.body.appendChild(L),setTimeout(()=>{try{L&&L.parentNode&&L.parentNode.removeChild(L)}catch{}},4e3)}catch{}},je=()=>{if(!G)return;const F=Z();if(!F||F.length===0){G.innerHTML=`
          <div class="no-recent-uploads">
            <p>No recent uploads found. Upload some images above to see them here.</p>
          </div>
        `;return}G.innerHTML="",F.forEach(q=>{const Q=document.createElement("div");Q.className="recent-upload-item",Q.dataset.uploadId=q.id,Q.dataset.imageUrl=q.dataUrl,Q.dataset.side=q.side||"front";const ee=document.createElement("img");ee.src=q.dataUrl,ee.alt=q.filename||"",ee.loading="lazy",ee.style.width="64px",ee.style.height="64px",ee.style.objectFit="cover",ee.style.cursor="pointer",ee.title="Insert image to canvas",ee.setAttribute("tabindex","0"),ee.setAttribute("aria-label","Insert image to canvas"),ee.addEventListener("click",()=>{ne(q.dataUrl,q.filename,q.side||"front")}),ee.addEventListener("keydown",te=>{(te.key==="Enter"||te.key===" ")&&(te.preventDefault(),ne(q.dataUrl,q.filename,q.side||"front"))}),ee.addEventListener("mouseenter",te=>{try{Fe(q.dataUrl,te.clientX,te.clientY)}catch{}}),ee.addEventListener("mousemove",te=>{try{Fe(q.dataUrl,te.clientX,te.clientY)}catch{}}),ee.addEventListener("mouseleave",()=>{ge()});const L=document.createElement("button");L.className="recent-upload-remove",L.title="Remove upload",L.textContent="âœ•",L.style.marginLeft="6px",L.addEventListener("click",()=>{Ee(q.id)}),Q.appendChild(ee),Q.appendChild(L),G.appendChild(Q)})},Ve=()=>{pe&&pe.click()},et=F=>{const q=F.target&&F.target.files?F.target.files:null;q&&q.length&&(oe(q,H()),F.target.value="")},mt="uploads-dropzone--active",kt=F=>{F.preventDefault(),F.stopPropagation();try{z&&z.classList.remove(mt)}catch{}const q=F.dataTransfer&&F.dataTransfer.files?F.dataTransfer.files:null;if(q&&q.length){oe(q,H());return}try{const Q=F.dataTransfer&&(F.dataTransfer.getData("text/uri-list")||F.dataTransfer.getData("text/plain"));Q&&fetch(Q).then(ee=>ee.blob()).then(ee=>{const L=new File([ee],Q.split("/").pop()||"remote-image",{type:ee.type});me(L,H())}).catch(()=>{})}catch{}},Et=F=>{F.preventDefault(),F.stopPropagation();try{z&&z.classList.add(mt)}catch{}},_t=F=>{try{z&&z.classList.remove(mt)}catch{}};z&&(z.addEventListener("dragover",Et),z.addEventListener("dragenter",Et),z.addEventListener("dragleave",_t),z.addEventListener("drop",kt));const rt=(F,q)=>{const Q=te=>{te.preventDefault(),te.dataTransfer.dropEffect="copy",F.style.outline="2px dashed #2563eb"},ee=te=>{try{F.style.outline=""}catch{}},L=te=>{te.preventDefault();try{F.style.outline=""}catch{}const he=te.dataTransfer&&te.dataTransfer.files?te.dataTransfer.files:null,Ae=Y(q);let K=null;if(Ae&&(K=ae(Ae,te.clientX,te.clientY)),he&&he.length){oe(he,q,K);return}try{const ze=te.dataTransfer&&(te.dataTransfer.getData("text/uri-list")||te.dataTransfer.getData("text/plain"));ze&&Ae&&fetch(ze).then(Ze=>Ze.blob()).then(Ze=>{const Xe=new File([Ze],ze.split("/").pop()||"remote-image",{type:Ze.type});me(Xe,q,K)}).catch(()=>{})}catch{}};return F.addEventListener("dragover",Q),F.addEventListener("dragleave",ee),F.addEventListener("drop",L),()=>{F.removeEventListener("dragover",Q),F.removeEventListener("dragleave",ee),F.removeEventListener("drop",L)}},Jt=s.current,xr=u.current,ve=Jt?rt(Jt,"front"):null,Zt=xr?rt(xr,"back"):null;return ce&&ce.addEventListener("click",Ve),pe&&pe.addEventListener("change",et),je(),()=>{ce&&ce.removeEventListener("click",Ve),pe&&pe.removeEventListener("change",et),z&&(z.removeEventListener("dragover",Et),z.removeEventListener("dragenter",Et),z.removeEventListener("dragleave",_t),z.removeEventListener("drop",kt)),ve&&ve(),Zt&&Zt();try{const F=document.getElementById("upload-side-front"),q=document.getElementById("upload-side-back");F&&typeof re=="function"&&F.removeEventListener("click",re),q&&typeof re=="function"&&q.removeEventListener("click",re),De&&typeof v=="function"&&De.removeEventListener("click",v),Ue&&typeof $=="function"&&Ue.removeEventListener("click",$)}catch{}try{ue&&ue.parentNode&&ue.parentNode.removeChild(ue),ue=null}catch{}}},[]),b.jsxs("div",{className:"template-editor two-column",children:[b.jsxs("div",{className:"template-canvas-column",children:[b.jsx("div",{className:"canvas-header",children:"Front Canvas"}),b.jsxs("div",{className:"canvas-with-ruler",children:[b.jsxs("div",{className:"ruler-vertical","aria-hidden":"true",children:[b.jsx("div",{className:"ruler-line"}),b.jsx("div",{className:"ruler-label",children:A.front.height?k(A.front.height,A.front.unit):""})]}),b.jsx("div",{className:"guide-vertical","aria-hidden":"true"}),b.jsxs("div",{className:"canvas-body",children:[b.jsx("div",{className:"canvas-stage",id:"template-editor-container-front",ref:s}),b.jsxs("div",{className:"ruler-horizontal","aria-hidden":"true",children:[b.jsx("div",{className:"ruler-line-horizontal"}),b.jsx("div",{className:"ruler-label-horizontal",children:k(A.front.width,A.front.unit)})]})]})]})]}),b.jsxs("div",{className:"template-canvas-column",children:[b.jsx("div",{className:"canvas-header",children:"Back Canvas"}),b.jsxs("div",{className:"canvas-with-ruler",children:[b.jsxs("div",{className:"ruler-vertical","aria-hidden":"true",children:[b.jsx("div",{className:"ruler-line"}),b.jsx("div",{className:"ruler-label",children:A.back.height?k(A.back.height,A.back.unit):""})]}),b.jsx("div",{className:"guide-vertical","aria-hidden":"true"}),b.jsxs("div",{className:"canvas-body",children:[b.jsx("div",{className:"canvas-stage",id:"template-editor-container-back",ref:u}),b.jsxs("div",{className:"ruler-horizontal","aria-hidden":"true",children:[b.jsx("div",{className:"ruler-line-horizontal"}),b.jsx("div",{className:"ruler-label-horizontal",children:k(A.back.width,A.back.unit)})]})]})]})]})]})}const Sa=[{label:"Warm Neutrals",colors:[{name:"Ivory Cream",hex:"#FFF6E5"},{name:"Champagne Beige",hex:"#F3E9DC"},{name:"Blush Pink",hex:"#F6C1CC"},{name:"Dusty Rose",hex:"#D8A7B1"},{name:"Light Lavender",hex:"#E8DFF5"},{name:"Pearl Gray",hex:"#F2F2F2"}]},{label:"Roses & Warm Accents",colors:[{name:"Burgundy Wine",hex:"#7A1F2B"},{name:"Mauve Plum",hex:"#8E5A7C"},{name:"Rose Gold",hex:"#E6B7A9"},{name:"Soft Peach",hex:"#FFD6C9"},{name:"Warm Taupe",hex:"#C4B6A6"}]},{label:"Greens & Blues",colors:[{name:"Sage Green",hex:"#A8C3A0"},{name:"Olive Mist",hex:"#C7D3BF"},{name:"Mint Cream",hex:"#E6F4EA"},{name:"Sky Blue",hex:"#DDEEFF"},{name:"Soft Teal",hex:"#B7DED9"},{name:"Navy Blue",hex:"#1F2A44"},{name:"Emerald Green",hex:"#1F7A5B"},{name:"Royal Purple",hex:"#4B2E83"},{name:"Charcoal",hex:"#2E2E2E"},{name:"Midnight Blue",hex:"#0F172A"}]},{label:"Extra Pastels",colors:[{name:"White",hex:"#FFFFFF"},{name:"Cream",hex:"#FFF3D6"},{name:"Light Pink",hex:"#FADADD"},{name:"Baby Blue",hex:"#E6F0FF"},{name:"Mint Green",hex:"#E9F7EF"},{name:"Lavender",hex:"#EFE6FF"},{name:"Soft Yellow",hex:"#FFF9C4"},{name:"Light Gray",hex:"#F2F2F2"},{name:"Peach",hex:"#FFE0CC"},{name:"Sky Blue",hex:"#DFF2FF"}]},{label:"Basic Colors",colors:[{name:"Red",hex:"#FF0000"},{name:"Blue",hex:"#0000FF"},{name:"Yellow",hex:"#FFFF00"},{name:"Green",hex:"#00FF00"},{name:"Orange",hex:"#FFA500"},{name:"Purple",hex:"#800080"},{name:"Pink",hex:"#FFC0CB"},{name:"Brown",hex:"#8B4513"},{name:"Black",hex:"#000000"},{name:"White",hex:"#FFFFFF"}]}];function Aa({bootstrap:ie={}}){const[s,u]=Ie.useState("#000000"),[l,p]=Ie.useState([]),[w,x]=Ie.useState("selection");Ie.useEffect(()=>{try{const k=localStorage.getItem("inkwise:recentColors");k&&p(JSON.parse(k))}catch{}},[]);const A=k=>{try{const C=[k,...l.filter(j=>j!==k)].slice(0,12);p(C),localStorage.setItem("inkwise:recentColors",JSON.stringify(C))}catch{}},S=(k,C="selection")=>{if(!k)return;u(k),A(k);const j=typeof window<"u"?window.inkwiseToolbar:null;if(C==="selection"){if(j&&typeof j.setColor=="function")try{j.setColor(k)}catch{}try{window.dispatchEvent(new CustomEvent("inkwise:color-selected",{detail:{color:k}})),window.dispatchEvent(new CustomEvent("inkwise:text-style-changed",{detail:{attribute:"fill",value:k}}))}catch{}}else{try{window.dispatchEvent(new CustomEvent("inkwise:color-selected",{detail:{color:k}}))}catch{}if(C==="front"||C==="back"||C==="both")try{window.dispatchEvent(new CustomEvent("inkwise:apply-background",{detail:{side:C,color:k}}))}catch{}}try{if(C==="front"||C==="back"||C==="both"){const ce=document.getElementById("colors-modal");if(ce){ce.setAttribute("aria-hidden","true"),ce.classList.remove("is-open");const pe=document.querySelector('.sidenav-btn[data-nav="colors"]');pe&&pe.classList.remove("active")}}}catch{}};return b.jsx("div",{className:"colors-panel-react",style:{fontFamily:"system-ui, sans-serif",padding:10},children:b.jsxs("div",{className:"colors-panel-inner",style:{display:"grid",gap:12},children:[b.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:b.jsx("div",{style:{fontWeight:600},children:"Choose a color"})}),b.jsxs("div",{className:"colors-custom",style:{display:"flex",flexDirection:"column",gap:8},children:[b.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[b.jsx("label",{htmlFor:"colors-panel-custom",style:{fontSize:13},children:"Custom"}),b.jsx("input",{id:"colors-panel-custom",type:"color",value:s,onChange:k=>{u(k.target.value),S(k.target.value,w)},style:{width:44,height:32,padding:0,border:"none",background:"transparent"}}),b.jsx("input",{type:"text",value:s,onChange:k=>u(k.target.value),onKeyDown:k=>{k.key==="Enter"&&S(k.currentTarget.value||s,w)},onBlur:k=>S(k.currentTarget.value||s,w),style:{marginLeft:6,width:110}})]}),b.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[b.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[b.jsx("input",{type:"radio",name:"applyTarget",value:"selection",checked:w==="selection",onChange:()=>x("selection")}),b.jsx("span",{style:{fontSize:13},children:"Selection"})]}),b.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[b.jsx("input",{type:"radio",name:"applyTarget",value:"front",checked:w==="front",onChange:()=>x("front")}),b.jsx("span",{style:{fontSize:13},children:"Front background"})]}),b.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[b.jsx("input",{type:"radio",name:"applyTarget",value:"back",checked:w==="back",onChange:()=>x("back")}),b.jsx("span",{style:{fontSize:13},children:"Back background"})]}),b.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[b.jsx("input",{type:"radio",name:"applyTarget",value:"both",checked:w==="both",onChange:()=>x("both")}),b.jsx("span",{style:{fontSize:13},children:"Both"})]})]})]}),Sa.map(k=>b.jsxs("div",{style:{display:"block"},children:[b.jsx("div",{style:{marginBottom:6,fontSize:12,color:"#444"},children:k.label}),b.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:8,marginBottom:10},children:k.colors.map(({name:C,hex:j})=>b.jsx("button",{type:"button","aria-label":`${C} ${j}`,className:"color-swatch",title:`${C} â€” ${j}`,style:{background:j,width:"100%",height:36,borderRadius:6,border:s.toLowerCase()===j.toLowerCase()?"2px solid #000":"1px solid rgba(0,0,0,0.06)"},onClick:()=>S(j,w)},j))})]},k.label)),l.length>0&&b.jsxs("div",{children:[b.jsx("div",{style:{marginBottom:6,fontSize:12,color:"#444"},children:"Recent"}),b.jsx("div",{className:"recent-grid",style:{display:"flex",gap:8,flexWrap:"wrap"},children:l.map(k=>b.jsx("button",{type:"button","aria-label":`Recent ${k}`,className:"color-swatch",style:{background:k,width:36,height:36,borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"},onClick:()=>S(k,w)},k))})]})]})})}function ka({bootstrap:ie={}}){const[s,u]=Ie.useState([]),[l,p]=Ie.useState([]),[w,x]=Ie.useState(!1),[A,S]=Ie.useState(!1),[k,C]=Ie.useState(null),[j,ce]=Ie.useState(null),[pe,G]=Ie.useState({}),z=Ie.useRef(null),U=["Arial, sans-serif","Helvetica, sans-serif","Times New Roman, serif","Georgia, serif","Verdana, sans-serif","Courier New, monospace","Impact, sans-serif","Comic Sans MS, cursive","Poppins, sans-serif","Montserrat, sans-serif","Playfair Display, serif","Lora, serif","Raleway, sans-serif","Great Vibes, cursive","Pacifico, cursive","Cormorant Garamond, serif","Open Sans, sans-serif","Bebas Neue, cursive","Allura, cursive","Alex Brush, cursive","Dancing Script, cursive","Cinzel, serif","Abril Fatface, cursive","Cormorant SC, serif","Libre Baskerville, serif","Crimson Text, serif","Josefin Sans, sans-serif","Tangerine, cursive"],H=[8,10,12,14,16,18,20,24,28,32,36,48,60,72];Ie.useEffect(()=>{const v=ue=>{const Se=(ue==null?void 0:ue.detail)||{};Se.type==="text"&&Se.key?C(Se.key):C(null)};window.addEventListener("inkwise:active-element",v),X();const $=document.getElementById("template-editor-container-front"),Z=document.getElementById("template-editor-container-back"),D={childList:!0,subtree:!0},Ee=ue=>{let Se=!1;ue.forEach(Fe=>{Fe.type==="childList"&&Fe.addedNodes.forEach(ge=>{(ge.nodeName==="svg"||ge.querySelector&&ge.querySelector("svg"))&&(Se=!0)})}),Se&&setTimeout(X,100)},Y=new MutationObserver(Ee),ae=new MutationObserver(Ee);$&&Y.observe($,D),Z&&ae.observe(Z,D);const de=setInterval(()=>{const ue=document.querySelector("#template-editor-container-front svg"),Se=document.querySelector("#template-editor-container-back svg"),Fe=ue?ue.querySelectorAll("text").length:0,ge=Se?Se.querySelectorAll("text").length:0;(Fe!==s.length||ge!==l.length)&&X()},1e3),ne=()=>{setTimeout(X,50)};window.addEventListener("inkwise:text-changed",ne);const me=()=>{setTimeout(X,100)};document.addEventListener("show.bs.modal",me);const oe=ue=>{z.current&&!z.current.contains(ue.target)&&ce(null)};return document.addEventListener("mousedown",oe),()=>{window.removeEventListener("inkwise:active-element",v),window.removeEventListener("inkwise:text-changed",ne),document.removeEventListener("show.bs.modal",me),document.removeEventListener("mousedown",oe),Y.disconnect(),ae.disconnect(),clearInterval(de)}},[s.length,l.length]);const X=()=>{const v=document.querySelector("#template-editor-container-front svg"),$=document.querySelector("#template-editor-container-back svg"),Z=v?Array.from(v.querySelectorAll("text")):[],D=$?Array.from($.querySelectorAll("text")):[],Ee=Z.map((de,ne)=>({key:de.getAttribute("data-preview-node")||de.id||`front-text-${ne}`,label:de.getAttribute("data-preview-label")||`Front Text ${ne+1}`,value:de.textContent||"",element:de})),Y=D.map((de,ne)=>({key:de.getAttribute("data-preview-node")||de.id||`back-text-${ne}`,label:de.getAttribute("data-preview-label")||`Back Text ${ne+1}`,value:de.textContent||"",element:de})),ae={};Ee.forEach((de,ne)=>{const me=`front-${ne}`;ae[me]={"font-weight":de.element.getAttribute("font-weight")||"normal","font-style":de.element.getAttribute("font-style")||"normal"}}),Y.forEach((de,ne)=>{const me=`back-${ne}`;ae[me]={"font-weight":de.element.getAttribute("font-weight")||"normal","font-style":de.element.getAttribute("font-style")||"normal"}}),G(ae),u(Ee),p(Y)},_=(v,$,Z)=>{const D=v==="front"?[...s]:[...l];D[$].value=Z,D[$].element.textContent=Z,v==="front"?u(D):p(D),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{key:D[$].key,value:Z}}))},P=(v,$,Z,D)=>{const Ee=v==="front"?[...s]:[...l],Y=Ee[$].element;Y&&(Z==="font-family"?(Y.setAttribute("font-family",D),Y.style.fontFamily=D):Z==="font-size"?(Y.setAttribute("font-size",D),Y.style.fontSize=`${D}px`):Z==="fill"?(Y.setAttribute("fill",D),Y.style.fill=D):Z==="font-weight"?(Y.setAttribute("font-weight",D),Y.style.fontWeight=D):Z==="font-style"?(Y.setAttribute("font-style",D),Y.style.fontStyle=D):Z==="text-anchor"&&Y.setAttribute("text-anchor",D)),window.dispatchEvent(new CustomEvent("inkwise:text-style-changed",{detail:{attribute:Z,value:D,key:Ee[$].key}}));const ae=`${v}-${$}`;G(de=>({...de,[ae]:{...de[ae],[Z]:D}}))},re=(v,$)=>{const D=(v==="front"?[...s]:[...l])[$];D&&D.element&&(D.element.remove(),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{action:"delete",key:D.key}})),setTimeout(X,10))},De=v=>{const $=v==="front"?"template-editor-container-front":"template-editor-container-back",Z=document.querySelector(`#${$} svg`);if(!Z){console.warn(`[TextFieldsPanel] No SVG root found for ${v} side`);return}const D=Date.now(),Ee=Math.random().toString(36).slice(2,5),Y=`custom_${D}_${Ee}`,ae=document.createElementNS("http://www.w3.org/2000/svg","text");ae.setAttribute("id",Y),ae.setAttribute("data-preview-node",Y),ae.setAttribute("data-default-text","NEW TEXT"),ae.setAttribute("x","50%"),ae.setAttribute("y","50%"),ae.setAttribute("text-anchor","middle"),ae.setAttribute("dominant-baseline","middle"),ae.setAttribute("font-family","Arial, sans-serif"),ae.setAttribute("font-size","24"),ae.setAttribute("fill","#000000"),ae.textContent="NEW TEXT",ae.addEventListener("input",()=>{ae.dataset.currentText=ae.textContent||"",window.inkwiseToolbar&&typeof window.inkwiseToolbar.scheduleOverlaySync=="function"&&window.inkwiseToolbar.scheduleOverlaySync()}),ae.addEventListener("click",()=>{window.dispatchEvent(new CustomEvent("inkwise:active-element",{detail:{type:"text",key:Y}}))}),Z.appendChild(ae);const de={key:Y,label:"Custom",value:"NEW TEXT",element:ae};v==="front"?u(ne=>[...ne,de]):p(ne=>[...ne,de]),window.dispatchEvent(new CustomEvent("inkwise:text-changed",{detail:{key:Y,value:"NEW TEXT"}})),setTimeout(X,50),window.inkwiseToolbar&&typeof window.inkwiseToolbar.scheduleOverlaySync=="function"&&window.inkwiseToolbar.scheduleOverlaySync()},Ue=({side:v,field:$,index:Z})=>{const D=$.element,Ee=`${v}-${Z}`,Y=pe[Ee]||{},ae=(D==null?void 0:D.getAttribute("font-family"))||"Arial, sans-serif",de=parseInt((D==null?void 0:D.getAttribute("font-size"))||"24"),ne=(D==null?void 0:D.getAttribute("fill"))||"#000000",me=Y["font-weight"]||(D==null?void 0:D.getAttribute("font-weight"))||"normal",oe=Y["font-style"]||(D==null?void 0:D.getAttribute("font-style"))||"normal",ue=(D==null?void 0:D.getAttribute("text-anchor"))||"middle",Se=j&&j.side===v&&j.index===Z,Fe=ge=>{P(v,Z,"font-family",ge),ce(null)};return b.jsxs("div",{className:"controls-row",children:[b.jsx("select",{value:de,onChange:ge=>P(v,Z,"font-size",ge.target.value),className:"size-select",children:H.map(ge=>b.jsx("option",{value:ge,children:ge},ge))}),b.jsx("input",{type:"color",value:ne,onChange:ge=>P(v,Z,"fill",ge.target.value),className:"color-picker"}),b.jsx("button",{onClick:()=>P(v,Z,"font-weight",me==="bold"?"normal":"bold"),className:`style-btn bold-toggle-btn ${me==="bold"?"active":""}`,title:me==="bold"?"Remove bold formatting":"Make text bold",children:"B"}),b.jsx("button",{onClick:()=>P(v,Z,"font-style",oe==="italic"?"normal":"italic"),className:`style-btn italic-btn ${oe==="italic"?"active":""}`,title:"Toggle italic",children:"I"}),b.jsx("div",{className:"align-group",children:[{value:"start",label:"L"},{value:"middle",label:"C"},{value:"end",label:"R"}].map(ge=>b.jsx("button",{onClick:()=>P(v,Z,"text-anchor",ge.value),className:`align-btn ${ue===ge.value?"active":""}`,children:ge.label},ge.value))}),b.jsxs("div",{className:"font-selector-container",children:[b.jsxs("button",{type:"button",className:"font-select-button",onClick:()=>ce(Se?null:{side:v,index:Z}),"aria-label":"Choose font family","aria-haspopup":"listbox","aria-expanded":Se,children:[b.jsx("span",{style:{fontFamily:ae},children:ae.split(",")[0]}),b.jsx("i",{className:"fa-solid fa-chevron-down","aria-hidden":"true"})]}),Se&&b.jsx("div",{className:"font-modal",ref:z,children:b.jsx("div",{className:"font-modal-content",children:U.map(ge=>b.jsx("button",{type:"button",className:"font-option",onClick:()=>Fe(ge),style:{fontFamily:ge},children:ge.split(",")[0]},ge))})})]})]})};return b.jsxs("div",{className:"text-fields-panel-react",children:[b.jsxs("div",{className:"text-section",style:{marginBottom:20},children:[b.jsxs("button",{onClick:()=>x(!w),className:"section-toggle-btn",children:["Front Text Fields",b.jsx("span",{children:w?"â–¶":"â–¼"})]}),!w&&b.jsxs("div",{className:"section-content",children:[s.map((v,$)=>b.jsxs("div",{className:`field-card ${k===v.key?"active":""}`,children:[b.jsxs("div",{className:"field-header",children:[b.jsx("div",{className:"field-label",children:v.label}),b.jsx("button",{onClick:()=>re("front",$),className:"delete-field-btn",title:"Delete this text field",children:"Ã—"})]}),b.jsx("input",{type:"text",value:v.value,onChange:Z=>_("front",$,Z.target.value),onFocus:()=>C(v.key),onBlur:()=>C(null),className:"text-input"}),b.jsx(Ue,{side:"front",field:v,index:$})]},v.key)),b.jsxs("button",{onClick:()=>De("front"),className:"add-section-field-btn",children:[b.jsx("span",{children:"+"}),"New Front Text Field"]})]})]}),b.jsxs("div",{className:"text-section",style:{marginBottom:20},children:[b.jsxs("button",{onClick:()=>S(!A),className:"section-toggle-btn",children:["Back Text Fields",b.jsx("span",{children:A?"â–¶":"â–¼"})]}),!A&&b.jsxs("div",{className:"section-content",children:[l.map((v,$)=>b.jsxs("div",{className:`field-card ${k===v.key?"active":""}`,children:[b.jsxs("div",{className:"field-header",children:[b.jsx("div",{className:"field-label",children:v.label}),b.jsx("button",{onClick:()=>re("back",$),className:"delete-field-btn",title:"Delete this text field",children:"Ã—"})]}),b.jsx("input",{type:"text",value:v.value,onChange:Z=>_("back",$,Z.target.value),onFocus:()=>C(v.key),onBlur:()=>C(null),className:"text-input"}),b.jsx(Ue,{side:"back",field:v,index:$})]},v.key)),b.jsxs("button",{onClick:()=>De("back"),className:"add-section-field-btn",children:[b.jsx("span",{children:"+"}),"New Back Text Field"]})]})]})]})}const Ea=["1.png","2.png","3.png","4.png","5.png","6.png","7.png","8.png","9.png","10.png","e.png","f.png","h.png","r.png"];function Ca({bootstrap:ie={}}){const[s,u]=Ie.useState(null),[l,p]=Ie.useState("front"),w=x=>{u(x);const A=`/customerVideo/studio/${x}`;window.dispatchEvent(new CustomEvent("inkwise:graphic-selected",{detail:{category:"studio-images",item:{id:x,name:x,thumbnail:A,full:A,type:"image",source:"studio"},side:l}})),window.dispatchEvent(new CustomEvent("inkwise:apply-background",{detail:{side:l,image:A,type:"image"}}))};return b.jsxs("div",{className:"graphics-panel-react",children:[b.jsxs("div",{className:"graphics-header",children:[b.jsx("h3",{children:"Graphics Library"}),b.jsxs("div",{className:"graphics-side-toggle",children:[b.jsx("button",{className:`side-toggle-btn ${l==="front"?"active":""}`,onClick:()=>p("front"),children:"Front"}),b.jsx("button",{className:`side-toggle-btn ${l==="back"?"active":""}`,onClick:()=>p("back"),children:"Back"})]})]}),b.jsx("div",{className:"graphics-content-scroll",children:b.jsx("div",{className:"graphics-items-grid",children:Ea.map(x=>b.jsxs("div",{className:`graphics-item-card ${s===x?"selected":""}`,onClick:()=>w(x),children:[b.jsxs("div",{className:"item-preview",children:[b.jsx("img",{src:`/customerVideo/studio/${x}`,alt:x,loading:"lazy",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),b.jsx("div",{className:"item-fallback-icon",style:{display:"none"},children:b.jsx("i",{className:"fa-solid fa-image"})})]}),b.jsx("div",{className:"item-action",children:b.jsx("i",{className:"fa-solid fa-plus"})}),b.jsx("div",{className:"item-name",children:x})]},x))})})]})}function Yt(){const ie=document.getElementById("inkwise-customer-studio-bootstrap");if(ie)try{const s=JSON.parse(ie.textContent||"{}");if(s&&typeof s=="object")return typeof window<"u"&&(window.inkwiseStudioBootstrap=s),s}catch(s){console.error("[InkWise Studio] Failed to parse bootstrap payload.",s)}return typeof window<"u"&&window.inkwiseStudioBootstrap?window.inkwiseStudioBootstrap:{}}function Na({template:ie}){if(!ie)return b.jsx("span",{className:"studio-status__message",children:"Template data unavailable"});const s=ie.updated_at?new Date(ie.updated_at):null,u=s&&!Number.isNaN(s.getTime())?s.toLocaleString():"Not yet saved";return b.jsxs("div",{className:"studio-status__summary",children:[b.jsx("span",{className:"studio-status__template-name",title:ie.name||"Untitled Template",children:ie.name||"Untitled Template"}),ie.svg_path&&b.jsx("span",{className:"studio-status__badge studio-status__badge--svg",children:"SVG ready"}),ie.preview&&b.jsx("span",{className:"studio-status__badge studio-status__badge--preview",children:"Preview loaded"}),b.jsxs("span",{className:"studio-status__meta",children:["Updated: ",u]})]})}function Ia({bootstrap:ie,status:s}){const u=(ie==null?void 0:ie.template)??null,l=(ie==null?void 0:ie.product)??null,p=s==="ready"?"Design canvas ready":s==="initializing"?"Preparing editorâ€¦":s;return b.jsxs("div",{className:"studio-status",role:"status","aria-live":"polite",children:[b.jsxs("div",{className:"studio-status__header",children:[b.jsx("span",{className:"studio-status__dot","data-state":s}),b.jsx("span",{className:"studio-status__label",children:p})]}),b.jsx(Na,{template:u}),l&&b.jsxs("div",{className:"studio-status__product",children:["Editing: ",l.name||`Product #${l.id}`]})]})}function La(){const ie=Ie.useMemo(()=>Yt(),[]),[s,u]=Ie.useState("initializing"),[l,p]=Ie.useState(null);Ie.useEffect(()=>{if(typeof document>"u")return;const x=l==="text"||l==="image";return document.body.classList.toggle("text-toolbar-visible",!!x),()=>{document.body.classList.remove("text-toolbar-visible")}},[l]),Ie.useEffect(()=>{wa(),u("ready")},[]),Ie.useEffect(()=>{if(typeof window>"u")return;const x=S=>{const k=(S==null?void 0:S.detail)||{};p(k.type||null)};window.addEventListener("inkwise:active-element",x);const A=window.inkwiseToolbar;if(A&&typeof A.getSelection=="function")try{const S=A.getSelection();S&&S.type&&p(S.type)}catch(S){console.debug("[InkWise Studio] Unable to read initial toolbar selection.",S)}return()=>{window.removeEventListener("inkwise:active-element",x)}},[]),Ie.useEffect(()=>{if(typeof window>"u")return;const x=A=>{const{category:S,item:k,side:C}=A.detail||{};!k||!C||w(k,C,S)};return window.addEventListener("inkwise:graphic-selected",x),()=>{window.removeEventListener("inkwise:graphic-selected",x)}},[]);const w=(x,A,S)=>{var k,C,j,ce;try{const pe=document.querySelector(`#template-editor-container-${A}`);if(!pe){console.warn(`Canvas container for ${A} not found`);return}const G=pe.querySelector("svg");if(!G){console.warn(`SVG element for ${A} not found`);return}let z;if(S==="shapes"&&x.svg){const X=new DOMParser().parseFromString(x.svg,"image/svg+xml").documentElement;for(z=document.createElementNS("http://www.w3.org/2000/svg","g"),z.setAttribute("class","inkwise-graphic inkwise-shape"),z.setAttribute("data-graphic-type","shape"),z.setAttribute("data-graphic-source",x.source);X.firstChild;)z.appendChild(X.firstChild);const _=z.getBBox(),re=`translate(50, 50) scale(${Math.min(100/Math.max(_.width,_.height),1)})`;z.setAttribute("transform",re)}else if(x.thumbnail||x.full){const U=document.createElementNS("http://www.w3.org/2000/svg","g");U.setAttribute("class",`inkwise-graphic inkwise-${S.slice(0,-1)} inkwise-graphic-group`),U.setAttribute("data-graphic-type",S.slice(0,-1)),U.setAttribute("data-graphic-source",x.source);const H=document.createElementNS("http://www.w3.org/2000/svg","image");H.setAttribute("class","inkwise-graphic-image");const X=x.full||x.thumbnail;H.setAttributeNS("http://www.w3.org/1999/xlink","href",X);const _=((C=(k=G.viewBox)==null?void 0:k.baseVal)==null?void 0:C.width)||G.clientWidth||400,P=((ce=(j=G.viewBox)==null?void 0:j.baseVal)==null?void 0:ce.height)||G.clientHeight||300,re=Math.min(_,P)*.3,De=(_-re)/2,Ue=(P-re)/2;H.setAttribute("x",0),H.setAttribute("y",0),H.setAttribute("width",re),H.setAttribute("height",re),H.setAttribute("preserveAspectRatio","xMidYMid meet");const v=document.createElementNS("http://www.w3.org/2000/svg","rect");v.setAttribute("class","inkwise-bounding-box"),v.setAttribute("x",0),v.setAttribute("y",0),v.setAttribute("width",re),v.setAttribute("height",re),v.setAttribute("fill","none"),v.setAttribute("stroke","#3b82f6"),v.setAttribute("stroke-width","2"),v.setAttribute("stroke-dasharray","5,5"),v.setAttribute("opacity","0"),v.setAttribute("pointer-events","none");const $=[];[{x:0,y:0,cursor:"nw-resize"},{x:re,y:0,cursor:"ne-resize"},{x:re,y:re,cursor:"se-resize"},{x:0,y:re,cursor:"sw-resize"}].forEach((de,ne)=>{const me=document.createElementNS("http://www.w3.org/2000/svg","circle");me.setAttribute("class","inkwise-resize-handle"),me.setAttribute("cx",de.x),me.setAttribute("cy",de.y),me.setAttribute("r","6"),me.setAttribute("fill","#3b82f6"),me.setAttribute("stroke","white"),me.setAttribute("stroke-width","2"),me.setAttribute("style",`cursor: ${de.cursor}; opacity: 0; pointer-events: none;`),me.setAttribute("data-handle-index",ne),$.push(me)}),U.addEventListener("click",de=>{de.stopPropagation(),document.querySelectorAll(".inkwise-graphic-group").forEach(ne=>{ne.classList.remove("selected")}),U.classList.add("selected")});let D=!1,Ee,Y,ae;U.addEventListener("mousedown",de=>{if(de.target.classList.contains("inkwise-resize-handle"))return;D=!0,Ee=de.clientX,Y=de.clientY;const me=(U.getAttribute("transform")||"translate(0,0)").match(/translate\(([^,]+),\s*([^)]+)\)/);me?ae={x:parseFloat(me[1]),y:parseFloat(me[2])}:ae={x:0,y:0},de.preventDefault()}),document.addEventListener("mousemove",de=>{if(!D)return;const ne=de.clientX-Ee,me=de.clientY-Y,oe=ae.x+ne,ue=ae.y+me;U.setAttribute("transform",`translate(${oe}, ${ue})`)}),document.addEventListener("mouseup",()=>{D=!1}),$.forEach((de,ne)=>{let me=!1,oe,ue,Se,Fe;de.addEventListener("mousedown",ge=>{me=!0,oe=ge.clientX,ue=ge.clientY;const je=(U.getAttribute("transform")||"translate(0,0)").match(/translate\(([^,]+),\s*([^)]+)\)/);Fe=je?{x:parseFloat(je[1]),y:parseFloat(je[2])}:{x:0,y:0},Se=parseFloat(v.getAttribute("width")),ge.preventDefault(),ge.stopPropagation()}),document.addEventListener("mousemove",ge=>{if(!me)return;const qe=ge.clientX-oe,je=ge.clientY-ue;let Ve=Se;switch(ne){case 0:Ve=Math.max(20,Se-Math.max(qe,je));break;case 1:Ve=Math.max(20,Se+qe);break;case 2:Ve=Math.max(20,Se+Math.max(qe,je));break;case 3:Ve=Math.max(20,Se+je);break}v.setAttribute("width",Ve),v.setAttribute("height",Ve),H.setAttribute("width",Ve),H.setAttribute("height",Ve);const et=[{x:0,y:0},{x:Ve,y:0},{x:Ve,y:Ve},{x:0,y:Ve}];$.forEach((mt,kt)=>{mt.setAttribute("cx",et[kt].x),mt.setAttribute("cy",et[kt].y)})}),document.addEventListener("mouseup",()=>{me=!1})}),z=U}if(z){if(G.appendChild(z),window.inkwiseEditors&&window.inkwiseEditors[A]){const U=window.inkwiseEditors[A];U&&typeof U.refreshInteractiveElements=="function"&&U.refreshInteractiveElements()}window.dispatchEvent(new CustomEvent("inkwise:canvas-changed",{detail:{side:A,action:"graphic-added",element:z}})),console.log(`Added ${S} graphic to ${A} canvas:`,x.name)}}catch(pe){console.error("Error adding graphic to canvas:",pe)}};return!ie||Object.keys(ie).length===0?null:b.jsx("div",{className:"studio-status-wrapper",children:b.jsx(Ia,{bootstrap:ie,status:s})})}function Ta(){const ie=()=>{const s=document.getElementById("inkwise-customer-studio-root");if(!s)return;Vt.createRoot(s).render(b.jsx(Xt.StrictMode,{children:b.jsx(La,{})}));try{const l=document.getElementById("template-editor-root");if(l){const p=Yt();Vt.createRoot(l).render(b.jsx(Xt.StrictMode,{children:b.jsx(xa,{bootstrap:p})}))}}catch(l){console.debug("[InkWise Studio] Failed to mount TemplateEditor",l)}try{const l=document.getElementById("colors-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(b.jsx(Xt.StrictMode,{children:b.jsx(Aa,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount ColorsPanel",l)}try{const l=document.getElementById("text-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(b.jsx(Xt.StrictMode,{children:b.jsx(ka,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount TextFieldsPanel",l)}try{const l=document.getElementById("graphics-modal");l&&Vt.createRoot(l.querySelector(".modal-content")||l).render(b.jsx(Xt.StrictMode,{children:b.jsx(Ca,{bootstrap:Yt()})}))}catch(l){console.debug("[InkWise Studio] Failed to mount GraphicsPanel",l)}};if(document.readyState==="complete"||document.readyState==="interactive"){ie();return}document.addEventListener("DOMContentLoaded",ie,{once:!0})}Ta();
